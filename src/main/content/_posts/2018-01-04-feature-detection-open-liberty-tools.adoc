---
layout: post
title:  "How feature detection in Open Liberty Tools works (and how to disable it)"
date:   2018-01-04 12:05:00 +0100
categories: news
---

:description: Learn how Open Liberty Tools determines what features to add to the server configuration when you deploy your application and how to disable it when needed.

## How does Open Liberty Tools decide what features your application needs

When you deploy an application to a Liberty server using Open Liberty Tools (OLT) it attempts to detect what features your application needs and add them to the server configuration automatically.  This applies to the entire application that is being deployed.  If you are deploying an EAR project that includes several web projects in its deployment assembly then OLT looks at all of these projects.  It considers the following:

* The facets that are set on the application projects.
* For CDI, OLT inspects the `beans.xml` file.  It looks at the version, if specified, otherwise it looks at the schema version.
* To decide if the JSP feature is needed, OLT checks for files with the following extensions: `.jsp`, `.jspf`, `.jsw`, `.jsv` and `.jspx`.
* For JSF, OLT looks for the existence of a `WEB-INF/faces-config.xml` file.
* OLT looks for certain resource references in the `web.xml` to decide if the JDBC or a JMS feature is needed.
* Finally, OLT looks at all of the Java imports in all of the application projects and tries to map them to features.  For example, if there is an import for `javax.persistence` then OLT will add the JPA feature to the server configuration.

Some of the above have version information (such as facets) and they are given higher priority then Java imports, for example, which have no version information.  If OLT determines that a feature is needed but there is no information about which version of the feature to use it will add the latest version.

To see what features OLT has detected for an application, right click on the application projects and select *Properties* > *Liberty* > *Required Features*.  A dialog shows you the features and also allows you to modify whether the feature is added to the server configuration or not.  If you do not see any features, make sure that your project is targeted to a Liberty runtime.  To check this, right click on the project and select *Properties* > *Targeted Runtimes*.  Make sure a Liberty runtime is selected.  Also, some projects, such as ears, don't usually have any required features so the dialog can be empty for these projects as well.

image::/img/blog_feature_detection_required_features.png

## Handling feature conflicts 

If OLT adds a feature to the server configuration that conflicts with an existing feature it will display a feature conflict dialog to allow you to resolve the conflict.  If, for example, your server configuration has the `servlet-3.0` feature enabled and you deploy a web 3.1 project with a jsp to the server you will see a dialog similar to the one below.  The `jsp-2.3` feature added by OLT conflicts with the existing `servlet-3.0` feature.  Select features in the dialog to see what other features they enable to understand how they conflict.  The `jsp-2.3` feature enables the `servlet-3.1` feature which conflicts with `servlet-3.0`.  The easiest way to fix this is to select the `servlet-3.0` feature and click *Remove*.

image::/img/blog_feature_detection_confict_dialog.png

OLT also detects existing feature conflicts within the server configuration and will show a warning in the `Markers` view such as: 'servlet-3.0' and ['jsp-2.3' --> 'servlet-3.1'] features are in conflict. Select a compatible set of features.

For more information see the WebSphere Liberty Knowledge Center doc on https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/rwlp_prog_model_supported_combos.html[Supported Java EE 6 and 7 feature combinations].

## Some things OLT does not do

If OLT determines that more than one feature will satisfy a requirement (such as more than one feature providing the same package specified in a Java import) then OLT will not add the feature since it does not know which one to add.

OLT cannot detect if an application has its own implementation of a feature such as its own JPA provider, and will still add the feature to the server configuration.  This is why it is useful to know how to disable feature detection when needed.

## How to disable feature detection in Open Liberty Tools

The required features dialog that was mentioned earlier can be used to prevent OLT from adding particular features.   Click on the arrow in the `Action` column and change the action from `Always add` to one of `Prompt before adding` or `Never add`.  Remember to check all of the projects that make up the application to catch all the places that might cause the feature to be added.

To disable feature detection on a more global basis go to *Window* > *Preferences* > *Server* > *Liberty Server*.  Here you can disable feature detection altogether or just change the default action from `Always add` to one of `Prompt before adding` or `Never add`.

Some features have a `container` version of the feature which tells both Open Liberty and OLT that the implementation of the feature is provided in the application.  If `jpaContainer-2.1` is already enabled in the server configuration, for example, OLT will not add the `jpa-2.1` feature.  Other examples are `jsfContainer`, `jsonbContainer`, and `jsonpContainer`.

For more info, see the WebSphere Liberty Knowledge Center docs on https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/t_customize_auto_feat.html[Customizing automatic feature detection] and https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/t_disable_auto_feat.html[Disabling automatic feature detection].

