<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      Monitoring the metrics of Java microservices using Eclipse MicroProfile Metrics
    
  </title>
  <meta name="description" content="A getting started tutorial and an example on how to expose system and application metrics from Java microservices and monitor metrics endpoints using Eclipse MicroProfile Metrics.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/microprofile-metrics">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="Monitoring the metrics of Java microservices using Eclipse MicroProfile Metrics" />
  <meta name="twitter:description" content="A getting started tutorial and an example on how to expose system and application metrics from Java microservices and monitor metrics endpoints using Eclipse MicroProfile Metrics." />

  <meta property='og:title' content="Monitoring the metrics of Java microservices using Eclipse MicroProfile Metrics" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="A getting started tutorial and an example on how to expose system and application metrics from Java microservices and monitor metrics endpoints using Eclipse MicroProfile Metrics." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/microprofile-metrics" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li><a href="#what-youll-learn">What you’ll learn</a></li>
<li>
<a href="#getting-started">Getting started</a>
<ul class="sectlevel2">
<li><a href="#try-what-youll-build">Try what you’ll build</a></li>
</ul>
</li>
<li>
<a href="#adding-microprofile-metrics-to-the-inventory-service">Adding MicroProfile Metrics to the inventory service</a>
<ul class="sectlevel2">
<li><a href="#adding-the-annotations">Adding the annotations</a></li>
</ul>
</li>
<li><a href="#enabling-vendor-metrics-for-the-microservices">Enabling vendor metrics for the microservices</a></li>
<li><a href="#building-and-running-the-application">Building and running the application</a></li>
<li>
<a href="#testing-the-metrics">Testing the metrics</a>
<ul class="sectlevel2">
<li><a href="#running-the-tests">Running the tests</a></li>
</ul>
</li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">Providing metrics from a microservice</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">15 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="https://openliberty.io/guides/microprofile-metrics.html">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You’ll explore how to provide system and application metrics from a microservice with MicroProfile Metrics.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will learn how to use MicroProfile Metrics to provide metrics from a microservice. You can monitor metrics to determine the performance and health of a service. You can also use them to pinpoint issues, collect data for capacity planning, or to decide when to scale a service to run with more or fewer resources.</p>
</div>
<div class="paragraph">
<p>The application that you will work with is an <code>inventory</code> service that stores information about various systems. The <code>inventory</code> service communicates with the <code>system</code> service on a particular host to retrieve its system properties when necessary.</p>
</div>
<div class="paragraph">
<p>You will use annotations provided by MicroProfile Metrics to instrument the <code>inventory</code> service to provide application-level metrics data. You will add counter, gauge, and timer metrics to the service.</p>
</div>
<div class="paragraph">
<p>You will also check well-known REST endpoints that are defined by MicroProfile Metrics to review the metrics data collected. Monitoring agents can access these endpoints to collect metrics.</p>
</div>
</div>
</div>
<div class="sect1 command">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to work through this guide is to clone the <a href="https://github.com/openliberty/guide-microprofile-metrics.git" target="_blank" rel="noopener noreferrer">Git repository</a> and use the projects that are provided inside:</p>
</div>
<div id="git_clone" class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-microprofile-metrics.git
cd guide-microprofile-metrics</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory contains the starting project that you will build upon.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished project that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary <span class="prerequisites">prerequisites</span>.</p>
</div>
<div class="sect2 command">
<h3 id="try-what-youll-build">Try what you’ll build</h3>
<div class="paragraph">
<p>The <code>finish</code> directory in the root of this guide contains the finished application. Give it a try before you proceed.</p>
</div>
<div class="paragraph">
<p>To try out the application, first go to the <code>finish</code> directory and run the following Maven goal to build the application and deploy it to Open Liberty:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd finish
mvn liberty:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you see the following message, your Liberty instance is ready:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>The defaultServer server is ready to run a smarter planet.</pre>
</div>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9080/inventory/systems" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9080/inventory/systems</a> URL to access the <code>inventory</code> service. Because you just started the application, the inventory is empty. Access the <a href="http://localhost:9080/inventory/systems/localhost" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9080/inventory/systems/localhost</a> URL to add the localhost into the inventory.</p>
</div>
<div class="paragraph">
<p>Access the <code>inventory</code> service at the <a href="http://localhost:9080/inventory/systems" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9080/inventory/systems</a> URL at least once so that application metrics are collected. Otherwise, the metrics do not appear.</p>
</div>
<div class="paragraph">
<p>Next, point your browser to the <a href="https://localhost:9443/metrics" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9443/metrics</a> MicroProfile Metrics endpoint. Log in as the <code>admin</code> user with <code>adminpwd</code> as the password. You can see both the system and application metrics in a text format.</p>
</div>
<div class="paragraph">
<p>To see only the application metrics, point your browser to <a href="https://localhost:9443/metrics?scope=application" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:9443/metrics?scope=application</a>.</p>
</div>
<div class="paragraph">
<p>See the following sample outputs for the <code>@Timed</code>, <code>@Gauge</code>, and <code>@Counted</code> metrics:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE application_inventoryProcessingTime_rate_per_second gauge
application_inventoryProcessingTime_rate_per_second{method="get"} 0.0019189661542898407
...
# TYPE application_inventoryProcessingTime_seconds summary
# HELP application_inventoryProcessingTime_seconds Time needed to process the inventory
application_inventoryProcessingTime_seconds_count{method="get"} 1
application_inventoryProcessingTime_seconds{method="get",quantile="0.5"} 0.127965469
...
# TYPE application_inventoryProcessingTime_rate_per_second gauge
application_inventoryProcessingTime_rate_per_second{method="list"} 0.0038379320982686884
...
# TYPE application_inventoryProcessingTime_seconds summary
# HELP application_inventoryProcessingTime_seconds Time needed to process the inventory
application_inventoryProcessingTime_seconds_count{method="list"} 2
application_inventoryProcessingTime_seconds{method="list",quantile="0.5"} 2.2185000000000002E-5
...</pre>
</div>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE application_inventorySizeGauge gauge
# HELP application_inventorySizeGauge Number of systems in the inventory
application_inventorySizeGauge 1</pre>
</div>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE application_inventoryAccessCount_total counter
# HELP application_inventoryAccessCount_total Number of times the list of systems method is requested
application_inventoryAccessCount_total 1</pre>
</div>
</div>
<div class="paragraph">
<p>To see only the system metrics, point your browser to <a href="https://localhost:9443/metrics?scope=base" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:9443/metrics?scope=base</a>.</p>
</div>
<div class="paragraph">
<p>See the following sample output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE base_jvm_uptime_seconds gauge
# HELP base_jvm_uptime_seconds Displays the start time of the Java virtual machine in milliseconds. This attribute displays the approximate time when the Java virtual machine started.
base_jvm_uptime_seconds 30.342000000000002</pre>
</div>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE base_classloader_loadedClasses_count gauge
# HELP base_classloader_loadedClasses_count Displays the number of classes that are currently loaded in the Java virtual machine.
base_classloader_loadedClasses_count 11231</pre>
</div>
</div>
<div class="paragraph">
<p>To see only the vendor metrics, point your browser to <a href="https://localhost:9443/metrics?scope=vendor" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:9443/metrics?scope=vendor</a>.</p>
</div>
<div class="paragraph">
<p>See the following sample output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE vendor_threadpool_size gauge
# HELP vendor_threadpool_size The size of the thread pool.
vendor_threadpool_size{pool="Default_Executor"} 32</pre>
</div>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre># TYPE vendor_servlet_request_total counter
# HELP vendor_servlet_request_total The number of visits to this servlet from the start of the server.
vendor_servlet_request_total{servlet="microprofile_metrics_io_openliberty_guides_inventory_InventoryApplication"} 1</pre>
</div>
</div>
<div class="paragraph">
<p>After you are finished checking out the application, stop the Liberty instance by pressing <code>CTRL+C</code> in the command-line session where you ran Liberty. Alternatively, you can run the <code>liberty:stop</code> goal from the <code>finish</code> directory in another shell session:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn liberty:stop</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-microprofile-metrics-to-the-inventory-service">Adding MicroProfile Metrics to the inventory service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>pom.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers">  1</span><span class="preprocessor">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="line-numbers">  2</span><span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">  3</span>
<span class="line-numbers">  4</span>  <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>
<span class="line-numbers">  5</span>
<span class="line-numbers">  6</span>  <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">  7</span>  <span class="tag">&lt;artifactId&gt;</span>guide-microprofile-metrics<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">  8</span>  <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">  9</span>  <span class="tag">&lt;packaging&gt;</span>war<span class="tag">&lt;/packaging&gt;</span>
<span class="line-numbers"> 10</span>
<span class="line-numbers"> 11</span>  <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers"> 12</span>    <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
<span class="line-numbers"> 13</span>    <span class="tag">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.reporting.outputEncoding&gt;</span>
<span class="line-numbers"> 14</span>    <span class="tag">&lt;maven.compiler.source&gt;</span>11<span class="tag">&lt;/maven.compiler.source&gt;</span>
<span class="line-numbers"> 15</span>    <span class="tag">&lt;maven.compiler.target&gt;</span>11<span class="tag">&lt;/maven.compiler.target&gt;</span>
<span class="line-numbers"> 16</span>    <span class="comment">&lt;!-- Liberty configuration --&gt;</span>
<span class="line-numbers"> 17</span>    <span class="tag">&lt;liberty.var.default.http.port&gt;</span>9080<span class="tag">&lt;/liberty.var.default.http.port&gt;</span>
<span class="line-numbers"> 18</span>    <span class="tag">&lt;liberty.var.default.https.port&gt;</span>9443<span class="tag">&lt;/liberty.var.default.https.port&gt;</span>
<span class="line-numbers"> 19</span>  <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span>  <span class="tag">&lt;dependencies&gt;</span>
<span class="line-numbers"> 22</span>    <span class="comment">&lt;!-- Provided dependencies --&gt;</span>
<span class="line-numbers"> 23</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 24</span>      <span class="tag">&lt;groupId&gt;</span>jakarta.platform<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 25</span>      <span class="tag">&lt;artifactId&gt;</span>jakarta.jakartaee-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 26</span>      <span class="tag">&lt;version&gt;</span>10.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 27</span>      <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 28</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 29</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 30</span>      <span class="tag">&lt;groupId&gt;</span>org.eclipse.microprofile<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 31</span>      <span class="comment">&lt;!-- tag::microprofile[] --&gt;</span>
<span class="line-numbers"> 32</span>      <span class="tag">&lt;artifactId&gt;</span>microprofile<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 33</span>      <span class="comment">&lt;!-- end::microprofile[] --&gt;</span>
<span class="line-numbers"> 34</span>      <span class="tag">&lt;version&gt;</span>6.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 35</span>      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers"> 36</span>      <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 37</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 38</span>    <span class="comment">&lt;!-- For tests --&gt;</span>
<span class="line-numbers"> 39</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 40</span>      <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 41</span>      <span class="tag">&lt;artifactId&gt;</span>junit-jupiter<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 42</span>      <span class="tag">&lt;version&gt;</span>5.9.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 43</span>      <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 44</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 45</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 46</span>      <span class="tag">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 47</span>      <span class="tag">&lt;artifactId&gt;</span>resteasy-client<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 48</span>      <span class="tag">&lt;version&gt;</span>6.2.3.Final<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 49</span>      <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 50</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 51</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 52</span>      <span class="tag">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 53</span>      <span class="tag">&lt;artifactId&gt;</span>resteasy-json-binding-provider<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 54</span>      <span class="tag">&lt;version&gt;</span>6.2.3.Final<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 55</span>      <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 56</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 57</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 58</span>      <span class="tag">&lt;groupId&gt;</span>org.glassfish<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 59</span>      <span class="tag">&lt;artifactId&gt;</span>jakarta.json<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 60</span>      <span class="tag">&lt;version&gt;</span>2.0.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 61</span>      <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 62</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 63</span>    <span class="comment">&lt;!-- Java utility classes --&gt;</span>
<span class="line-numbers"> 64</span>    <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 65</span>      <span class="tag">&lt;groupId&gt;</span>org.apache.commons<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 66</span>      <span class="tag">&lt;artifactId&gt;</span>commons-lang3<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 67</span>      <span class="tag">&lt;version&gt;</span>3.12.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 68</span>    <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 69</span>  <span class="tag">&lt;/dependencies&gt;</span>
<span class="line-numbers"> 70</span>
<span class="line-numbers"> 71</span>  <span class="tag">&lt;build&gt;</span>
<span class="line-numbers"> 72</span>    <span class="tag">&lt;finalName&gt;</span>${project.artifactId}<span class="tag">&lt;/finalName&gt;</span>
<span class="line-numbers"> 73</span>    <span class="tag">&lt;plugins&gt;</span>
<span class="line-numbers"> 74</span>      <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> 75</span>        <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 76</span>        <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 77</span>        <span class="tag">&lt;version&gt;</span>3.3.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 78</span>      <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers"> 79</span>      <span class="comment">&lt;!-- Plugin to run unit tests --&gt;</span>
<span class="line-numbers"> 80</span>      <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> 81</span>        <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 82</span>        <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 83</span>        <span class="tag">&lt;version&gt;</span>3.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 84</span>      <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers"> 85</span>      <span class="comment">&lt;!-- Enable liberty-maven plugin --&gt;</span>
<span class="line-numbers"> 86</span>      <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> 87</span>        <span class="tag">&lt;groupId&gt;</span>io.openliberty.tools<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 88</span>        <span class="tag">&lt;artifactId&gt;</span>liberty-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 89</span>        <span class="tag">&lt;version&gt;</span>3.8.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 90</span>      <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers"> 91</span>      <span class="comment">&lt;!-- Plugin to run functional tests --&gt;</span>
<span class="line-numbers"> 92</span>      <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> 93</span>        <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 94</span>        <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 95</span>        <span class="tag">&lt;version&gt;</span>3.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 96</span>        <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers"> 97</span>          <span class="tag">&lt;systemPropertyVariables&gt;</span>
<span class="line-numbers"> 98</span>            <span class="tag">&lt;http.port&gt;</span>${liberty.var.default.http.port}<span class="tag">&lt;/http.port&gt;</span>
<span class="line-numbers"> 99</span>            <span class="tag">&lt;https.port&gt;</span>${liberty.var.default.https.port}<span class="tag">&lt;/https.port&gt;</span>
<span class="line-numbers">100</span>            <span class="tag">&lt;javax.net.ssl.trustStore&gt;</span>${project.build.directory}/liberty/wlp/usr/servers/defaultServer/resources/security/key.jks<span class="tag">&lt;/javax.net.ssl.trustStore&gt;</span>
<span class="line-numbers">101</span>          <span class="tag">&lt;/systemPropertyVariables&gt;</span>
<span class="line-numbers">102</span>        <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">103</span>      <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">104</span>    <span class="tag">&lt;/plugins&gt;</span>
<span class="line-numbers">105</span>  <span class="tag">&lt;/build&gt;</span>
<span class="line-numbers">106</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to the <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>When you run Open Liberty in <a href="https://openliberty.io/docs/latest/development-mode.html" target="_blank" rel="noopener">dev mode</a>, dev mode listens for file changes and automatically recompiles and deploys your updates whenever you save a new change. Run the following goal to start Open Liberty in dev mode:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn liberty:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you see the following message, your Liberty instance is ready in dev mode:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
<div class="paragraph">
<p>Dev mode holds your command-line session to listen for file changes. Open another command-line session to continue, or open the project in your editor.</p>
</div>
<div class="paragraph">
<p>The MicroProfile Metrics API is included in the MicroProfile dependency specified by your <code class="hotspot file=0">pom.xml</code> file. Look for the dependency with the <code class="hotspot=microprofile file=0">microprofile</code> artifact ID. This dependency provides a library that allows you to use the MicroProfile Metrics API in your code to provide metrics from your microservices.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the Liberty <code>server.xml</code> configuration file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Sample Liberty server</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 2</span>
<span class="line-numbers"> 3</span>  <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;feature&gt;</span>restfulWS-3.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 5</span>    <span class="tag">&lt;feature&gt;</span>jsonp-2.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>    <span class="tag">&lt;feature&gt;</span>jsonb-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>    <span class="tag">&lt;feature&gt;</span>cdi-4.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>    <span class="tag">&lt;feature&gt;</span>mpConfig-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 9</span>   <span class="tag">&lt;feature&gt;</span>mpMetrics-5.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">10</span>   <span class="tag">&lt;feature&gt;</span>mpRestClient-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">11</span> <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>  <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">14</span>  <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>  <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">17</span>  <span class="comment">&lt;!-- tag::quickStartSecurity[] --&gt;</span>
<span class="line-numbers">18</span>  <span class="tag">&lt;quickStartSecurity</span> <span class="attribute-name">userName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="attribute-name">userPassword</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">19</span>  <span class="comment">&lt;!-- end::quickStartSecurity[] --&gt;</span>
<span class="line-numbers">20</span>  <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">"</span><span class="content">*</span><span class="delimiter">"</span></span> <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span>
<span class="line-numbers">21</span>      <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">22</span>  <span class="tag">&lt;webApplication</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">guide-microprofile-metrics.war</span><span class="delimiter">"</span></span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">23</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=mpMetrics file=1">mpMetrics</code> feature enables MicroProfile Metrics support in Open Liberty. Note that this feature requires SSL and the configuration has been provided for you.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=quickStartSecurity file=1">quickStartSecurity</code> configuration element provides basic security to secure the Liberty. When you visit the <code>/metrics</code> endpoint, use the credentials defined in the Liberty’s configuration to log in and view the data.</p>
</div>
<div class="sect2">
<h3 id="adding-the-annotations">Adding the annotations</h3>
<div class="listingblock code_command hotspot">
<div class="content">
<pre><mark>Replace the <code>InventoryManager</code> class.</mark>
<code>src/main/java/io/openliberty/guides/inventory/InventoryManager.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>InventoryManager.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2017, 2022 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="comment">// tag::InventoryManager[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.inventory</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.Collections</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 19</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.MetricUnits</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Counted</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Gauge</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Timed</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.inventory.model.InventoryList</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.inventory.model.SystemData</span>;
<span class="line-numbers"> 29</span>
<span class="line-numbers"> 30</span><span class="comment">// tag::ApplicationScoped[]</span>
<span class="line-numbers"> 31</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 32</span><span class="comment">// end::ApplicationScoped[]</span>
<span class="line-numbers"> 33</span><span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryManager</span> {
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span>  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;SystemData&gt; systems = <span class="predefined-type">Collections</span>.synchronizedList(<span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;());
<span class="line-numbers"> 36</span>  <span class="directive">private</span> InventoryUtils invUtils = <span class="keyword">new</span> InventoryUtils();
<span class="line-numbers"> 37</span>
<span class="line-numbers"> 38</span>  <span class="comment">// tag::timedForGet[]</span>
<span class="line-numbers"> 39</span>  <span class="comment">// tag::nameForGet[]</span>
<span class="line-numbers"> 40</span>  <span class="annotation">@Timed</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryProcessingTime</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 41</span>  <span class="comment">// end::nameForGet[]</span>
<span class="line-numbers"> 42</span>         <span class="comment">// tag::tagForGet[]</span>
<span class="line-numbers"> 43</span>         tags = {<span class="string"><span class="delimiter">"</span><span class="content">method=get</span><span class="delimiter">"</span></span>},
<span class="line-numbers"> 44</span>         <span class="comment">// end::tagForGet[]</span>
<span class="line-numbers"> 45</span>         <span class="comment">// tag::absoluteForGet[]</span>
<span class="line-numbers"> 46</span>         absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 47</span>         <span class="comment">// end::absoluteForGet[]</span>
<span class="line-numbers"> 48</span>         <span class="comment">// tag::desForGet[]</span>
<span class="line-numbers"> 49</span>         description = <span class="string"><span class="delimiter">"</span><span class="content">Time needed to process the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 50</span>         <span class="comment">// end::desForGet[]</span>
<span class="line-numbers"> 51</span>  <span class="comment">// end::timedForGet[]</span>
<span class="line-numbers"> 52</span>  <span class="comment">// tag::get[]</span>
<span class="line-numbers"> 53</span>  <span class="directive">public</span> <span class="predefined-type">Properties</span> get(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 54</span>    <span class="keyword">return</span> invUtils.getProperties(hostname);
<span class="line-numbers"> 55</span>  }
<span class="line-numbers"> 56</span>  <span class="comment">// end::get[]</span>
<span class="line-numbers"> 57</span>
<span class="line-numbers"> 58</span>  <span class="comment">// tag::timedForAdd[]</span>
<span class="line-numbers"> 59</span>  <span class="comment">// tag::nameForAdd[]</span>
<span class="line-numbers"> 60</span>  <span class="annotation">@Timed</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryAddingTime</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 61</span>  <span class="comment">// end::nameForAdd[]</span>
<span class="line-numbers"> 62</span>    <span class="comment">// tag::absoluteForAdd[]</span>
<span class="line-numbers"> 63</span>    absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 64</span>    <span class="comment">// end::absoluteForAdd[]</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::desForAdd[]</span>
<span class="line-numbers"> 66</span>    description = <span class="string"><span class="delimiter">"</span><span class="content">Time needed to add system properties to the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 67</span>    <span class="comment">// end::desForAdd[]</span>
<span class="line-numbers"> 68</span>  <span class="comment">// end::timedForAdd[]</span>
<span class="line-numbers"> 69</span>  <span class="comment">// tag::add[]</span>
<span class="line-numbers"> 70</span>  <span class="directive">public</span> <span class="type">void</span> add(<span class="predefined-type">String</span> hostname, <span class="predefined-type">Properties</span> systemProps) {
<span class="line-numbers"> 71</span>    <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 72</span>    props.setProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>, systemProps.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 73</span>    props.setProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>, systemProps.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 74</span>
<span class="line-numbers"> 75</span>    SystemData host = <span class="keyword">new</span> SystemData(hostname, props);
<span class="line-numbers"> 76</span>    <span class="keyword">if</span> (!systems.contains(host)) {
<span class="line-numbers"> 77</span>      systems.add(host);
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>  }
<span class="line-numbers"> 80</span>  <span class="comment">// end::add[]</span>
<span class="line-numbers"> 81</span>
<span class="line-numbers"> 82</span>  <span class="comment">// tag::timedForList[]</span>
<span class="line-numbers"> 83</span>  <span class="comment">// tag::nameForList[]</span>
<span class="line-numbers"> 84</span>  <span class="annotation">@Timed</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryProcessingTime</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 85</span>  <span class="comment">// end::nameForList[]</span>
<span class="line-numbers"> 86</span>         <span class="comment">// tag::tagForList[]</span>
<span class="line-numbers"> 87</span>         tags = {<span class="string"><span class="delimiter">"</span><span class="content">method=list</span><span class="delimiter">"</span></span>},
<span class="line-numbers"> 88</span>         <span class="comment">// end::tagForList[]</span>
<span class="line-numbers"> 89</span>         <span class="comment">// tag::absoluteForList[]</span>
<span class="line-numbers"> 90</span>         absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 91</span>         <span class="comment">// end::absoluteForList[]</span>
<span class="line-numbers"> 92</span>         <span class="comment">// tag::desForList[]</span>
<span class="line-numbers"> 93</span>         description = <span class="string"><span class="delimiter">"</span><span class="content">Time needed to process the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 94</span>         <span class="comment">// end::desForList[]</span>
<span class="line-numbers"> 95</span>  <span class="comment">// end::timedForList[]</span>
<span class="line-numbers"> 96</span>  <span class="comment">// tag::countedForList[]</span>
<span class="line-numbers"> 97</span>  <span class="annotation">@Counted</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryAccessCount</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 98</span>           absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 99</span>           description = <span class="string"><span class="delimiter">"</span><span class="content">Number of times the list of systems method is requested</span><span class="delimiter">"</span></span>)
<span class="line-numbers">100</span>  <span class="comment">// end::countedForList[]</span>
<span class="line-numbers">101</span>  <span class="comment">// tag::list[]</span>
<span class="line-numbers">102</span>  <span class="directive">public</span> InventoryList list() {
<span class="line-numbers">103</span>    <span class="keyword">return</span> <span class="keyword">new</span> InventoryList(systems);
<span class="line-numbers">104</span>  }
<span class="line-numbers">105</span>  <span class="comment">// end::list[]</span>
<span class="line-numbers">106</span>
<span class="line-numbers">107</span>  <span class="comment">// tag::gaugeForGetTotal[]</span>
<span class="line-numbers">108</span>  <span class="comment">// tag::unitForGetTotal[]</span>
<span class="line-numbers">109</span>  <span class="annotation">@Gauge</span>(unit = MetricUnits.NONE,
<span class="line-numbers">110</span>  <span class="comment">// end::unitForGetTotal[]</span>
<span class="line-numbers">111</span>         name = <span class="string"><span class="delimiter">"</span><span class="content">inventorySizeGauge</span><span class="delimiter">"</span></span>,
<span class="line-numbers">112</span>         absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers">113</span>         description = <span class="string"><span class="delimiter">"</span><span class="content">Number of systems in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">114</span>  <span class="comment">// end::gaugeForGetTotal[]</span>
<span class="line-numbers">115</span>  <span class="comment">// tag::getTotal[]</span>
<span class="line-numbers">116</span>  <span class="directive">public</span> <span class="type">int</span> getTotal() {
<span class="line-numbers">117</span>    <span class="keyword">return</span> systems.size();
<span class="line-numbers">118</span>  }
<span class="line-numbers">119</span>  <span class="comment">// end::getTotal[]</span>
<span class="line-numbers">120</span>}
<span class="line-numbers">121</span><span class="comment">// end::InventoryManager[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the <code class="hotspot=timedForGet">@Timed</code> annotation to the <code class="hotspot=get">get()</code> method,
and apply the <code class="hotspot=timedForList">@Timed</code> annotation to the <code class="hotspot=list">list()</code> method.</p>
</div>
<div class="paragraph">
<p>This annotation has these metadata fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=nameForGet hotspot=nameForList">name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. Use this field to name the metric.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=tagForGet hotspot=tagForList">tags</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. Use this field to add tags to the metric with the same <code class="hotspot=nameForGet hotspot=nameForList">name</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=absoluteForGet hotspot=absoluteForList">absolute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. Use this field to determine whether the metric name is the exact name that is specified in the <code class="hotspot=nameForGet hotspot=nameForList">name</code> field or that is specified with the package prefix.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=desForGet hotspot=desForList">description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. Use this field to describe the purpose of the metric.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>@Timed</code> annotation tracks how frequently the method is invoked and how long it takes for each invocation of the method to complete. Both the <code class="hotspot=get">get()</code> and <code class="hotspot=list">list()</code> methods are annotated with the <code>@Timed</code> metric and have the same <code class="hotspot=nameForGet hotspot=nameForList">inventoryProcessingTime</code> name. The <code class="hotspot=tagForGet">method=get</code> and <code class="hotspot=tagForList">method=list</code> tags add a dimension that uniquely identifies the collected metric data from the inventory processing time in getting the system properties.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code class="hotspot=tagForGet">method=get</code> tag identifies the <code class="hotspot=nameForGet">inventoryProcessingTime</code> metric that measures the elapsed time to get the system properties when you call the <code>system</code> service.</p>
</li>
<li>
<p>The <code class="hotspot=tagForList">method=list</code> tag identifies the <code class="hotspot=nameForList">inventoryProcessingTime</code> metric that measures the elapsed time for the <code>inventory</code> service to list all of the system properties in the inventory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tags allow you to query the metrics together or separately based on the functionality of the monitoring tool of your choice. The <code>inventoryProcessingTime</code> metrics for example could be queried to display an aggregate time of both tagged metrics or individual times.</p>
</div>
<div class="paragraph">
<p>Apply the <code class="hotspot=timedForAdd">@Timed</code> annotation to the <code class="hotspot=add">add()</code> method to track how frequently the method is invoked and how long it takes for each invocation of the method to complete.</p>
</div>
<div class="paragraph">
<p>Apply the <code class="hotspot=countedForList">@Counted</code> annotation to the <code class="hotspot=list">list()</code> method to count how many times the <code>http://localhost:9080/inventory/systems</code> URL is accessed monotonically, which is counting up sequentially.</p>
</div>
<div class="paragraph">
<p>Apply the <code class="hotspot=gaugeForGetTotal">@Gauge</code> annotation to the <code class="hotspot=getTotal">getTotal()</code> method to track the number of systems that are stored in the inventory. When the value of the gauge is retrieved, the underlying <code class="hotspot=getTotal">getTotal()</code> method is called to return the size of the inventory. Note the additional metadata field:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=unitForGetTotal">unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the unit of the metric. If it is <code class="hotspot=unitForGetTotal">MetricUnits.NONE</code>, the metric name is used without appending the unit name, no scaling is applied.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional information about these annotations, relevant metadata fields, and more are available at
the <a href="https://openliberty.io/docs/latest/reference/javadoc/microprofile-5.0-javadoc.html#package=org/eclipse/microprofile/metrics/annotation/package-frame.html&amp;class=org/eclipse/microprofile/metrics/annotation/package-summary.html" target="_blank" rel="noopener">MicroProfile Metrics Annotation Javadoc</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enabling-vendor-metrics-for-the-microservices">Enabling vendor metrics for the microservices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Sample Liberty server</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 2</span>
<span class="line-numbers"> 3</span>  <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;feature&gt;</span>restfulWS-3.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 5</span>    <span class="tag">&lt;feature&gt;</span>jsonp-2.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>    <span class="tag">&lt;feature&gt;</span>jsonb-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>    <span class="tag">&lt;feature&gt;</span>cdi-4.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>    <span class="tag">&lt;feature&gt;</span>mpConfig-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 9</span>   <span class="tag">&lt;feature&gt;</span>mpMetrics-5.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">10</span>   <span class="tag">&lt;feature&gt;</span>mpRestClient-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">11</span> <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>  <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">14</span>  <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>  <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">17</span>  <span class="comment">&lt;!-- tag::quickStartSecurity[] --&gt;</span>
<span class="line-numbers">18</span>  <span class="tag">&lt;quickStartSecurity</span> <span class="attribute-name">userName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="attribute-name">userPassword</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">19</span>  <span class="comment">&lt;!-- end::quickStartSecurity[] --&gt;</span>
<span class="line-numbers">20</span>  <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">"</span><span class="content">*</span><span class="delimiter">"</span></span> <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span>
<span class="line-numbers">21</span>      <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">22</span>  <span class="tag">&lt;webApplication</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">guide-microprofile-metrics.war</span><span class="delimiter">"</span></span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">23</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>MicroProfile Metrics API implementers can provide vendor metrics in the same forms as the base and application metrics do. Open Liberty as a vendor supplies server component metrics when the <code class="hotspot=mpMetrics">mpMetrics</code> feature is enabled in the <code class="hotspot">server.xml</code> configuration file.</p>
</div>
<div class="paragraph">
<p>You can see the vendor-only metrics in the <code>metrics?scope=vendor</code> endpoint. You see metrics from the runtime components, such as Web Application, ThreadPool and Session Management. Note that these metrics are specific to the Liberty instance. Different vendors may provide other metrics. Visit the <a href="https://openliberty.io/docs/ref/general/#metrics-list.html" target="_blank" rel="noopener">Metrics reference list</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-and-running-the-application">Building and running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Open Liberty instance was started in dev mode at the beginning of the guide and all the changes were automatically picked up.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="https://localhost:9443/metrics" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:9443/metrics</a> URL to review all the metrics that are enabled through MicroProfile Metrics. Log in with <code>admin</code> as your username and <code>adminpwd</code> as your password. You see only the system and vendor metrics because the Liberty instance just started, and the <code>inventory</code> service has not been accessed.</p>
</div>
<div class="paragraph">
<p>Next, point your browser to the <a href="http://localhost:9080/inventory/systems" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9080/inventory/systems</a> URL. Reload the <a href="https://localhost:9443/metrics" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:9443/metrics</a> URL, or access only the application metrics at the <a href="https://localhost:9443/metrics?scope=application" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:9443/metrics?scope=application</a> URL.</p>
</div>
<div class="paragraph">
<p>You can see the system metrics in the <a href="https://localhost:9443/metrics?scope=base" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9443/metrics?scope=base</a> URL as well as see the vendor metrics in the <a href="https://localhost:9443/metrics?scope=vendor" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9443/metrics?scope=vendor</a> URL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-metrics">Testing the metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can test your application manually, but automated tests ensure code quality because they trigger a failure whenever a code change introduces a defect. JUnit and the Jakarta Restful Web Services Client API provide a simple environment for you to write tests.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>MetricsIT</code> class.</mark>
<code>src/test/java/it/io/openliberty/guides/metrics/MetricsIT.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>MetricsIT.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2017, 2022 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="comment">// tag::MetricsTest[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.metrics</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertTrue</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.fail</span>;
<span class="line-numbers"> 18</span>
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.io.BufferedReader</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">java.io.FileInputStream</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">java.io.InputStream</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">java.io.InputStreamReader</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">java.security.KeyStore</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.Client</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 35</span>
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.AfterEach</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeEach</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.MethodOrderer.OrderAnnotation</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Order</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.TestMethodOrder</span>;
<span class="line-numbers"> 43</span>
<span class="line-numbers"> 44</span><span class="comment">// tag::TestMethodOrder[]</span>
<span class="line-numbers"> 45</span><span class="annotation">@TestMethodOrder</span>(OrderAnnotation.class)
<span class="line-numbers"> 46</span><span class="comment">// end::TestMethodOrder[]</span>
<span class="line-numbers"> 47</span><span class="directive">public</span> <span class="type">class</span> <span class="class">MetricsIT</span> {
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> KEYSTORE_PATH = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.dir</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 50</span>                              + <span class="string"><span class="delimiter">"</span><span class="content">/target/liberty/wlp/usr/servers/</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 51</span>                              + <span class="string"><span class="delimiter">"</span><span class="content">defaultServer/resources/security/key.p12</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 52</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> SYSTEM_ENV_PATH =  <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.dir</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 53</span>                              + <span class="string"><span class="delimiter">"</span><span class="content">/target/liberty/wlp/usr/servers/</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 54</span>                              + <span class="string"><span class="delimiter">"</span><span class="content">defaultServer/server.env</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 55</span>
<span class="line-numbers"> 56</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> httpPort;
<span class="line-numbers"> 57</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> httpsPort;
<span class="line-numbers"> 58</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> baseHttpUrl;
<span class="line-numbers"> 59</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> baseHttpsUrl;
<span class="line-numbers"> 60</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">KeyStore</span> keystore;
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; metrics;
<span class="line-numbers"> 63</span>  <span class="directive">private</span> Client client;
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>  <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> INVENTORY_HOSTS = <span class="string"><span class="delimiter">"</span><span class="content">inventory/systems</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 66</span>  <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> INVENTORY_HOSTNAME = <span class="string"><span class="delimiter">"</span><span class="content">inventory/systems/localhost</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 67</span>  <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> METRICS_APPLICATION = <span class="string"><span class="delimiter">"</span><span class="content">metrics?scope=application</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 68</span>
<span class="line-numbers"> 69</span>  <span class="comment">// tag::BeforeAll[]</span>
<span class="line-numbers"> 70</span>  <span class="annotation">@BeforeAll</span>
<span class="line-numbers"> 71</span>  <span class="comment">// end::BeforeAll[]</span>
<span class="line-numbers"> 72</span>  <span class="comment">// tag::oneTimeSetup[]</span>
<span class="line-numbers"> 73</span>  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> oneTimeSetup() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 74</span>    httpPort = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">http.port</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 75</span>    httpsPort = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">https.port</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 76</span>    baseHttpUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost:</span><span class="delimiter">"</span></span> + httpPort + <span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 77</span>    baseHttpsUrl = <span class="string"><span class="delimiter">"</span><span class="content">https://localhost:</span><span class="delimiter">"</span></span> + httpsPort + <span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 78</span>    loadKeystore();
<span class="line-numbers"> 79</span>  }
<span class="line-numbers"> 80</span>  <span class="comment">// end::oneTimeSetup[]</span>
<span class="line-numbers"> 81</span>
<span class="line-numbers"> 82</span>  <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> loadKeystore() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 83</span>    <span class="predefined-type">Properties</span> sysEnv = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 84</span>    sysEnv.load(<span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(SYSTEM_ENV_PATH));
<span class="line-numbers"> 85</span>    <span class="type">char</span><span class="type">[]</span> password = sysEnv.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">keystore_password</span><span class="delimiter">"</span></span>).toCharArray();
<span class="line-numbers"> 86</span>    keystore = <span class="predefined-type">KeyStore</span>.getInstance(<span class="string"><span class="delimiter">"</span><span class="content">PKCS12</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 87</span>    keystore.load(<span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(KEYSTORE_PATH), password);
<span class="line-numbers"> 88</span>  }
<span class="line-numbers"> 89</span>
<span class="line-numbers"> 90</span>  <span class="comment">// tag::BeforeEach[]</span>
<span class="line-numbers"> 91</span>  <span class="annotation">@BeforeEach</span>
<span class="line-numbers"> 92</span>  <span class="comment">// end::BeforeEach[]</span>
<span class="line-numbers"> 93</span>  <span class="comment">// tag::setup[]</span>
<span class="line-numbers"> 94</span>  <span class="directive">public</span> <span class="type">void</span> setup() {
<span class="line-numbers"> 95</span>    client = ClientBuilder.newBuilder().trustStore(keystore).build();
<span class="line-numbers"> 96</span>  }
<span class="line-numbers"> 97</span>  <span class="comment">// end::setup[]</span>
<span class="line-numbers"> 98</span>
<span class="line-numbers"> 99</span>  <span class="comment">// tag::AfterEach[]</span>
<span class="line-numbers">100</span>  <span class="annotation">@AfterEach</span>
<span class="line-numbers">101</span>  <span class="comment">// end::AfterEach[]</span>
<span class="line-numbers">102</span>  <span class="comment">// tag::teardown[]</span>
<span class="line-numbers">103</span>  <span class="directive">public</span> <span class="type">void</span> teardown() {
<span class="line-numbers">104</span>    client.close();
<span class="line-numbers">105</span>  }
<span class="line-numbers">106</span>  <span class="comment">// end::teardown[]</span>
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>  <span class="comment">// tag::Test1[]</span>
<span class="line-numbers">109</span>  <span class="annotation">@Test</span>
<span class="line-numbers">110</span>  <span class="comment">// end::Test1[]</span>
<span class="line-numbers">111</span>  <span class="comment">// tag::Order1[]</span>
<span class="line-numbers">112</span>  <span class="annotation">@Order</span>(<span class="integer">1</span>)
<span class="line-numbers">113</span>  <span class="comment">// end::Order1[]</span>
<span class="line-numbers">114</span>  <span class="comment">// tag::testPropertiesRequestTimeMetric[]</span>
<span class="line-numbers">115</span>  <span class="directive">public</span> <span class="type">void</span> testPropertiesRequestTimeMetric() {
<span class="line-numbers">116</span>    connectToEndpoint(baseHttpUrl + INVENTORY_HOSTNAME);
<span class="line-numbers">117</span>    metrics = getMetrics();
<span class="line-numbers">118</span>    <span class="keyword">for</span> (<span class="predefined-type">String</span> metric : metrics) {
<span class="line-numbers">119</span>      <span class="keyword">if</span> (metric.startsWith(
<span class="line-numbers">120</span>          <span class="string"><span class="delimiter">"</span><span class="content">application_inventoryProcessingTime_rate_per_second</span><span class="delimiter">"</span></span>)) {
<span class="line-numbers">121</span>        <span class="type">float</span> seconds = <span class="predefined-type">Float</span>.parseFloat(metric.split(<span class="string"><span class="delimiter">"</span><span class="content"> </span><span class="delimiter">"</span></span>)[<span class="integer">1</span>]);
<span class="line-numbers">122</span>        assertTrue(<span class="integer">4</span> &gt; seconds);
<span class="line-numbers">123</span>      }
<span class="line-numbers">124</span>    }
<span class="line-numbers">125</span>  }
<span class="line-numbers">126</span>  <span class="comment">// end::testPropertiesRequestTimeMetric[]</span>
<span class="line-numbers">127</span>
<span class="line-numbers">128</span>  <span class="comment">// tag::Test2[]</span>
<span class="line-numbers">129</span>  <span class="annotation">@Test</span>
<span class="line-numbers">130</span>  <span class="comment">// end::Test2[]</span>
<span class="line-numbers">131</span>  <span class="comment">// tag::Order2[]</span>
<span class="line-numbers">132</span>  <span class="annotation">@Order</span>(<span class="integer">2</span>)
<span class="line-numbers">133</span>  <span class="comment">// end::Order2[]</span>
<span class="line-numbers">134</span>  <span class="comment">// tag::testInventoryAccessCountMetric[]</span>
<span class="line-numbers">135</span>  <span class="directive">public</span> <span class="type">void</span> testInventoryAccessCountMetric() {
<span class="line-numbers">136</span>    metrics = getMetrics();
<span class="line-numbers">137</span>    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; accessCountsBefore = getIntMetrics(metrics,
<span class="line-numbers">138</span>            <span class="string"><span class="delimiter">"</span><span class="content">application_inventoryAccessCount_total</span><span class="delimiter">"</span></span>);
<span class="line-numbers">139</span>    connectToEndpoint(baseHttpUrl + INVENTORY_HOSTS);
<span class="line-numbers">140</span>    metrics = getMetrics();
<span class="line-numbers">141</span>    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; accessCountsAfter = getIntMetrics(metrics,
<span class="line-numbers">142</span>            <span class="string"><span class="delimiter">"</span><span class="content">application_inventoryAccessCount_total</span><span class="delimiter">"</span></span>);
<span class="line-numbers">143</span>    <span class="keyword">for</span> (<span class="predefined-type">String</span> key : accessCountsBefore.keySet()) {
<span class="line-numbers">144</span>      <span class="predefined-type">Integer</span> accessCountBefore = accessCountsBefore.get(key);
<span class="line-numbers">145</span>      <span class="predefined-type">Integer</span> accessCountAfter = accessCountsAfter.get(key);
<span class="line-numbers">146</span>      assertTrue(accessCountAfter &gt; accessCountBefore);
<span class="line-numbers">147</span>    }
<span class="line-numbers">148</span>  }
<span class="line-numbers">149</span>  <span class="comment">// end::testInventoryAccessCountMetric[]</span>
<span class="line-numbers">150</span>
<span class="line-numbers">151</span>  <span class="comment">// tag::Test3[]</span>
<span class="line-numbers">152</span>  <span class="annotation">@Test</span>
<span class="line-numbers">153</span>  <span class="comment">// end::Test3[]</span>
<span class="line-numbers">154</span>  <span class="comment">// tag::Order3[]</span>
<span class="line-numbers">155</span>  <span class="annotation">@Order</span>(<span class="integer">3</span>)
<span class="line-numbers">156</span>  <span class="comment">// end::Order3[]</span>
<span class="line-numbers">157</span>  <span class="comment">// tag::testInventorySizeGaugeMetric[]</span>
<span class="line-numbers">158</span>  <span class="directive">public</span> <span class="type">void</span> testInventorySizeGaugeMetric() {
<span class="line-numbers">159</span>    metrics = getMetrics();
<span class="line-numbers">160</span>    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; inventorySizeGauges = getIntMetrics(metrics,
<span class="line-numbers">161</span>            <span class="string"><span class="delimiter">"</span><span class="content">application_inventorySizeGauge</span><span class="delimiter">"</span></span>);
<span class="line-numbers">162</span>    <span class="keyword">for</span> (<span class="predefined-type">Integer</span> value : inventorySizeGauges.values()) {
<span class="line-numbers">163</span>      assertTrue(<span class="integer">1</span> &lt;= value);
<span class="line-numbers">164</span>    }
<span class="line-numbers">165</span>  }
<span class="line-numbers">166</span>  <span class="comment">// end::testInventorySizeGaugeMetric[]</span>
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>  <span class="comment">// tag::Test4[]</span>
<span class="line-numbers">169</span>  <span class="annotation">@Test</span>
<span class="line-numbers">170</span>  <span class="comment">// end::Test4[]</span>
<span class="line-numbers">171</span>  <span class="comment">// tag::Order4[]</span>
<span class="line-numbers">172</span>  <span class="annotation">@Order</span>(<span class="integer">4</span>)
<span class="line-numbers">173</span>  <span class="comment">// end::Order4[]</span>
<span class="line-numbers">174</span>  <span class="comment">// tag::testPropertiesAddTimeMetric[]</span>
<span class="line-numbers">175</span>  <span class="directive">public</span> <span class="type">void</span> testPropertiesAddTimeMetric() {
<span class="line-numbers">176</span>    connectToEndpoint(baseHttpUrl + INVENTORY_HOSTNAME);
<span class="line-numbers">177</span>    metrics = getMetrics();
<span class="line-numbers">178</span>    <span class="type">boolean</span> checkMetric = <span class="predefined-constant">false</span>;
<span class="line-numbers">179</span>    <span class="keyword">for</span> (<span class="predefined-type">String</span> metric : metrics) {
<span class="line-numbers">180</span>      <span class="keyword">if</span> (metric.startsWith(
<span class="line-numbers">181</span>          <span class="string"><span class="delimiter">"</span><span class="content">inventoryAddingTime_seconds_count</span><span class="delimiter">"</span></span>)) {
<span class="line-numbers">182</span>            checkMetric = <span class="predefined-constant">true</span>;
<span class="line-numbers">183</span>      }
<span class="line-numbers">184</span>    }
<span class="line-numbers">185</span>    assertTrue(checkMetric);
<span class="line-numbers">186</span>  }
<span class="line-numbers">187</span>  <span class="comment">// end::testPropertiesAddTimeMetric[]</span>
<span class="line-numbers">188</span>
<span class="line-numbers">189</span>  <span class="directive">public</span> <span class="type">void</span> connectToEndpoint(<span class="predefined-type">String</span> url) {
<span class="line-numbers">190</span>    Response response = <span class="local-variable">this</span>.getResponse(url);
<span class="line-numbers">191</span>    <span class="local-variable">this</span>.assertResponse(url, response);
<span class="line-numbers">192</span>    response.close();
<span class="line-numbers">193</span>  }
<span class="line-numbers">194</span>
<span class="line-numbers">195</span>  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getMetrics() {
<span class="line-numbers">196</span>    <span class="predefined-type">String</span> usernameAndPassword = <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + <span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span>;
<span class="line-numbers">197</span>    <span class="predefined-type">String</span> authorizationHeaderValue = <span class="string"><span class="delimiter">"</span><span class="content">Basic </span><span class="delimiter">"</span></span>
<span class="line-numbers">198</span>        + java.util.Base64.getEncoder()
<span class="line-numbers">199</span>                          .encodeToString(usernameAndPassword.getBytes());
<span class="line-numbers">200</span>    Response metricsResponse = client.target(baseHttpsUrl + METRICS_APPLICATION)
<span class="line-numbers">201</span>                                     .request(MediaType.TEXT_PLAIN)
<span class="line-numbers">202</span>                                     .header(<span class="string"><span class="delimiter">"</span><span class="content">Authorization</span><span class="delimiter">"</span></span>,
<span class="line-numbers">203</span>                                         authorizationHeaderValue)
<span class="line-numbers">204</span>                                     .get();
<span class="line-numbers">205</span>
<span class="line-numbers">206</span>    <span class="predefined-type">BufferedReader</span> br = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>((<span class="predefined-type">InputStream</span>)
<span class="line-numbers">207</span>    metricsResponse.getEntity()));
<span class="line-numbers">208</span>    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; result = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;();
<span class="line-numbers">209</span>    <span class="keyword">try</span> {
<span class="line-numbers">210</span>      <span class="predefined-type">String</span> input;
<span class="line-numbers">211</span>      <span class="keyword">while</span> ((input = br.readLine()) != <span class="predefined-constant">null</span>) {
<span class="line-numbers">212</span>        result.add(input);
<span class="line-numbers">213</span>      }
<span class="line-numbers">214</span>      br.close();
<span class="line-numbers">215</span>    } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
<span class="line-numbers">216</span>      e.printStackTrace();
<span class="line-numbers">217</span>      fail();
<span class="line-numbers">218</span>    }
<span class="line-numbers">219</span>
<span class="line-numbers">220</span>    metricsResponse.close();
<span class="line-numbers">221</span>    <span class="keyword">return</span> result;
<span class="line-numbers">222</span>  }
<span class="line-numbers">223</span>
<span class="line-numbers">224</span>  <span class="directive">private</span> Response getResponse(<span class="predefined-type">String</span> url) {
<span class="line-numbers">225</span>    <span class="keyword">return</span> client.target(url).request().get();
<span class="line-numbers">226</span>  }
<span class="line-numbers">227</span>
<span class="line-numbers">228</span>  <span class="directive">private</span> <span class="type">void</span> assertResponse(<span class="predefined-type">String</span> url, Response response) {
<span class="line-numbers">229</span>    assertEquals(<span class="integer">200</span>, response.getStatus(), <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + url);
<span class="line-numbers">230</span>  }
<span class="line-numbers">231</span>
<span class="line-numbers">232</span>  <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; getIntMetrics(<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; metrics, <span class="predefined-type">String</span> metricName) {
<span class="line-numbers">233</span>    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; output = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;();
<span class="line-numbers">234</span>    <span class="keyword">for</span> (<span class="predefined-type">String</span> metric : metrics) {
<span class="line-numbers">235</span>      <span class="keyword">if</span> (metric.startsWith(metricName)) {
<span class="line-numbers">236</span>        <span class="predefined-type">String</span><span class="type">[]</span> mSplit = metric.split(<span class="string"><span class="delimiter">"</span><span class="content"> </span><span class="delimiter">"</span></span>);
<span class="line-numbers">237</span>        <span class="predefined-type">String</span> key = mSplit[<span class="integer">0</span>];
<span class="line-numbers">238</span>        <span class="predefined-type">Integer</span> value = <span class="predefined-type">Integer</span>.parseInt(mSplit[mSplit.length - <span class="integer">1</span>]);
<span class="line-numbers">239</span>        output.put(key, value);
<span class="line-numbers">240</span>      }
<span class="line-numbers">241</span>    }
<span class="line-numbers">242</span>    <span class="keyword">return</span> output;
<span class="line-numbers">243</span>  }
<span class="line-numbers">244</span>}
<span class="line-numbers">245</span><span class="comment">// end::MetricsTest[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>InventoryManager.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2017, 2022 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="comment">// tag::InventoryManager[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.inventory</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.Collections</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 19</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.MetricUnits</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Counted</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Gauge</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Timed</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.inventory.model.InventoryList</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.inventory.model.SystemData</span>;
<span class="line-numbers"> 29</span>
<span class="line-numbers"> 30</span><span class="comment">// tag::ApplicationScoped[]</span>
<span class="line-numbers"> 31</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 32</span><span class="comment">// end::ApplicationScoped[]</span>
<span class="line-numbers"> 33</span><span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryManager</span> {
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span>  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;SystemData&gt; systems = <span class="predefined-type">Collections</span>.synchronizedList(<span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;());
<span class="line-numbers"> 36</span>  <span class="directive">private</span> InventoryUtils invUtils = <span class="keyword">new</span> InventoryUtils();
<span class="line-numbers"> 37</span>
<span class="line-numbers"> 38</span>  <span class="comment">// tag::timedForGet[]</span>
<span class="line-numbers"> 39</span>  <span class="comment">// tag::nameForGet[]</span>
<span class="line-numbers"> 40</span>  <span class="annotation">@Timed</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryProcessingTime</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 41</span>  <span class="comment">// end::nameForGet[]</span>
<span class="line-numbers"> 42</span>         <span class="comment">// tag::tagForGet[]</span>
<span class="line-numbers"> 43</span>         tags = {<span class="string"><span class="delimiter">"</span><span class="content">method=get</span><span class="delimiter">"</span></span>},
<span class="line-numbers"> 44</span>         <span class="comment">// end::tagForGet[]</span>
<span class="line-numbers"> 45</span>         <span class="comment">// tag::absoluteForGet[]</span>
<span class="line-numbers"> 46</span>         absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 47</span>         <span class="comment">// end::absoluteForGet[]</span>
<span class="line-numbers"> 48</span>         <span class="comment">// tag::desForGet[]</span>
<span class="line-numbers"> 49</span>         description = <span class="string"><span class="delimiter">"</span><span class="content">Time needed to process the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 50</span>         <span class="comment">// end::desForGet[]</span>
<span class="line-numbers"> 51</span>  <span class="comment">// end::timedForGet[]</span>
<span class="line-numbers"> 52</span>  <span class="comment">// tag::get[]</span>
<span class="line-numbers"> 53</span>  <span class="directive">public</span> <span class="predefined-type">Properties</span> get(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 54</span>    <span class="keyword">return</span> invUtils.getProperties(hostname);
<span class="line-numbers"> 55</span>  }
<span class="line-numbers"> 56</span>  <span class="comment">// end::get[]</span>
<span class="line-numbers"> 57</span>
<span class="line-numbers"> 58</span>  <span class="comment">// tag::timedForAdd[]</span>
<span class="line-numbers"> 59</span>  <span class="comment">// tag::nameForAdd[]</span>
<span class="line-numbers"> 60</span>  <span class="annotation">@Timed</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryAddingTime</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 61</span>  <span class="comment">// end::nameForAdd[]</span>
<span class="line-numbers"> 62</span>    <span class="comment">// tag::absoluteForAdd[]</span>
<span class="line-numbers"> 63</span>    absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 64</span>    <span class="comment">// end::absoluteForAdd[]</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::desForAdd[]</span>
<span class="line-numbers"> 66</span>    description = <span class="string"><span class="delimiter">"</span><span class="content">Time needed to add system properties to the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 67</span>    <span class="comment">// end::desForAdd[]</span>
<span class="line-numbers"> 68</span>  <span class="comment">// end::timedForAdd[]</span>
<span class="line-numbers"> 69</span>  <span class="comment">// tag::add[]</span>
<span class="line-numbers"> 70</span>  <span class="directive">public</span> <span class="type">void</span> add(<span class="predefined-type">String</span> hostname, <span class="predefined-type">Properties</span> systemProps) {
<span class="line-numbers"> 71</span>    <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 72</span>    props.setProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>, systemProps.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 73</span>    props.setProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>, systemProps.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 74</span>
<span class="line-numbers"> 75</span>    SystemData host = <span class="keyword">new</span> SystemData(hostname, props);
<span class="line-numbers"> 76</span>    <span class="keyword">if</span> (!systems.contains(host)) {
<span class="line-numbers"> 77</span>      systems.add(host);
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>  }
<span class="line-numbers"> 80</span>  <span class="comment">// end::add[]</span>
<span class="line-numbers"> 81</span>
<span class="line-numbers"> 82</span>  <span class="comment">// tag::timedForList[]</span>
<span class="line-numbers"> 83</span>  <span class="comment">// tag::nameForList[]</span>
<span class="line-numbers"> 84</span>  <span class="annotation">@Timed</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryProcessingTime</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 85</span>  <span class="comment">// end::nameForList[]</span>
<span class="line-numbers"> 86</span>         <span class="comment">// tag::tagForList[]</span>
<span class="line-numbers"> 87</span>         tags = {<span class="string"><span class="delimiter">"</span><span class="content">method=list</span><span class="delimiter">"</span></span>},
<span class="line-numbers"> 88</span>         <span class="comment">// end::tagForList[]</span>
<span class="line-numbers"> 89</span>         <span class="comment">// tag::absoluteForList[]</span>
<span class="line-numbers"> 90</span>         absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 91</span>         <span class="comment">// end::absoluteForList[]</span>
<span class="line-numbers"> 92</span>         <span class="comment">// tag::desForList[]</span>
<span class="line-numbers"> 93</span>         description = <span class="string"><span class="delimiter">"</span><span class="content">Time needed to process the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 94</span>         <span class="comment">// end::desForList[]</span>
<span class="line-numbers"> 95</span>  <span class="comment">// end::timedForList[]</span>
<span class="line-numbers"> 96</span>  <span class="comment">// tag::countedForList[]</span>
<span class="line-numbers"> 97</span>  <span class="annotation">@Counted</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">inventoryAccessCount</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 98</span>           absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers"> 99</span>           description = <span class="string"><span class="delimiter">"</span><span class="content">Number of times the list of systems method is requested</span><span class="delimiter">"</span></span>)
<span class="line-numbers">100</span>  <span class="comment">// end::countedForList[]</span>
<span class="line-numbers">101</span>  <span class="comment">// tag::list[]</span>
<span class="line-numbers">102</span>  <span class="directive">public</span> InventoryList list() {
<span class="line-numbers">103</span>    <span class="keyword">return</span> <span class="keyword">new</span> InventoryList(systems);
<span class="line-numbers">104</span>  }
<span class="line-numbers">105</span>  <span class="comment">// end::list[]</span>
<span class="line-numbers">106</span>
<span class="line-numbers">107</span>  <span class="comment">// tag::gaugeForGetTotal[]</span>
<span class="line-numbers">108</span>  <span class="comment">// tag::unitForGetTotal[]</span>
<span class="line-numbers">109</span>  <span class="annotation">@Gauge</span>(unit = MetricUnits.NONE,
<span class="line-numbers">110</span>  <span class="comment">// end::unitForGetTotal[]</span>
<span class="line-numbers">111</span>         name = <span class="string"><span class="delimiter">"</span><span class="content">inventorySizeGauge</span><span class="delimiter">"</span></span>,
<span class="line-numbers">112</span>         absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers">113</span>         description = <span class="string"><span class="delimiter">"</span><span class="content">Number of systems in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">114</span>  <span class="comment">// end::gaugeForGetTotal[]</span>
<span class="line-numbers">115</span>  <span class="comment">// tag::getTotal[]</span>
<span class="line-numbers">116</span>  <span class="directive">public</span> <span class="type">int</span> getTotal() {
<span class="line-numbers">117</span>    <span class="keyword">return</span> systems.size();
<span class="line-numbers">118</span>  }
<span class="line-numbers">119</span>  <span class="comment">// end::getTotal[]</span>
<span class="line-numbers">120</span>}
<span class="line-numbers">121</span><span class="comment">// end::InventoryManager[]</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code class="hotspot=testPropertiesRequestTimeMetric file=0">testPropertiesRequestTimeMetric()</code> test case validates the <code class="hotspot=timedForGet file=1">@Timed</code> metric. The test case sends a request to the <code>http://localhost:9080/inventory/systems/localhost</code> URL to access the <code>inventory</code> service, which adds the <code>localhost</code> host to the inventory. Next, the test case makes a connection to the <code>https://localhost:9443/metrics?scope=application</code> URL to retrieve application metrics as plain text. Then, it asserts whether the time that is needed to retrieve the system properties for localhost is less than 4 seconds.</p>
</li>
<li>
<p>The <code class="hotspot=testInventoryAccessCountMetric file=0">testInventoryAccessCountMetric()</code> test case validates the <code class="hotspot=countedForList file=1">@Counted</code> metric. The test case obtains metric data before and after a request to the <code>http://localhost:9080/inventory/systems</code> URL. It then asserts that the metric was increased after the URL was accessed.</p>
</li>
<li>
<p>The <code class="hotspot=testInventorySizeGaugeMetric file=0">testInventorySizeGaugeMetric()</code> test case validates the <code class="hotspot=gaugeForGetTotal file=1">@Gauge</code> metric. The test case first ensures that the localhost is in the inventory, then looks for the <code class="hotspot=gaugeForGetTotal file=1">@Gauge</code> metric and asserts that the inventory size is greater or equal to 1.</p>
</li>
<li>
<p>The <code class="hotspot=testPropertiesAddTimeMetric file=0">testPropertiesAddTimeMetric()</code> test case validates the <code class="hotspot=timedForAdd file=1">@Timed</code> metric. The test case sends a request to the <code>http://localhost:9080/inventory/systems/localhost</code> URL to access the <code>inventory</code> service, which adds the <code>localhost</code> host to the inventory. Next, the test case makes a connection to the <code>https://localhost:9443/metrics?scope=application</code> URL to retrieve application metrics as plain text. Then, it looks for the <code class="hotspot=timedForAdd file=1">@Timed</code> metric and asserts true if the metric exists.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code class="hotspot=oneTimeSetup file=0">oneTimeSetup()</code> method retrieves the port number for the Liberty and builds a base URL string to set up the tests. Apply the <code class="hotspot=BeforeAll file=0">@BeforeAll</code> annotation to this method to run it before any of the test cases.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=setup file=0">setup()</code> method creates a JAX-RS client that makes HTTP requests to the <code>inventory</code> service. The <code class="hotspot=teardown file=0">teardown()</code> method destroys this client instance. Apply the <code class="hotspot=BeforeEach file=0">@BeforeEach</code> annotation so that a method runs before a test case and apply the <code class="hotspot=AfterEach file=0">@AfterEach</code> annotation so that a method runs after a test case. Apply these annotations to methods that are generally used to perform any setup and teardown tasks before and after a test.</p>
</div>
<div class="paragraph">
<p>To force these test cases to run in a particular order, annotate your <code class="hotspot file=0">MetricsIT</code> test class with the <code class="hotspot=TestMethodOrder file=0">@TestMethodOrder(OrderAnnotation.class)</code> annotation. <code class="hotspot=TestMethodOrder file=0">OrderAnnotation.class</code> runs test methods in numerical order, according to the values specified in the <code class="hotspot=Order1 hotspot=Order2 hotspot=Order3 file=0">@Order</code> annotation. You can also create a custom <code>MethodOrderer</code> class or use built-in <code>MethodOrderer</code> implementations, such as <code>OrderAnnotation.class</code>, <code>Alphanumeric.class</code>, or <code>Random.class</code>. Label your test cases with the <code class="hotspot=Test1 hotspot=Test2 hotspot=Test3 file=0">@Test</code> annotation so that they automatically run when your test class runs.</p>
</div>
<div class="paragraph">
<p>In addition, the endpoint tests <code>src/test/java/it/io/openliberty/guides/inventory/InventoryEndpointIT.java</code> and <code>src/test/java/it/io/openliberty/guides/system/SystemEndpointIT.java</code> are provided for you to test the basic functionality of the <code>inventory</code> and <code>system</code> services. If a test failure occurs, then you might have introduced a bug into the code.</p>
</div>
<div class="sect2">
<h3 id="running-the-tests">Running the tests</h3>
<div class="paragraph">
<p>Because you started Open Liberty in dev mode at the start of the guide, press the <code>enter/return</code> key to run the tests and see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.system.SystemEndpointIT
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.4 sec - in it.io.openliberty.guides.system.SystemEndpointIT
Running it.io.openliberty.guides.metrics.MetricsIT
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.476 sec - in it.io.openliberty.guides.metrics.MetricsIT
Running it.io.openliberty.guides.inventory.InventoryEndpointIT
[WARNING ] Interceptor for {http://client.inventory.guides.openliberty.io/}SystemClient has thrown exception, unwinding now
Could not send Message.
[err] The specified host is unknown.
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.264 sec - in it.io.openliberty.guides.inventory.InventoryEndpointIT

Results :

Tests run: 8, Failures: 0, Errors: 0, Skipped: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The warning and error messages are expected and result from a request to a bad or an unknown hostname. This request is made in the <code>testUnknownHost()</code> test from the <code>InventoryEndpointIT</code> integration test.</p>
</div>
<div class="paragraph">
<p>To determine whether the tests detect a failure, go to the <code class="hotspot file=0">MetricsIT.java</code> file and change any of the assertions in the test methods. Then re-run the tests to see a test failure occur.</p>
</div>
<div class="paragraph">
<p>When you are done checking out the service, exit dev mode by pressing <code>CTRL+C</code> in the command-line session where you ran Liberty, or by typing <code>q</code> and then pressing the <code>enter/return</code> key.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You learned how to enable system, application and vendor metrics for microservices by using MicroProfile Metrics
and wrote tests to validate them in Open Liberty.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Providing metrics from a microservice <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-microprofile-metrics/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-microprofile-metrics/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-microprofile-metrics/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/rest-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Creating a RESTful web service</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">30 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-health.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Adding health reports to microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/cdi-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Injecting dependencies into microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
