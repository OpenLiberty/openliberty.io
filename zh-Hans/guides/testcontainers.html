<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      Testing Java microservices using Testcontainers and JUnit with multiple containers and Open Liberty Docker container
    
  </title>
  <meta name="description" content="A getting started tutorial on how to develop true-to-production integration tests for Java microservices in production-like settings by using Testcontainers and JUnit with multiple containers and Open Liberty Docker container.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/testcontainers">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="Testing Java microservices using Testcontainers and JUnit with multiple containers and Open Liberty Docker container" />
  <meta name="twitter:description" content="A getting started tutorial on how to develop true-to-production integration tests for Java microservices in production-like settings by using Testcontainers and JUnit with multiple containers and Open Liberty Docker container." />

  <meta property='og:title' content="Testing Java microservices using Testcontainers and JUnit with multiple containers and Open Liberty Docker container" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="A getting started tutorial on how to develop true-to-production integration tests for Java microservices in production-like settings by using Testcontainers and JUnit with multiple containers and Open Liberty Docker container." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/testcontainers" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li>
<a href="#what-youll-learn">What you’ll learn</a>
<ul class="sectlevel2">
<li><a href="#what-is-testcontainers">What is Testcontainers?</a></li>
</ul>
</li>
<li><a href="#additional-prerequisites">Additional prerequisites</a></li>
<li>
<a href="#getting-started">Getting started</a>
<ul class="sectlevel2">
<li><a href="#try-what-youll-build">Try what you’ll build</a></li>
</ul>
</li>
<li>
<a href="#implementing-integration-tests-to-use-testcontainers">Implementing integration tests to use Testcontainers</a>
<ul class="sectlevel2">
<li><a href="#building-test-rest-client">Building test REST client</a></li>
<li><a href="#building-test-container-for-open-liberty">Building test container for Open Liberty</a></li>
<li><a href="#building-test-cases">Building test cases</a></li>
<li><a href="#setting-up-logs">Setting up logs</a></li>
<li><a href="#configuring-maven-project">Configuring Maven project</a></li>
</ul>
</li>
<li><a href="#running-tests-in-a-cicd-pipeline">Running tests in a CI/CD pipeline</a></li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">Building true-to-production integration tests with Testcontainers</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">20 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <div class="new_guide_container">
            <span class="guide_new">New</span>
          </div>
          
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="https://openliberty.io/guides/testcontainers.html">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Learn how to test your microservices with multiple containers using Testcontainers and JUnit.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You’ll learn how to write true-to-production integration tests for Java microservices by using <a href="https://www.testcontainers.org/" target="_blank" rel="noopener noreferrer">Testcontainers</a> and JUnit. You’ll learn to set up and configure multiple containers, including the Open Liberty Docker container, to simulate a production-like environment for your tests.</p>
</div>
<div class="paragraph">
<p>Sometimes tests might pass in development and testing (dev/test) environments, but fail in production because the application runs differently in production than in dev/test. Fortunately, you can minimize these differences between dev/test and production by testing your application in the same Docker containers that you’ll use in production.</p>
</div>
<div class="sect2">
<h3 id="what-is-testcontainers">What is Testcontainers?</h3>
<div class="paragraph">
<p>Testcontainers is an open source library that wraps Docker in a Java API. It is often used in testing applications that involve external resource dependencies such as databases, message queues, or web services. Testcontainers supports any container image, which allows for uniform and portable testing environments. By encapsulating dependencies in containers, it ensures test consistency and simplifies the setup process.</p>
</div>
<div class="paragraph">
<p>The microservice that you’ll be working with is called <code>inventory</code>. The <code>inventory</code> microservice persists data into a PostgreSQL database and supports create, retrieve, update, and delete (CRUD) operations on the database records. You will write integration tests for the application by using Testcontainers to run it in Docker containers.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/guide/testcontainers/inventory.png" alt="Inventory microservice">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-prerequisites">Additional prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you begin, Docker needs to be installed. For installation instructions, refer to the <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">official Docker documentation</a>. You’ll test the application in Docker containers.</p>
</div>
<div class="paragraph">
<p>Make sure to start your Docker daemon before you proceed.</p>
</div>
</div>
</div>
<div class="sect1 command">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to work through this guide is to clone the <a href="https://github.com/openliberty/guide-testcontainers.git" target="_blank" rel="noopener noreferrer">Git repository</a> and use the projects that are provided inside:</p>
</div>
<div id="git_clone" class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-testcontainers.git
cd guide-testcontainers</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory contains the starting project that you will build upon.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished project that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary <span class="prerequisites">prerequisites</span>.</p>
</div>
<div class="sect2">
<h3 id="try-what-youll-build">Try what you’ll build</h3>
<div class="paragraph">
<p>This guide uses Docker to run an instance of the PostgreSQL database for a fast installation and setup. A Dockerfile file is provided for you. Navigate to the <code>postgres</code> directory and run the following commands to use the Dockerfile to build the image:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd postgres
docker build -t postgres-sample .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory in the root of this guide contains the finished application. Give it a try before you proceed.</p>
</div>
<div class="paragraph">
<p>To try out the test, first go to the <code>finish</code> directory and run the <code>mvn package</code> command so that the <code>.war</code> file resides in the <code>target</code> directory, and the <code>.jar</code> PostgreSQL JDBC driver file resides in the <code>target/liberty/wlp/usr/shared/resources</code> directory:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd ../finish
mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the <code>inventory</code> container image with the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker build -t inventory:1.0-SNAPSHOT .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, run the Maven <code>verify</code> goal, which compiles the Java files, starts the containers, runs the tests, and then stops the containers.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section mac_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn verify</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>export TESTCONTAINERS_RYUK_DISABLED=true
mvn verify -Dtest.protocol=http</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You will see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre> -------------------------------------------------------
  T E S T S
 -------------------------------------------------------
 Running it.io.openliberty.guides.inventory.SystemResourceIT
 ...
 Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 10.118 s - in it.io.openliberty.guides.inventory.SystemResourceIT

 Results:

 Tests run: 3, Failures: 0, Errors: 0, Skipped: 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-integration-tests-to-use-testcontainers">Implementing integration tests to use Testcontainers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You’ll develop integration tests capable of running in both <a href="https://openliberty.io/docs/latest/development-mode.html" target="_blank" rel="noopener">dev mode</a> and a CI/CD pipeline. These flexible tests ensure the application’s reliability across diverse environments.</p>
</div>
<div class="paragraph">
<p>Navigate to the <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL database is integral for the <code>inventory</code> microservice as it handles the persistence of data. Run the following command to start the PostgreSQL database, which runs the <code>postgres-sample</code> image in a Docker container and maps <code>5432</code> port from the container to your host machine:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker run --name postgres-container --rm -p 5432:5432 -d postgres-sample</code></pre>
</div>
</div>
<div class="paragraph">
<p>Retrieve the PostgreSQL container IP address by running the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker inspect -f "{{.NetworkSettings.IPAddress }}" postgres-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command returns the PostgreSQL container IP address:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>172.17.0.2</pre>
</div>
</div>
<div class="paragraph">
<p>The Open Liberty Maven plug-in includes a <code>devc</code> goal that simplifies developing your application in a container by starting dev mode with container support. This goal builds a container image, mounts the required directories, binds the required ports, and then runs the application inside of a container. Dev mode also listens for any changes in the application source code or configuration and rebuilds the image and restarts the container as necessary.</p>
</div>
<div class="paragraph">
<p>Build and run the container by running the <code>devc</code> goal with the PostgreSQL container IP address. If your PostgreSQL container IP address is not <code>172.17.0.2</code>, replace the command with the right IP address.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn liberty:devc -DdockerRunOpts="-e DB_HOSTNAME=172.17.0.2" -DserverStartTimeout=240</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to wait a while to let dev mode start. After you see the following message, your Liberty instance is ready in dev mode:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.
*    ...
*    Docker network information:
*        Container name: [ liberty-dev ]
*        IP address [ 172.17.0.3 ] on Docker network [ bridge ]
*    ...</pre>
</div>
</div>
<div class="paragraph">
<p>Dev mode holds your command-line session to listen for file changes. Open another command-line session to continue, or open the project in your editor.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> URL to try out the <code>inventory</code> microservice manually. This interface provides a convenient visual way to interact with the APIs and test out their functionalities.</p>
</div>
<div class="sect2">
<h3 id="building-test-rest-client">Building test REST client</h3>
<div class="paragraph">
<p>Test REST client is responsible for sending HTTP requests to an application and handling the responses. It enables accurate verification of the application’s behavior by ensuring that it responds correctly to various scenarios and conditions. Using a REST client for testing ensures reliable interaction with the <code>inventory</code> microservice across various deployment environments: local, Docker container, or Testcontainers.</p>
</div>
<div class="paragraph">
<p>Begin by creating a test REST client interface for the <code>inventory</code> microservice.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemResourceClient</code> class.</mark>
<code>src/test/java/it/io/openliberty/guides/inventory/SystemResourceClient.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResourceClient.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.inventory</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers">15</span>
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers">22</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers">24</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers">25</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers">26</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers">27</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>
<span class="line-numbers">30</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">31</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers">32</span><span class="directive">public</span> <span class="type">interface</span> <span class="class">SystemResourceClient</span> {
<span class="line-numbers">33</span>
<span class="line-numbers">34</span>    <span class="comment">// tag::listContents[]</span>
<span class="line-numbers">35</span>    <span class="annotation">@GET</span>
<span class="line-numbers">36</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers">37</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">38</span>    <span class="predefined-type">List</span>&lt;SystemData&gt; listContents();
<span class="line-numbers">39</span>    <span class="comment">// end::listContents[]</span>
<span class="line-numbers">40</span>
<span class="line-numbers">41</span>    <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers">42</span>    <span class="annotation">@GET</span>
<span class="line-numbers">43</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">44</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">45</span>    SystemData getSystem(
<span class="line-numbers">46</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname);
<span class="line-numbers">47</span>    <span class="comment">// end::getSystem[]</span>
<span class="line-numbers">48</span>
<span class="line-numbers">49</span>    <span class="comment">// tag::addSystem[]</span>
<span class="line-numbers">50</span>    <span class="annotation">@POST</span>
<span class="line-numbers">51</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">52</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">53</span>    Response addSystem(
<span class="line-numbers">54</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">55</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">56</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">57</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize);
<span class="line-numbers">58</span>    <span class="comment">// end::addSystem[]</span>
<span class="line-numbers">59</span>
<span class="line-numbers">60</span>    <span class="comment">// tag::updateSystem[]</span>
<span class="line-numbers">61</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">62</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">63</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">64</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">65</span>    Response updateSystem(
<span class="line-numbers">66</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">67</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">68</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">69</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize);
<span class="line-numbers">70</span>    <span class="comment">// end::updateSystem[]</span>
<span class="line-numbers">71</span>
<span class="line-numbers">72</span>    <span class="comment">// tag::removeSystem[]</span>
<span class="line-numbers">73</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">74</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">75</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">76</span>    Response removeSystem(
<span class="line-numbers">77</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname);
<span class="line-numbers">78</span>    <span class="comment">// end::removeSystem[]</span>
<span class="line-numbers">79</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot file=0">SystemResourceClient</code> interface declares the <code class="hotspot=listContents file=0">listContents()</code>, <code class="hotspot=getSystem file=0">getSystem()</code>, <code class="hotspot=addSystem file=0">addSystem()</code>, <code class="hotspot=updateSystem file=0">updateSystem()</code>, and <code class="hotspot=removeSystem file=0">removeSystem()</code> methods for accessing the corresponding endpoints within the <code>inventory</code> microservice.</p>
</div>
<div class="paragraph">
<p>Next, create the <code>SystemData</code> data model for testing.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>SystemData</code> class.</mark>
<code>src/test/java/it/io/openliberty/guides/inventory/SystemData.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemData.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.inventory</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemData</span> {
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>    <span class="comment">// tag::fields[]</span>
<span class="line-numbers">17</span>    <span class="directive">private</span> <span class="type">int</span> id;
<span class="line-numbers">18</span>    <span class="directive">private</span> <span class="predefined-type">String</span> hostname;
<span class="line-numbers">19</span>    <span class="directive">private</span> <span class="predefined-type">String</span> osName;
<span class="line-numbers">20</span>    <span class="directive">private</span> <span class="predefined-type">String</span> javaVersion;
<span class="line-numbers">21</span>    <span class="directive">private</span> <span class="predefined-type">Long</span> heapSize;
<span class="line-numbers">22</span>    <span class="comment">// end::fields[]</span>
<span class="line-numbers">23</span>
<span class="line-numbers">24</span>    <span class="directive">public</span> SystemData() {
<span class="line-numbers">25</span>    }
<span class="line-numbers">26</span>
<span class="line-numbers">27</span>    <span class="comment">// tag::getMethods[]</span>
<span class="line-numbers">28</span>    <span class="directive">public</span> <span class="type">int</span> getId() {
<span class="line-numbers">29</span>        <span class="keyword">return</span> id;
<span class="line-numbers">30</span>    }
<span class="line-numbers">31</span>
<span class="line-numbers">32</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers">33</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers">34</span>    }
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOsName() {
<span class="line-numbers">37</span>        <span class="keyword">return</span> osName;
<span class="line-numbers">38</span>    }
<span class="line-numbers">39</span>
<span class="line-numbers">40</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJavaVersion() {
<span class="line-numbers">41</span>        <span class="keyword">return</span> javaVersion;
<span class="line-numbers">42</span>    }
<span class="line-numbers">43</span>
<span class="line-numbers">44</span>    <span class="directive">public</span> <span class="predefined-type">Long</span> getHeapSize() {
<span class="line-numbers">45</span>        <span class="keyword">return</span> heapSize;
<span class="line-numbers">46</span>    }
<span class="line-numbers">47</span>    <span class="comment">// end::getMethods[]</span>
<span class="line-numbers">48</span>
<span class="line-numbers">49</span>    <span class="comment">// tag::setMethods[]</span>
<span class="line-numbers">50</span>    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
<span class="line-numbers">51</span>        <span class="local-variable">this</span>.id = id;
<span class="line-numbers">52</span>    }
<span class="line-numbers">53</span>
<span class="line-numbers">54</span>    <span class="directive">public</span> <span class="type">void</span> setHostname(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">55</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">56</span>    }
<span class="line-numbers">57</span>
<span class="line-numbers">58</span>    <span class="directive">public</span> <span class="type">void</span> setOsName(<span class="predefined-type">String</span> osName) {
<span class="line-numbers">59</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">60</span>    }
<span class="line-numbers">61</span>
<span class="line-numbers">62</span>    <span class="directive">public</span> <span class="type">void</span> setJavaVersion(<span class="predefined-type">String</span> javaVersion) {
<span class="line-numbers">63</span>        <span class="local-variable">this</span>.javaVersion = javaVersion;
<span class="line-numbers">64</span>    }
<span class="line-numbers">65</span>
<span class="line-numbers">66</span>    <span class="directive">public</span> <span class="type">void</span> setHeapSize(<span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">67</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">68</span>    }
<span class="line-numbers">69</span>    <span class="comment">// end::setMethods[]</span>
<span class="line-numbers">70</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot file=1">SystemData</code> class contains the ID, hostname, operating system name, Java version, and heap size properties. The various <code class="hotspot=getMethods file=1">get</code> and <code class="hotspot=setMethods file=1">set</code> methods within this class enable you to view and edit the properties of each system in the inventory.</p>
</div>
</div>
<div class="sect2">
<h3 id="building-test-container-for-open-liberty">Building test container for Open Liberty</h3>
<div class="paragraph">
<p>Next, you’ll learn to create a custom class that extends Testcontainers' generic container to define specific configurations that suit your application’s requirements.</p>
</div>
<div class="paragraph">
<p>Define a custom <code>LibertyContainer</code> class, which provides a framework to start and access a containerized version of the Open Liberty application for testing.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>LibertyContainer</code> class.</mark>
<code>src/test/java/it/io/openliberty/guides/inventory/LibertyContainer.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>LibertyContainer.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.inventory</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.GenericContainer</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.wait.strategy.Wait</span>;
<span class="line-numbers">16</span>
<span class="line-numbers">17</span><span class="comment">// tag::GenericContainer[]</span>
<span class="line-numbers">18</span><span class="directive">public</span> <span class="type">class</span> <span class="class">LibertyContainer</span> <span class="directive">extends</span> GenericContainer&lt;LibertyContainer&gt; {
<span class="line-numbers">19</span><span class="comment">// end::GenericContainer[]</span>
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>    <span class="directive">public</span> LibertyContainer(<span class="predefined-type">String</span> imageName, <span class="type">int</span> httpPort, <span class="type">int</span> httpsPort) {
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>        <span class="local-variable">super</span>(imageName);
<span class="line-numbers">24</span>        <span class="comment">// tag::addExposedPorts1[]</span>
<span class="line-numbers">25</span>        addExposedPorts(httpPort, httpsPort);
<span class="line-numbers">26</span>        <span class="comment">// end::addExposedPorts1[]</span>
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>        <span class="comment">// wait for smarter planet message by default</span>
<span class="line-numbers">29</span>        <span class="comment">// tag::waitingFor[]</span>
<span class="line-numbers">30</span>        waitingFor(Wait.forLogMessage(<span class="string"><span class="delimiter">"</span><span class="content">^.*CWWKF0011I.*$</span><span class="delimiter">"</span></span>, <span class="integer">1</span>));
<span class="line-numbers">31</span>        <span class="comment">// end::waitingFor[]</span>
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>    }
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>    <span class="comment">// tag::getBaseURL[]</span>
<span class="line-numbers">36</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getBaseURL() <span class="directive">throws</span> <span class="exception">IllegalStateException</span> {
<span class="line-numbers">37</span>        <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">http://</span><span class="delimiter">"</span></span> + getHost() + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + getFirstMappedPort();
<span class="line-numbers">38</span>    }
<span class="line-numbers">39</span>    <span class="comment">// end::getBaseURL[]</span>
<span class="line-numbers">40</span>
<span class="line-numbers">41</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot file=0">LibertyContainer</code> class extends the <code class="hotspot=GenericContainer file=0">GenericContainer</code> class from Testcontainers to create a custom container configuration specific to the Open Liberty application.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=addExposedPorts1 hotspot=addExposedPorts2 file=0">addExposedPorts()</code> method exposes specified ports from the container’s perspective, allowing test clients to communicate with services running inside the container. To avoid any port conflicts, Testcontainers assigns random host ports to these exposed container ports.</p>
</div>
<div class="paragraph">
<p>By default, the <code class="hotspot=waitingFor file=0">Wait.forLogMessage()</code> method directs <code>LibertyContainer</code> to wait for the specific <code>CWWKF0011I</code> log message that indicates the Liberty instance has started successfully.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getBaseURL file=0">getBaseURL()</code> method contructs the base URL to access the container.</p>
</div>
<div class="paragraph">
<p>For more information about Testcontainers APIs and its functionality, refer to the <a href="https://javadoc.io/doc/org.testcontainers/testcontainers/latest/index.html" target="_blank" rel="noopener noreferrer">Testcontainers JavaDocs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="building-test-cases">Building test cases</h3>
<div class="paragraph">
<p>Next, you’ll learn to write tests that use the <code>SystemResourceClient</code> REST client and the Testcontainers integration. You’ll set up a multi-container test environment, determine the appropriate environment to launch Testcontainers, and configure the test REST client for HTTPS communication.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemResourceIT</code> class.</mark>
<code>src/test/java/it/io/openliberty/guides/inventory/SystemResourceIT.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResourceIT.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.inventory</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.net.Socket</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 18</span>
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.jboss.resteasy.client.jaxrs.ResteasyClient</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.jboss.resteasy.client.jaxrs.ResteasyClientBuilder</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.jboss.resteasy.client.jaxrs.ResteasyWebTarget</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.AfterAll</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.MethodOrderer.OrderAnnotation</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Order</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.TestMethodOrder</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">org.slf4j.Logger</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.GenericContainer</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.Network</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.output.Slf4jLogConsumer</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.wait.strategy.Wait</span>;
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.UriBuilder</span>;
<span class="line-numbers"> 37</span>
<span class="line-numbers"> 38</span><span class="annotation">@TestMethodOrder</span>(OrderAnnotation.class)
<span class="line-numbers"> 39</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResourceIT</span> {
<span class="line-numbers"> 40</span>
<span class="line-numbers"> 41</span>    <span class="comment">// tag::getLogger[]</span>
<span class="line-numbers"> 42</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = LoggerFactory.getLogger(SystemResourceIT.class);
<span class="line-numbers"> 43</span>    <span class="comment">// end::getLogger[]</span>
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DB_HOST = <span class="string"><span class="delimiter">"</span><span class="content">postgres</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 46</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> DB_PORT = <span class="integer">5432</span>;
<span class="line-numbers"> 47</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DB_IMAGE = <span class="string"><span class="delimiter">"</span><span class="content">postgres-sample:latest</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="type">int</span> httpPort = <span class="predefined-type">Integer</span>.parseInt(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">http.port</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 50</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="type">int</span> httpsPort = <span class="predefined-type">Integer</span>.parseInt(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">https.port</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 51</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> contextRoot = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">context.root</span><span class="delimiter">"</span></span>) + <span class="string"><span class="delimiter">"</span><span class="content">/api</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 52</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> invImage = <span class="string"><span class="delimiter">"</span><span class="content">inventory:1.0-SNAPSHOT</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 53</span>
<span class="line-numbers"> 54</span>    <span class="directive">private</span> <span class="directive">static</span> SystemResourceClient client;
<span class="line-numbers"> 55</span>    <span class="comment">// tag::network1[]</span>
<span class="line-numbers"> 56</span>    <span class="directive">private</span> <span class="directive">static</span> Network network = Network.newNetwork();
<span class="line-numbers"> 57</span>    <span class="comment">// end::network1[]</span>
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="comment">// tag::postgresContainer[]</span>
<span class="line-numbers"> 60</span>    <span class="comment">// tag::GenericContainer[]</span>
<span class="line-numbers"> 61</span>    <span class="directive">private</span> <span class="directive">static</span> GenericContainer&lt;?&gt; postgresContainer
<span class="line-numbers"> 62</span>    <span class="comment">// end::GenericContainer[]</span>
<span class="line-numbers"> 63</span>        = <span class="keyword">new</span> GenericContainer&lt;&gt;(DB_IMAGE)
<span class="line-numbers"> 64</span>              <span class="comment">// tag::network2[]</span>
<span class="line-numbers"> 65</span>              .withNetwork(network)
<span class="line-numbers"> 66</span>              <span class="comment">// end::network2[]</span>
<span class="line-numbers"> 67</span>              .withExposedPorts(DB_PORT)
<span class="line-numbers"> 68</span>              .withNetworkAliases(DB_HOST)
<span class="line-numbers"> 69</span>              <span class="comment">// tag::withLogConsumer1[]</span>
<span class="line-numbers"> 70</span>              .withLogConsumer(<span class="keyword">new</span> Slf4jLogConsumer(logger));
<span class="line-numbers"> 71</span>              <span class="comment">// end::withLogConsumer1[]</span>
<span class="line-numbers"> 72</span>    <span class="comment">// end::postgresContainer[]</span>
<span class="line-numbers"> 73</span>
<span class="line-numbers"> 74</span>    <span class="comment">// tag::inventoryContainer[]</span>
<span class="line-numbers"> 75</span>    <span class="comment">// tag::LibertyContainer[]</span>
<span class="line-numbers"> 76</span>    <span class="directive">private</span> <span class="directive">static</span> LibertyContainer inventoryContainer
<span class="line-numbers"> 77</span>    <span class="comment">// end::LibertyContainer[]</span>
<span class="line-numbers"> 78</span>        = <span class="keyword">new</span> LibertyContainer(invImage, httpPort, httpsPort)
<span class="line-numbers"> 79</span>              .withEnv(<span class="string"><span class="delimiter">"</span><span class="content">DB_HOSTNAME</span><span class="delimiter">"</span></span>, DB_HOST)
<span class="line-numbers"> 80</span>              <span class="comment">// tag::network3[]</span>
<span class="line-numbers"> 81</span>              .withNetwork(network)
<span class="line-numbers"> 82</span>              <span class="comment">// end::network3[]</span>
<span class="line-numbers"> 83</span>              <span class="comment">// tag::waitingFor[]</span>
<span class="line-numbers"> 84</span>              .waitingFor(Wait.forHttp(<span class="string"><span class="delimiter">"</span><span class="content">/health/ready</span><span class="delimiter">"</span></span>).forPort(httpPort))
<span class="line-numbers"> 85</span>              <span class="comment">// end::waitingFor[]</span>
<span class="line-numbers"> 86</span>              <span class="comment">// tag::withLogConsumer2[]</span>
<span class="line-numbers"> 87</span>              .withLogConsumer(<span class="keyword">new</span> Slf4jLogConsumer(logger));
<span class="line-numbers"> 88</span>              <span class="comment">// end::withLogConsumer2[]</span>
<span class="line-numbers"> 89</span>    <span class="comment">// end::inventoryContainer[]</span>
<span class="line-numbers"> 90</span>
<span class="line-numbers"> 91</span>    <span class="comment">// tag::isServiceRunning[]</span>
<span class="line-numbers"> 92</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="type">boolean</span> isServiceRunning(<span class="predefined-type">String</span> host, <span class="type">int</span> port) {
<span class="line-numbers"> 93</span>        <span class="keyword">try</span> {
<span class="line-numbers"> 94</span>            <span class="predefined-type">Socket</span> socket = <span class="keyword">new</span> <span class="predefined-type">Socket</span>(host, port);
<span class="line-numbers"> 95</span>            socket.close();
<span class="line-numbers"> 96</span>            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
<span class="line-numbers"> 97</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers"> 98</span>            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
<span class="line-numbers"> 99</span>        }
<span class="line-numbers">100</span>    }
<span class="line-numbers">101</span>    <span class="comment">// end::isServiceRunning[]</span>
<span class="line-numbers">102</span>
<span class="line-numbers">103</span>    <span class="comment">// tag::createRestClient[]</span>
<span class="line-numbers">104</span>    <span class="directive">private</span> <span class="directive">static</span> SystemResourceClient createRestClient(<span class="predefined-type">String</span> urlPath) {
<span class="line-numbers">105</span>        ClientBuilder builder = ResteasyClientBuilder.newBuilder();
<span class="line-numbers">106</span>        ResteasyClient client = (ResteasyClient) builder.build();
<span class="line-numbers">107</span>        ResteasyWebTarget target = client.target(UriBuilder.fromPath(urlPath));
<span class="line-numbers">108</span>        <span class="keyword">return</span> target.proxy(SystemResourceClient.class);
<span class="line-numbers">109</span>    }
<span class="line-numbers">110</span>    <span class="comment">// end::createRestClient[]</span>
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>    <span class="comment">// tag::setup[]</span>
<span class="line-numbers">113</span>    <span class="annotation">@BeforeAll</span>
<span class="line-numbers">114</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setup() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers">115</span>        <span class="predefined-type">String</span> urlPath;
<span class="line-numbers">116</span>        <span class="keyword">if</span> (isServiceRunning(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>, httpPort)) {
<span class="line-numbers">117</span>            logger.info(<span class="string"><span class="delimiter">"</span><span class="content">Testing by dev mode or local Liberty...</span><span class="delimiter">"</span></span>);
<span class="line-numbers">118</span>            <span class="keyword">if</span> (isServiceRunning(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>, DB_PORT)) {
<span class="line-numbers">119</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">The application is ready to test.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">120</span>                urlPath = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost:</span><span class="delimiter">"</span></span> + httpPort;
<span class="line-numbers">121</span>            } <span class="keyword">else</span> {
<span class="line-numbers">122</span>                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">Exception</span>(<span class="string"><span class="delimiter">"</span><span class="content">Postgres database is not running</span><span class="delimiter">"</span></span>);
<span class="line-numbers">123</span>            }
<span class="line-numbers">124</span>        } <span class="keyword">else</span> {
<span class="line-numbers">125</span>            logger.info(<span class="string"><span class="delimiter">"</span><span class="content">Testing by using Testcontainers...</span><span class="delimiter">"</span></span>);
<span class="line-numbers">126</span>            <span class="keyword">if</span> (isServiceRunning(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>, DB_PORT)) {
<span class="line-numbers">127</span>                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">Exception</span>(
<span class="line-numbers">128</span>                      <span class="string"><span class="delimiter">"</span><span class="content">Postgres database is running locally. Stop it and retry.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">129</span>            } <span class="keyword">else</span> {
<span class="line-numbers">130</span>                <span class="comment">// tag::postgresContainerStart[]</span>
<span class="line-numbers">131</span>                postgresContainer.start();
<span class="line-numbers">132</span>                <span class="comment">// end::postgresContainerStart[]</span>
<span class="line-numbers">133</span>                <span class="comment">// tag::inventoryContainerStart[]</span>
<span class="line-numbers">134</span>                inventoryContainer.start();
<span class="line-numbers">135</span>                <span class="comment">// end::inventoryContainerStart[]</span>
<span class="line-numbers">136</span>                urlPath = inventoryContainer.getBaseURL();
<span class="line-numbers">137</span>            }
<span class="line-numbers">138</span>        }
<span class="line-numbers">139</span>        urlPath += contextRoot;
<span class="line-numbers">140</span>        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">TEST: </span><span class="delimiter">"</span></span> + urlPath);
<span class="line-numbers">141</span>        client = createRestClient(urlPath);
<span class="line-numbers">142</span>    }
<span class="line-numbers">143</span>    <span class="comment">// end::setup[]</span>
<span class="line-numbers">144</span>
<span class="line-numbers">145</span>    <span class="comment">// tag::tearDown[]</span>
<span class="line-numbers">146</span>    <span class="annotation">@AfterAll</span>
<span class="line-numbers">147</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> tearDown() {
<span class="line-numbers">148</span>        inventoryContainer.stop();
<span class="line-numbers">149</span>        postgresContainer.stop();
<span class="line-numbers">150</span>        network.close();
<span class="line-numbers">151</span>    }
<span class="line-numbers">152</span>    <span class="comment">// end::tearDown[]</span>
<span class="line-numbers">153</span>
<span class="line-numbers">154</span>    <span class="directive">private</span> <span class="type">void</span> showSystemData(SystemData system) {
<span class="line-numbers">155</span>        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">TEST: SystemData &gt; </span><span class="delimiter">"</span></span>
<span class="line-numbers">156</span>            + system.getId() + <span class="string"><span class="delimiter">"</span><span class="content">, </span><span class="delimiter">"</span></span>
<span class="line-numbers">157</span>            + system.getHostname() + <span class="string"><span class="delimiter">"</span><span class="content">, </span><span class="delimiter">"</span></span>
<span class="line-numbers">158</span>            + system.getOsName() + <span class="string"><span class="delimiter">"</span><span class="content">, </span><span class="delimiter">"</span></span>
<span class="line-numbers">159</span>            + system.getJavaVersion() + <span class="string"><span class="delimiter">"</span><span class="content">, </span><span class="delimiter">"</span></span>
<span class="line-numbers">160</span>            + system.getHeapSize());
<span class="line-numbers">161</span>    }
<span class="line-numbers">162</span>
<span class="line-numbers">163</span>    <span class="comment">// tag::testAddSystem[]</span>
<span class="line-numbers">164</span>    <span class="annotation">@Test</span>
<span class="line-numbers">165</span>    <span class="annotation">@Order</span>(<span class="integer">1</span>)
<span class="line-numbers">166</span>    <span class="directive">public</span> <span class="type">void</span> testAddSystem() {
<span class="line-numbers">167</span>        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">TEST: Testing add a system</span><span class="delimiter">"</span></span>);
<span class="line-numbers">168</span>        <span class="comment">// tag::addSystem[]</span>
<span class="line-numbers">169</span>        client.addSystem(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>, <span class="predefined-type">Long</span>.valueOf(<span class="integer">2048</span>));
<span class="line-numbers">170</span>        <span class="comment">// end::addSystem[]</span>
<span class="line-numbers">171</span>        <span class="comment">// tag::listContents[]</span>
<span class="line-numbers">172</span>        <span class="predefined-type">List</span>&lt;SystemData&gt; systems = client.listContents();
<span class="line-numbers">173</span>        <span class="comment">// end::listContents[]</span>
<span class="line-numbers">174</span>        assertEquals(<span class="integer">1</span>, systems.size());
<span class="line-numbers">175</span>        showSystemData(systems.get(<span class="integer">0</span>));
<span class="line-numbers">176</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>, systems.get(<span class="integer">0</span>).getJavaVersion());
<span class="line-numbers">177</span>        assertEquals(<span class="predefined-type">Long</span>.valueOf(<span class="integer">2048</span>), systems.get(<span class="integer">0</span>).getHeapSize());
<span class="line-numbers">178</span>    }
<span class="line-numbers">179</span>    <span class="comment">// end::testAddSystem[]</span>
<span class="line-numbers">180</span>
<span class="line-numbers">181</span>    <span class="comment">// tag::testUpdateSystem[]</span>
<span class="line-numbers">182</span>    <span class="annotation">@Test</span>
<span class="line-numbers">183</span>    <span class="annotation">@Order</span>(<span class="integer">2</span>)
<span class="line-numbers">184</span>    <span class="directive">public</span> <span class="type">void</span> testUpdateSystem() {
<span class="line-numbers">185</span>        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">TEST: Testing update a system</span><span class="delimiter">"</span></span>);
<span class="line-numbers">186</span>        <span class="comment">// tag::updateSystem[]</span>
<span class="line-numbers">187</span>        client.updateSystem(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">8</span><span class="delimiter">"</span></span>, <span class="predefined-type">Long</span>.valueOf(<span class="integer">1024</span>));
<span class="line-numbers">188</span>        <span class="comment">// end::updateSystem[]</span>
<span class="line-numbers">189</span>        <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers">190</span>        SystemData system = client.getSystem(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>);
<span class="line-numbers">191</span>        <span class="comment">// end::getSystem[]</span>
<span class="line-numbers">192</span>        showSystemData(system);
<span class="line-numbers">193</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">8</span><span class="delimiter">"</span></span>, system.getJavaVersion());
<span class="line-numbers">194</span>        assertEquals(<span class="predefined-type">Long</span>.valueOf(<span class="integer">1024</span>), system.getHeapSize());
<span class="line-numbers">195</span>    }
<span class="line-numbers">196</span>    <span class="comment">// end::testUpdateSystem[]</span>
<span class="line-numbers">197</span>
<span class="line-numbers">198</span>    <span class="comment">// tag::testRemoveSystem[]</span>
<span class="line-numbers">199</span>    <span class="annotation">@Test</span>
<span class="line-numbers">200</span>    <span class="annotation">@Order</span>(<span class="integer">3</span>)
<span class="line-numbers">201</span>    <span class="directive">public</span> <span class="type">void</span> testRemoveSystem() {
<span class="line-numbers">202</span>        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">TEST: Testing remove a system</span><span class="delimiter">"</span></span>);
<span class="line-numbers">203</span>        <span class="comment">// tag::removeSystem[]</span>
<span class="line-numbers">204</span>        client.removeSystem(<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>);
<span class="line-numbers">205</span>        <span class="comment">// end::removeSystem[]</span>
<span class="line-numbers">206</span>        <span class="predefined-type">List</span>&lt;SystemData&gt; systems = client.listContents();
<span class="line-numbers">207</span>        assertEquals(<span class="integer">0</span>, systems.size());
<span class="line-numbers">208</span>    }
<span class="line-numbers">209</span>    <span class="comment">// end::testRemoveSystem[]</span>
<span class="line-numbers">210</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>LibertyContainer.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.inventory</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.GenericContainer</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">org.testcontainers.containers.wait.strategy.Wait</span>;
<span class="line-numbers">16</span>
<span class="line-numbers">17</span><span class="comment">// tag::GenericContainer[]</span>
<span class="line-numbers">18</span><span class="directive">public</span> <span class="type">class</span> <span class="class">LibertyContainer</span> <span class="directive">extends</span> GenericContainer&lt;LibertyContainer&gt; {
<span class="line-numbers">19</span><span class="comment">// end::GenericContainer[]</span>
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>    <span class="directive">public</span> LibertyContainer(<span class="predefined-type">String</span> imageName, <span class="type">int</span> httpPort, <span class="type">int</span> httpsPort) {
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>        <span class="local-variable">super</span>(imageName);
<span class="line-numbers">24</span>        <span class="comment">// tag::addExposedPorts1[]</span>
<span class="line-numbers">25</span>        addExposedPorts(httpPort, httpsPort);
<span class="line-numbers">26</span>        <span class="comment">// end::addExposedPorts1[]</span>
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>        <span class="comment">// wait for smarter planet message by default</span>
<span class="line-numbers">29</span>        <span class="comment">// tag::waitingFor[]</span>
<span class="line-numbers">30</span>        waitingFor(Wait.forLogMessage(<span class="string"><span class="delimiter">"</span><span class="content">^.*CWWKF0011I.*$</span><span class="delimiter">"</span></span>, <span class="integer">1</span>));
<span class="line-numbers">31</span>        <span class="comment">// end::waitingFor[]</span>
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>    }
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>    <span class="comment">// tag::getBaseURL[]</span>
<span class="line-numbers">36</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getBaseURL() <span class="directive">throws</span> <span class="exception">IllegalStateException</span> {
<span class="line-numbers">37</span>        <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">http://</span><span class="delimiter">"</span></span> + getHost() + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + getFirstMappedPort();
<span class="line-numbers">38</span>    }
<span class="line-numbers">39</span>    <span class="comment">// end::getBaseURL[]</span>
<span class="line-numbers">40</span>
<span class="line-numbers">41</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code class="hotspot=GenericContainer file=0">GenericContainer</code> class to create the <code class="hotspot=postgresContainer file=0">postgresContainer</code> test container to start up the PostgreSQL container image, and use the <code class="hotspot=LibertyContainer file=0">LibertyContainer</code> custom class to create the <code class="hotspot=inventoryContainer file=0">inventoryContainer</code> test container to start up the <code>inventory</code> container image. Because containers are isolated by default, make sure both containers use the same <code class="hotspot=network1 hotspot=network2 hotspot=network3 file=0">network</code> for them to communicate.</p>
</div>
<div class="paragraph">
<p>ReadinessCheck.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.inventory.health</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">java.net.Socket</span>;
<span class="line-numbers">15</span>
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheck</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheckResponse</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheckResponseBuilder</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.Readiness</span>;
<span class="line-numbers">21</span>
<span class="line-numbers">22</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers">24</span>
<span class="line-numbers">25</span><span class="annotation">@Readiness</span>
<span class="line-numbers">26</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">27</span><span class="directive">public</span> <span class="type">class</span> <span class="class">ReadinessCheck</span> <span class="directive">implements</span> HealthCheck {
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>    <span class="annotation">@Inject</span>
<span class="line-numbers">30</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">db.hostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers">31</span>    <span class="directive">private</span> <span class="predefined-type">String</span> host;
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>    <span class="annotation">@Inject</span>
<span class="line-numbers">34</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">db.portnum</span><span class="delimiter">"</span></span>)
<span class="line-numbers">35</span>    <span class="directive">private</span> <span class="type">int</span> port;
<span class="line-numbers">36</span>
<span class="line-numbers">37</span>    <span class="annotation">@Override</span>
<span class="line-numbers">38</span>    <span class="directive">public</span> HealthCheckResponse call() {
<span class="line-numbers">39</span>        HealthCheckResponseBuilder responseBuilder =
<span class="line-numbers">40</span>            HealthCheckResponse.named(<span class="string"><span class="delimiter">"</span><span class="content">Readiness Check</span><span class="delimiter">"</span></span>);
<span class="line-numbers">41</span>
<span class="line-numbers">42</span>        <span class="keyword">try</span> {
<span class="line-numbers">43</span>            <span class="predefined-type">Socket</span> socket = <span class="keyword">new</span> <span class="predefined-type">Socket</span>(host, port);
<span class="line-numbers">44</span>            socket.close();
<span class="line-numbers">45</span>            responseBuilder.up();
<span class="line-numbers">46</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers">47</span>            responseBuilder.down();
<span class="line-numbers">48</span>        }
<span class="line-numbers">49</span>        <span class="keyword">return</span> responseBuilder.build();
<span class="line-numbers">50</span>    }
<span class="line-numbers">51</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <code>inventory</code> service provides the <code class="hotspot file=2">/health/ready</code> health readiness check, call the <code class="hotspot=waitingFor file=0">waitingFor()</code> method again to override the default <code class="hotspot=waitingFor file=1">waitingFor()</code> method in <code class="hotspot file=1">LibertyContainer</code>. That ensures the <code>inventoryContainer</code> is ready before tests run by checking the <code class="hotspot=waitingFor file=0">/health/ready</code> REST API instead of the log message. For different container readiness check customizations, refer to the <a href="https://www.testcontainers.org/features/startup_and_waits/" target="_blank" rel="noopener noreferrer">official Testcontainers documentation</a>.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getLogger file=0">LoggerFactory.getLogger()</code> and <code class="hotspot=withLogConsumer1 hotspot=withLogConsumer2 file=0">withLogConsumer(new Slf4jLogConsumer(Logger))</code> methods integrate container logs with the test logs by piping the container output to the specified logger.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=createRestClient file=0">createRestClient()</code> method creates a REST client instance with the <code>SystemResourceClient</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=setup file=0">setup()</code> method prepares the test environment. It checks whether the test is running in dev mode or there is a local running Liberty instance, by using the <code class="hotspot=isServiceRunning file=0">isServiceRunning()</code> helper. In the case of no running Liberty instance, the test starts the <code class="hotspot=postgresContainerStart file=0">postgresContainer</code> and <code class="hotspot=inventoryContainerStart file=0">inventoryContainer</code> test containers. Otherwise, it ensures that the Postgres database is running locally.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testAddSystem file=0">testAddSystem()</code> verifies the <code class="hotspot=addSystem file=0">addSystem</code> and <code class="hotspot=listContents file=0">listContents</code> endpoints.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testUpdateSystem file=0">testUpdateSystem()</code> verifies the <code class="hotspot=updateSystem file=0">updateSystem</code> and <code class="hotspot=getSystem file=0">getSystem</code> endpoints.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testRemoveSystem file=0">testRemoveSystem()</code> verifies the <code class="hotspot=removeSystem file=0">removeSystem</code> endpoint.</p>
</div>
<div class="paragraph">
<p>After tests, the <code class="hotspot=tearDown file=0">tearDown()</code> method stops the containers and closes the network.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-logs">Setting up logs</h3>
<div class="paragraph">
<p>Having reliable logs is essential for efficient debugging, as they provide detailed insights into the test execution flow and help pinpoint issues during test failures. Testcontainers' built-in <code>Slf4jLogConsumer</code> enables integration of container output directly with the JUnit process, enhancing log analysis and simplifying test creation and debugging.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>log4j.properties</code> file.</mark>
<code>src/test/resources/log4j.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>log4j.properties</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"><span class="line-numbers"> 1</span>log4j.rootLogger=INFO, stdout
<span class="line-numbers"> 2</span>
<span class="line-numbers"> 3</span>log4j.appender=org.apache.log4j.ConsoleAppender
<span class="line-numbers"> 4</span>log4j.appender.layout=org.apache.log4j.PatternLayout
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>log4j.appender.stdout=org.apache.log4j.ConsoleAppender
<span class="line-numbers"> 7</span>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
<span class="line-numbers"> 8</span>log4j.appender.stdout.layout.ConversionPattern=%r %p %c %x - %m%n
<span class="line-numbers"> 9</span>
<span class="line-numbers">10</span># tag::package[]
<span class="line-numbers">11</span>log4j.logger.it.io.openliberty.guides.inventory=DEBUG
<span class="line-numbers">12</span># end::package[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot file=0">log4j.properties</code> file configures the root logger, appenders, and layouts for console output. It sets the logging level to <code>DEBUG</code> for the <code class="hotspot=package file=0">it.io.openliberty.guides.inventory</code> package. This level provides detailed logging information for the specified package, which can be helpful for debugging and understanding test behavior.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-maven-project">Configuring Maven project</h3>
<div class="paragraph">
<p>Next, you’ll learn to prepare your Maven project for test execution. You’ll add the required dependencies for Testcontainers and logging, set up Maven to copy the PostgreSQL JDBC driver during the build phase, and configure the Liberty Maven Plugin to handle PostgreSQL dependency.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>pom.xml</code> file.</mark>
<code>pom.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>pom.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="line-numbers">  1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="line-numbers">  2</span><span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span>
<span class="line-numbers">  3</span>         <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span>
<span class="line-numbers">  4</span>         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">  5</span>
<span class="line-numbers">  6</span>    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>
<span class="line-numbers">  7</span>
<span class="line-numbers">  8</span>    <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">  9</span>    <span class="tag">&lt;artifactId&gt;</span>guide-testcontainers<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 10</span>    <span class="tag">&lt;packaging&gt;</span>war<span class="tag">&lt;/packaging&gt;</span>
<span class="line-numbers"> 11</span>    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 12</span>
<span class="line-numbers"> 13</span>    <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers"> 14</span>        <span class="tag">&lt;maven.compiler.source&gt;</span>11<span class="tag">&lt;/maven.compiler.source&gt;</span>
<span class="line-numbers"> 15</span>        <span class="tag">&lt;maven.compiler.target&gt;</span>11<span class="tag">&lt;/maven.compiler.target&gt;</span>
<span class="line-numbers"> 16</span>        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
<span class="line-numbers"> 17</span>        <span class="tag">&lt;liberty.var.default.http.port&gt;</span>9080<span class="tag">&lt;/liberty.var.default.http.port&gt;</span>
<span class="line-numbers"> 18</span>        <span class="tag">&lt;liberty.var.default.https.port&gt;</span>9443<span class="tag">&lt;/liberty.var.default.https.port&gt;</span>
<span class="line-numbers"> 19</span>        <span class="tag">&lt;liberty.var.default.context.root&gt;</span>/inventory<span class="tag">&lt;/liberty.var.default.context.root&gt;</span>
<span class="line-numbers"> 20</span>    <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span>    <span class="tag">&lt;dependencies&gt;</span>
<span class="line-numbers"> 23</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 24</span>            <span class="tag">&lt;groupId&gt;</span>jakarta.platform<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 25</span>            <span class="tag">&lt;artifactId&gt;</span>jakarta.jakartaee-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 26</span>            <span class="tag">&lt;version&gt;</span>10.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 27</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 28</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 29</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 30</span>            <span class="tag">&lt;groupId&gt;</span>org.eclipse.microprofile<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 31</span>            <span class="tag">&lt;artifactId&gt;</span>microprofile<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 32</span>            <span class="tag">&lt;version&gt;</span>6.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 33</span>            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers"> 34</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 35</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 36</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 37</span>            <span class="tag">&lt;groupId&gt;</span>org.postgresql<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 38</span>            <span class="tag">&lt;artifactId&gt;</span>postgresql<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 39</span>            <span class="tag">&lt;version&gt;</span>42.3.8<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 40</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 41</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 42</span>        
<span class="line-numbers"> 43</span>        <span class="comment">&lt;!-- tag::testDependenies[] --&gt;</span>
<span class="line-numbers"> 44</span>        <span class="comment">&lt;!-- Test dependencies --&gt;</span>
<span class="line-numbers"> 45</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 46</span>            <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 47</span>            <span class="tag">&lt;artifactId&gt;</span>junit-jupiter<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 48</span>            <span class="tag">&lt;version&gt;</span>5.9.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 49</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 50</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 51</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 52</span>            <span class="tag">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 53</span>            <span class="tag">&lt;artifactId&gt;</span>resteasy-client<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 54</span>            <span class="tag">&lt;version&gt;</span>6.0.0.Final<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 55</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 56</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 57</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 58</span>            <span class="tag">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 59</span>            <span class="tag">&lt;artifactId&gt;</span>resteasy-json-binding-provider<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 60</span>            <span class="tag">&lt;version&gt;</span>6.0.0.Final<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 61</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 62</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 63</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 64</span>            <span class="tag">&lt;groupId&gt;</span>org.glassfish<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 65</span>            <span class="tag">&lt;artifactId&gt;</span>jakarta.json<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 66</span>            <span class="tag">&lt;version&gt;</span>2.0.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 67</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 68</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 69</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 70</span>            <span class="tag">&lt;groupId&gt;</span>org.eclipse<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 71</span>            <span class="tag">&lt;artifactId&gt;</span>yasson<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 72</span>            <span class="tag">&lt;version&gt;</span>2.0.4<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 73</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 74</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 75</span>        <span class="comment">&lt;!-- tag::testcontainers[] --&gt;</span>
<span class="line-numbers"> 76</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 77</span>            <span class="tag">&lt;groupId&gt;</span>org.testcontainers<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 78</span>            <span class="tag">&lt;artifactId&gt;</span>testcontainers<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 79</span>            <span class="tag">&lt;version&gt;</span>1.18.3<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 80</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 81</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 82</span>        <span class="comment">&lt;!-- end::testcontainers[] --&gt;</span>
<span class="line-numbers"> 83</span>        <span class="comment">&lt;!-- tag::slf4j[] --&gt;</span>
<span class="line-numbers"> 84</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 85</span>            <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 86</span>            <span class="tag">&lt;artifactId&gt;</span>slf4j-reload4j<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 87</span>            <span class="tag">&lt;version&gt;</span>2.0.7<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 88</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 89</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 90</span>        <span class="comment">&lt;!-- end::slf4j[] --&gt;</span>
<span class="line-numbers"> 91</span>        <span class="comment">&lt;!-- tag::slf4j-api[] --&gt;</span>
<span class="line-numbers"> 92</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 93</span>            <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 94</span>            <span class="tag">&lt;artifactId&gt;</span>slf4j-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 95</span>            <span class="tag">&lt;version&gt;</span>2.0.7<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 96</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 97</span>        <span class="comment">&lt;!-- end::slf4j-api[] --&gt;</span>
<span class="line-numbers"> 98</span>        <span class="comment">&lt;!-- end::testDependenies[] --&gt;</span>
<span class="line-numbers"> 99</span>    <span class="tag">&lt;/dependencies&gt;</span>
<span class="line-numbers">100</span>
<span class="line-numbers">101</span>    <span class="tag">&lt;build&gt;</span>
<span class="line-numbers">102</span>        <span class="tag">&lt;finalName&gt;</span>inventory<span class="tag">&lt;/finalName&gt;</span>
<span class="line-numbers">103</span>        <span class="tag">&lt;plugins&gt;</span>
<span class="line-numbers">104</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">105</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">106</span>                <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">107</span>                <span class="tag">&lt;version&gt;</span>3.3.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">108</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">109</span>            <span class="comment">&lt;!-- tag::maven-dependency-plugin[] --&gt;</span>
<span class="line-numbers">110</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">111</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">112</span>                <span class="tag">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">113</span>                <span class="tag">&lt;version&gt;</span>3.2.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">114</span>                <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers">115</span>                    <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">116</span>                        <span class="tag">&lt;id&gt;</span>copy-dependencies<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">117</span>                        <span class="tag">&lt;phase&gt;</span>prepare-package<span class="tag">&lt;/phase&gt;</span>
<span class="line-numbers">118</span>                        <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">119</span>                            <span class="tag">&lt;goal&gt;</span>copy-dependencies<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">120</span>                        <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">121</span>                        <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">122</span>                            <span class="tag">&lt;includeGroupIds&gt;</span>org.postgresql<span class="tag">&lt;/includeGroupIds&gt;</span>
<span class="line-numbers">123</span>                            <span class="tag">&lt;includeArtifactIds&gt;</span>postgresql<span class="tag">&lt;/includeArtifactIds&gt;</span>
<span class="line-numbers">124</span>                            <span class="tag">&lt;outputDirectory&gt;</span>${project.build.directory}/liberty/wlp/usr/shared/resources<span class="tag">&lt;/outputDirectory&gt;</span>
<span class="line-numbers">125</span>                        <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">126</span>                    <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">127</span>                <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers">128</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">129</span>            <span class="comment">&lt;!-- end::maven-dependency-plugin[] --&gt;</span>
<span class="line-numbers">130</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">131</span>                <span class="tag">&lt;groupId&gt;</span>io.openliberty.tools<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">132</span>                <span class="tag">&lt;artifactId&gt;</span>liberty-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">133</span>                <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">134</span>                    <span class="tag">&lt;copyDependencies&gt;</span>
<span class="line-numbers">135</span>                        <span class="tag">&lt;dependencyGroup&gt;</span>
<span class="line-numbers">136</span>                            <span class="tag">&lt;location&gt;</span>${project.build.directory}/liberty/wlp/usr/shared/resources<span class="tag">&lt;/location&gt;</span>
<span class="line-numbers">137</span>                            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers">138</span>                                <span class="tag">&lt;groupId&gt;</span>org.postgresql<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">139</span>                                <span class="tag">&lt;artifactId&gt;</span>postgresql<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">140</span>                            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">141</span>                        <span class="tag">&lt;/dependencyGroup&gt;</span>
<span class="line-numbers">142</span>                    <span class="tag">&lt;/copyDependencies&gt;</span>
<span class="line-numbers">143</span>                <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">144</span>                <span class="tag">&lt;version&gt;</span>3.8.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">145</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">146</span>            <span class="comment">&lt;!-- tag::failsafe[] --&gt;</span>
<span class="line-numbers">147</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">148</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">149</span>                <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">150</span>                <span class="tag">&lt;version&gt;</span>2.22.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">151</span>                <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">152</span>                    <span class="tag">&lt;systemPropertyVariables&gt;</span>
<span class="line-numbers">153</span>                        <span class="tag">&lt;http.port&gt;</span>${liberty.var.default.http.port}<span class="tag">&lt;/http.port&gt;</span>
<span class="line-numbers">154</span>                        <span class="tag">&lt;https.port&gt;</span>${liberty.var.default.https.port}<span class="tag">&lt;/https.port&gt;</span>
<span class="line-numbers">155</span>                        <span class="tag">&lt;context.root&gt;</span>${liberty.var.default.context.root}<span class="tag">&lt;/context.root&gt;</span>
<span class="line-numbers">156</span>                    <span class="tag">&lt;/systemPropertyVariables&gt;</span>
<span class="line-numbers">157</span>                <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">158</span>                <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers">159</span>                    <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">160</span>                        <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">161</span>                            <span class="tag">&lt;goal&gt;</span>integration-test<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">162</span>                            <span class="tag">&lt;goal&gt;</span>verify<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">163</span>                        <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">164</span>                    <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">165</span>                <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers">166</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">167</span>            <span class="comment">&lt;!-- end::failsafe[] --&gt;</span>
<span class="line-numbers">168</span>        <span class="tag">&lt;/plugins&gt;</span>
<span class="line-numbers">169</span>    <span class="tag">&lt;/build&gt;</span>
<span class="line-numbers">170</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the required <code>dependency</code> for Testcontainers and Log4J libraries with <code>test</code> scope. The <code class="hotspot=testcontainers file=0">testcontainers</code> dependency offers a general-purpose API for managing container-based test environments. The <code class="hotspot=slf4j file=0">slf4j-reload4j</code> and <code class="hotspot=slf4j-api file=0">slf4j-api</code> dependencies enable the Simple Logging Facade for Java (SLF4J) API for trace logging during test execution and facilitates debugging and test performance tracking.</p>
</div>
<div class="paragraph">
<p>The Maven pom.xml file contains a configuration for the <code class="hotspot=maven-dependency-plugin file=0">maven-dependency-plugin</code> to copy the PostgreSQL JDBC driver into the Liberty configuration’s shared resources directory. This setup occurs during the <code>prepare-package</code> phase. As a result, running the <code>mvn package</code> command ensures the PostgreSQL driver is prepared and accessible for your application when it runs on the Liberty.</p>
</div>
<div class="paragraph">
<p>Also, add and configure the <code class="hotspot=failsafe file=0">maven-failsafe-plugin</code> plugin, so that the integration test can be run by the Maven <code>verify</code> goal.</p>
</div>
<div class="paragraph">
<p>Because you started Open Liberty in dev mode, all the changes were automatically picked up. You can run the tests by pressing the <code>enter/return</code> key from the command-line session where you started dev mode. You will see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre> -------------------------------------------------------
  T E S T S
 -------------------------------------------------------
 Running it.io.openliberty.guides.inventory.SystemResourceIT
 it.io.openliberty.guides.inventory.SystemResourceIT  - Testing by dev mode or local Liberty...
 ...
 Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.873 s - in it.io.openliberty.guides.inventory.SystemResourceIT

 Results:

 Tests run: 3, Failures: 0, Errors: 0, Skipped: 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-tests-in-a-cicd-pipeline">Running tests in a CI/CD pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Running tests in dev mode is useful for local development, but there may be times when you want to test your application in other scenarios, such as in a CI/CD pipeline. For these cases, you can use Testcontainers to run tests against a running Open Liberty instance in a controlled, self-contained environment, ensuring that your tests run consistently regardless of the deployment context.</p>
</div>
<div class="paragraph">
<p>To test outside of dev mode, exit dev mode by pressing <code>CTRL+C</code> in the command-line session where you ran the Liberty, or by typing <code>q</code> and then pressing the <code>enter/return</code> key.</p>
</div>
<div class="paragraph">
<p>Also, run the following commands to stop the PostgreSQL container that was started in the previous section:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker stop postgres-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because you have already built the <code>inventory</code> container image in the <strong>Try what you’ll build</strong> section, there’s no need to build it again here.</p>
</div>
<div class="paragraph">
<p>Now, use the following Maven goal to run the tests from a cold start outside of dev mode:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section mac_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn verify</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>export TESTCONTAINERS_RYUK_DISABLED=true
mvn verify -Dtest.protocol=http</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You will see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre> -------------------------------------------------------
  T E S T S
 -------------------------------------------------------
 Running it.io.openliberty.guides.inventory.SystemResourceIT
 it.io.openliberty.guides.inventory.SystemResourceIT  - Testing by using Testcontainers...
 ...
 tc.postgres-sample:latest  - Creating container for image: postgres-sample:latest
 tc.postgres-sample:latest  - Container postgres-sample:latest is starting: 7cf2e2c6a505f41877014d08b7688399b3abb9725550e882f1d33db8fa4cff5a
 tc.postgres-sample:latest  - Container postgres-sample:latest started in PT2.925405S
 tc.inventory:1.0-SNAPSHOT  - Creating container for image: inventory:1.0-SNAPSHOT
 tc.inventory:1.0-SNAPSHOT  - Container inventory:1.0-SNAPSHOT is starting: 432ac739f377abe957793f358bbb85cc916439283ed2336014cacb585f9992b8
 it.io.openliberty.guides.inventory.SystemResourceIT  - STDOUT: [AUDIT   ] CWWKF0011I: The defaultServer server is ready to run a smarter planet. The defaultServer server started in 7.855 seconds.

 Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 12.208 s - in it.io.openliberty.guides.inventory.SystemResourceIT

 Results:

 Tests run: 3, Failures: 0, Errors: 0, Skipped: 0</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the test initiates a new Docker container each for the PostgreSQL database and the <code>inventory</code> microservice, resulting in a longer test runtime. Despite this, cold start testing benefits from a clean instance per run and ensures consistent results. These tests also automatically hook into existing build pipelines that are set up to run the <code>integration-test</code> phase.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You just tested your microservices with multiple Docker containers using Testcontainers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Building true-to-production integration tests with Testcontainers <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-testcontainers/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-testcontainers/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-testcontainers/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microshed-testing.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Testing a MicroProfile or Jakarta EE application</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/reactive-service-testing.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Testing reactive Java microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/arquillian-managed.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Testing microservices with the Arquillian managed container</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
