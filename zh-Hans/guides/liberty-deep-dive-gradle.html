<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      A hands-on technical deep dive on Liberty
    
  </title>
  <meta name="description" content="An in-depth and end-to-end tutorial with examples (akin to a &quot;masterclass&quot;) on how to easily develop cloud-native Java applications and microservices using Jakarta EE and MicroProfile APIs using Open Liberty and WebSphere Liberty as the runtime or framework, and how to build, run and deploy the applications in containers to Kubernetes.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/liberty-deep-dive-gradle">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="A hands-on technical deep dive on Liberty" />
  <meta name="twitter:description" content="An in-depth and end-to-end tutorial with examples (akin to a &quot;masterclass&quot;) on how to easily develop cloud-native Java applications and microservices using Jakarta EE and MicroProfile APIs using Open Liberty and WebSphere Liberty as the runtime or framework, and how to build, run and deploy the applications in containers to Kubernetes." />

  <meta property='og:title' content="A hands-on technical deep dive on Liberty" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="An in-depth and end-to-end tutorial with examples (akin to a &quot;masterclass&quot;) on how to easily develop cloud-native Java applications and microservices using Jakarta EE and MicroProfile APIs using Open Liberty and WebSphere Liberty as the runtime or framework, and how to build, run and deploy the applications in containers to Kubernetes." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/liberty-deep-dive-gradle" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li><a href="#what-youll-learn">What you’ll learn</a></li>
<li><a href="#additional-prerequisites">Additional prerequisites</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li>
<a href="#getting-started-with-liberty-and-rest">Getting started with Liberty and REST</a>
<ul class="sectlevel2">
<li><a href="#building-the-application">Building the application</a></li>
<li><a href="#starting-and-stopping-the-liberty-server-in-the-background">Starting and stopping the Liberty server in the background</a></li>
<li><a href="#updating-the-server-configuration-without-restarting-the-server">Updating the server configuration without restarting the server</a></li>
<li><a href="#developing-a-restful-microservice">Developing a RESTful microservice</a></li>
<li><a href="#running-the-application">Running the application</a></li>
</ul>
</li>
<li>
<a href="#documenting-apis">Documenting APIs</a>
<ul class="sectlevel2">
<li><a href="#generating-the-openapi-document">Generating the OpenAPI document</a></li>
<li><a href="#augmenting-the-existing-jakarta-restful-web-services-annotations-with-openapi-annotations">Augmenting the existing Jakarta RESTful Web Services annotations with OpenAPI annotations</a></li>
<li><a href="#augmenting-pojos-with-openapi-annotations">Augmenting POJOs with OpenAPI annotations</a></li>
</ul>
</li>
<li>
<a href="#configuring-the-microservice">Configuring the microservice</a>
<ul class="sectlevel2">
<li><a href="#enabling-configurable-ports-and-context-root">Enabling configurable ports and context root</a></li>
<li><a href="#injecting-static-configuration">Injecting static configuration</a></li>
<li><a href="#adding-the-microprofile-config-properties-file">Adding the microprofile-config.properties file</a></li>
</ul>
</li>
<li>
<a href="#persisting-data">Persisting data</a>
<ul class="sectlevel2">
<li><a href="#defining-a-jpa-entity-class">Defining a JPA entity class</a></li>
<li><a href="#performing-crud-operations-using-jpa">Performing CRUD operations using JPA</a></li>
<li><a href="#configuring-jpa">Configuring JPA</a></li>
<li><a href="#starting-postgresql-database">Starting PostgreSQL database</a></li>
<li><a href="#running-the-application-2">Running the application</a></li>
</ul>
</li>
<li><a href="#securing-restful-apis">Securing RESTful APIs</a></li>
<li>
<a href="#consuming-the-secured-restful-apis-by-jwt">Consuming the secured RESTful APIs by JWT</a>
<ul class="sectlevel2">
<li><a href="#writing-the-restful-client-interface">Writing the RESTful client interface</a></li>
<li><a href="#implementing-the-clienthostname-endpoint">Implementing the <code>/client/{hostname}</code> endpoint</a></li>
<li><a href="#configuring-the-json-web-token">Configuring the JSON Web Token</a></li>
<li><a href="#running-the-clienthostname-endpoint">Running the <code>/client/{hostname}</code> endpoint</a></li>
</ul>
</li>
<li><a href="#adding-health-checks">Adding health checks</a></li>
<li><a href="#providing-metrics">Providing metrics</a></li>
<li>
<a href="#building-the-container">Building the container </a>
<ul class="sectlevel2">
<li><a href="#building-the-container-image">Building the container image</a></li>
<li><a href="#running-the-application-in-container">Running the application in container</a></li>
</ul>
</li>
<li><a href="#support-licensing">Support Licensing</a></li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">A Technical Deep Dive on Liberty</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">80 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the documentation source. To view this exercise in published form, view it on the <a href="https://openliberty.io/guides/liberty-deep-dive-gradle.html">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Liberty is a cloud-optimized Java runtime that is fast to start up with a low memory footprint and the dev mode for quick iteration. With Liberty, adopting the latest open cloud-native Java APIs, like MicroProfile and Jakarta EE, is as simple as adding features to your server configuration. The Liberty zero migration architecture lets you focus on what’s important and not the APIs changing under you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will learn how to build a RESTful microservice on Liberty with Jakarta EE and MicroProfile. You will use Gradle throughout this exercise to build the microservice and to interact with the running Liberty instance. Then, you’ll build a container image for the microservice. You will also learn how to secure the REST endpoints and use JSON Web Tokens to communicate with the provided <code>system</code> secured microservice.</p>
</div>
<div class="paragraph">
<p>The microservice that you’ll work with is called <code>inventory</code>. The <code>inventory</code> microservice persists data into a PostgreSQL database.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/guide/liberty-deep-dive-gradle/inventory.png" alt="Inventory microservice">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-prerequisites">Additional prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you begin, Podman needs to be installed before you start the <strong>Persisting Data</strong> module. For installation instructions, refer to the <a href="https://podman.io/getting-started/installation" target="_blank" rel="noopener noreferrer">official Podman documentation</a>. You will build and run the microservices in containers.</p>
</div>
<div class="paragraph">
<p>If you are running Mac or Windows, make sure to start your Podman-managed VM before you proceed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clone the <a href="https://github.com/OpenLiberty/guide-liberty-deep-dive-gradle.git" target="_blank" rel="noopener noreferrer">Git repository</a>:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-liberty-deep-dive-gradle.git
cd guide-liberty-deep-dive-gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory is an empty directory where you will build the <code>inventory</code> service.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished projects of different modules that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary prerequisites.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-with-liberty-and-rest">Getting started with Liberty and REST</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Liberty now offers an easier way to get started with developing your application: the Open Liberty Starter. This tool provides a simple and quick way to get the necessary files to start building an application on Liberty. Through this tool, you can specify your application and project name. You can also choose a build tool from either Maven or Gradle, and pick the Java SE, Jakarta EE, and MicroProfile versions for your application.</p>
</div>
<div class="paragraph">
<p>In this workshop, the starting project is provided for you or you can use the Open Liberty Starter to create the starting point of the application. Gradle is used as the selected build tool and the application uses of Jakarta EE 10 and MicroProfile 6.</p>
</div>
<div class="paragraph">
<p>To get started with this tool, see the Getting Started page: <a href="https://openliberty.io/start/" target="_blank" rel="noopener">https://openliberty.io/start/</a></p>
</div>
<div class="paragraph">
<p>On that page, enter the following properties in the <strong>Create a starter application</strong> wizard.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under Group specify: <code>io.openliberty.deepdive</code></p>
</li>
<li>
<p>Under Artifact specify: <code>inventory</code></p>
</li>
<li>
<p>Under Build Tool select: <code>Gradle</code></p>
</li>
<li>
<p>Under Java SE Version select: <code>your version</code></p>
</li>
<li>
<p>Under Java EE/Jakarta EE Version select: <code>10</code></p>
</li>
<li>
<p>Under MicroProfile Version select: <code>6.0</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, click <code>Generate Project</code>, which downloads the starter project as <code>inventory.zip</code> file to the <code>start</code> directory of this project. You can replace the provided <code>inventory.zip</code> file.</p>
</div>
<div class="paragraph">
<p>Next, extract the <code>inventory.zip</code> file to the <code>guide-liberty-deepdive-gradle/start/inventory</code> directory.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="paragraph">
<p>Use Powershell for the following commands:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start
Expand-Archive -LiteralPath .\inventory.zip -DestinationPath inventory</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start
unzip inventory.zip -d inventory</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-the-application">Building the application</h3>
<div class="paragraph">
<p>This application is configured to be built with Gradle. Every Gradle-configured project contains a <code>settings.gradle</code> and a <code>build.gradle</code> file that defines the project configuration, dependencies, and plug-ins.</p>
</div>
<div class="paragraph">
<p>settings.gradle</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle"><span class="line-numbers">1</span>rootProject.name = 'inventory'</code></pre>
</div>
</div>
<div class="paragraph">
<p>build.gradle</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle"><span class="line-numbers"> 1</span>plugins {
<span class="line-numbers"> 2</span>    id 'war'
<span class="line-numbers"> 3</span>    // tag::libertyGradlePlugin[]
<span class="line-numbers"> 4</span>    id 'io.openliberty.tools.gradle.Liberty' version '3.6.2'
<span class="line-numbers"> 5</span>    // end::libertyGradlePlugin[]
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>version '1.0-SNAPSHOT'
<span class="line-numbers"> 9</span>group 'io.openliberty.deepdive'
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>sourceCompatibility = 11
<span class="line-numbers">12</span>targetCompatibility = 11
<span class="line-numbers">13</span>tasks.withType(JavaCompile) {
<span class="line-numbers">14</span>    options.encoding = 'UTF-8'
<span class="line-numbers">15</span>}
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>repositories {
<span class="line-numbers">18</span>    mavenCentral()
<span class="line-numbers">19</span>}
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>dependencies {
<span class="line-numbers">22</span>    // provided dependencies
<span class="line-numbers">23</span>    providedCompile 'jakarta.platform:jakarta.jakartaee-api:10.0.0' 
<span class="line-numbers">24</span>    providedCompile 'org.eclipse.microprofile:microprofile:6.0' 
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>}
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>clean.dependsOn 'libertyStop'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your <code class="hotspot file=0">settings.gradle</code> and <code class="hotspot file=1">build.gradle</code> files are located in the <code>start/inventory</code> directory and is configured to include the <code class="hotspot=libertyGradlePlugin file=1">io.openliberty.tools.gradle.Liberty</code> Liberty Gradle plugin. Using the plug-in, you can install applications into Liberty and manage the associated Liberty instances.</p>
</div>
<div class="paragraph">
<p>To begin, open a command-line session and navigate to your application directory.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd inventory</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build and deploy the <code>inventory</code> microservice to Liberty by running the Gradle <code>libertyRun</code> task:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>gradlew libertyRun</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew libertyRun</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>gradlew</code> command initiates a Gradle build, during which the target directory is created to store all build-related files.</p>
</div>
<div class="paragraph">
<p>The <code>libertyRun</code> argument specifies the Liberty <code>run</code> task, which starts a Liberty server instance in the foreground. As part of this phase, a Liberty server runtime is downloaded and installed into the <code>build/wlp</code> directory. Additionally, a server instance is created and configured in the <code>build/wlp/usr/servers/defaultServer</code> directory, and the application is installed into that server by using <a href="https://www.ibm.com/support/knowledgecenter/en/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/rwlp_loose_applications.html" target="_blank" rel="noopener noreferrer">loose config</a>.</p>
</div>
<div class="paragraph">
<p>For more information about the Liberty Gradle plug-in, see its <a href="https://github.com/OpenLiberty/ci.gradle" target="_blank" rel="noopener noreferrer">GitHub repository</a>.</p>
</div>
<div class="paragraph">
<p>While the server starts up, various messages display in your command-line session. Wait for the following message, which indicates that the server startup is complete:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>[INFO] [AUDIT] CWWKF0011I: The server defaultServer is ready to run a smarter planet.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you need to stop the server, press <code>CTRL+C</code> in the command-line session where you ran the server, or run the <code>libertyStop</code> goal from the <code>start/inventory</code> directory in another command-line session:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>gradlew libertyStop</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew libertyStop</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-and-stopping-the-liberty-server-in-the-background">Starting and stopping the Liberty server in the background</h3>
<div class="paragraph">
<p>Although you can start and stop the server in the foreground by using the Gradle <code>libertyRun</code> task, you can also start and stop the server in the background with the Gradle <code>libertyStart</code> and <code>libertyStop</code> goals:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>gradlew libertyStart
gradlew libertyStop</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew libertyStart
./gradlew libertyStop</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-the-server-configuration-without-restarting-the-server">Updating the server configuration without restarting the server</h3>
<div class="paragraph">
<p>The Liberty Gradle plug-in includes a <code>dev</code> task that listens for any changes in the project, including application source code or configuration. The Liberty server automatically reloads the configuration without restarting. This goal allows for quicker turnarounds and an improved developer experience.</p>
</div>
<div class="paragraph">
<p>If the Liberty server is running, stop it and restart it in dev mode by running the <code>libertyDev</code> goal in the <code>start/inventory</code> directory:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>gradlew libertyDev</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew libertyDev</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After you see the following message, your application server in dev mode is ready:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
<div class="paragraph">
<p>Dev mode automatically picks up changes that you make to your application and allows you to run tests by pressing the <code>enter/return</code> key in the active command-line session. When you’re working on your application, rather than rerunning Gradle tasks, press the <code>enter/return</code> key to verify your change.</p>
</div>
</div>
<div class="sect2">
<h3 id="developing-a-restful-microservice">Developing a RESTful microservice</h3>
<div class="paragraph">
<p>Now that a basic Liberty application is running, the next step is to create the additional application and resource classes that the application needs. Within these classes, you use Jakarta REST and other MicroProfile and Jakarta APIs.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>Inventory</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/Inventory.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inventory.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.util.Collections</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">22</span><span class="directive">public</span> <span class="type">class</span> <span class="class">Inventory</span> {
<span class="line-numbers">23</span>
<span class="line-numbers">24</span>    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;SystemData&gt; systems = <span class="predefined-type">Collections</span>.synchronizedList(<span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;());
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; getSystems() {
<span class="line-numbers">27</span>        <span class="keyword">return</span> systems;
<span class="line-numbers">28</span>    }
<span class="line-numbers">29</span>
<span class="line-numbers">30</span>    <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers">31</span>    <span class="directive">public</span> SystemData getSystem(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">32</span>        <span class="keyword">for</span> (SystemData s : systems) {
<span class="line-numbers">33</span>            <span class="keyword">if</span> (s.getHostname().equalsIgnoreCase(hostname)) {
<span class="line-numbers">34</span>                <span class="keyword">return</span> s;
<span class="line-numbers">35</span>            }
<span class="line-numbers">36</span>        }
<span class="line-numbers">37</span>        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
<span class="line-numbers">38</span>    }
<span class="line-numbers">39</span>    <span class="comment">// end::getSystem[]</span>
<span class="line-numbers">40</span>
<span class="line-numbers">41</span>    <span class="comment">// tag::add[]</span>
<span class="line-numbers">42</span>    <span class="directive">public</span> <span class="type">void</span> add(<span class="predefined-type">String</span> hostname, <span class="predefined-type">String</span> osName, <span class="predefined-type">String</span> javaVersion, <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">43</span>        systems.add(<span class="keyword">new</span> SystemData(hostname, osName, javaVersion, heapSize));
<span class="line-numbers">44</span>    }
<span class="line-numbers">45</span>    <span class="comment">// end::add[]</span>
<span class="line-numbers">46</span>
<span class="line-numbers">47</span>    <span class="comment">// tag::update[]</span>
<span class="line-numbers">48</span>    <span class="directive">public</span> <span class="type">void</span> update(SystemData s) {
<span class="line-numbers">49</span>        <span class="keyword">for</span> (SystemData systemData : systems) {
<span class="line-numbers">50</span>            <span class="keyword">if</span> (systemData.getHostname().equalsIgnoreCase(s.getHostname())) {
<span class="line-numbers">51</span>                systemData.setOsName(s.getOsName());
<span class="line-numbers">52</span>                systemData.setJavaVersion(s.getJavaVersion());
<span class="line-numbers">53</span>                systemData.setHeapSize(s.getHeapSize());
<span class="line-numbers">54</span>            }
<span class="line-numbers">55</span>        }
<span class="line-numbers">56</span>    }
<span class="line-numbers">57</span>    <span class="comment">// end::update[]</span>
<span class="line-numbers">58</span>
<span class="line-numbers">59</span>    <span class="comment">// tag::removeSystem[]</span>
<span class="line-numbers">60</span>    <span class="directive">public</span> <span class="type">boolean</span> removeSystem(SystemData s) {
<span class="line-numbers">61</span>        <span class="keyword">return</span> systems.remove(s);
<span class="line-numbers">62</span>    }
<span class="line-numbers">63</span>    <span class="comment">// end::removeSystem[]</span>
<span class="line-numbers">64</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>Inventory</code> class stores a record of all systems and their system properties. The <code class="hotspot=getSystem file=0">getSystem()</code> method within this class retrieves and returns the system data from the system. The <code class="hotspot=add file=0">add()</code> method enables the addition of a system and its data to the inventory. The <code class="hotspot=update file=0">update()</code> method enables a system and its data on the inventory to be updated. The <code class="hotspot=removeSystem file=0">removeSystem()</code> method enables the deletion of a system from the inventory.</p>
</div>
<div class="paragraph">
<p>Create the <code>model</code> subdirectory, then create the <code>SystemData</code> class. The <code>SystemData</code> class is a Plain Old Java Object (POJO) that represents a single inventory entry.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src\main\java\io\openliberty\deepdive\rest\model</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src/main/java/io/openliberty/deepdive/rest/model</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>SystemData</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/model/SystemData.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemData.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.model</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemData</span> {
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>    <span class="directive">private</span> <span class="type">int</span> id;
<span class="line-numbers">17</span>    <span class="directive">private</span> <span class="predefined-type">String</span> hostname;
<span class="line-numbers">18</span>    <span class="directive">private</span> <span class="predefined-type">String</span> osName;
<span class="line-numbers">19</span>    <span class="directive">private</span> <span class="predefined-type">String</span> javaVersion;
<span class="line-numbers">20</span>    <span class="directive">private</span> <span class="predefined-type">Long</span>   heapSize;
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    <span class="directive">public</span> SystemData() {
<span class="line-numbers">23</span>    }
<span class="line-numbers">24</span>
<span class="line-numbers">25</span>    <span class="directive">public</span> SystemData(<span class="predefined-type">String</span> hostname, <span class="predefined-type">String</span> osName, <span class="predefined-type">String</span> javaVer, <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">26</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">27</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">28</span>        <span class="local-variable">this</span>.javaVersion = javaVer;
<span class="line-numbers">29</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">30</span>    }
<span class="line-numbers">31</span>
<span class="line-numbers">32</span>    <span class="directive">public</span> <span class="type">int</span> getId() {
<span class="line-numbers">33</span>        <span class="keyword">return</span> id;
<span class="line-numbers">34</span>    }
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
<span class="line-numbers">37</span>        <span class="local-variable">this</span>.id = id;
<span class="line-numbers">38</span>    }
<span class="line-numbers">39</span>
<span class="line-numbers">40</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers">41</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers">42</span>    }
<span class="line-numbers">43</span>
<span class="line-numbers">44</span>    <span class="directive">public</span> <span class="type">void</span> setHostname(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">45</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">46</span>    }
<span class="line-numbers">47</span>
<span class="line-numbers">48</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOsName() {
<span class="line-numbers">49</span>        <span class="keyword">return</span> osName;
<span class="line-numbers">50</span>    }
<span class="line-numbers">51</span>
<span class="line-numbers">52</span>    <span class="directive">public</span> <span class="type">void</span> setOsName(<span class="predefined-type">String</span> osName) {
<span class="line-numbers">53</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">54</span>    }
<span class="line-numbers">55</span>
<span class="line-numbers">56</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJavaVersion() {
<span class="line-numbers">57</span>        <span class="keyword">return</span> javaVersion;
<span class="line-numbers">58</span>    }
<span class="line-numbers">59</span>
<span class="line-numbers">60</span>    <span class="directive">public</span> <span class="type">void</span> setJavaVersion(<span class="predefined-type">String</span> javaVersion) {
<span class="line-numbers">61</span>        <span class="local-variable">this</span>.javaVersion = javaVersion;
<span class="line-numbers">62</span>    }
<span class="line-numbers">63</span>
<span class="line-numbers">64</span>    <span class="directive">public</span> <span class="predefined-type">Long</span> getHeapSize() {
<span class="line-numbers">65</span>        <span class="keyword">return</span> heapSize;
<span class="line-numbers">66</span>    }
<span class="line-numbers">67</span>
<span class="line-numbers">68</span>    <span class="directive">public</span> <span class="type">void</span> setHeapSize(<span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">69</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">70</span>    }
<span class="line-numbers">71</span>
<span class="line-numbers">72</span>    <span class="annotation">@Override</span>
<span class="line-numbers">73</span>    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> host) {
<span class="line-numbers">74</span>      <span class="keyword">if</span> (host <span class="keyword">instanceof</span> SystemData) {
<span class="line-numbers">75</span>        <span class="keyword">return</span> hostname.equals(((SystemData) host).getHostname());
<span class="line-numbers">76</span>      }
<span class="line-numbers">77</span>      <span class="keyword">return</span> <span class="predefined-constant">false</span>;
<span class="line-numbers">78</span>    }
<span class="line-numbers">79</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SystemData</code> class contains the hostname, operating system name, Java version, and heap size properties. The various methods within this class allow the viewing or editing the properties of each system in the inventory.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Create the <code>SystemResource</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 32</span><span class="comment">//tag::path[]</span>
<span class="line-numbers"> 33</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 34</span><span class="comment">//end::path[]</span>
<span class="line-numbers"> 35</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 36</span>
<span class="line-numbers"> 37</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 38</span>    Inventory inventory;
<span class="line-numbers"> 39</span>
<span class="line-numbers"> 40</span>    <span class="comment">//tag::getListContents[]</span>
<span class="line-numbers"> 41</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 42</span>    <span class="comment">//end::getListContents[]</span>
<span class="line-numbers"> 43</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 44</span>    <span class="comment">//tag::producesListContents[]</span>
<span class="line-numbers"> 45</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 46</span>    <span class="comment">//end::producesListContents[]</span>
<span class="line-numbers"> 47</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 48</span>        <span class="comment">//tag::getSystems[]</span>
<span class="line-numbers"> 49</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 50</span>        <span class="comment">//end::getSystems[]</span>
<span class="line-numbers"> 51</span>    }
<span class="line-numbers"> 52</span>
<span class="line-numbers"> 53</span>    <span class="comment">//tag::getGetSystem[]</span>
<span class="line-numbers"> 54</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 55</span>    <span class="comment">//end::getGetSystem[]</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="comment">//tag::producesGetSystem[]</span>
<span class="line-numbers"> 58</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 59</span>    <span class="comment">//end::producesGetSystem[]</span>
<span class="line-numbers"> 60</span>    <span class="directive">public</span> SystemData getSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 61</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers"> 62</span>    }
<span class="line-numbers"> 63</span>
<span class="line-numbers"> 64</span>    <span class="annotation">@POST</span>
<span class="line-numbers"> 65</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers"> 66</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 67</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers"> 68</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers"> 69</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers"> 70</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers"> 71</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers"> 72</span>
<span class="line-numbers"> 73</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers"> 74</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers"> 75</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 76</span>        }
<span class="line-numbers"> 77</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers"> 78</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 79</span>    }
<span class="line-numbers"> 80</span>
<span class="line-numbers"> 81</span>    <span class="annotation">@PUT</span>
<span class="line-numbers"> 82</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 83</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers"> 84</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 85</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers"> 86</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers"> 87</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers"> 88</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers"> 89</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers"> 90</span>
<span class="line-numbers"> 91</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers"> 92</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers"> 93</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 94</span>        }
<span class="line-numbers"> 95</span>        s.setOsName(osName);
<span class="line-numbers"> 96</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers"> 97</span>        s.setHeapSize(heapSize);
<span class="line-numbers"> 98</span>        inventory.update(s);
<span class="line-numbers"> 99</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">100</span>    }
<span class="line-numbers">101</span>
<span class="line-numbers">102</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">103</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">104</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">105</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">106</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">107</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">108</span>            inventory.removeSystem(s);
<span class="line-numbers">109</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">110</span>        } <span class="keyword">else</span> {
<span class="line-numbers">111</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">112</span>        }
<span class="line-numbers">113</span>    }
<span class="line-numbers">114</span>
<span class="line-numbers">115</span>    <span class="annotation">@POST</span>
<span class="line-numbers">116</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">117</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">118</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">119</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">120</span>        <span class="keyword">return</span> fail(<span class="string"><span class="delimiter">"</span><span class="content">This api is not implemented yet.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">121</span>    }
<span class="line-numbers">122</span>
<span class="line-numbers">123</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">124</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">125</span>    }
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">128</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">129</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">130</span>                       .build();
<span class="line-numbers">131</span>    }
<span class="line-numbers">132</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>RestApplication.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.ApplicationPath</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Application</span>;
<span class="line-numbers">16</span>
<span class="line-numbers">17</span><span class="comment">//tag::applicationPath[]</span>
<span class="line-numbers">18</span><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">"</span><span class="content">/api</span><span class="delimiter">"</span></span>)
<span class="line-numbers">19</span><span class="comment">//end::applicationPath[]</span>
<span class="line-numbers">20</span><span class="directive">public</span> <span class="type">class</span> <span class="class">RestApplication</span> <span class="directive">extends</span> Application {
<span class="line-numbers">21</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Jakarta RESTful Web Services, a single class like the <code>SystemResource.java</code> class must represent a single resource, or a group of resources of the same type. In this application, a resource might be a system property, or a set of system properties. It is efficient to have a single class handle multiple different resources, but keeping a clean separation between types of resources helps with maintainability.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=path file=2">@Path</code> annotation on this class indicates that this resource responds to the <code>/systems</code> path in the RESTful application. The <code class="hotspot=applicationPath file=3">@ApplicationPath</code> annotation in the <code>RestApplication</code> class, together with the <code class="hotspot=path file=2">@Path</code> annotation in the <code>SystemResource</code> class, indicates that this resource is available at the <code>/api/systems</code> path.</p>
</div>
<div class="paragraph">
<p>The Jakarta RESTful Web Services API maps the HTTP methods on the URL to the methods of the class by using annotations. This application uses the <code>GET</code> annotation to map an HTTP <code>GET</code> request to the <code>/api/systems</code> path.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getListContents file=2">@GET</code> annotation on the <code>listContents</code> method indicates that the method is to be called for the HTTP <code>GET</code> method. The <code class="hotspot=producesListContents file=2">@Produces</code> annotation indicates the format of the content that is returned. The value of the <code class="hotspot=producesListContents file=2">@Produces</code> annotation is specified in the HTTP <code>Content-Type</code> response header. For this application, a JSON structure is returned for these <code>Get</code> methods. The <code>Content-Type</code> for a JSON response is <code>application/json</code> with <code>MediaType.APPLICATION_JSON</code> instead of the <code>String</code> content type. Using a constant such as <code>MediaType.APPLICATION_JSON</code> is better as in case of a spelling error, a compile failure occurs.</p>
</div>
<div class="paragraph">
<p>The Jakarta RESTful Web Services API supports a number of ways to marshal JSON. The Jakarta RESTful Web Services specification mandates JSON-Binding (JSON-B). The method body returns the result of <code class="hotspot=getSystems file=2">inventory.getSystems()</code>. Because the method is annotated with <code class="hotspot=producesListContents file=2">@Produces(MediaType.APPLICATION_JSON)</code>, the Jakarta RESTful Web Services API uses JSON-B to automatically convert the returned object to JSON data in the HTTP response.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-the-application">Running the application</h3>
<div class="paragraph">
<p>Because you started the Liberty server in dev mode at the beginning of this exercise, all the changes were automatically picked up.</p>
</div>
<div class="paragraph">
<p>Check out the service that you created at the <a href="http://localhost:9080/inventory/api/systems" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/inventory/api/systems</a> URL. If successful, it returns <code>[]</code> to you.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="documenting-apis">Documenting APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, you will investigate how to document and filter RESTful APIs from annotations, POJOs, and static OpenAPI files by using MicroProfile OpenAPI.</p>
</div>
<div class="paragraph">
<p>The OpenAPI specification, previously known as the Swagger specification, defines a standard interface for documenting and exposing RESTful APIs. This specification allows both humans and computers to understand or process the functionalities of services without requiring direct access to underlying source code or documentation. The MicroProfile OpenAPI specification provides a set of Java interfaces and programming models that allow Java developers to natively produce OpenAPI v3 documents from their RESTful applications.</p>
</div>
<div class="paragraph">
<p>build.gradle</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle"><span class="line-numbers"> 1</span>plugins {
<span class="line-numbers"> 2</span>    id 'war'
<span class="line-numbers"> 3</span>    id 'io.openliberty.tools.gradle.Liberty' version '3.6.2'
<span class="line-numbers"> 4</span>}
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>version '1.0-SNAPSHOT'
<span class="line-numbers"> 7</span>group 'io.openliberty.deepdive'
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>sourceCompatibility = 11
<span class="line-numbers">10</span>targetCompatibility = 11
<span class="line-numbers">11</span>tasks.withType(JavaCompile) {
<span class="line-numbers">12</span>    options.encoding = 'UTF-8'
<span class="line-numbers">13</span>}
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>repositories {
<span class="line-numbers">16</span>    mavenCentral()
<span class="line-numbers">17</span>}
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>dependencies {
<span class="line-numbers">20</span>    // provided dependencies
<span class="line-numbers">21</span>    providedCompile 'jakarta.platform:jakarta.jakartaee-api:10.0.0' 
<span class="line-numbers">22</span>    // tag::mp5[]
<span class="line-numbers">23</span>    providedCompile 'org.eclipse.microprofile:microprofile:6.0' 
<span class="line-numbers">24</span>    // end::mp5[]
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>}
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>clean.dependsOn 'libertyStop'</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="comment">&lt;!-- Enable features --&gt;</span>
<span class="line-numbers"> 5</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>        <span class="comment">&lt;!-- tag::mp5[] --&gt;</span>
<span class="line-numbers"> 8</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 9</span>        <span class="comment">&lt;!-- end::mp5[] --&gt;</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>    <span class="comment">&lt;!-- To access this server from a remote client add a host attribute to the following element, e.g. host="*" --&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">14</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span>
<span class="line-numbers">15</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">18</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">19</span>
<span class="line-numbers">20</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">21</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">22</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The MicroProfile OpenAPI API is included in the <code class="hotspot=mp5 file=0">microProfile</code> dependency that is specified in your <code>build.gradle</code> file. The <code class="hotspot=mp5 file=1">microProfile</code> feature that includes the <code>mpOpenAPI</code> feature is also enabled in the <code>server.xml</code> file.</p>
</div>
<div class="sect2">
<h3 id="generating-the-openapi-document">Generating the OpenAPI document</h3>
<div class="paragraph">
<p>Because the Jakarta RESTful Web Services framework handles basic API generation for Jakarta RESTful Web Services annotations, a skeleton OpenAPI tree can be generated from the existing inventory service. You can use this tree as a starting point and augment it with annotations and code to produce a complete OpenAPI document.</p>
</div>
<div class="paragraph">
<p>To see the generated OpenAPI tree, you can either visit the <a href="http://localhost:9080/openapi" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi</a> URL or visit the <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> URL for a more interactive view of the APIs. Click the <code>interactive UI</code> link on the welcome page. Within this UI, you can view each of the endpoints that are available in your application and any schemas. Each endpoint is color coordinated to easily identify the type of each request (for example GET, POST, PUT, DELETE, etc.). Clicking each endpoint within this UI enables you to view further details of each endpoint’s parameters and responses. This UI is used for the remainder of this workshop to view and test the application endpoints.</p>
</div>
</div>
<div class="sect2">
<h3 id="augmenting-the-existing-jakarta-restful-web-services-annotations-with-openapi-annotations">Augmenting the existing Jakarta RESTful Web Services annotations with OpenAPI annotations</h3>
<div class="paragraph">
<p>Because all Jakarta RESTful Web Services annotations are processed by default, you can augment the existing code with OpenAPI annotations without needing to rewrite portions of the OpenAPI document that are already covered by the Jakarta RESTful Web Services framework.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemResources</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.Operation</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.ParameterIn</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameters</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponseSchema</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponses</span>;
<span class="line-numbers"> 25</span>
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 40</span>
<span class="line-numbers"> 41</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 42</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 43</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 46</span>    Inventory inventory;
<span class="line-numbers"> 47</span>
<span class="line-numbers"> 48</span>    <span class="comment">// tag::listContents[]</span>
<span class="line-numbers"> 49</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 50</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 51</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 52</span>    <span class="comment">// tag::listContentsAPIResponseSchema[]</span>
<span class="line-numbers"> 53</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 54</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">A list of system data stored within the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 55</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 56</span>    <span class="comment">// end::listContentsAPIResponseSchema[]</span>
<span class="line-numbers"> 57</span>    <span class="comment">// tag::listContentsOperation[]</span>
<span class="line-numbers"> 58</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 59</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">List contents.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 60</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Returns the currently stored system data in the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 61</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">listContents</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 62</span>    <span class="comment">// end::listContentsOperation[]</span>
<span class="line-numbers"> 63</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 64</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 65</span>    }
<span class="line-numbers"> 66</span>    <span class="comment">// end::listContents[]</span>
<span class="line-numbers"> 67</span>
<span class="line-numbers"> 68</span>    <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers"> 69</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 70</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 71</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 72</span>    <span class="comment">// tag::getSystemAPIResponseSchema[]</span>
<span class="line-numbers"> 73</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 74</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">System data of a particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 75</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 76</span>    <span class="comment">// end::getSystemAPIResponseSchema[]</span>
<span class="line-numbers"> 77</span>    <span class="comment">// tag::getSystemOperation[]</span>
<span class="line-numbers"> 78</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 79</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Get System</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 80</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Retrieves and returns the system data from the system </span><span class="delimiter">"</span></span>
<span class="line-numbers"> 81</span>                      + <span class="string"><span class="delimiter">"</span><span class="content">service running on the particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 82</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">getSystem</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 83</span>    <span class="comment">// end::getSystemOperation[]</span>
<span class="line-numbers"> 84</span>    <span class="directive">public</span> SystemData getSystem(
<span class="line-numbers"> 85</span>        <span class="comment">// tag::getSystemParameter[]</span>
<span class="line-numbers"> 86</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers"> 87</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers"> 88</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 89</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 90</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING))
<span class="line-numbers"> 91</span>        <span class="comment">// end::getSystemParameter[]</span>
<span class="line-numbers"> 92</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 93</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers"> 94</span>    }
<span class="line-numbers"> 95</span>    <span class="comment">// end::getSystem[]</span>
<span class="line-numbers"> 96</span>
<span class="line-numbers"> 97</span>    <span class="comment">// tag::addSystem[]</span>
<span class="line-numbers"> 98</span>    <span class="annotation">@POST</span>
<span class="line-numbers"> 99</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">100</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">101</span>    <span class="comment">// tag::addSystemAPIResponses[]</span>
<span class="line-numbers">102</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">103</span>        <span class="comment">// tag::addSystemAPIResponse[]</span>
<span class="line-numbers">104</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">105</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system to inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">106</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">107</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system to inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">108</span>        <span class="comment">// end::addSystemAPIResponse[]</span>
<span class="line-numbers">109</span>    })
<span class="line-numbers">110</span>    <span class="comment">// end::addSystemAPIResponses[]</span>
<span class="line-numbers">111</span>    <span class="comment">// tag::addSystemParameters[]</span>
<span class="line-numbers">112</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">113</span>        <span class="comment">// tag::addSystemParameter[]</span>
<span class="line-numbers">114</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">115</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">116</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">117</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">118</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">119</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">120</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">121</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">122</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">123</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">124</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">125</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">126</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">127</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">128</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">129</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">130</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">131</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">132</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">133</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">134</span>        <span class="comment">// end::addSystemParameter[]</span>
<span class="line-numbers">135</span>    })
<span class="line-numbers">136</span>    <span class="comment">// end::addSystemParameters[]</span>
<span class="line-numbers">137</span>    <span class="comment">// tag::addSystemOperation[]</span>
<span class="line-numbers">138</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">139</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">140</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Add a system and its data to the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">141</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">142</span>    )
<span class="line-numbers">143</span>    <span class="comment">// end::addSystemOperation[]</span>
<span class="line-numbers">144</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers">145</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">146</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">147</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">148</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">149</span>
<span class="line-numbers">150</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">151</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">152</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">153</span>        }
<span class="line-numbers">154</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers">155</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">156</span>    }
<span class="line-numbers">157</span>    <span class="comment">// end::addSystem[]</span>
<span class="line-numbers">158</span>
<span class="line-numbers">159</span>    <span class="comment">// tag::updateSystem[]</span>
<span class="line-numbers">160</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">161</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">162</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">163</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">164</span>    <span class="comment">// tag::updateSystemAPIResponses[]</span>
<span class="line-numbers">165</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">166</span>        <span class="comment">// tag::updateSystemAPIResponse[]</span>
<span class="line-numbers">167</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">168</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully updated system</span><span class="delimiter">"</span></span>),
<span class="line-numbers">169</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">170</span>            description =
<span class="line-numbers">171</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to update because the system does not exist in the inventory.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">172</span>        <span class="comment">// end::updateSystemAPIResponse[]</span>
<span class="line-numbers">173</span>    })
<span class="line-numbers">174</span>    <span class="comment">// end::updateSystemAPIResponses[]</span>
<span class="line-numbers">175</span>    <span class="comment">// tag::updateSystemParameters[]</span>
<span class="line-numbers">176</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">177</span>        <span class="comment">// tag::updateSystemParameter[]</span>
<span class="line-numbers">178</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">179</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">180</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">181</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">182</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">183</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">184</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">185</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">186</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">187</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">188</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">189</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">190</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">191</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">192</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">193</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">194</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">195</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">196</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">197</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">198</span>        <span class="comment">// end::updateSystemParameter[]</span>
<span class="line-numbers">199</span>    })
<span class="line-numbers">200</span>    <span class="comment">// end::updateSystemParameters[]</span>
<span class="line-numbers">201</span>    <span class="comment">// tag::updateSystemOperation[]</span>
<span class="line-numbers">202</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">203</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Update system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">204</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Update a system and its data on the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">205</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">206</span>    )
<span class="line-numbers">207</span>    <span class="comment">// end::updateSystemOperation[]</span>
<span class="line-numbers">208</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers">209</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">210</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">211</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">212</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">213</span>
<span class="line-numbers">214</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">215</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers">216</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">217</span>        }
<span class="line-numbers">218</span>        s.setOsName(osName);
<span class="line-numbers">219</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers">220</span>        s.setHeapSize(heapSize);
<span class="line-numbers">221</span>        inventory.update(s);
<span class="line-numbers">222</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">223</span>    }
<span class="line-numbers">224</span>    <span class="comment">// end::updateSystem[]</span>
<span class="line-numbers">225</span>
<span class="line-numbers">226</span>    <span class="comment">// tag::removeSystem[]</span>
<span class="line-numbers">227</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">228</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">229</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">230</span>    <span class="comment">// tag::removeSystemAPIResponses[]</span>
<span class="line-numbers">231</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">232</span>        <span class="comment">// tag::removeSystemAPIResponse[]</span>
<span class="line-numbers">233</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">234</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully deleted the system from inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">235</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">236</span>            description =
<span class="line-numbers">237</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to delete because the system does not exist in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">238</span>        <span class="comment">// end::removeSystemAPIResponse[]</span>
<span class="line-numbers">239</span>    })
<span class="line-numbers">240</span>    <span class="comment">// end::removeSystemAPIResponses[]</span>
<span class="line-numbers">241</span>    <span class="comment">// tag::removeSystemParameter[]</span>
<span class="line-numbers">242</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">243</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">244</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">245</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">246</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">247</span>    )
<span class="line-numbers">248</span>    <span class="comment">// end::removeSystemParameter[]</span>
<span class="line-numbers">249</span>    <span class="comment">// tag::removeSystemOperation[]</span>
<span class="line-numbers">250</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">251</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Remove system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">252</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Removes a system from the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">253</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">254</span>    )
<span class="line-numbers">255</span>    <span class="comment">// end::removeSystemOperation[]</span>
<span class="line-numbers">256</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">257</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">258</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">259</span>            inventory.removeSystem(s);
<span class="line-numbers">260</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">261</span>        } <span class="keyword">else</span> {
<span class="line-numbers">262</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">263</span>        }
<span class="line-numbers">264</span>    }
<span class="line-numbers">265</span>    <span class="comment">// end::removeSystem[]</span>
<span class="line-numbers">266</span>
<span class="line-numbers">267</span>    <span class="comment">// tag::addSystemClient[]</span>
<span class="line-numbers">268</span>    <span class="annotation">@POST</span>
<span class="line-numbers">269</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">270</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">271</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">272</span>    <span class="comment">// tag::addSystemClientAPIResponses[]</span>
<span class="line-numbers">273</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">274</span>        <span class="comment">// tag::addSystemClientAPIResponse[]</span>
<span class="line-numbers">275</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">276</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system client</span><span class="delimiter">"</span></span>),
<span class="line-numbers">277</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">278</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system client</span><span class="delimiter">"</span></span>)
<span class="line-numbers">279</span>        <span class="comment">// end::addSystemClientAPIResponse[]</span>
<span class="line-numbers">280</span>    })
<span class="line-numbers">281</span>    <span class="comment">// end::addSystemClientAPIResponses[]</span>
<span class="line-numbers">282</span>    <span class="comment">// tag::addSystemClientParameter[]</span>
<span class="line-numbers">283</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">284</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">285</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">286</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">287</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">288</span>    )
<span class="line-numbers">289</span>    <span class="comment">// end::addSystemClientParameter[]</span>
<span class="line-numbers">290</span>    <span class="comment">// tag::addSystemClientOperation[]</span>
<span class="line-numbers">291</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">292</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system client</span><span class="delimiter">"</span></span>,
<span class="line-numbers">293</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">This adds a system client.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">294</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>
<span class="line-numbers">295</span>    )
<span class="line-numbers">296</span>    <span class="comment">// end::addSystemClientOperation[]</span>
<span class="line-numbers">297</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">298</span>        <span class="keyword">return</span> fail(<span class="string"><span class="delimiter">"</span><span class="content">This api is not implemented yet.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">299</span>    }
<span class="line-numbers">300</span>    <span class="comment">// end::addSystemClient[]</span>
<span class="line-numbers">301</span>
<span class="line-numbers">302</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">303</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">304</span>    }
<span class="line-numbers">305</span>
<span class="line-numbers">306</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">307</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">308</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">309</span>                       .build();
<span class="line-numbers">310</span>    }
<span class="line-numbers">311</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add OpenAPI <code class="hotspot=listContentsAPIResponseSchema hotspot=getSystemAPIResponseSchema file=0">@APIResponseSchema</code>, <code class="hotspot=addSystemAPIResponses file=0">@APIResponses</code>, <code class="hotspot=addSystemAPIResponse file=0">@APIResponse</code>, <code class="hotspot=addSystemParameters file=0">@Parameters</code>, <code class="hotspot=addSystemParameter file=0">@Parameter</code>, and <code class="hotspot=addSystemOperation file=0">@Operation</code> annotations to the REST methods, <code class="hotspot=listContents file=0">listContents()</code>, <code class="hotspot=getSystem file=0">getSystem()</code>, <code class="hotspot=addSystem file=0">addSystem()</code>, <code class="hotspot=updateSystem file=0">updateSystem()</code>, <code class="hotspot=removeSystem file=0">removeSystem()</code>, and <code class="hotspot=addSystemClient file=0">addSystemClient()</code>.</p>
</div>
<div class="paragraph">
<p>Note, the <code>@Parameter</code> annotation can be placed either <code class="hotspot=getSystemParameter file=0">inline</code> or <code class="hotspot=removeSystemParameter file=0">outline</code>. Examples of both are provided within this workshop.</p>
</div>
<div class="paragraph">
<p>Many OpenAPI annotations are available and can be used according to what’s best for your application and its classes. You can find all the annotations in the <a href="https://download.eclipse.org/microprofile/microprofile-open-api-3.0/microprofile-openapi-spec-3.0.html#_annotations" target="_blank" rel="noopener noreferrer">MicroProfile OpenAPI specification</a>.</p>
</div>
<div class="paragraph">
<p>Because the Liberty server was started in dev mode at the beginning of this exercise, your changes were automatically picked up. Go to the <a href="http://localhost:9080/openapi" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi</a> URL to see the updated endpoint descriptions. The endpoints at which your REST methods are served now more meaningful:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="head"><span class="head">---</span></span>
<span class="key">openapi</span>: <span class="string"><span class="content">3.0.3</span></span>
<span class="key">info</span>:
  <span class="key">title</span>: <span class="string"><span class="content">Generated API</span></span>
  <span class="key">version</span>: <span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span>
<span class="key">servers</span>:
- <span class="string"><span class="content">url: http://localhost:9080/inventory</span></span>
- <span class="string"><span class="content">url: https://localhost:9443/inventory</span></span>
<span class="key">paths</span>:
  <span class="key">/api/systems</span>:
    <span class="key">get</span>:
      <span class="key">summary</span>: <span class="string"><span class="content">List contents.</span></span>
      <span class="key">description</span>: <span class="string"><span class="content">Returns the currently stored host:properties pairs in the inventory.</span></span>
      <span class="key">operationId</span>: <span class="string"><span class="content">listContents</span></span>
      <span class="key">responses</span>:
        <span class="key"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>:
          <span class="key">description</span>: <span class="string"><span class="content">Returns the currently stored host:properties pairs in the inventory.</span></span>
          <span class="key">content</span>:
            <span class="key">application/json</span>:
              <span class="key">schema</span>:
                <span class="error">$ref</span>: <span class="error">'#/components/schemas/SystemData'</span>
<span class="head"><span class="head">...</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also visit the <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> URL to see each endpoint’s updated description. Click each of the icons within the UI to see the updated descriptions for each of the endpoints.</p>
</div>
</div>
<div class="sect2">
<h3 id="augmenting-pojos-with-openapi-annotations">Augmenting POJOs with OpenAPI annotations</h3>
<div class="paragraph">
<p>OpenAPI annotations can also be added to POJOs to describe what they represent. Currently, the OpenAPI document doesn’t have a meaningful description of the <code>SystemData</code> POJO so it’s difficult to tell exactly what this POJO is used for. To describe the <code>SystemData</code> POJO in more detail, augment the <code>SystemData.java</code> file with some OpenAPI annotations.</p>
</div>
<div class="listingblock code_command hotspot">
<div class="content">
<pre><mark>Replace the <code>SystemData</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/model/SystemData.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemData.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.model</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers">15</span><span class="comment">//tag::SystemDataSchema[]</span>
<span class="line-numbers">16</span><span class="annotation">@Schema</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData</span><span class="delimiter">"</span></span>,
<span class="line-numbers">17</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">POJO that represents a single inventory entry.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">18</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemData</span> {
<span class="line-numbers">19</span><span class="comment">//end::SystemDataSchema[]</span>
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>    <span class="directive">private</span> <span class="type">int</span> id;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>    <span class="comment">//tag::hostnameSchema[]</span>
<span class="line-numbers">24</span>    <span class="annotation">@Schema</span>(required = <span class="predefined-constant">true</span>)
<span class="line-numbers">25</span>    <span class="directive">private</span> <span class="predefined-type">String</span> hostname;
<span class="line-numbers">26</span>    <span class="comment">//end::hostnameSchema[]</span>
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>    <span class="directive">private</span> <span class="predefined-type">String</span> osName;
<span class="line-numbers">29</span>    <span class="directive">private</span> <span class="predefined-type">String</span> javaVersion;
<span class="line-numbers">30</span>    <span class="directive">private</span> <span class="predefined-type">Long</span>   heapSize;
<span class="line-numbers">31</span>
<span class="line-numbers">32</span>    <span class="directive">public</span> SystemData() {
<span class="line-numbers">33</span>    }
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>    <span class="directive">public</span> SystemData(<span class="predefined-type">String</span> hostname, <span class="predefined-type">String</span> osName, <span class="predefined-type">String</span> javaVer, <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">36</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">37</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">38</span>        <span class="local-variable">this</span>.javaVersion = javaVer;
<span class="line-numbers">39</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">40</span>    }
<span class="line-numbers">41</span>
<span class="line-numbers">42</span>    <span class="directive">public</span> <span class="type">int</span> getId() {
<span class="line-numbers">43</span>        <span class="keyword">return</span> id;
<span class="line-numbers">44</span>    }
<span class="line-numbers">45</span>
<span class="line-numbers">46</span>    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
<span class="line-numbers">47</span>        <span class="local-variable">this</span>.id = id;
<span class="line-numbers">48</span>    }
<span class="line-numbers">49</span>
<span class="line-numbers">50</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers">51</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers">52</span>    }
<span class="line-numbers">53</span>
<span class="line-numbers">54</span>    <span class="directive">public</span> <span class="type">void</span> setHostname(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">55</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">56</span>    }
<span class="line-numbers">57</span>
<span class="line-numbers">58</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOsName() {
<span class="line-numbers">59</span>        <span class="keyword">return</span> osName;
<span class="line-numbers">60</span>    }
<span class="line-numbers">61</span>
<span class="line-numbers">62</span>    <span class="directive">public</span> <span class="type">void</span> setOsName(<span class="predefined-type">String</span> osName) {
<span class="line-numbers">63</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">64</span>    }
<span class="line-numbers">65</span>
<span class="line-numbers">66</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJavaVersion() {
<span class="line-numbers">67</span>        <span class="keyword">return</span> javaVersion;
<span class="line-numbers">68</span>    }
<span class="line-numbers">69</span>
<span class="line-numbers">70</span>    <span class="directive">public</span> <span class="type">void</span> setJavaVersion(<span class="predefined-type">String</span> javaVersion) {
<span class="line-numbers">71</span>        <span class="local-variable">this</span>.javaVersion = javaVersion;
<span class="line-numbers">72</span>    }
<span class="line-numbers">73</span>
<span class="line-numbers">74</span>    <span class="directive">public</span> <span class="predefined-type">Long</span> getHeapSize() {
<span class="line-numbers">75</span>        <span class="keyword">return</span> heapSize;
<span class="line-numbers">76</span>    }
<span class="line-numbers">77</span>
<span class="line-numbers">78</span>    <span class="directive">public</span> <span class="type">void</span> setHeapSize(<span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">79</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">80</span>    }
<span class="line-numbers">81</span>
<span class="line-numbers">82</span>    <span class="annotation">@Override</span>
<span class="line-numbers">83</span>    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> host) {
<span class="line-numbers">84</span>      <span class="keyword">if</span> (host <span class="keyword">instanceof</span> SystemData) {
<span class="line-numbers">85</span>        <span class="keyword">return</span> hostname.equals(((SystemData) host).getHostname());
<span class="line-numbers">86</span>      }
<span class="line-numbers">87</span>      <span class="keyword">return</span> <span class="predefined-constant">false</span>;
<span class="line-numbers">88</span>    }
<span class="line-numbers">89</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add OpenAPI <code>@Schema</code> annotations to the <code class="hotspot=SystemDataSchema">SystemData</code> class and the <code class="hotspot=hostnameSchema">hostname</code> variable.</p>
</div>
<div class="paragraph">
<p>Refresh the <a href="http://localhost:9080/openapi" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi</a> URL to see the updated OpenAPI tree. You should see much more meaningful data for the Schema:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="key">components</span>:
  <span class="key">schemas</span>:
    <span class="key">SystemData</span>:
      <span class="key">description</span>: <span class="string"><span class="content">POJO that represents a single inventory entry.</span></span>
      <span class="key">required</span>:
      - <span class="string"><span class="content">hostname</span></span>
      - <span class="string"><span class="content">properties</span></span>
      <span class="key">type</span>: <span class="string"><span class="content">object</span></span>
      <span class="key">properties</span>:
        <span class="key">hostname</span>:
          <span class="key">type</span>: <span class="string"><span class="content">string</span></span>
        <span class="key">properties</span>:
          <span class="key">type</span>: <span class="string"><span class="content">object</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, you can also view this at the <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> URL. Scroll down in the UI to the schemas section and open up the SystemData schema icon.</p>
</div>
<div class="paragraph">
<p>You can also use this UI to try out the various endpoints. In the UI, head to the POST request <code>/api/systems</code>. This endpoint enables you to create a system. Once you’ve opened this icon up, click the <code>Try it out</code> button. Now enter appropriate values for each of the required parameters and click the <code>Execute</code> button.</p>
</div>
<div class="paragraph">
<p>You can verify that this system was created by testing the <code>/api/systems</code> GET request that returns the currently stored system data in the inventory. Execute this request in the UI, then in the response body you should see your system and its data listed.</p>
</div>
<div class="paragraph">
<p>You can follow these same steps for updating and deleting systems: visiting the corresponding endpoint in the UI, executing the endpoint, and then verifying the result by using the <code>/api/systems</code> GET request endpoint.</p>
</div>
<div class="paragraph">
<p>You can learn more about MicroProfile OpenAPI from the <a href="https://openliberty.io/guides/microprofile-openapi.html" target="_blank" rel="noopener">Documenting RESTful APIs guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-microservice">Configuring the microservice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, you can externalize your Liberty server configuration and inject configuration for your microservice by using MicroProfile Config.</p>
</div>
<div class="sect2">
<h3 id="enabling-configurable-ports-and-context-root">Enabling configurable ports and context root</h3>
<div class="paragraph">
<p>So far, you used hardcoded values to set the HTTP and HTTPS ports and the context root for the Liberty server. These configurations can be externalized so you can easily change their values when you want to deploy your microservice by different ports and context root.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>server.xml</code> file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="comment">&lt;!-- Enable features --&gt;</span>
<span class="line-numbers"> 5</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers"> 9</span>
<span class="line-numbers">10</span>    <span class="comment">&lt;!-- tag::httpPortVariable[] --&gt;</span>
<span class="line-numbers">11</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">12</span>    <span class="comment">&lt;!-- end::httpPortVariable[] --&gt;</span>
<span class="line-numbers">13</span>    <span class="comment">&lt;!-- tag::httpsPortVariable[] --&gt;</span>
<span class="line-numbers">14</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">15</span>    <span class="comment">&lt;!-- end::httpsPortVariable[] --&gt;</span>
<span class="line-numbers">16</span>    <span class="comment">&lt;!-- tag::contextRootVariable[] --&gt;</span>
<span class="line-numbers">17</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.context.root</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">18</span>    <span class="comment">&lt;!-- end::contextRootVariable[] --&gt;</span>
<span class="line-numbers">19</span>
<span class="line-numbers">20</span>    <span class="comment">&lt;!-- To access this server from a remote client,</span>
<span class="line-numbers">21</span><span class="comment">         add a host attribute to the following element, e.g. host="*" --&gt;</span>
<span class="line-numbers">22</span>    <span class="comment">&lt;!-- tag::editedHttpEndpoint[] --&gt;</span>
<span class="line-numbers">23</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">24</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">25</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">26</span>    <span class="comment">&lt;!-- end::editedHttpEndpoint[] --&gt;</span>
<span class="line-numbers">27</span>    
<span class="line-numbers">28</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">29</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">30</span>
<span class="line-numbers">31</span>    <span class="comment">&lt;!-- Configures the application on a specified context root --&gt;</span>
<span class="line-numbers">32</span>    <span class="comment">&lt;!-- tag::editedContextRoot[] --&gt;</span>
<span class="line-numbers">33</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.context.root}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">34</span>                    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory.war</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span> 
<span class="line-numbers">35</span>    <span class="comment">&lt;!-- end::editedContextRoot[] --&gt;</span>
<span class="line-numbers">36</span>
<span class="line-numbers">37</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">38</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">39</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add variables for the <code class="hotspot=httpPortVariable file=0">HTTP</code> port, <code class="hotspot=httpsPortVariable file=0">HTTPS</code> port, and the <code class="hotspot=contextRootVariable file=0">context root</code> to the <code>server.xml</code> file. Change the <code class="hotspot=editedHttpEndpoint file=0">httpEndpoint</code> element to reflect the new <code>default.http.port</code> and <code>default.http.port</code> variables and change the <code class="hotspot=editedContextRoot file=0">contextRoot</code> to use the new <code>default.context.root</code> variable too.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>build.gradle</code> file.</mark>
<code>build.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>build.gradle</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span>plugins {
<span class="line-numbers"> 2</span>    id 'war'
<span class="line-numbers"> 3</span>    // tag::libertyGradlePlugin[]
<span class="line-numbers"> 4</span>    id 'io.openliberty.tools.gradle.Liberty' version '3.6.2'
<span class="line-numbers"> 5</span>    // end::libertyGradlePlugin[]
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>version '1.0-SNAPSHOT'
<span class="line-numbers"> 9</span>group 'io.openliberty.deepdive'
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>sourceCompatibility = 11
<span class="line-numbers">12</span>targetCompatibility = 11
<span class="line-numbers">13</span>tasks.withType(JavaCompile) {
<span class="line-numbers">14</span>    options.encoding = 'UTF-8'
<span class="line-numbers">15</span>}
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>repositories {
<span class="line-numbers">18</span>    mavenCentral()
<span class="line-numbers">19</span>}
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>dependencies {
<span class="line-numbers">22</span>    // provided dependencies
<span class="line-numbers">23</span>    providedCompile 'jakarta.platform:jakarta.jakartaee-api:10.0.0'
<span class="line-numbers">24</span>    providedCompile 'org.eclipse.microprofile:microprofile:6.0'
<span class="line-numbers">25</span>}
<span class="line-numbers">26</span>
<span class="line-numbers">27</span>// tag::war[]
<span class="line-numbers">28</span>war {
<span class="line-numbers">29</span>    archiveVersion = ''
<span class="line-numbers">30</span>}
<span class="line-numbers">31</span>// end::war[]
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>// tag::ext[]
<span class="line-numbers">34</span>ext  {
<span class="line-numbers">35</span>    // tag::httpPort[]
<span class="line-numbers">36</span>    liberty.server.var.'default.http.port' = '9081'
<span class="line-numbers">37</span>    // end::httpPort[]
<span class="line-numbers">38</span>    // tag::httpsPort[]
<span class="line-numbers">39</span>    liberty.server.var.'default.https.port' = '9445'
<span class="line-numbers">40</span>    // end::httpsPort[]
<span class="line-numbers">41</span>    // tag::contextRoot[]
<span class="line-numbers">42</span>    liberty.server.var.'default.context.root' = '/trial'
<span class="line-numbers">43</span>    // end::contextRoot[]
<span class="line-numbers">44</span>}
<span class="line-numbers">45</span>// end::ext[]
<span class="line-numbers">46</span>
<span class="line-numbers">47</span>clean.dependsOn 'libertyStop'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set the <code class="hotspot=war file=1">archiveVersion</code> property to an empty string for the <code>war</code> task and add properties for the <code>HTTP</code> port, <code>HTTPS</code> port, and the <code>context root</code> to the <code>build.gradle</code> file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="hotspot=httpPort file=1">liberty.server.var.'default.http.port'</code> to <code>9081</code></p>
</li>
<li>
<p><code class="hotspot=httpsPort file=1">liberty.server.var.'default.https.port'</code> to <code>9445</code></p>
</li>
<li>
<p><code class="hotspot=contextRoot file=1">liberty.server.var.'default.context.root'</code> to <code>/trial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because you are using dev mode, these changes are automatically picked up by the server. After you see the following message, your application server in dev mode is ready again:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can access the application by the <a href="http://localhost:9081/trial/api/systems" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/trial/api/systems</a> URL. Alternatively, for the updated OpenAPI UI, use the following URL <a href="http://localhost:9081/openapi/ui/" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/openapi/ui/</a>.</p>
</div>
<div class="paragraph">
<p>build.gradle</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span>plugins {
<span class="line-numbers"> 2</span>    id 'war'
<span class="line-numbers"> 3</span>    // tag::libertyGradlePlugin[]
<span class="line-numbers"> 4</span>    id 'io.openliberty.tools.gradle.Liberty' version '3.6.2'
<span class="line-numbers"> 5</span>    // end::libertyGradlePlugin[]
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>version '1.0-SNAPSHOT'
<span class="line-numbers"> 9</span>group 'io.openliberty.deepdive'
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>sourceCompatibility = 11
<span class="line-numbers">12</span>targetCompatibility = 11
<span class="line-numbers">13</span>tasks.withType(JavaCompile) {
<span class="line-numbers">14</span>    options.encoding = 'UTF-8'
<span class="line-numbers">15</span>}
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>repositories {
<span class="line-numbers">18</span>    mavenCentral()
<span class="line-numbers">19</span>}
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>dependencies {
<span class="line-numbers">22</span>    // provided dependencies
<span class="line-numbers">23</span>    providedCompile 'jakarta.platform:jakarta.jakartaee-api:10.0.0'
<span class="line-numbers">24</span>    providedCompile 'org.eclipse.microprofile:microprofile:6.0'
<span class="line-numbers">25</span>}
<span class="line-numbers">26</span>
<span class="line-numbers">27</span>// tag::war[]
<span class="line-numbers">28</span>war {
<span class="line-numbers">29</span>    archiveVersion = ''
<span class="line-numbers">30</span>}
<span class="line-numbers">31</span>// end::war[]
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>// tag::ext[]
<span class="line-numbers">34</span>ext  {
<span class="line-numbers">35</span>    // tag::httpPort[]
<span class="line-numbers">36</span>    liberty.server.var.'default.http.port' = '9080'
<span class="line-numbers">37</span>    // end::httpPort[]
<span class="line-numbers">38</span>    // tag::httpsPort[]
<span class="line-numbers">39</span>    liberty.server.var.'default.https.port' = '9443'
<span class="line-numbers">40</span>    // end::httpsPort[]
<span class="line-numbers">41</span>    // tag::contextRoot[]
<span class="line-numbers">42</span>    liberty.server.var.'default.context.root' = '/inventory'
<span class="line-numbers">43</span>    // end::contextRoot[]
<span class="line-numbers">44</span>}
<span class="line-numbers">45</span>// end::ext[]
<span class="line-numbers">46</span>
<span class="line-numbers">47</span>clean.dependsOn 'libertyStop'</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you are finished trying out changing this configuration, change the variables back to their original values.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>update <code class="hotspot=httpPort file=2">liberty.server.var.'default.http.port'</code> to <code>9080</code></p>
</li>
<li>
<p>update <code class="hotspot=httpsPort file=2">liberty.server.var.'default.https.port'</code> to <code>9443</code></p>
</li>
<li>
<p>update <code class="hotspot=contextRoot file=2">liberty.server.var.'default.context.root'</code> to <code>/inventory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wait until you see the following message:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="injecting-static-configuration">Injecting static configuration</h3>
<div class="paragraph">
<p>You can now explore how to use MicroProfile’s Config API to inject static configuration into your microservice.</p>
</div>
<div class="paragraph">
<p>The MicroProfile Config API is included in the MicroProfile dependency that is specified in your <code>build.gradle</code> file. Look for the dependency with the <code>microprofile</code> artifact ID. This dependency provides a library that allows the use of the MicroProfile Config API. The <code>microProfile</code> feature is also enabled in the <code>server.xml</code> file.</p>
</div>
<div class="paragraph">
<p>First, you need to edit the <code>SystemResource</code> class to inject static configuration into the <code>CLIENT_PORT</code> variable.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemResource</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.Operation</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.ParameterIn</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameters</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponseSchema</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponses</span>;
<span class="line-numbers"> 25</span>
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 42</span>
<span class="line-numbers"> 43</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 44</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 45</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 46</span>
<span class="line-numbers"> 47</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 48</span>    Inventory inventory;
<span class="line-numbers"> 49</span>
<span class="line-numbers"> 50</span>    <span class="comment">// tag::inject[]</span>
<span class="line-numbers"> 51</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 52</span>    <span class="comment">// end::inject[]</span>
<span class="line-numbers"> 53</span>    <span class="comment">// tag::configProperty[]</span>
<span class="line-numbers"> 54</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">client.https.port</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 55</span>    <span class="comment">// end::configProperty[]</span>
<span class="line-numbers"> 56</span>    <span class="predefined-type">String</span> CLIENT_PORT;
<span class="line-numbers"> 57</span>
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 61</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 62</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 63</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">A list of system data stored within the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 64</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 65</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 66</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">List contents.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 67</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Returns the currently stored system data in the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 68</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">listContents</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 69</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 70</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 71</span>    }
<span class="line-numbers"> 72</span>
<span class="line-numbers"> 73</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 74</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 75</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 76</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 77</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">System data of a particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 78</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 79</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 80</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Get System</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 81</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Retrieves and returns the system data from the system </span><span class="delimiter">"</span></span>
<span class="line-numbers"> 82</span>        + <span class="string"><span class="delimiter">"</span><span class="content">service running on the particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 83</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">getSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 84</span>    )
<span class="line-numbers"> 85</span>    <span class="directive">public</span> SystemData getSystem(
<span class="line-numbers"> 86</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers"> 87</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers"> 88</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 89</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 90</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers"> 91</span>        )
<span class="line-numbers"> 92</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 93</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers"> 94</span>    }
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>    <span class="annotation">@POST</span>
<span class="line-numbers"> 97</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers"> 98</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 99</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">100</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">101</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system to inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">102</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">103</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system to inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">104</span>    })
<span class="line-numbers">105</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">106</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">107</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">108</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">109</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">110</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">111</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">112</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">113</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">114</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">115</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">116</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">117</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">118</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">119</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">120</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">121</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">122</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">123</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">124</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">125</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">126</span>    })
<span class="line-numbers">127</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">128</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">129</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Add a system and its data to the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">130</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">131</span>    )
<span class="line-numbers">132</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers">133</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">134</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">135</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">136</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">137</span>
<span class="line-numbers">138</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">139</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">140</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">141</span>        }
<span class="line-numbers">142</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers">143</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">144</span>    }
<span class="line-numbers">145</span>
<span class="line-numbers">146</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">147</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">148</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">149</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">150</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">151</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">152</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully updated system</span><span class="delimiter">"</span></span>),
<span class="line-numbers">153</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">154</span>           description =
<span class="line-numbers">155</span>               <span class="string"><span class="delimiter">"</span><span class="content">Unable to update because the system does not exist in the inventory.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">156</span>    })
<span class="line-numbers">157</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">158</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">159</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">160</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">161</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">162</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">163</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">164</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">165</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">166</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">167</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">168</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">169</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">170</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">171</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">172</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">173</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">174</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">175</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">176</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">177</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">178</span>    })
<span class="line-numbers">179</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">180</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Update system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">181</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Update a system and its data on the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">182</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">183</span>    )
<span class="line-numbers">184</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers">185</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">186</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">187</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">188</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">189</span>
<span class="line-numbers">190</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">191</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers">192</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">193</span>        }
<span class="line-numbers">194</span>        s.setOsName(osName);
<span class="line-numbers">195</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers">196</span>        s.setHeapSize(heapSize);
<span class="line-numbers">197</span>        inventory.update(s);
<span class="line-numbers">198</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">199</span>    }
<span class="line-numbers">200</span>
<span class="line-numbers">201</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">202</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">203</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">204</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">205</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">206</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully deleted the system from inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">207</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">208</span>            description =
<span class="line-numbers">209</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to delete because the system does not exist in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">210</span>    })
<span class="line-numbers">211</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">212</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">213</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">214</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">215</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">216</span>    )
<span class="line-numbers">217</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">218</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Remove system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">219</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Removes a system from the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">220</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">221</span>    )
<span class="line-numbers">222</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">223</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">224</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">225</span>            inventory.removeSystem(s);
<span class="line-numbers">226</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">227</span>        } <span class="keyword">else</span> {
<span class="line-numbers">228</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">229</span>        }
<span class="line-numbers">230</span>    }
<span class="line-numbers">231</span>
<span class="line-numbers">232</span>    <span class="annotation">@POST</span>
<span class="line-numbers">233</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">234</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">235</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">236</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">237</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">238</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system client</span><span class="delimiter">"</span></span>),
<span class="line-numbers">239</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">240</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system client</span><span class="delimiter">"</span></span>)
<span class="line-numbers">241</span>    })
<span class="line-numbers">242</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">243</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">244</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">245</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">246</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">247</span>    )
<span class="line-numbers">248</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">249</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system client</span><span class="delimiter">"</span></span>,
<span class="line-numbers">250</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">This adds a system client.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">251</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>
<span class="line-numbers">252</span>    )
<span class="line-numbers">253</span>    <span class="comment">//tag::printClientPort[]</span>
<span class="line-numbers">254</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">255</span>        <span class="predefined-type">System</span>.out.println(CLIENT_PORT);
<span class="line-numbers">256</span>        <span class="keyword">return</span> success(<span class="string"><span class="delimiter">"</span><span class="content">Client Port: </span><span class="delimiter">"</span></span> + CLIENT_PORT);
<span class="line-numbers">257</span>    }
<span class="line-numbers">258</span>    <span class="comment">//end::printClientPort[]</span>
<span class="line-numbers">259</span>
<span class="line-numbers">260</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">261</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">262</span>    }
<span class="line-numbers">263</span>
<span class="line-numbers">264</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">265</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">266</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">267</span>                       .build();
<span class="line-numbers">268</span>    }
<span class="line-numbers">269</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=inject file=0">@Inject</code> annotation injects the value from other configuration sources to the <code>CLIENT_PORT</code> variable. The <code class="hotspot=configProperty file=0">@ConfigProperty</code> defines the external property name as <code>client.https.port</code>.</p>
</div>
<div class="paragraph">
<p>Update the <code class="hotspot=printClientPort file=0">POST</code> request so that the <code>/client/{hostname}</code> endpoint prints the <code>CLIENT_PORT</code> value.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-the-microprofile-config-properties-file">Adding the microprofile-config.properties file</h3>
<div class="paragraph">
<p>Define the configurable variables in the <code>microprofile-config.properties</code> configuration file for MicroProfile Config at the <code>src/main/resources/META-INF</code> directory.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src\main\resources\META-INF</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir -p src/main/resources/META-INF</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>microprofile-config.properties</code> file.</mark>
<code>src/main/resources/META-INF/microprofile-config.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>microprofile-config.properties</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"><span class="line-numbers">1</span># tag::ordinal[]
<span class="line-numbers">2</span>config_ordinal=100
<span class="line-numbers">3</span># end::ordinal[]
<span class="line-numbers">4</span>
<span class="line-numbers">5</span># tag::configPort[]
<span class="line-numbers">6</span>client.https.port=5555
<span class="line-numbers">7</span># end::configPort[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code class="hotspot=ordinal file=0">config_ordinal</code> variable in this properties file, you can set the ordinal of this file and thus other configuration sources.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=configPort file=0">client.https.port</code> variable enables the client port to be overwritten.</p>
</div>
<div class="paragraph">
<p>Revisit the OpenAPI UI <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> to view these changes. Open the <code>/api/systems/client/{hostname}</code> endpoint and run it within the UI to view the <code>CLIENT_PORT</code> value.</p>
</div>
<div class="paragraph">
<p>You can learn more about MicroProfile Config from the <a href="https://openliberty.io/guides/microprofile-config.html" target="_blank" rel="noopener">Configuring microservices guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persisting-data">Persisting data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, you’ll persist the system data into the PostgreSQL database by using  the <a href="https://jakarta.ee/specifications/persistence" target="_blank" rel="noopener noreferrer">Jakarta Persistence API</a> (JPA).</p>
</div>
<div class="paragraph">
<p>Navigate to your application directory.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start/inventory</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-jpa-entity-class">Defining a JPA entity class</h3>
<div class="paragraph">
<p>To store Java objects in a database, you must define a JPA entity class. A JPA entity is a Java object whose nontransient and nonstatic fields are persisted to the database. Any POJO class can be designated as a JPA entity. However, the class must be annotated with the <code>@Entity</code> annotation, must not be declared final, and must have a public or protected nonargument constructor. JPA maps an entity type to a database table and persisted instances will be represented as rows in the table.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=SystemData">SystemData</code> class is a data model that represents systems in the <code>inventory</code> microservice. Annotate it with JPA annotations.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemData</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/model/SystemData.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemData.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.model</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Column</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Entity</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.persistence.GeneratedValue</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.persistence.GenerationType</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Id</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.persistence.NamedQuery</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.persistence.SequenceGenerator</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Table</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="annotation">@Schema</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 28</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">POJO that represents a single inventory entry.</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 29</span><span class="comment">// tag::Entity[]</span>
<span class="line-numbers"> 30</span><span class="annotation">@Entity</span>
<span class="line-numbers"> 31</span><span class="comment">// end::Entity[]</span>
<span class="line-numbers"> 32</span><span class="comment">// tag::Table[]</span>
<span class="line-numbers"> 33</span><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 34</span><span class="comment">// end::Table[]</span>
<span class="line-numbers"> 35</span><span class="comment">// tag::findAll[]</span>
<span class="line-numbers"> 36</span><span class="annotation">@NamedQuery</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData.findAll</span><span class="delimiter">"</span></span>, query = <span class="string"><span class="delimiter">"</span><span class="content">SELECT e FROM SystemData e</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 37</span><span class="comment">//end::findAll[]</span>
<span class="line-numbers"> 38</span><span class="comment">//tag::findSystem[]</span>
<span class="line-numbers"> 39</span><span class="annotation">@NamedQuery</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData.findSystem</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 40</span>            query = <span class="string"><span class="delimiter">"</span><span class="content">SELECT e FROM SystemData e WHERE e.hostname = :hostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 41</span><span class="comment">// end::findSystem[]</span>
<span class="line-numbers"> 42</span><span class="comment">// tag::SystemData[]</span>
<span class="line-numbers"> 43</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemData</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
<span class="line-numbers"> 44</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
<span class="line-numbers"> 45</span>
<span class="line-numbers"> 46</span>    <span class="comment">// tag::GeneratedValue[]</span>
<span class="line-numbers"> 47</span>    <span class="annotation">@SequenceGenerator</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SEQ</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 48</span>                       sequenceName = <span class="string"><span class="delimiter">"</span><span class="content">systemData_id_seq</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 49</span>                       allocationSize = <span class="integer">1</span>)
<span class="line-numbers"> 50</span>    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY, generator = <span class="string"><span class="delimiter">"</span><span class="content">SEQ</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 51</span>    <span class="comment">// end::GeneratedValue[]</span>
<span class="line-numbers"> 52</span>    <span class="comment">// tag::Id[]</span>
<span class="line-numbers"> 53</span>    <span class="annotation">@Id</span>
<span class="line-numbers"> 54</span>    <span class="comment">// end::Id[]</span>
<span class="line-numbers"> 55</span>    <span class="comment">// tag::columnId[]</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="comment">// end::columnId[]</span>
<span class="line-numbers"> 58</span>    <span class="directive">private</span> <span class="type">int</span> id;
<span class="line-numbers"> 59</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@Schema</span>(required = <span class="predefined-constant">true</span>)
<span class="line-numbers"> 61</span>    <span class="comment">// tag::columnHostname[]</span>
<span class="line-numbers"> 62</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 63</span>    <span class="comment">// end::columnHostname[]</span>
<span class="line-numbers"> 64</span>    <span class="directive">private</span> <span class="predefined-type">String</span> hostname;
<span class="line-numbers"> 65</span>
<span class="line-numbers"> 66</span>    <span class="comment">// tag::columnOsName[]</span>
<span class="line-numbers"> 67</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 68</span>    <span class="comment">// end::columnOsName[]</span>
<span class="line-numbers"> 69</span>    <span class="directive">private</span> <span class="predefined-type">String</span> osName;
<span class="line-numbers"> 70</span>    <span class="comment">// tag::columnJavaVersion[]</span>
<span class="line-numbers"> 71</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 72</span>    <span class="comment">// end::columnJavaVersion[]</span>
<span class="line-numbers"> 73</span>    <span class="directive">private</span> <span class="predefined-type">String</span> javaVersion;
<span class="line-numbers"> 74</span>    <span class="comment">// tag::columnHeapSize[]</span>
<span class="line-numbers"> 75</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 76</span>    <span class="comment">// end::columnHeapSize[]</span>
<span class="line-numbers"> 77</span>    <span class="directive">private</span> <span class="predefined-type">Long</span> heapSize;
<span class="line-numbers"> 78</span>
<span class="line-numbers"> 79</span>    <span class="directive">public</span> SystemData() {
<span class="line-numbers"> 80</span>    }
<span class="line-numbers"> 81</span>
<span class="line-numbers"> 82</span>    <span class="directive">public</span> SystemData(<span class="predefined-type">String</span> hostname, <span class="predefined-type">String</span> osName, <span class="predefined-type">String</span> javaVer, <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers"> 83</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers"> 84</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers"> 85</span>        <span class="local-variable">this</span>.javaVersion = javaVer;
<span class="line-numbers"> 86</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers"> 87</span>    }
<span class="line-numbers"> 88</span>
<span class="line-numbers"> 89</span>    <span class="directive">public</span> <span class="type">int</span> getId() {
<span class="line-numbers"> 90</span>        <span class="keyword">return</span> id;
<span class="line-numbers"> 91</span>    }
<span class="line-numbers"> 92</span>
<span class="line-numbers"> 93</span>    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
<span class="line-numbers"> 94</span>        <span class="local-variable">this</span>.id = id;
<span class="line-numbers"> 95</span>    }
<span class="line-numbers"> 96</span>
<span class="line-numbers"> 97</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers"> 98</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers"> 99</span>    }
<span class="line-numbers">100</span>
<span class="line-numbers">101</span>    <span class="directive">public</span> <span class="type">void</span> setHostname(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">102</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">103</span>    }
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOsName() {
<span class="line-numbers">106</span>        <span class="keyword">return</span> osName;
<span class="line-numbers">107</span>    }
<span class="line-numbers">108</span>
<span class="line-numbers">109</span>    <span class="directive">public</span> <span class="type">void</span> setOsName(<span class="predefined-type">String</span> osName) {
<span class="line-numbers">110</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">111</span>    }
<span class="line-numbers">112</span>
<span class="line-numbers">113</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJavaVersion() {
<span class="line-numbers">114</span>        <span class="keyword">return</span> javaVersion;
<span class="line-numbers">115</span>    }
<span class="line-numbers">116</span>
<span class="line-numbers">117</span>    <span class="directive">public</span> <span class="type">void</span> setJavaVersion(<span class="predefined-type">String</span> javaVersion) {
<span class="line-numbers">118</span>        <span class="local-variable">this</span>.javaVersion = javaVersion;
<span class="line-numbers">119</span>    }
<span class="line-numbers">120</span>
<span class="line-numbers">121</span>    <span class="directive">public</span> <span class="predefined-type">Long</span> getHeapSize() {
<span class="line-numbers">122</span>        <span class="keyword">return</span> heapSize;
<span class="line-numbers">123</span>    }
<span class="line-numbers">124</span>
<span class="line-numbers">125</span>    <span class="directive">public</span> <span class="type">void</span> setHeapSize(<span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">126</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">127</span>    }
<span class="line-numbers">128</span>
<span class="line-numbers">129</span>    <span class="annotation">@Override</span>
<span class="line-numbers">130</span>    <span class="directive">public</span> <span class="type">int</span> hashCode() {
<span class="line-numbers">131</span>        <span class="keyword">return</span> hostname.hashCode();
<span class="line-numbers">132</span>    }
<span class="line-numbers">133</span>
<span class="line-numbers">134</span>    <span class="annotation">@Override</span>
<span class="line-numbers">135</span>    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> host) {
<span class="line-numbers">136</span>        <span class="keyword">if</span> (host <span class="keyword">instanceof</span> SystemData) {
<span class="line-numbers">137</span>            <span class="keyword">return</span> hostname.equals(((SystemData) host).getHostname());
<span class="line-numbers">138</span>        }
<span class="line-numbers">139</span>        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>}
<span class="line-numbers">142</span><span class="comment">// end::SystemData[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table breaks down the new annotations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.8936%;">
<col style="width: 85.1064%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Annotation</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=Entity">@Entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the class as an entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=Table">@Table</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies details of the table such as name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=findAll hotspot=findSystem">@NamedQuery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a predefined database query that is run by an <code>EntityManager</code> instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=Id">@Id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the primary key of the entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=GeneratedValue">@GeneratedValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the strategy that is used for generating the value of the primary key. The <code>strategy = GenerationType.IDENTITY</code> code indicates that the database automatically increments the <code>inventoryid</code> upon inserting it into the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=columnId hotspot=columnHostname hotspot=columnOsName hotspot=columnJavaVersion hotspot=columnHeapSize">@Column</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the field is mapped to a column in the database table. The <code>name</code> attribute is optional and indicates the name of the column in the table.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="performing-crud-operations-using-jpa">Performing CRUD operations using JPA</h3>
<div class="paragraph">
<p>The create, retrieve, update, and delete (CRUD) operations are defined in the Inventory. To perform these operations by using JPA, you need to update the <code>Inventory</code> class.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>Inventory</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/Inventory.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inventory.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers">15</span>
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.persistence.EntityManager</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.persistence.PersistenceContext</span>;
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">22</span><span class="comment">// tag::Inventory[]</span>
<span class="line-numbers">23</span><span class="directive">public</span> <span class="type">class</span> <span class="class">Inventory</span> {
<span class="line-numbers">24</span>
<span class="line-numbers">25</span>    <span class="comment">// tag::PersistenceContext[]</span>
<span class="line-numbers">26</span>    <span class="annotation">@PersistenceContext</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">jpa-unit</span><span class="delimiter">"</span></span>)
<span class="line-numbers">27</span>    <span class="comment">// end::PersistenceContext[]</span>
<span class="line-numbers">28</span>    <span class="directive">private</span> EntityManager em;
<span class="line-numbers">29</span>
<span class="line-numbers">30</span>    <span class="comment">// tag::getSystems[]</span>
<span class="line-numbers">31</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; getSystems() {
<span class="line-numbers">32</span>        <span class="keyword">return</span> em.createNamedQuery(<span class="string"><span class="delimiter">"</span><span class="content">SystemData.findAll</span><span class="delimiter">"</span></span>, SystemData.class)
<span class="line-numbers">33</span>                 .getResultList();
<span class="line-numbers">34</span>    }
<span class="line-numbers">35</span>    <span class="comment">// end::getSystems[]</span>
<span class="line-numbers">36</span>
<span class="line-numbers">37</span>    <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers">38</span>    <span class="directive">public</span> SystemData getSystem(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">39</span>        <span class="comment">// tag::find[]</span>
<span class="line-numbers">40</span>        <span class="predefined-type">List</span>&lt;SystemData&gt; systems =
<span class="line-numbers">41</span>            em.createNamedQuery(<span class="string"><span class="delimiter">"</span><span class="content">SystemData.findSystem</span><span class="delimiter">"</span></span>, SystemData.class)
<span class="line-numbers">42</span>              .setParameter(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, hostname)
<span class="line-numbers">43</span>              .getResultList();
<span class="line-numbers">44</span>        <span class="keyword">return</span> systems == <span class="predefined-constant">null</span> || systems.isEmpty() ? <span class="predefined-constant">null</span> : systems.get(<span class="integer">0</span>);
<span class="line-numbers">45</span>        <span class="comment">// end::find[]</span>
<span class="line-numbers">46</span>    }
<span class="line-numbers">47</span>    <span class="comment">// end::getSystem[]</span>
<span class="line-numbers">48</span>
<span class="line-numbers">49</span>    <span class="comment">// tag::add[]</span>
<span class="line-numbers">50</span>    <span class="directive">public</span> <span class="type">void</span> add(<span class="predefined-type">String</span> hostname, <span class="predefined-type">String</span> osName, <span class="predefined-type">String</span> javaVersion, <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">51</span>        <span class="comment">// tag::Persist[]</span>
<span class="line-numbers">52</span>        em.persist(<span class="keyword">new</span> SystemData(hostname, osName, javaVersion, heapSize));
<span class="line-numbers">53</span>        <span class="comment">// end::Persist[]</span>
<span class="line-numbers">54</span>    }
<span class="line-numbers">55</span>    <span class="comment">// end::add[]</span>
<span class="line-numbers">56</span>
<span class="line-numbers">57</span>    <span class="comment">// tag::update[]</span>
<span class="line-numbers">58</span>    <span class="directive">public</span> <span class="type">void</span> update(SystemData s) {
<span class="line-numbers">59</span>        <span class="comment">// tag::Merge[]</span>
<span class="line-numbers">60</span>        em.merge(s);
<span class="line-numbers">61</span>        <span class="comment">// end::Merge[]</span>
<span class="line-numbers">62</span>    }
<span class="line-numbers">63</span>    <span class="comment">// end::update[]</span>
<span class="line-numbers">64</span>
<span class="line-numbers">65</span>    <span class="comment">// tag::removeSystem[]</span>
<span class="line-numbers">66</span>    <span class="directive">public</span> <span class="type">void</span> removeSystem(SystemData s) {
<span class="line-numbers">67</span>        <span class="comment">// tag::Remove[]</span>
<span class="line-numbers">68</span>        em.remove(s);
<span class="line-numbers">69</span>        <span class="comment">// end::Remove[]</span>
<span class="line-numbers">70</span>    }
<span class="line-numbers">71</span>    <span class="comment">// end::removeSystem[]</span>
<span class="line-numbers">72</span>
<span class="line-numbers">73</span>}
<span class="line-numbers">74</span><span class="comment">// end::Inventory[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the entity manager at run time, inject it into your CDI bean through the <code class="hotspot=PersistenceContext file=0">@PersistenceContext</code> annotation. The entity manager interacts with the persistence context. Every <code>EntityManager</code> instance is associated with a persistence context. The persistence context manages a set of entities and is aware of the different states that an entity can have. The persistence context synchronizes with the database when a transaction commits.</p>
</div>
<div class="paragraph">
<p>SystemData.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.model</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Column</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Entity</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.persistence.GeneratedValue</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.persistence.GenerationType</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Id</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.persistence.NamedQuery</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.persistence.SequenceGenerator</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.persistence.Table</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="annotation">@Schema</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 28</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">POJO that represents a single inventory entry.</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 29</span><span class="comment">// tag::Entity[]</span>
<span class="line-numbers"> 30</span><span class="annotation">@Entity</span>
<span class="line-numbers"> 31</span><span class="comment">// end::Entity[]</span>
<span class="line-numbers"> 32</span><span class="comment">// tag::Table[]</span>
<span class="line-numbers"> 33</span><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 34</span><span class="comment">// end::Table[]</span>
<span class="line-numbers"> 35</span><span class="comment">// tag::findAll[]</span>
<span class="line-numbers"> 36</span><span class="annotation">@NamedQuery</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData.findAll</span><span class="delimiter">"</span></span>, query = <span class="string"><span class="delimiter">"</span><span class="content">SELECT e FROM SystemData e</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 37</span><span class="comment">//end::findAll[]</span>
<span class="line-numbers"> 38</span><span class="comment">//tag::findSystem[]</span>
<span class="line-numbers"> 39</span><span class="annotation">@NamedQuery</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SystemData.findSystem</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 40</span>            query = <span class="string"><span class="delimiter">"</span><span class="content">SELECT e FROM SystemData e WHERE e.hostname = :hostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 41</span><span class="comment">// end::findSystem[]</span>
<span class="line-numbers"> 42</span><span class="comment">// tag::SystemData[]</span>
<span class="line-numbers"> 43</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemData</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
<span class="line-numbers"> 44</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
<span class="line-numbers"> 45</span>
<span class="line-numbers"> 46</span>    <span class="comment">// tag::GeneratedValue[]</span>
<span class="line-numbers"> 47</span>    <span class="annotation">@SequenceGenerator</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SEQ</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 48</span>                       sequenceName = <span class="string"><span class="delimiter">"</span><span class="content">systemData_id_seq</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 49</span>                       allocationSize = <span class="integer">1</span>)
<span class="line-numbers"> 50</span>    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY, generator = <span class="string"><span class="delimiter">"</span><span class="content">SEQ</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 51</span>    <span class="comment">// end::GeneratedValue[]</span>
<span class="line-numbers"> 52</span>    <span class="comment">// tag::Id[]</span>
<span class="line-numbers"> 53</span>    <span class="annotation">@Id</span>
<span class="line-numbers"> 54</span>    <span class="comment">// end::Id[]</span>
<span class="line-numbers"> 55</span>    <span class="comment">// tag::columnId[]</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="comment">// end::columnId[]</span>
<span class="line-numbers"> 58</span>    <span class="directive">private</span> <span class="type">int</span> id;
<span class="line-numbers"> 59</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@Schema</span>(required = <span class="predefined-constant">true</span>)
<span class="line-numbers"> 61</span>    <span class="comment">// tag::columnHostname[]</span>
<span class="line-numbers"> 62</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 63</span>    <span class="comment">// end::columnHostname[]</span>
<span class="line-numbers"> 64</span>    <span class="directive">private</span> <span class="predefined-type">String</span> hostname;
<span class="line-numbers"> 65</span>
<span class="line-numbers"> 66</span>    <span class="comment">// tag::columnOsName[]</span>
<span class="line-numbers"> 67</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 68</span>    <span class="comment">// end::columnOsName[]</span>
<span class="line-numbers"> 69</span>    <span class="directive">private</span> <span class="predefined-type">String</span> osName;
<span class="line-numbers"> 70</span>    <span class="comment">// tag::columnJavaVersion[]</span>
<span class="line-numbers"> 71</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 72</span>    <span class="comment">// end::columnJavaVersion[]</span>
<span class="line-numbers"> 73</span>    <span class="directive">private</span> <span class="predefined-type">String</span> javaVersion;
<span class="line-numbers"> 74</span>    <span class="comment">// tag::columnHeapSize[]</span>
<span class="line-numbers"> 75</span>    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 76</span>    <span class="comment">// end::columnHeapSize[]</span>
<span class="line-numbers"> 77</span>    <span class="directive">private</span> <span class="predefined-type">Long</span> heapSize;
<span class="line-numbers"> 78</span>
<span class="line-numbers"> 79</span>    <span class="directive">public</span> SystemData() {
<span class="line-numbers"> 80</span>    }
<span class="line-numbers"> 81</span>
<span class="line-numbers"> 82</span>    <span class="directive">public</span> SystemData(<span class="predefined-type">String</span> hostname, <span class="predefined-type">String</span> osName, <span class="predefined-type">String</span> javaVer, <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers"> 83</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers"> 84</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers"> 85</span>        <span class="local-variable">this</span>.javaVersion = javaVer;
<span class="line-numbers"> 86</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers"> 87</span>    }
<span class="line-numbers"> 88</span>
<span class="line-numbers"> 89</span>    <span class="directive">public</span> <span class="type">int</span> getId() {
<span class="line-numbers"> 90</span>        <span class="keyword">return</span> id;
<span class="line-numbers"> 91</span>    }
<span class="line-numbers"> 92</span>
<span class="line-numbers"> 93</span>    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
<span class="line-numbers"> 94</span>        <span class="local-variable">this</span>.id = id;
<span class="line-numbers"> 95</span>    }
<span class="line-numbers"> 96</span>
<span class="line-numbers"> 97</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers"> 98</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers"> 99</span>    }
<span class="line-numbers">100</span>
<span class="line-numbers">101</span>    <span class="directive">public</span> <span class="type">void</span> setHostname(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">102</span>        <span class="local-variable">this</span>.hostname = hostname;
<span class="line-numbers">103</span>    }
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOsName() {
<span class="line-numbers">106</span>        <span class="keyword">return</span> osName;
<span class="line-numbers">107</span>    }
<span class="line-numbers">108</span>
<span class="line-numbers">109</span>    <span class="directive">public</span> <span class="type">void</span> setOsName(<span class="predefined-type">String</span> osName) {
<span class="line-numbers">110</span>        <span class="local-variable">this</span>.osName = osName;
<span class="line-numbers">111</span>    }
<span class="line-numbers">112</span>
<span class="line-numbers">113</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJavaVersion() {
<span class="line-numbers">114</span>        <span class="keyword">return</span> javaVersion;
<span class="line-numbers">115</span>    }
<span class="line-numbers">116</span>
<span class="line-numbers">117</span>    <span class="directive">public</span> <span class="type">void</span> setJavaVersion(<span class="predefined-type">String</span> javaVersion) {
<span class="line-numbers">118</span>        <span class="local-variable">this</span>.javaVersion = javaVersion;
<span class="line-numbers">119</span>    }
<span class="line-numbers">120</span>
<span class="line-numbers">121</span>    <span class="directive">public</span> <span class="predefined-type">Long</span> getHeapSize() {
<span class="line-numbers">122</span>        <span class="keyword">return</span> heapSize;
<span class="line-numbers">123</span>    }
<span class="line-numbers">124</span>
<span class="line-numbers">125</span>    <span class="directive">public</span> <span class="type">void</span> setHeapSize(<span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">126</span>        <span class="local-variable">this</span>.heapSize = heapSize;
<span class="line-numbers">127</span>    }
<span class="line-numbers">128</span>
<span class="line-numbers">129</span>    <span class="annotation">@Override</span>
<span class="line-numbers">130</span>    <span class="directive">public</span> <span class="type">int</span> hashCode() {
<span class="line-numbers">131</span>        <span class="keyword">return</span> hostname.hashCode();
<span class="line-numbers">132</span>    }
<span class="line-numbers">133</span>
<span class="line-numbers">134</span>    <span class="annotation">@Override</span>
<span class="line-numbers">135</span>    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> host) {
<span class="line-numbers">136</span>        <span class="keyword">if</span> (host <span class="keyword">instanceof</span> SystemData) {
<span class="line-numbers">137</span>            <span class="keyword">return</span> hostname.equals(((SystemData) host).getHostname());
<span class="line-numbers">138</span>        }
<span class="line-numbers">139</span>        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>}
<span class="line-numbers">142</span><span class="comment">// end::SystemData[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=Inventory file=0">Inventory</code> class has a method for each CRUD operation, so let’s break them down:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code class="hotspot=add file=0">add()</code> method persists an instance of the <code>SystemData</code> entity class to the data store by calling the <code class="hotspot=Persist file=0">persist()</code> method on an <code>EntityManager</code> instance. The entity instance becomes managed and changes to it are tracked by the entity manager.</p>
</li>
<li>
<p>The <code class="hotspot=getSystems file=0">getSystems()</code> method demonstrates a way to retrieve system objects from the database. This method returns a list of instances of the <code>SystemData</code> entity class by using the <code class="hotspot=findAll file=1">SystemData.findAll</code> query that is specified in the <code class="hotspot=findAll hotspot=findSystem file=1">@NamedQuery</code> annotation on the <code>SystemData</code> class. Similarly, the <code class="hotspot=getSystem file=0">getSystem()</code> method uses the <code class="hotspot=findSystem file=1">SystemData.findSystem</code> named query to find a system with the given hostname.</p>
</li>
<li>
<p>The <code class="hotspot=update file=0">update()</code> method creates a managed instance of a detached entity instance. The entity manager automatically tracks all managed entity objects in its persistence context for changes and synchronizes them with the database. However, if an entity becomes detached, you must merge that entity into the persistence context by calling the <code class="hotspot=Merge file=0">merge()</code> method so that changes to loaded fields of the detached entity are tracked.</p>
</li>
<li>
<p>The <code class="hotspot=removeSystem file=0">removeSystem()</code> method removes an instance of the <code>SystemData</code> entity class from the database by calling the <code class="hotspot=Remove file=0">remove()</code> method on an <code>EntityManager</code> instance. The state of the entity is changed to removed and is removed from the database upon transaction commit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Declare the endpoints with transaction management.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Replace the <code>SystemResource</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.Operation</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.ParameterIn</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameters</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponseSchema</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponses</span>;
<span class="line-numbers"> 25</span>
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">jakarta.transaction.Transactional</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 43</span>
<span class="line-numbers"> 44</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 45</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 46</span><span class="comment">// tag::SystemResource[]</span>
<span class="line-numbers"> 47</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>    <span class="comment">// tag::inventory[]</span>
<span class="line-numbers"> 50</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 51</span>    Inventory inventory;
<span class="line-numbers"> 52</span>    <span class="comment">// end::inventory[]</span>
<span class="line-numbers"> 53</span>
<span class="line-numbers"> 54</span>    <span class="comment">// tag::inject[]</span>
<span class="line-numbers"> 55</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 56</span>    <span class="comment">// end::inject[]</span>
<span class="line-numbers"> 57</span>    <span class="comment">// tag::configProperty[]</span>
<span class="line-numbers"> 58</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">client.https.port</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 59</span>    <span class="comment">// end::configProperty[]</span>
<span class="line-numbers"> 60</span>    <span class="predefined-type">String</span> CLIENT_PORT;
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>
<span class="line-numbers"> 63</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 64</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 65</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 66</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 67</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">A list of system data stored within the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 68</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 69</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 70</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">List contents.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 71</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Returns the currently stored system data in the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 72</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">listContents</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 73</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 74</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 75</span>    }
<span class="line-numbers"> 76</span>
<span class="line-numbers"> 77</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 78</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 79</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 80</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 81</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">System data of a particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 82</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 83</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 84</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Get System</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 85</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Retrieves and returns the system data from the system </span><span class="delimiter">"</span></span>
<span class="line-numbers"> 86</span>                      + <span class="string"><span class="delimiter">"</span><span class="content">service running on the particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 87</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">getSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 88</span>    )
<span class="line-numbers"> 89</span>    <span class="directive">public</span> SystemData getSystem(
<span class="line-numbers"> 90</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers"> 91</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers"> 92</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 93</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 94</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers"> 95</span>        )
<span class="line-numbers"> 96</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 97</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers"> 98</span>    }
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="comment">// tag::postTransactional[]</span>
<span class="line-numbers">101</span>    <span class="annotation">@POST</span>
<span class="line-numbers">102</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">103</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">104</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">105</span>    <span class="comment">// end::postTransactional[]</span>
<span class="line-numbers">106</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">107</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">108</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system to inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">109</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">110</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system to inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">111</span>    })
<span class="line-numbers">112</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">113</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">114</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">115</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">116</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">117</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">118</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">119</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">120</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">121</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">122</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">123</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">124</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">125</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">126</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">127</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">128</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">129</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">130</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">131</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">132</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">133</span>    })
<span class="line-numbers">134</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">135</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">136</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Add a system and its data to the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">137</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">138</span>    )
<span class="line-numbers">139</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers">140</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">141</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">142</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">143</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">144</span>
<span class="line-numbers">145</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">146</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">147</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">148</span>        }
<span class="line-numbers">149</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers">150</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">151</span>    }
<span class="line-numbers">152</span>
<span class="line-numbers">153</span>    <span class="comment">// tag::putTransactional[]</span>
<span class="line-numbers">154</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">155</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">156</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">157</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">158</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">159</span>    <span class="comment">// end::putTransactional[]</span>
<span class="line-numbers">160</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">161</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">162</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully updated system</span><span class="delimiter">"</span></span>),
<span class="line-numbers">163</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">164</span>           description =
<span class="line-numbers">165</span>               <span class="string"><span class="delimiter">"</span><span class="content">Unable to update because the system does not exist in the inventory.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">166</span>    })
<span class="line-numbers">167</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">168</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">169</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">170</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">171</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">172</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">173</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">174</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">175</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">176</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">177</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">178</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">179</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">180</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">181</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">182</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">183</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">184</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">185</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">186</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">187</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">188</span>    })
<span class="line-numbers">189</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">190</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Update system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">191</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Update a system and its data on the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">192</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">193</span>    )
<span class="line-numbers">194</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers">195</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">196</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">197</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">198</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">199</span>
<span class="line-numbers">200</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">201</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers">202</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">203</span>        }
<span class="line-numbers">204</span>        s.setOsName(osName);
<span class="line-numbers">205</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers">206</span>        s.setHeapSize(heapSize);
<span class="line-numbers">207</span>        inventory.update(s);
<span class="line-numbers">208</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">209</span>    }
<span class="line-numbers">210</span>
<span class="line-numbers">211</span>    <span class="comment">// tag::deleteTransactional[]</span>
<span class="line-numbers">212</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">213</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">214</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">215</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">216</span>    <span class="comment">// end::deleteTransactional[]</span>
<span class="line-numbers">217</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">218</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">219</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully deleted the system from inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">220</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">221</span>            description =
<span class="line-numbers">222</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to delete because the system does not exist in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">223</span>    })
<span class="line-numbers">224</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">225</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">226</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">227</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">228</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">229</span>    )
<span class="line-numbers">230</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">231</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Remove system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">232</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Removes a system from the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">233</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">234</span>    )
<span class="line-numbers">235</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">236</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">237</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">238</span>            inventory.removeSystem(s);
<span class="line-numbers">239</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">240</span>        } <span class="keyword">else</span> {
<span class="line-numbers">241</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">242</span>        }
<span class="line-numbers">243</span>    }
<span class="line-numbers">244</span>
<span class="line-numbers">245</span>    <span class="annotation">@POST</span>
<span class="line-numbers">246</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">247</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">248</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">249</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">250</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">251</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">252</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system client</span><span class="delimiter">"</span></span>),
<span class="line-numbers">253</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">254</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system client</span><span class="delimiter">"</span></span>)
<span class="line-numbers">255</span>    })
<span class="line-numbers">256</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">257</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">258</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">259</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">260</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">261</span>    )
<span class="line-numbers">262</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">263</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system client</span><span class="delimiter">"</span></span>,
<span class="line-numbers">264</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">This adds a system client.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">265</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>
<span class="line-numbers">266</span>    )
<span class="line-numbers">267</span>    <span class="comment">//tag::printClientPort[]</span>
<span class="line-numbers">268</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">269</span>        <span class="predefined-type">System</span>.out.println(CLIENT_PORT);
<span class="line-numbers">270</span>        <span class="keyword">return</span> success(<span class="string"><span class="delimiter">"</span><span class="content">Client Port: </span><span class="delimiter">"</span></span> + CLIENT_PORT);
<span class="line-numbers">271</span>    }
<span class="line-numbers">272</span>    <span class="comment">//end::printClientPort[]</span>
<span class="line-numbers">273</span>
<span class="line-numbers">274</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">275</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">276</span>    }
<span class="line-numbers">277</span>
<span class="line-numbers">278</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">279</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">280</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">281</span>                       .build();
<span class="line-numbers">282</span>    }
<span class="line-numbers">283</span>}
<span class="line-numbers">284</span><span class="comment">// end::SystemResource[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Transactional</code> annotation is used in the <code class="hotspot=postTransactional file=2">POST</code>, <code class="hotspot=putTransactional file=2">PUT</code>, and <code class="hotspot=deleteTransactional file=2">DELETE</code> endpoints of the <code>SystemResource</code> class to declaratively control the transaction boundaries on the <code class="hotspot=inventory file=2">inventory</code> CDI bean. This configuration ensures that the methods run within the boundaries of an active global transaction, and therefore you don’t need to explicitly begin, commit, or rollback transactions. At the end of the transactional method invocation, the transaction commits and the persistence context flushes any changes to the Event entity instances that it is managing to the database.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-jpa">Configuring JPA</h3>
<div class="paragraph">
<p>The <code class="hotspot file=0">persistence.xml</code> file is a configuration file that defines a persistence unit. The
persistence unit specifies configuration information for the entity manager.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the configuration file.</mark>
<code>src/main/resources/META-INF/persistence.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>persistence.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;persistence</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">"</span><span class="content">2.2</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 3</span>    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://xmlns.jcp.org/xml/ns/persistence</span><span class="delimiter">"</span></span> 
<span class="line-numbers"> 4</span>    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 5</span>    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://xmlns.jcp.org/xml/ns/persistence </span></span>
<span class="line-numbers"> 6</span><span class="string">                        <span class="content">http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 7</span>    <span class="comment">&lt;!-- tag::persistence-unit[] --&gt;</span>
<span class="line-numbers"> 8</span>    <span class="comment">&lt;!-- tag::transaction-type[] --&gt;</span>
<span class="line-numbers"> 9</span>    <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">jpa-unit</span><span class="delimiter">"</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">"</span><span class="content">JTA</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">10</span>    <span class="comment">&lt;!-- end::transaction-type[] --&gt;</span>
<span class="line-numbers">11</span>      <span class="comment">&lt;!-- tag::jta-data[] --&gt;</span>
<span class="line-numbers">12</span>      <span class="tag">&lt;jta-data-source&gt;</span>jdbc/postgresql<span class="tag">&lt;/jta-data-source&gt;</span>
<span class="line-numbers">13</span>      <span class="tag">&lt;class&gt;</span>io.openliberty.deepdive.rest.model.SystemData<span class="tag">&lt;/class&gt;</span>
<span class="line-numbers">14</span>      <span class="tag">&lt;exclude-unlisted-classes&gt;</span>false<span class="tag">&lt;/exclude-unlisted-classes&gt;</span>
<span class="line-numbers">15</span>      <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers">16</span>        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">jakarta.persistence.schema-generation.database.action</span><span class="delimiter">"</span></span>
<span class="line-numbers">17</span>                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">18</span>        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">jakarta.persistence.schema-generation.scripts.action</span><span class="delimiter">"</span></span>
<span class="line-numbers">19</span>                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">20</span>        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">jakarta.persistence.schema-generation.scripts.create-target</span><span class="delimiter">"</span></span>
<span class="line-numbers">21</span>                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">createDDL.ddl</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">22</span>      <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers">23</span>    <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="line-numbers">24</span>    <span class="comment">&lt;!-- end::persistence-unit[] --&gt;</span>
<span class="line-numbers">25</span><span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The persistence unit is defined by the <code class="hotspot=persistence-unit file=0">persistence-unit</code> XML element. The <code class="hotspot=transaction-type file=0">name</code> attribute is required. This attribute identifies the persistent unit when you use the <code>@PersistenceContext</code> annotation to inject the entity manager later in this exercise. The <code class="hotspot=transaction-type file=0">transaction-type="JTA"</code> attribute specifies to use Java Transaction API (JTA) transaction management. When you use a container-managed entity manager, you must use JTA transactions.</p>
</div>
<div class="paragraph">
<p>A JTA transaction type requires a JTA data source to be provided. The <code class="hotspot=jta-data file=0">jta-data-source</code> element specifies the Java Naming and Directory Interface (JNDI) name of the data source that is used.</p>
</div>
<div class="paragraph">
<p>Configure the <code>jdbc/postgresql</code> data source in the Liberty server configuration file.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>server.xml</code> configuration file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">11</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.context.root</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">12</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/hostname</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/portnum</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">16</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">17</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">20</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    <span class="comment">&lt;!-- Configures the application on a specified context root --&gt;</span>
<span class="line-numbers">23</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.context.root}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">24</span>                    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory.war</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span> 
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">27</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">28</span>    
<span class="line-numbers">29</span>    <span class="comment">&lt;!-- tag::postgresqlLibrary[] --&gt;</span>
<span class="line-numbers">30</span>    <span class="tag">&lt;library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">31</span>        <span class="tag">&lt;fileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">"</span><span class="content">${shared.resource.dir}/</span><span class="delimiter">"</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">"</span><span class="content">*.jar</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">32</span>    <span class="tag">&lt;/library&gt;</span>
<span class="line-numbers">33</span>    <span class="comment">&lt;!-- end::postgresqlLibrary[] --&gt;</span>
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>    <span class="comment">&lt;!-- Datasource Configuration --&gt;</span>
<span class="line-numbers">36</span>    <span class="comment">&lt;!-- tag::dataSource[] --&gt;</span>
<span class="line-numbers">37</span>    <span class="tag">&lt;dataSource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">DefaultDataSource</span><span class="delimiter">"</span></span> <span class="attribute-name">jndiName</span>=<span class="string"><span class="delimiter">"</span><span class="content">jdbc/postgresql</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">38</span>        <span class="tag">&lt;jdbcDriver</span> <span class="attribute-name">libraryRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">39</span>        <span class="tag">&lt;properties.postgresql</span> <span class="attribute-name">databaseName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">40</span>                               <span class="attribute-name">serverName</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>
<span class="line-numbers">41</span>                               <span class="attribute-name">portNumber</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span>
<span class="line-numbers">42</span>                               <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">43</span>                               <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">44</span>    <span class="tag">&lt;/dataSource&gt;</span>
<span class="line-numbers">45</span>    <span class="comment">&lt;!-- end::dataSource[] --&gt;</span>
<span class="line-numbers">46</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=postgresqlLibrary file=1">library</code> element tells the Liberty server where to find the PostgreSQL library. The <code class="hotspot=dataSource file=1">dataSource</code> element points to where the Java Database Connectivity (JDBC) driver connects, along with some database vendor-specific properties. For more information, see the <a href="https://www.openliberty.io/docs/latest/relational-database-connections-JDBC.html#_data_source_configuration" target="_blank" rel="noopener noreferrer">Data source configuration</a> and <a href="https://www.openliberty.io/docs/latest/reference/config/dataSource.html" target="_blank" rel="noopener noreferrer">dataSource element</a> documentation.</p>
</div>
<div class="paragraph">
<p>To use a PostgreSQL database, you need to download its library and store it to the Liberty shared resources directory. Configure the Liberty Maven plug-in in the <code>build.gradle</code> file.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Replace the <code>build.gradle</code> file.</mark>
<code>build.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>build.gradle</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle"><span class="line-numbers"> 1</span>plugins {
<span class="line-numbers"> 2</span>    id 'war'
<span class="line-numbers"> 3</span>    // tag::libertyGradlePlugin[]
<span class="line-numbers"> 4</span>    id 'io.openliberty.tools.gradle.Liberty' version '3.6.2'
<span class="line-numbers"> 5</span>    // end::libertyGradlePlugin[]
<span class="line-numbers"> 6</span>}
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>version '1.0-SNAPSHOT'
<span class="line-numbers"> 9</span>group 'io.openliberty.deepdive'
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>sourceCompatibility = 11
<span class="line-numbers">12</span>targetCompatibility = 11
<span class="line-numbers">13</span>tasks.withType(JavaCompile) {
<span class="line-numbers">14</span>    options.encoding = 'UTF-8'
<span class="line-numbers">15</span>}
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>repositories {
<span class="line-numbers">18</span>    mavenCentral()
<span class="line-numbers">19</span>}
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>// tag::configurations[]
<span class="line-numbers">22</span>configurations {
<span class="line-numbers">23</span>    jdbcLib
<span class="line-numbers">24</span>}
<span class="line-numbers">25</span>// end::configurations[]
<span class="line-numbers">26</span>
<span class="line-numbers">27</span>dependencies {
<span class="line-numbers">28</span>    // provided dependencies
<span class="line-numbers">29</span>    providedCompile 'jakarta.platform:jakarta.jakartaee-api:10.0.0'
<span class="line-numbers">30</span>    providedCompile 'org.eclipse.microprofile:microprofile:6.0'
<span class="line-numbers">31</span>    // tag::postgresql[]
<span class="line-numbers">32</span>    jdbcLib 'org.postgresql:postgresql:42.3.8'
<span class="line-numbers">33</span>    // end::postgresql[]
<span class="line-numbers">34</span>}
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>war {
<span class="line-numbers">37</span>    archiveVersion = ''
<span class="line-numbers">38</span>}
<span class="line-numbers">39</span>
<span class="line-numbers">40</span>ext  {
<span class="line-numbers">41</span>    // tag::httpPort[]
<span class="line-numbers">42</span>    liberty.server.var.'default.http.port' = '9080'
<span class="line-numbers">43</span>    // end::httpPort[]
<span class="line-numbers">44</span>    // tag::httpsPort[]
<span class="line-numbers">45</span>    liberty.server.var.'default.https.port' = '9443'
<span class="line-numbers">46</span>    // end::httpsPort[]
<span class="line-numbers">47</span>    // tag::contextRoot[]
<span class="line-numbers">48</span>    liberty.server.var.'default.context.root' = '/inventory'
<span class="line-numbers">49</span>    // end::contextRoot[]
<span class="line-numbers">50</span>    // tag::setResourcesDir[]
<span class="line-numbers">51</span>    sourceSets.main.output.resourcesDir = sourceSets.main.java.destinationDirectory
<span class="line-numbers">52</span>    // end::setResourcesDir[]
<span class="line-numbers">53</span>}
<span class="line-numbers">54</span>
<span class="line-numbers">55</span>// tag::copyJDBC[]
<span class="line-numbers">56</span>task copyJdbcLibs(type: Copy) {
<span class="line-numbers">57</span>    from configurations.jdbcLib
<span class="line-numbers">58</span>    into "${buildDir}/wlp/usr/shared/resources"
<span class="line-numbers">59</span>}
<span class="line-numbers">60</span>
<span class="line-numbers">61</span>deploy.dependsOn 'copyJdbcLibs'
<span class="line-numbers">62</span>// end::copyJDBC[]
<span class="line-numbers">63</span>
<span class="line-numbers">64</span>clean.dependsOn 'libertyStop'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=postgresql file=2">postgresql</code> dependency under the <code class="hotspot=configurations file=2">jdbcLib</code> configuration ensures that Gradle downloads the PostgreSQL library to local project. The <code class="hotspot=copyJDBC file=2">copyJdbcLibs</code> task copies the library to the Liberty shared resources directory and ensures that the driver is available for the Liberty server’s use each time the project is built. To make the <code class="hotspot file=0">persistence.xml</code> file available in the Liberty loose application configuration, set the value for the Gradle <code class="hotspot=setResourcesDir file=2">resourcesDir</code> output directory location to be the Gradle <code class="hotspot=setResourcesDir file=2">destinationDirectory</code> directory.  The Gradle project generates the resources artifacts into the <code>resourcesDir</code> directory and the Java class files into the <code>destinationDirectory</code> directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-postgresql-database">Starting PostgreSQL database</h3>
<div class="paragraph">
<p>Use Docker to run an instance of the PostgreSQL database for a fast installation and setup.</p>
</div>
<div class="paragraph">
<p>A container file is provided for you. First, navigate to the <code>finish/postgres</code> directory. Then, run the following commands to use the <code>Dockerfile</code> to build the image, run the image in a Docker container, and map <code>5432</code> port from the container to your machine:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd ../../finish/postgres
podman build -t postgres-sample .
podman run --name postgres-container -p 5432:5432 -d postgres-sample</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-application-2">Running the application</h3>
<div class="paragraph">
<p>In your dev mode console for the <code>inventory</code> microservice, type <code>r</code> and press <code>enter/return</code> key to restart the server.</p>
</div>
<div class="paragraph">
<p>After you see the following message, your application server in dev mode is ready again:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> URL. This URL displays the available REST endpoints.</p>
</div>
<div class="paragraph">
<p>First, make a POST request to the <code>/api/systems/</code> endpoint. To make this request, expand the first POST endpoint on the UI, click the <code>Try it out</code> button, provide values to the <code>heapSize</code>, <code>hostname</code>, <code>javaVersion</code>, and <code>osName</code> parameters, and then click the <code>Execute</code> button. The POST request adds a system with the specified values to the database.</p>
</div>
<div class="paragraph">
<p>Next, make a GET request to the <code>/api/systems</code> endpoint. To make this request, expand the GET endpoint on the UI, click the <code>Try it out</code> button, and then click the <code>Execute</code> button. The GET request returns all systems from the database.</p>
</div>
<div class="paragraph">
<p>Next, make a PUT request to the <code>/api/systems/{hostname}</code> endpoint. To make this request, expand the PUT endpoint on the UI, click the <code>Try it out</code> button. Then, provide the same value to the <code>hostname</code> parameter as in the previous step, provide different values to the <code>heapSize</code>, <code>javaVersion</code>, and <code>osName</code> parameters, and click the <code>Execute</code> button. The PUT request updates the system with the specified values.</p>
</div>
<div class="paragraph">
<p>To see the updated system, make a GET request to the <code>/api/systems/{hostname}</code> endpoint. To make this request, expand the GET endpoint on the UI, click the <code>Try it out</code> button, provide the same value to the <code>hostname</code> parameter as the previous step, and then click the <code>Execute</code> button. The GET request returns the system from the database.</p>
</div>
<div class="paragraph">
<p>Next, make a DELETE request to the <code>/api/systems/{hostname}</code> endpoint. To make this request, expand the DELETE endpoint on the UI, click the <code>Try it out</code> button, and then click <code>Execute</code>. The DELETE request removes the system from the database. Run the GET request again to see that the system no longer exists in the database.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="securing-restful-apis">Securing RESTful APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now you can secure your RESTful APIs. Navigate to your application directory.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start/inventory</code></pre>
</div>
</div>
<div class="paragraph">
<p>Begin by adding some users and user groups to your <code>server.xml</code> Liberty configuration file.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>server.xml</code> file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">11</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.context.root</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">12</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/hostname</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/portnum</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">16</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">17</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">20</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    <span class="comment">&lt;!-- tag::basicregistry[] --&gt;</span>
<span class="line-numbers">23</span>    <span class="tag">&lt;basicRegistry</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">basic</span><span class="delimiter">"</span></span> <span class="attribute-name">realm</span>=<span class="string"><span class="delimiter">"</span><span class="content">WebRealm</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">24</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PTA9Lyg7</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">25</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PjM2PDovKDs=</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">26</span>        <span class="comment">&lt;!-- tag::myadmins[] --&gt;</span>
<span class="line-numbers">27</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">28</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">29</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">30</span>        <span class="comment">&lt;!-- end::myadmins[] --&gt;</span>
<span class="line-numbers">31</span>        <span class="comment">&lt;!-- tag::myusers[] --&gt;</span>
<span class="line-numbers">32</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">33</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">34</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">35</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">36</span>        <span class="comment">&lt;!-- end::myusers[] --&gt;</span>
<span class="line-numbers">37</span>    <span class="tag">&lt;/basicRegistry&gt;</span>
<span class="line-numbers">38</span>    <span class="comment">&lt;!-- end::basicregistry[] --&gt;</span>
<span class="line-numbers">39</span>
<span class="line-numbers">40</span>    <span class="comment">&lt;!-- Configures the application on a specified context root --&gt;</span>
<span class="line-numbers">41</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.context.root}</span><span class="delimiter">"</span></span>
<span class="line-numbers">42</span>                    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory.war</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">43</span>        <span class="tag">&lt;application-bnd&gt;</span>
<span class="line-numbers">44</span>            <span class="comment">&lt;!-- tag::securityrole[] --&gt;</span>
<span class="line-numbers">45</span>            <span class="comment">&lt;!-- tag::adminrole[] --&gt;</span>
<span class="line-numbers">46</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">47</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">48</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">49</span>            <span class="comment">&lt;!-- end::adminrole[] --&gt;</span>
<span class="line-numbers">50</span>            <span class="comment">&lt;!-- tag::userrole[] --&gt;</span>
<span class="line-numbers">51</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">52</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">53</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">54</span>            <span class="comment">&lt;!-- end::userrole[] --&gt;</span>
<span class="line-numbers">55</span>            <span class="comment">&lt;!-- end::securityrole[] --&gt;</span>
<span class="line-numbers">56</span>        <span class="tag">&lt;/application-bnd&gt;</span>
<span class="line-numbers">57</span>     <span class="tag">&lt;/webApplication&gt;</span>
<span class="line-numbers">58</span>
<span class="line-numbers">59</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">60</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">61</span>
<span class="line-numbers">62</span>    <span class="tag">&lt;library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">63</span>        <span class="tag">&lt;fileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">"</span><span class="content">${shared.resource.dir}/</span><span class="delimiter">"</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">"</span><span class="content">*.jar</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">64</span>    <span class="tag">&lt;/library&gt;</span>
<span class="line-numbers">65</span>
<span class="line-numbers">66</span>    <span class="tag">&lt;dataSource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">DefaultDataSource</span><span class="delimiter">"</span></span> <span class="attribute-name">jndiName</span>=<span class="string"><span class="delimiter">"</span><span class="content">jdbc/postgresql</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">67</span>        <span class="tag">&lt;jdbcDriver</span> <span class="attribute-name">libraryRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">68</span>        <span class="tag">&lt;properties.postgresql</span> <span class="attribute-name">databaseName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">69</span>                               <span class="attribute-name">serverName</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>
<span class="line-numbers">70</span>                               <span class="attribute-name">portNumber</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span>
<span class="line-numbers">71</span>                               <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">72</span>                               <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">73</span>    <span class="tag">&lt;/dataSource&gt;</span>
<span class="line-numbers">74</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=basicregistry file=0">basicRegistry</code> element contains a list of all users for the application and their passwords, as well as all of the user groups. Note that this <code class="hotspot=basicregistry file=0">basicRegistry</code> element is a very simple case for learning purposes. For more information about the different user registries, see the <a href="https://openliberty.io/docs/latest/user-registries-application-security.html" target="_blank" rel="noopener">User registries documentation</a>. The <code class="hotspot=myadmins file=0">admin</code> group tells the application which of the users are in the administrator group. The <code class="hotspot=myusers file=0">user</code> group tells the application that users are in the user group.</p>
</div>
<div class="paragraph">
<p>The <code>security-role</code> maps the <code class="hotspot=adminrole file=0">admin</code> role to the <code class="hotspot=myadmins file=0">admin</code> group, meaning that all users in the <code>admin</code> group have the administrator role. Similarly, the <code class="hotspot=userrole file=0">user</code> role is mapped to the <code class="hotspot=myusers file=0">user</code> group, meaning all users in the <code>user</code> group have the user role.</p>
</div>
<div class="paragraph">
<p>Your application has the following users and passwords:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.0459%;">
<col style="width: 45.977%;">
<col style="width: 45.9771%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Username</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Role</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bob</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bobpwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">admin, user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alice</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">alicepwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">user</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now you can secure the <code>inventory</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>SystemResource</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span>
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.Operation</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.ParameterIn</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameters</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponseSchema</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponses</span>;
<span class="line-numbers"> 25</span>
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">jakarta.transaction.Transactional</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 43</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 46</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 47</span><span class="comment">// tag::SystemResource[]</span>
<span class="line-numbers"> 48</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 49</span>
<span class="line-numbers"> 50</span>    <span class="comment">// tag::inventory[]</span>
<span class="line-numbers"> 51</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 52</span>    Inventory inventory;
<span class="line-numbers"> 53</span>    <span class="comment">// end::inventory[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>    <span class="comment">// tag::inject[]</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 57</span>    <span class="comment">// end::inject[]</span>
<span class="line-numbers"> 58</span>    <span class="comment">// tag::configProperty[]</span>
<span class="line-numbers"> 59</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">client.https.port</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 60</span>    <span class="comment">// end::configProperty[]</span>
<span class="line-numbers"> 61</span>    <span class="predefined-type">String</span> CLIENT_PORT;
<span class="line-numbers"> 62</span>
<span class="line-numbers"> 63</span>
<span class="line-numbers"> 64</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 65</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 66</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 67</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 68</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">A list of system data stored within the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 69</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 70</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 71</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">List contents.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 72</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Returns the currently stored system data in the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 73</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">listContents</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 74</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 75</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 76</span>    }
<span class="line-numbers"> 77</span>
<span class="line-numbers"> 78</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 79</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 80</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 81</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 82</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">System data of a particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 83</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 84</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 85</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Get System</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 86</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Retrieves and returns the system data from the system </span><span class="delimiter">"</span></span>
<span class="line-numbers"> 87</span>                      + <span class="string"><span class="delimiter">"</span><span class="content">service running on the particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 88</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">getSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 89</span>    )
<span class="line-numbers"> 90</span>    <span class="directive">public</span> SystemData getSystem(
<span class="line-numbers"> 91</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers"> 92</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers"> 93</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 94</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 95</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers"> 96</span>        )
<span class="line-numbers"> 97</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 98</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers"> 99</span>    }
<span class="line-numbers">100</span>
<span class="line-numbers">101</span>    <span class="comment">// tag::postTransactional[]</span>
<span class="line-numbers">102</span>    <span class="annotation">@POST</span>
<span class="line-numbers">103</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">104</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">105</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">106</span>    <span class="comment">// end::postTransactional[]</span>
<span class="line-numbers">107</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">108</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">109</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system to inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">110</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">111</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system to inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">112</span>    })
<span class="line-numbers">113</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">114</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">115</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">116</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">117</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">118</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">119</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">120</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">121</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">122</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">123</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">124</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">125</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">126</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">127</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">128</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">129</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">130</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">131</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">132</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">133</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">134</span>    })
<span class="line-numbers">135</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">136</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">137</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Add a system and its data to the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">138</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">139</span>    )
<span class="line-numbers">140</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers">141</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">142</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">143</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">144</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">145</span>
<span class="line-numbers">146</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">147</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">148</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">149</span>        }
<span class="line-numbers">150</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers">151</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">152</span>    }
<span class="line-numbers">153</span>
<span class="line-numbers">154</span>    <span class="comment">// tag::putTransactional[]</span>
<span class="line-numbers">155</span>    <span class="comment">// tag::put[]</span>
<span class="line-numbers">156</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">157</span>    <span class="comment">// end::put[]</span>
<span class="line-numbers">158</span>    <span class="comment">// tag::putEndpoint[]</span>
<span class="line-numbers">159</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">160</span>    <span class="comment">// end::putEndpoint[]</span>
<span class="line-numbers">161</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">162</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">163</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">164</span>    <span class="comment">// end::putTransactional[]</span>
<span class="line-numbers">165</span>    <span class="comment">// tag::putRolesAllowed[]</span>
<span class="line-numbers">166</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> })
<span class="line-numbers">167</span>    <span class="comment">// end::putRolesAllowed[]</span>
<span class="line-numbers">168</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">169</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">170</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully updated system</span><span class="delimiter">"</span></span>),
<span class="line-numbers">171</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">172</span>           description =
<span class="line-numbers">173</span>           <span class="string"><span class="delimiter">"</span><span class="content">Unable to update because the system does not exist in the inventory.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">174</span>    })
<span class="line-numbers">175</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">176</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">177</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">178</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">179</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">180</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">181</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">182</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">183</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">184</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">185</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">186</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">187</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">188</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">189</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">190</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">191</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">192</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">193</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">194</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">195</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">196</span>    })
<span class="line-numbers">197</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">198</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Update system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">199</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Update a system and its data on the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">200</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">201</span>    )
<span class="line-numbers">202</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers">203</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">204</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">205</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">206</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">207</span>
<span class="line-numbers">208</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">209</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers">210</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">211</span>        }
<span class="line-numbers">212</span>        s.setOsName(osName);
<span class="line-numbers">213</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers">214</span>        s.setHeapSize(heapSize);
<span class="line-numbers">215</span>        inventory.update(s);
<span class="line-numbers">216</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">217</span>    }
<span class="line-numbers">218</span>
<span class="line-numbers">219</span>    <span class="comment">// tag::deleteTransactional[]</span>
<span class="line-numbers">220</span>    <span class="comment">// tag::delete[]</span>
<span class="line-numbers">221</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">222</span>    <span class="comment">// end::delete[]</span>
<span class="line-numbers">223</span>    <span class="comment">// tag::deleteEndpoint[]</span>
<span class="line-numbers">224</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">225</span>    <span class="comment">// end::deleteEndpoint[]</span>
<span class="line-numbers">226</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">227</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">228</span>    <span class="comment">// end::deleteTransactional[]</span>
<span class="line-numbers">229</span>    <span class="comment">// tag::deleteRolesAllowed[]</span>
<span class="line-numbers">230</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">231</span>    <span class="comment">// end::deleteRolesAllowed[]</span>
<span class="line-numbers">232</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">233</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">234</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully deleted the system from inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">235</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">236</span>            description =
<span class="line-numbers">237</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to delete because the system does not exist in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">238</span>    })
<span class="line-numbers">239</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">240</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">241</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">242</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">243</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">244</span>    )
<span class="line-numbers">245</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">246</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Remove system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">247</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Removes a system from the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">248</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">249</span>    )
<span class="line-numbers">250</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">251</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">252</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">253</span>            inventory.removeSystem(s);
<span class="line-numbers">254</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">255</span>        } <span class="keyword">else</span> {
<span class="line-numbers">256</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">257</span>        }
<span class="line-numbers">258</span>    }
<span class="line-numbers">259</span>
<span class="line-numbers">260</span>    <span class="comment">// tag::postTransactional[]</span>
<span class="line-numbers">261</span>    <span class="comment">// tag::addSystemClient[]</span>
<span class="line-numbers">262</span>    <span class="annotation">@POST</span>
<span class="line-numbers">263</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">264</span>    <span class="comment">// end::addSystemClient[]</span>
<span class="line-numbers">265</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">266</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">267</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">268</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">269</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">270</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">271</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system client</span><span class="delimiter">"</span></span>),
<span class="line-numbers">272</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">273</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system client</span><span class="delimiter">"</span></span>)
<span class="line-numbers">274</span>    })
<span class="line-numbers">275</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">276</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">277</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">278</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">279</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">280</span>    )
<span class="line-numbers">281</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">282</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system client</span><span class="delimiter">"</span></span>,
<span class="line-numbers">283</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">This adds a system client.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">284</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>
<span class="line-numbers">285</span>    )
<span class="line-numbers">286</span>    <span class="comment">//tag::printClientPort[]</span>
<span class="line-numbers">287</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">288</span>        <span class="predefined-type">System</span>.out.println(CLIENT_PORT);
<span class="line-numbers">289</span>        <span class="keyword">return</span> success(<span class="string"><span class="delimiter">"</span><span class="content">Client Port: </span><span class="delimiter">"</span></span> + CLIENT_PORT);
<span class="line-numbers">290</span>    }
<span class="line-numbers">291</span>    <span class="comment">//end::printClientPort[]</span>
<span class="line-numbers">292</span>
<span class="line-numbers">293</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">294</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">295</span>    }
<span class="line-numbers">296</span>
<span class="line-numbers">297</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">298</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">299</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">300</span>                       .build();
<span class="line-numbers">301</span>    }
<span class="line-numbers">302</span>}
<span class="line-numbers">303</span><span class="comment">// end::SystemResource[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class now has role-based access control. The role names that are used in the <code class="hotspot=putRolesAllowed hotspot=deleteRolesAllowed file=1">@RolesAllowed</code> annotations are mapped to group names in the groups claim of the JSON Web Token (JWT). This mapping results in an authorization decision wherever the security constraint is applied.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=putEndpoint file=1">/{hostname}</code> endpoint that is annotated with the <code class="hotspot=put file=1">@PUT</code> annotation updates a system in the inventory. This PUT endpoint is annotated with the <code class="hotspot=putRolesAllowed file=1">@RolesAllowed({ "admin", "user" })</code> annotation. Only authenticated users with the role of <code>admin</code> or <code>user</code> can access this endpoint.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=deleteEndpoint file=1">/{hostname}</code> endpoint that is annotated with the <code class="hotspot=delete file=1">@DELETE</code> annotation removes a system from the inventory. This DELETE endpoint is annotated with the <code class="hotspot=deleteRolesAllowed file=1">@RolesAllowed({ "admin" })</code> annotation. Only authenticated users with the role of <code>admin</code> can access this endpoint.</p>
</div>
<div class="paragraph">
<p>You can manually check that the <code>inventory</code> microservice is secured by making requests to the PUT and DELETE endpoints.</p>
</div>
<div class="paragraph">
<p>Before making requests, you must add a system to the inventory. Try adding a system by using the POST endpoint <code>/systems</code> by running the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl -X POST "http://localhost:9080/inventory/api/systems?hostname=localhost&amp;osName=mac&amp;javaVersion=11&amp;heapSize=1"</pre>
</div>
</div>
<div class="paragraph">
<p>You can expect the following response:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{ "ok" : "localhost was added." }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command calls the <code>/systems</code> endpoint and adds a system <code>localhost</code> to the inventory. You can validate that the command worked by calling the <code>/systems</code> endpoint with a <code>GET</code> request to retrieve all the systems in the inventory, with the following curl command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl -s "http://localhost:9080/inventory/api/systems"</pre>
</div>
</div>
<div class="paragraph">
<p>You can now expect the following response:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>[{"heapSize":1,"hostname":"localhost","javaVersion":"11","osName":"mac","id":23}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now try calling your secure PUT endpoint to update the system that you just added by the following curl command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl -k --user alice:alicepwd -X PUT "http://localhost:9080/inventory/api/systems/localhost?heapSize=2097152&amp;javaVersion=11&amp;osName=linux"</pre>
</div>
</div>
<div class="paragraph">
<p>As this endpoint is accessible to the groups <code>user</code> and <code>admin</code>, you must log in with <code>user</code> credentials to update the system.</p>
</div>
<div class="paragraph">
<p>You should see the following response:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{ "ok" : "localhost was updated." }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This response means that you logged in successfully as an authenticated <code>user</code>, and that the endpoint works as expected.</p>
</div>
<div class="paragraph">
<p>Now try calling the DELETE endpoint. As this endpoint is only accessible to <code>admin</code> users, you can expect this command to fail if you attempt to access it with a user in the <code>user</code> group.</p>
</div>
<div class="paragraph">
<p>You can check that your application is secured against these requests with the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl -k --user alice:alicepwd -X DELETE "https://localhost:9443/inventory/api/systems/localhost"</pre>
</div>
</div>
<div class="paragraph">
<p>As <code>alice</code> is part of the <code>user</code> group, this request cannot work. In your dev mode console, you can expect the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>jakarta.ws.rs.ForbiddenException: Unauthorized</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now attempt to call this endpoint with an authenticated <code>admin</code> user that can work correctly. Run the following curl command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl -k --user bob:bobpwd -X DELETE "https://localhost:9443/inventory/api/systems/localhost"</pre>
</div>
</div>
<div class="paragraph">
<p>You can expect to see the following response:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{ "ok" : "localhost was removed." }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This response means that your endpoint is secure. Validate that it works correctly by calling the <code>/systems</code> endpoint with the following curl command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl "http://localhost:9080/inventory/api/systems"</pre>
</div>
</div>
<div class="paragraph">
<p>You can expect to see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This response shows that the endpoints work as expected and that the system you added was successfully deleted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="consuming-the-secured-restful-apis-by-jwt">Consuming the secured RESTful APIs by JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can now implement JSON Web Tokens (JWT) and configure them as Single Sign On (SSO) cookies to use the RESTful APIs. The JWT that is generated by Liberty is used to communicate securely between the <code>inventory</code> and <code>system</code> microservices. You can implement the <code>/client/{hostname}</code> POST endpoint to collect the properties from the <code>system</code> microservices and create a system in the inventory.</p>
</div>
<div class="paragraph">
<p>The <code>system</code> microservice is provided for you.</p>
</div>
<div class="sect2">
<h3 id="writing-the-restful-client-interface">Writing the RESTful client interface</h3>
<div class="paragraph">
<p>Create the <code>client</code> subdirectory. Then, create a RESTful client interface for the <code>system</code> microservice in the <code>inventory</code> microservice.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src\main\java\io\openliberty\deepdive\rest\client</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src/main/java/io/openliberty/deepdive/rest/client</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemClient</code> interface.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/client/SystemClient.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemClient.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.client</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.HeaderParam</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/api</span><span class="delimiter">"</span></span>)
<span class="line-numbers">22</span><span class="directive">public</span> <span class="type">interface</span> <span class="class">SystemClient</span> <span class="directive">extends</span> AutoCloseable {
<span class="line-numbers">23</span>
<span class="line-numbers">24</span>    <span class="annotation">@GET</span>
<span class="line-numbers">25</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/property/{property}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">26</span>    <span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers">27</span>    <span class="predefined-type">String</span> getProperty(<span class="annotation">@HeaderParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">Authorization</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> authHeader,
<span class="line-numbers">28</span>                       <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> property);
<span class="line-numbers">29</span>
<span class="line-numbers">30</span>    <span class="annotation">@GET</span>
<span class="line-numbers">31</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/heapsize</span><span class="delimiter">"</span></span>)
<span class="line-numbers">32</span>    <span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers">33</span>    <span class="predefined-type">Long</span> getHeapSize(<span class="annotation">@HeaderParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">Authorization</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> authHeader);
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface declares methods for accessing each of the endpoints that are set up for you in the <code>system</code> service. The MicroProfile Rest Client feature automatically builds and generates a client implementation based on what is defined in the <code class="hotspot file=0">SystemClient</code> interface. You don’t need to set up the client and connect with the remote service.</p>
</div>
<div class="paragraph">
<p>Now create the required exception classes that are used by the <code>SystemClient</code> instance.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>UnknownUriException</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/client/UnknownUriException.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>UnknownUriException.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.client</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="directive">public</span> <span class="type">class</span> <span class="class">UnknownUriException</span> <span class="directive">extends</span> <span class="exception">Exception</span> {
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span>    <span class="directive">public</span> UnknownUriException() {
<span class="line-numbers">19</span>        <span class="local-variable">super</span>();
<span class="line-numbers">20</span>    }
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    <span class="directive">public</span> UnknownUriException(<span class="predefined-type">String</span> message) {
<span class="line-numbers">23</span>        <span class="local-variable">super</span>(message);
<span class="line-numbers">24</span>    }
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class is an exception that is thrown when an unknown URI is passed to the <code>SystemClient</code>.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Create the <code>UnknownUriExceptionMapper</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/client/UnknownUriExceptionMapper.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>UnknownUriExceptionMapper.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.client</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers">15</span>
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.ext.ResponseExceptionMapper</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MultivaluedMap</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="directive">public</span> <span class="type">class</span> <span class="class">UnknownUriExceptionMapper</span>
<span class="line-numbers">22</span>    <span class="directive">implements</span> ResponseExceptionMapper&lt;UnknownUriException&gt; {
<span class="line-numbers">23</span>    <span class="predefined-type">Logger</span> LOG = <span class="predefined-type">Logger</span>.getLogger(UnknownUriExceptionMapper.class.getName());
<span class="line-numbers">24</span>
<span class="line-numbers">25</span>    <span class="annotation">@Override</span>
<span class="line-numbers">26</span>    <span class="directive">public</span> <span class="type">boolean</span> handles(<span class="type">int</span> status, MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; headers) {
<span class="line-numbers">27</span>        LOG.info(<span class="string"><span class="delimiter">"</span><span class="content">status = </span><span class="delimiter">"</span></span> + status);
<span class="line-numbers">28</span>        <span class="keyword">return</span> status == <span class="integer">404</span>;
<span class="line-numbers">29</span>    }
<span class="line-numbers">30</span>
<span class="line-numbers">31</span>    <span class="annotation">@Override</span>
<span class="line-numbers">32</span>    <span class="directive">public</span> UnknownUriException toThrowable(Response response) {
<span class="line-numbers">33</span>        <span class="keyword">return</span> <span class="keyword">new</span> UnknownUriException();
<span class="line-numbers">34</span>    }
<span class="line-numbers">35</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class links the <code>UnknownUriException</code> class with the corresponding response code through a <code>ResponseExceptionMapper</code> mapper class.</p>
</div>
</div>
<div class="sect2">
<h3 id="implementing-the-clienthostname-endpoint">Implementing the <code>/client/{hostname}</code> endpoint</h3>
<div class="paragraph">
<p>Now implement the <code>/client/{hostname}</code> POST endpoint of the <code>SystemResource</code> class to consume the secured <code>system</code> microservice.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemResource</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.net.URI</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 16</span>
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.Operation</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.ParameterIn</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameters</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponseSchema</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponses</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.RestClientBuilder</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.jwt.JsonWebToken</span>;
<span class="line-numbers"> 29</span>
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.client.SystemClient</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.client.UnknownUriExceptionMapper</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.transaction.Transactional</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 43</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 44</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 45</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 46</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 47</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 50</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 51</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 52</span>
<span class="line-numbers"> 53</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 54</span>    Inventory inventory;
<span class="line-numbers"> 55</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 57</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">client.https.port</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 58</span>    <span class="predefined-type">String</span> CLIENT_PORT;
<span class="line-numbers"> 59</span>
<span class="line-numbers"> 60</span>    <span class="comment">// tag::jwt[]</span>
<span class="line-numbers"> 61</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 62</span>    JsonWebToken jwt;
<span class="line-numbers"> 63</span>    <span class="comment">// end::jwt[]</span>
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 67</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 68</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 69</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">A list of system data stored within the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 70</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 71</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 72</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">List contents.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 73</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Returns the currently stored system data in the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 74</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">listContents</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 75</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 76</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 77</span>    }
<span class="line-numbers"> 78</span>
<span class="line-numbers"> 79</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 80</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 81</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 82</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 83</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">System data of a particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 84</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 85</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 86</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Get System</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 87</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Retrieves and returns the system data from the system </span><span class="delimiter">"</span></span>
<span class="line-numbers"> 88</span>                      + <span class="string"><span class="delimiter">"</span><span class="content">service running on the particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 89</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">getSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 90</span>    )
<span class="line-numbers"> 91</span>    <span class="directive">public</span> SystemData getSystem(
<span class="line-numbers"> 92</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers"> 93</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers"> 94</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 95</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 96</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers"> 97</span>        )
<span class="line-numbers"> 98</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 99</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers">100</span>    }
<span class="line-numbers">101</span>
<span class="line-numbers">102</span>    <span class="annotation">@POST</span>
<span class="line-numbers">103</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">104</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">105</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">106</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">107</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">108</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system to inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">109</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">110</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system to inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">111</span>    })
<span class="line-numbers">112</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">113</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">114</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">115</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">116</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">117</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">118</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">119</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">120</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">121</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">122</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">123</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">124</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">125</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">126</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">127</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">128</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">129</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">130</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">131</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">132</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">133</span>    })
<span class="line-numbers">134</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">135</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">136</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Add a system and its data to the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">137</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">138</span>    )
<span class="line-numbers">139</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers">140</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">141</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">142</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">143</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">144</span>
<span class="line-numbers">145</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">146</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">147</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">148</span>        }
<span class="line-numbers">149</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers">150</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">151</span>    }
<span class="line-numbers">152</span>
<span class="line-numbers">153</span>    <span class="comment">// tag::put[]</span>
<span class="line-numbers">154</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">155</span>    <span class="comment">// end::put[]</span>
<span class="line-numbers">156</span>    <span class="comment">// tag::putEndpoint[]</span>
<span class="line-numbers">157</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">158</span>    <span class="comment">// end::putEndpoint[]</span>
<span class="line-numbers">159</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">160</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">161</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">162</span>    <span class="comment">// tag::putRolesAllowed[]</span>
<span class="line-numbers">163</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> })
<span class="line-numbers">164</span>    <span class="comment">// end::putRolesAllowed[]</span>
<span class="line-numbers">165</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">166</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">167</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully updated system</span><span class="delimiter">"</span></span>),
<span class="line-numbers">168</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">169</span>           description =
<span class="line-numbers">170</span>               <span class="string"><span class="delimiter">"</span><span class="content">Unable to update because the system does not exist in the inventory.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">171</span>    })
<span class="line-numbers">172</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">173</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">174</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">175</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">176</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">177</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">178</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">179</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">180</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">181</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">182</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">183</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">184</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">185</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">186</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">187</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">188</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">189</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">190</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">191</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">192</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">193</span>    })
<span class="line-numbers">194</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">195</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Update system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">196</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Update a system and its data on the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">197</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">198</span>    )
<span class="line-numbers">199</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers">200</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">201</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">202</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">203</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">204</span>
<span class="line-numbers">205</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">206</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers">207</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">208</span>        }
<span class="line-numbers">209</span>        s.setOsName(osName);
<span class="line-numbers">210</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers">211</span>        s.setHeapSize(heapSize);
<span class="line-numbers">212</span>        inventory.update(s);
<span class="line-numbers">213</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">214</span>    }
<span class="line-numbers">215</span>
<span class="line-numbers">216</span>    <span class="comment">// tag::delete[]</span>
<span class="line-numbers">217</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">218</span>    <span class="comment">// end::delete[]</span>
<span class="line-numbers">219</span>    <span class="comment">// tag::deleteEndpoint[]</span>
<span class="line-numbers">220</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">221</span>    <span class="comment">// end::deleteEndpoint[]</span>
<span class="line-numbers">222</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">223</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">224</span>    <span class="comment">// tag::deleteRolesAllowed[]</span>
<span class="line-numbers">225</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">226</span>    <span class="comment">// end::deleteRolesAllowed[]</span>
<span class="line-numbers">227</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">228</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">229</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully deleted the system from inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">230</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">231</span>            description =
<span class="line-numbers">232</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to delete because the system does not exist in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">233</span>    })
<span class="line-numbers">234</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">235</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">236</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">237</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">238</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">239</span>    )
<span class="line-numbers">240</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">241</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Remove system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">242</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Removes a system from the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">243</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">244</span>    )
<span class="line-numbers">245</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">246</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">247</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">248</span>            inventory.removeSystem(s);
<span class="line-numbers">249</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">250</span>        } <span class="keyword">else</span> {
<span class="line-numbers">251</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">252</span>        }
<span class="line-numbers">253</span>    }
<span class="line-numbers">254</span>
<span class="line-numbers">255</span>    <span class="comment">// tag::addSystemClient[]</span>
<span class="line-numbers">256</span>    <span class="annotation">@POST</span>
<span class="line-numbers">257</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">258</span>    <span class="comment">// end::addSystemClient[]</span>
<span class="line-numbers">259</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">260</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">261</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">262</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">263</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">264</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">265</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system client</span><span class="delimiter">"</span></span>),
<span class="line-numbers">266</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">267</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system client</span><span class="delimiter">"</span></span>)
<span class="line-numbers">268</span>    })
<span class="line-numbers">269</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">270</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">271</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">272</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">273</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">274</span>    )
<span class="line-numbers">275</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">276</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system client</span><span class="delimiter">"</span></span>,
<span class="line-numbers">277</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">This adds a system client.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">278</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>
<span class="line-numbers">279</span>    )
<span class="line-numbers">280</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">281</span>
<span class="line-numbers">282</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">283</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">284</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">285</span>        }
<span class="line-numbers">286</span>
<span class="line-numbers">287</span>        <span class="comment">// tag::getCustomRestClient[]</span>
<span class="line-numbers">288</span>        SystemClient customRestClient = <span class="predefined-constant">null</span>;
<span class="line-numbers">289</span>        <span class="keyword">try</span> {
<span class="line-numbers">290</span>            customRestClient = getSystemClient(hostname);
<span class="line-numbers">291</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers">292</span>            <span class="keyword">return</span> fail(<span class="string"><span class="delimiter">"</span><span class="content">Failed to create the client </span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content">.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">293</span>        }
<span class="line-numbers">294</span>        <span class="comment">// end::getCustomRestClient[]</span>
<span class="line-numbers">295</span>
<span class="line-numbers">296</span>        <span class="comment">// tag::authHeader[]</span>
<span class="line-numbers">297</span>        <span class="predefined-type">String</span> authHeader = <span class="string"><span class="delimiter">"</span><span class="content">Bearer </span><span class="delimiter">"</span></span> + jwt.getRawToken();
<span class="line-numbers">298</span>        <span class="comment">// end::authHeader[]</span>
<span class="line-numbers">299</span>        <span class="keyword">try</span> {
<span class="line-numbers">300</span>            <span class="comment">// tag::customRestClient[]</span>
<span class="line-numbers">301</span>            <span class="predefined-type">String</span> osName = customRestClient.getProperty(authHeader, <span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">302</span>            <span class="predefined-type">String</span> javaVer = customRestClient.getProperty(authHeader, <span class="string"><span class="delimiter">"</span><span class="content">java.version</span><span class="delimiter">"</span></span>);
<span class="line-numbers">303</span>            <span class="predefined-type">Long</span> heapSize = customRestClient.getHeapSize(authHeader);
<span class="line-numbers">304</span>            <span class="comment">// end::customRestClient[]</span>
<span class="line-numbers">305</span>            <span class="comment">// tag::addSystem[]</span>
<span class="line-numbers">306</span>            inventory.add(hostname, osName, javaVer, heapSize);
<span class="line-numbers">307</span>            <span class="comment">// end::addSystem[]</span>
<span class="line-numbers">308</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers">309</span>            <span class="keyword">return</span> fail(<span class="string"><span class="delimiter">"</span><span class="content">Failed to reach the client </span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content">.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">310</span>        }
<span class="line-numbers">311</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">312</span>    }
<span class="line-numbers">313</span>
<span class="line-numbers">314</span>    <span class="comment">// tag::getSystemClient[]</span>
<span class="line-numbers">315</span>    <span class="directive">private</span> SystemClient getSystemClient(<span class="predefined-type">String</span> hostname) <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers">316</span>        <span class="predefined-type">String</span> customURIString = <span class="string"><span class="delimiter">"</span><span class="content">https://</span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + CLIENT_PORT + <span class="string"><span class="delimiter">"</span><span class="content">/system</span><span class="delimiter">"</span></span>;
<span class="line-numbers">317</span>        <span class="predefined-type">URI</span> customURI = <span class="predefined-type">URI</span>.create(customURIString);
<span class="line-numbers">318</span>        <span class="keyword">return</span> RestClientBuilder.newBuilder()
<span class="line-numbers">319</span>                                .baseUri(customURI)
<span class="line-numbers">320</span>                                .register(UnknownUriExceptionMapper.class)
<span class="line-numbers">321</span>                                .build(SystemClient.class);
<span class="line-numbers">322</span>    }
<span class="line-numbers">323</span>    <span class="comment">// end::getSystemClient[]</span>
<span class="line-numbers">324</span>
<span class="line-numbers">325</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">326</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">327</span>    }
<span class="line-numbers">328</span>
<span class="line-numbers">329</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">330</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">331</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">332</span>                       .build();
<span class="line-numbers">333</span>    }
<span class="line-numbers">334</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getSystemClient file=0">getSystemClient()</code> method builds and returns a new instance of the <code>SystemClient</code> class for the hostname provided. The <code class="hotspot=addSystemClient file=0">/client/{hostname}</code> POST endpoint uses this method to create a REST client that is called <code class="hotspot=getCustomRestClient file=0">customRestClient</code> to consume the <code>system</code> microservice.</p>
</div>
<div class="paragraph">
<p>A JWT instance is injected to the <code class="hotspot=jwt file=0">jwt</code> field variable by the <code>jwtSso</code> feature. It is used to create the <code class="hotspot=authHeader file=0">authHeader</code> authentication header. It is then passed as a parameter to the endpoints of the <code class="hotspot=customRestClient file=0">customRestClient</code> to get the properties from the <code>system</code> microservice. A <code class="hotspot=addSystem file=0">system</code> is then added to the inventory.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-json-web-token">Configuring the JSON Web Token</h3>
<div class="paragraph">
<p>Next, add the JSON Web Token (Single Sign On) feature to the server configuration file for the <code>inventory</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>server.xml</code> file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>        <span class="comment">&lt;!-- tag::jwtSsoFeature[] --&gt;</span>
<span class="line-numbers"> 8</span>        <span class="tag">&lt;feature&gt;</span>jwtSso-1.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 9</span>        <span class="comment">&lt;!-- end::jwtSsoFeature[] --&gt;</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">14</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.context.root</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">15</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/hostname</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">16</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/portnum</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">17</span>
<span class="line-numbers">18</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">19</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">20</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">23</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">24</span>    
<span class="line-numbers">25</span>    <span class="comment">&lt;!-- tag::keyStore[] --&gt;</span>
<span class="line-numbers">26</span>    <span class="tag">&lt;keyStore</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultKeyStore</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">secret</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">27</span>    <span class="comment">&lt;!-- end::keyStore[] --&gt;</span>
<span class="line-numbers">28</span>    
<span class="line-numbers">29</span>    <span class="tag">&lt;basicRegistry</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">basic</span><span class="delimiter">"</span></span> <span class="attribute-name">realm</span>=<span class="string"><span class="delimiter">"</span><span class="content">WebRealm</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">30</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PTA9Lyg7</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">31</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PjM2PDovKDs=</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">34</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">35</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">36</span>
<span class="line-numbers">37</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">38</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">39</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">40</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">41</span>    <span class="tag">&lt;/basicRegistry&gt;</span>
<span class="line-numbers">42</span>
<span class="line-numbers">43</span>    <span class="comment">&lt;!-- Configures the application on a specified context root --&gt;</span>
<span class="line-numbers">44</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.context.root}</span><span class="delimiter">"</span></span>
<span class="line-numbers">45</span>                    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory.war</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">46</span>        <span class="tag">&lt;application-bnd&gt;</span>
<span class="line-numbers">47</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">48</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">49</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">50</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">51</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">52</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">53</span>        <span class="tag">&lt;/application-bnd&gt;</span>
<span class="line-numbers">54</span>    <span class="tag">&lt;/webApplication&gt;</span>
<span class="line-numbers">55</span>
<span class="line-numbers">56</span>    <span class="comment">&lt;!-- tag::jwtSsoConfig[] --&gt;</span>
<span class="line-numbers">57</span>    <span class="tag">&lt;jwtSso</span> <span class="attribute-name">jwtBuilderRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">jwtInventoryBuilder</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span> 
<span class="line-numbers">58</span>    <span class="comment">&lt;!-- end::jwtSsoConfig[] --&gt;</span>
<span class="line-numbers">59</span>    <span class="comment">&lt;!-- tag::jwtBuilder[] --&gt;</span>
<span class="line-numbers">60</span>    <span class="tag">&lt;jwtBuilder</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">jwtInventoryBuilder</span><span class="delimiter">"</span></span> 
<span class="line-numbers">61</span>                <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://openliberty.io</span><span class="delimiter">"</span></span> 
<span class="line-numbers">62</span>                <span class="attribute-name">audiences</span>=<span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span>
<span class="line-numbers">63</span>                <span class="attribute-name">expiry</span>=<span class="string"><span class="delimiter">"</span><span class="content">24h</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">64</span>    <span class="comment">&lt;!-- end::jwtBuilder[] --&gt;</span>
<span class="line-numbers">65</span>    <span class="comment">&lt;!-- tag::mpJwt[] --&gt;</span>
<span class="line-numbers">66</span>    <span class="tag">&lt;mpJwt</span> <span class="attribute-name">audiences</span>=<span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span> 
<span class="line-numbers">67</span>           <span class="attribute-name">groupNameAttribute</span>=<span class="string"><span class="delimiter">"</span><span class="content">groups</span><span class="delimiter">"</span></span> 
<span class="line-numbers">68</span>           <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">myMpJwt</span><span class="delimiter">"</span></span> 
<span class="line-numbers">69</span>           <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://openliberty.io</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">70</span>    <span class="comment">&lt;!-- end::mpJwt[] --&gt;</span>
<span class="line-numbers">71</span>
<span class="line-numbers">72</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">73</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">74</span>
<span class="line-numbers">75</span>    <span class="tag">&lt;library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">76</span>        <span class="tag">&lt;fileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">"</span><span class="content">${shared.resource.dir}/</span><span class="delimiter">"</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">"</span><span class="content">*.jar</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">77</span>    <span class="tag">&lt;/library&gt;</span>
<span class="line-numbers">78</span>
<span class="line-numbers">79</span>    <span class="tag">&lt;dataSource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">DefaultDataSource</span><span class="delimiter">"</span></span> <span class="attribute-name">jndiName</span>=<span class="string"><span class="delimiter">"</span><span class="content">jdbc/postgresql</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">80</span>        <span class="tag">&lt;jdbcDriver</span> <span class="attribute-name">libraryRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">81</span>        <span class="tag">&lt;properties.postgresql</span> <span class="attribute-name">databaseName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">82</span>                               <span class="attribute-name">serverName</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>
<span class="line-numbers">83</span>                               <span class="attribute-name">portNumber</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span>
<span class="line-numbers">84</span>                               <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">85</span>                               <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">86</span>    <span class="tag">&lt;/dataSource&gt;</span>
<span class="line-numbers">87</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>microprofile-config.properties</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers">1</span>mp.jwt.verify.issuer=http://openliberty.io
<span class="line-numbers">2</span>mp.jwt.token.header=Authorization
<span class="line-numbers">3</span>mp.jwt.token.cookie=Bearer
<span class="line-numbers">4</span>mp.jwt.verify.audiences=systemService, adminServices
<span class="line-numbers">5</span># mp.jwt.decrypt.key.location=privatekey.pem
<span class="line-numbers">6</span>mp.jwt.verify.publickey.algorithm=RS256</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=jwtSsoFeature file=0">jwtSso</code> feature adds the libraries that are required for JWT SSO implementation. Configure the <code class="hotspot=jwtSsoConfig file=0">jwtSso</code> feature by adding the <code class="hotspot=jwtBuilder file=0">jwtBuilder</code> configuration to your <code>server.xml</code>. Also, configure the MicroProfile <code class="hotspot=mpJwt file=0">JWT</code> with the <code>audiences</code> and <code>issuer</code> properties that match the <code class="hotspot file=1">microprofile-config.properties</code> defined at the <code>system/src/main/webapp/META-INF</code> directory under the <code>system</code> project. For more information, see the <a href="https://www.openliberty.io/docs/latest/reference/feature/jwtSso-1.0.html" target="_blank" rel="noopener noreferrer">JSON Web Token Single Sign-On feature</a>, <a href="https://www.openliberty.io/docs/latest/reference/config/jwtSso.html" target="_blank" rel="noopener noreferrer">jwtSso element</a>, and <a href="https://www.openliberty.io/docs/latest/reference/config/jwtBuilder.html" target="_blank" rel="noopener noreferrer">jwtBuilder element</a> documentation.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=keyStore file=0">keyStore</code> element is used to define the repository of security certificates used for SSL encryption. The <code>id</code> attribute is a unique configuration ID that is set to <code>defaultKeyStore</code>. The <code>password</code> attribute is used to load the keystore file, and its value can be stored in clear text or encoded form. To learn more about other attributes, see the <a href="https://openliberty.io/docs/latest/reference/config/keyStore.html#keyStore.html" target="_blank" rel="noopener">keyStore</a> attribute documentation.</p>
</div>
<div class="paragraph">
<p>Because the keystore file is not provided at the <code>src</code> directory, Liberty creates a Public Key Cryptography Standards #12 (PKCS12) keystore file for you by default. This file needs to be replaced, as the <code class="hotspot=keyStore file=0">keyStore</code> configuration must be the same in both <code>system</code> and <code>inventory</code> microservices. As the configured <code>system</code> microservice is already provided for you, copy the <code>key.p12</code> keystore file from the <code>system</code> microservice to your <code>inventory</code> service.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src\main\liberty\config\resources\security
copy ..\..\finish\system\src\main\liberty\config\resources\security\key.p12 src\main\liberty\config\resources\security\key.p12</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir -p src/main/liberty/config/resources/security
cp ../../finish/system/src/main/liberty/config/resources/security/key.p12 src/main/liberty/config/resources/security/key.p12</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now configure the client https port in the <code>build.gradle</code> configuration file.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Replace the <code>build.gradle</code> file.</mark>
<code>build.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>build.gradle</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle"><span class="line-numbers"> 1</span>plugins {
<span class="line-numbers"> 2</span>    id 'war'
<span class="line-numbers"> 3</span>    id 'io.openliberty.tools.gradle.Liberty' version '3.6.2'
<span class="line-numbers"> 4</span>}
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>version '1.0-SNAPSHOT'
<span class="line-numbers"> 7</span>group 'io.openliberty.deepdive'
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>sourceCompatibility = 11
<span class="line-numbers">10</span>targetCompatibility = 11
<span class="line-numbers">11</span>tasks.withType(JavaCompile) {
<span class="line-numbers">12</span>    options.encoding = 'UTF-8'
<span class="line-numbers">13</span>}
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>repositories {
<span class="line-numbers">16</span>    mavenCentral()
<span class="line-numbers">17</span>}
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>configurations {
<span class="line-numbers">20</span>    jdbcLib
<span class="line-numbers">21</span>}
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>dependencies {
<span class="line-numbers">24</span>    // provided dependencies
<span class="line-numbers">25</span>    providedCompile 'jakarta.platform:jakarta.jakartaee-api:10.0.0'
<span class="line-numbers">26</span>    providedCompile 'org.eclipse.microprofile:microprofile:6.0'
<span class="line-numbers">27</span>    jdbcLib 'org.postgresql:postgresql:42.3.8'
<span class="line-numbers">28</span>}
<span class="line-numbers">29</span>
<span class="line-numbers">30</span>war {
<span class="line-numbers">31</span>    archiveVersion = ''
<span class="line-numbers">32</span>}
<span class="line-numbers">33</span>
<span class="line-numbers">34</span>ext  {
<span class="line-numbers">35</span>    liberty.server.var.'default.http.port' = '9080'
<span class="line-numbers">36</span>    liberty.server.var.'default.https.port' = '9443'
<span class="line-numbers">37</span>    liberty.server.var.'default.context.root' = '/inventory'
<span class="line-numbers">38</span>    // tag::https[]
<span class="line-numbers">39</span>    liberty.server.var.'client.https.port' = '9444'
<span class="line-numbers">40</span>    // end::https[]
<span class="line-numbers">41</span>    sourceSets.main.output.resourcesDir = sourceSets.main.java.destinationDirectory
<span class="line-numbers">42</span>}
<span class="line-numbers">43</span>
<span class="line-numbers">44</span>task copyJdbcLibs(type: Copy) {
<span class="line-numbers">45</span>    from configurations.jdbcLib
<span class="line-numbers">46</span>    into "${buildDir}/wlp/usr/shared/resources"
<span class="line-numbers">47</span>}
<span class="line-numbers">48</span>
<span class="line-numbers">49</span>deploy.dependsOn 'copyJdbcLibs'
<span class="line-numbers">50</span>
<span class="line-numbers">51</span>clean.dependsOn 'libertyStop'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the client https port by setting the <code class="hotspot=https file=2">liberty.server.var.'client.https.port'</code> to <code>9444</code>.</p>
</div>
<div class="paragraph">
<p>In your dev mode console for the <code>inventory</code> microservice, press <code>CTRL+C</code> to stop the server. Then, restart the dev mode of the <code>inventory</code> microservice.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>gradlew libertyDev</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew libertyDev</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After you see the following message, your application server in dev mode is ready again:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-clienthostname-endpoint">Running the <code>/client/{hostname}</code> endpoint</h3>
<div class="paragraph">
<p>Open another command-line session and run the <code>system</code> microservice from the <code>finish</code> directory.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd finish\system
gradlew libertyRun</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd finish/system
./gradlew libertyRun</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Wait until the following message displays on the <code>system</code> microservice console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CWWKF0011I: The defaultServer server is ready to run a smarter planet. ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check that the <code>system</code> microservice is secured against unauthenticated requests at the <a href="https://localhost:9444/system/api/heapsize" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9444/system/api/heapsize</a> URL. You can expect to see the following error in the console of the <code>system</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CWWKS5522E: The MicroProfile JWT feature cannot perform authentication because a MicroProfile JWT cannot be found in the request.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check that the <code>/client/{hostname}</code> endpoint you updated can access the <code>system</code> microservice.</p>
</div>
<div class="paragraph">
<p>Make an authorized request to the new <code>/client/{hostname}</code> endpoint.
As this endpoint is restricted to <code>admin</code>, you can use the login credentials for <code>bob</code>, which is in the <code>admin</code> group.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl -k --user bob:bobpwd -X POST "https://localhost:9443/inventory/api/systems/client/localhost"</pre>
</div>
</div>
<div class="paragraph">
<p>You can expect the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{ "ok" : "localhost was added." }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that this endpoint works as expected by running the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>curl "http://localhost:9080/inventory/api/systems"</pre>
</div>
</div>
<div class="paragraph">
<p>You can expect to see your system listed in the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[
  {
    "heapSize": 2999975936,
    "hostname": "localhost",
    "id": 11,
    "javaVersion": "11.0.11",
    "osName": "Linux"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-health-checks">Adding health checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, you’ll use <a href="https://download.eclipse.org/microprofile/microprofile-health-4.0/microprofile-health-spec-4.0.html" target="_blank" rel="noopener noreferrer">MicroProfile Health</a> to report the health status of the microservice and PostgreSQL database connection.</p>
</div>
<div class="paragraph">
<p>Navigate to your application directory</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start/inventory</code></pre>
</div>
</div>
<div class="paragraph">
<p>A health report is generated automatically for all health services that enable MicroProfile Health.</p>
</div>
<div class="paragraph">
<p>All health services must provide an implementation of the <code>HealthCheck</code> interface, which is used to verify their health. MicroProfile Health offers health checks for startup, liveness, and readiness.</p>
</div>
<div class="paragraph">
<p>A startup check allows applications to define startup probes that are used for initial verification of the application before the liveness probe takes over. For example, a startup check might check which applications require additional startup time on their first initialization.</p>
</div>
<div class="paragraph">
<p>A liveness check allows third-party services to determine whether a microservice is running. If the liveness check fails, the application can be terminated. For example, a liveness check might fail if the application runs out of memory.</p>
</div>
<div class="paragraph">
<p>A readiness check allows third-party services, such as Kubernetes, to determine whether a microservice is ready to process requests.</p>
</div>
<div class="paragraph">
<p>Create the <code>health</code> subdirectory before creating the health check classes.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src\main\java\io\openliberty\deepdive\rest\health</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mkdir src/main/java/io/openliberty/deepdive/rest/health</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>StartupCheck</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/health/StartupCheck.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>StartupCheck.java</p>
</div>
<div class="listingblock code_column tags=StartupCheck hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="comment">// tag::StartupCheck[]</span>
<span class="line-numbers">13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.health</span>;
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.lang.management.ManagementFactory</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">com.sun.management.OperatingSystemMXBean</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.Startup</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheck</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheckResponse</span>;
<span class="line-numbers">21</span>
<span class="line-numbers">22</span><span class="comment">// tag::Startup[]</span>
<span class="line-numbers">23</span><span class="annotation">@Startup</span>
<span class="line-numbers">24</span><span class="comment">// end::Startup[]</span>
<span class="line-numbers">25</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">26</span><span class="directive">public</span> <span class="type">class</span> <span class="class">StartupCheck</span> <span class="directive">implements</span> HealthCheck {
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>    <span class="annotation">@Override</span>
<span class="line-numbers">29</span>    <span class="directive">public</span> HealthCheckResponse call() {
<span class="line-numbers">30</span>        <span class="predefined-type">OperatingSystemMXBean</span> bean = (com.sun.management.OperatingSystemMXBean)
<span class="line-numbers">31</span>        <span class="predefined-type">ManagementFactory</span>.getOperatingSystemMXBean();
<span class="line-numbers">32</span>        <span class="type">double</span> cpuUsed = bean.getSystemCpuLoad();
<span class="line-numbers">33</span>        <span class="predefined-type">String</span> cpuUsage = <span class="predefined-type">String</span>.valueOf(cpuUsed);
<span class="line-numbers">34</span>        <span class="keyword">return</span> HealthCheckResponse.named(<span class="string"><span class="delimiter">"</span><span class="content">Startup Check</span><span class="delimiter">"</span></span>)
<span class="line-numbers">35</span>                                  .status(cpuUsed &lt; <span class="float">0.95</span>).build();
<span class="line-numbers">36</span>    }
<span class="line-numbers">37</span>}
<span class="line-numbers">38</span><span class="comment">// end::StartupCheck[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=Startup file=0">@Startup</code> annotation indicates that this class is a startup health check procedure. Navigate to the <a href="http://localhost:9080/health/started" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/health/started</a> URL to check the status of the startup health check. In this case, you are checking the cpu usage. If more than 95% of the cpu is being used, a status of <code>DOWN</code> is returned.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>LivenessCheck</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/health/LivenessCheck.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>LivenessCheck.java</p>
</div>
<div class="listingblock code_column tags=LivenessCheck hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="comment">// tag::LivenessCheck[]</span>
<span class="line-numbers">13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.health</span>;
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.lang.management.ManagementFactory</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">java.lang.management.MemoryMXBean</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.Liveness</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheck</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheckResponse</span>;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span><span class="comment">// tag::Liveness[]</span>
<span class="line-numbers">24</span><span class="annotation">@Liveness</span>
<span class="line-numbers">25</span><span class="comment">// end::Liveness[]</span>
<span class="line-numbers">26</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">27</span><span class="directive">public</span> <span class="type">class</span> <span class="class">LivenessCheck</span> <span class="directive">implements</span> HealthCheck {
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>    <span class="annotation">@Override</span>
<span class="line-numbers">30</span>    <span class="directive">public</span> HealthCheckResponse call() {
<span class="line-numbers">31</span>        <span class="predefined-type">MemoryMXBean</span> memBean = <span class="predefined-type">ManagementFactory</span>.getMemoryMXBean();
<span class="line-numbers">32</span>        <span class="type">long</span> memUsed = memBean.getHeapMemoryUsage().getUsed();
<span class="line-numbers">33</span>        <span class="type">long</span> memMax = memBean.getHeapMemoryUsage().getMax();
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>        <span class="keyword">return</span> HealthCheckResponse.named(<span class="string"><span class="delimiter">"</span><span class="content">Liveness Check</span><span class="delimiter">"</span></span>)
<span class="line-numbers">36</span>                                  .status(memUsed &lt; memMax * <span class="float">0.9</span>)
<span class="line-numbers">37</span>                                  .build();
<span class="line-numbers">38</span>    }
<span class="line-numbers">39</span>}
<span class="line-numbers">40</span><span class="comment">// end::LivenessCheck[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=Liveness file=1">@Liveness</code> annotation indicates that this class is a liveness health check procedure. Navigate to the <a href="http://localhost:9080/health/live" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/health/live</a> URL to check the status of the liveness health check. In this case, you are checking the heap memory usage. If more than 90% of the maximum memory is being used, a status of <code>DOWN</code> is returned.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Create the <code>ReadinessCheck</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/health/ReadinessCheck.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>ReadinessCheck.java</p>
</div>
<div class="listingblock code_column tags=ReadinessCheck hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="comment">// tag::ReadinessCheck[]</span>
<span class="line-numbers">13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest.health</span>;
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.time.LocalDateTime</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.Readiness</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheck</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.health.HealthCheckResponse</span>;
<span class="line-numbers">21</span>
<span class="line-numbers">22</span><span class="comment">// tag::Readiness[]</span>
<span class="line-numbers">23</span><span class="annotation">@Readiness</span>
<span class="line-numbers">24</span><span class="comment">// end::Readiness[]</span>
<span class="line-numbers">25</span><span class="comment">// tag::ApplicationScoped[]</span>
<span class="line-numbers">26</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">27</span><span class="comment">// end::ApplicationScoped[]</span>
<span class="line-numbers">28</span><span class="directive">public</span> <span class="type">class</span> <span class="class">ReadinessCheck</span> <span class="directive">implements</span> HealthCheck {
<span class="line-numbers">29</span>
<span class="line-numbers">30</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> ALIVE_DELAY_SECONDS = <span class="integer">10</span>;
<span class="line-numbers">31</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> READINESS_CHECK = <span class="string"><span class="delimiter">"</span><span class="content">Readiness Check</span><span class="delimiter">"</span></span>;
<span class="line-numbers">32</span>    <span class="directive">private</span> <span class="directive">static</span> LocalDateTime aliveAfter = LocalDateTime.now();
<span class="line-numbers">33</span>
<span class="line-numbers">34</span>    <span class="annotation">@Override</span>
<span class="line-numbers">35</span>    <span class="directive">public</span> HealthCheckResponse call() {
<span class="line-numbers">36</span>        <span class="keyword">if</span> (isAlive()) {
<span class="line-numbers">37</span>            <span class="keyword">return</span> HealthCheckResponse.up(READINESS_CHECK);
<span class="line-numbers">38</span>        }
<span class="line-numbers">39</span>
<span class="line-numbers">40</span>        <span class="keyword">return</span> HealthCheckResponse.down(READINESS_CHECK);
<span class="line-numbers">41</span>    }
<span class="line-numbers">42</span>
<span class="line-numbers">43</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setUnhealthy() {
<span class="line-numbers">44</span>        aliveAfter = LocalDateTime.now().plusSeconds(ALIVE_DELAY_SECONDS);
<span class="line-numbers">45</span>    }
<span class="line-numbers">46</span>
<span class="line-numbers">47</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="type">boolean</span> isAlive() {
<span class="line-numbers">48</span>        <span class="keyword">return</span> LocalDateTime.now().isAfter(aliveAfter);
<span class="line-numbers">49</span>    }
<span class="line-numbers">50</span>}
<span class="line-numbers">51</span><span class="comment">// end::ReadinessCheck[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=Readiness file=2">@Readiness</code> annotation indicates that this class is a readiness health check procedure. Navigate to the <a href="http://localhost:9080/health/ready" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/health/ready</a> URL to check the status of the readiness health check. This readiness check tests the connection to the PostgreSQL container that was created earlier in the guide. If the connection is refused, a status of <code>DOWN</code> is returned.</p>
</div>
<div class="paragraph">
<p>Or, you can visit the <a href="http://localhost:9080/health" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/health</a> URL to see the overall health status of the application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="providing-metrics">Providing metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, you can learn how to use <a href="https://download.eclipse.org/microprofile/microprofile-metrics-4.0/microprofile-metrics-spec-4.0.html" target="_blank" rel="noopener noreferrer">MicroProfile Metrics</a> to provide metrics from the <code>inventory</code> microservice.</p>
</div>
<div class="paragraph">
<p>Go to your application directory.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start/inventory</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enable the <code>bob</code> user to access the <code>/metrics</code> endpoints.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>server.xml</code> file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>        <span class="tag">&lt;feature&gt;</span>jwtSso-1.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers"> 9</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">11</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">12</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.context.root</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/hostname</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">14</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/portnum</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">17</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">18</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">19</span>
<span class="line-numbers">20</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">21</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">22</span>    
<span class="line-numbers">23</span>    <span class="tag">&lt;keyStore</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultKeyStore</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">secret</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">24</span>    
<span class="line-numbers">25</span>    <span class="tag">&lt;basicRegistry</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">basic</span><span class="delimiter">"</span></span> <span class="attribute-name">realm</span>=<span class="string"><span class="delimiter">"</span><span class="content">WebRealm</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">26</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PTA9Lyg7</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">27</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PjM2PDovKDs=</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">30</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">31</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">34</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">35</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">36</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">37</span>    <span class="tag">&lt;/basicRegistry&gt;</span>
<span class="line-numbers">38</span>
<span class="line-numbers">39</span>    <span class="comment">&lt;!-- tag::administrator[] --&gt;</span>
<span class="line-numbers">40</span>    <span class="tag">&lt;administrator-role&gt;</span>
<span class="line-numbers">41</span>        <span class="tag">&lt;user&gt;</span>bob<span class="tag">&lt;/user&gt;</span>
<span class="line-numbers">42</span>        <span class="tag">&lt;group&gt;</span>AuthorizedGroup<span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">43</span>    <span class="tag">&lt;/administrator-role&gt;</span>
<span class="line-numbers">44</span>    <span class="comment">&lt;!-- end::administrator[] --&gt;</span>
<span class="line-numbers">45</span>
<span class="line-numbers">46</span>    <span class="comment">&lt;!-- Configures the application on a specified context root --&gt;</span>
<span class="line-numbers">47</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.context.root}</span><span class="delimiter">"</span></span>
<span class="line-numbers">48</span>                    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory.war</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">49</span>        <span class="tag">&lt;application-bnd&gt;</span>
<span class="line-numbers">50</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">51</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">52</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">53</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">54</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">55</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">56</span>        <span class="tag">&lt;/application-bnd&gt;</span>
<span class="line-numbers">57</span>    <span class="tag">&lt;/webApplication&gt;</span>
<span class="line-numbers">58</span>
<span class="line-numbers">59</span>    <span class="tag">&lt;jwtSso</span> <span class="attribute-name">jwtBuilderRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">jwtInventoryBuilder</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span> 
<span class="line-numbers">60</span>    <span class="tag">&lt;jwtBuilder</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">jwtInventoryBuilder</span><span class="delimiter">"</span></span> 
<span class="line-numbers">61</span>                <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://openliberty.io</span><span class="delimiter">"</span></span> 
<span class="line-numbers">62</span>                <span class="attribute-name">audiences</span>=<span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span>
<span class="line-numbers">63</span>                <span class="attribute-name">expiry</span>=<span class="string"><span class="delimiter">"</span><span class="content">24h</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">64</span>    <span class="tag">&lt;mpJwt</span> <span class="attribute-name">audiences</span>=<span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span> 
<span class="line-numbers">65</span>           <span class="attribute-name">groupNameAttribute</span>=<span class="string"><span class="delimiter">"</span><span class="content">groups</span><span class="delimiter">"</span></span> 
<span class="line-numbers">66</span>           <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">myMpJwt</span><span class="delimiter">"</span></span> 
<span class="line-numbers">67</span>           <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://openliberty.io</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">68</span>
<span class="line-numbers">69</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">70</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">71</span>
<span class="line-numbers">72</span>    <span class="tag">&lt;library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">73</span>        <span class="tag">&lt;fileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">"</span><span class="content">${shared.resource.dir}/</span><span class="delimiter">"</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">"</span><span class="content">*.jar</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">74</span>    <span class="tag">&lt;/library&gt;</span>
<span class="line-numbers">75</span>
<span class="line-numbers">76</span>    <span class="tag">&lt;dataSource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">DefaultDataSource</span><span class="delimiter">"</span></span> <span class="attribute-name">jndiName</span>=<span class="string"><span class="delimiter">"</span><span class="content">jdbc/postgresql</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">77</span>        <span class="tag">&lt;jdbcDriver</span> <span class="attribute-name">libraryRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">78</span>        <span class="tag">&lt;properties.postgresql</span> <span class="attribute-name">databaseName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">79</span>                               <span class="attribute-name">serverName</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>
<span class="line-numbers">80</span>                               <span class="attribute-name">portNumber</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span>
<span class="line-numbers">81</span>                               <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">82</span>                               <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">83</span>    <span class="tag">&lt;/dataSource&gt;</span>
<span class="line-numbers">84</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=administrator file=0">administrator-role</code> configuration authorizes the <code>bob</code> user as an administrator.</p>
</div>
<div class="paragraph">
<p>Use annotations that are provided by MicroProfile Metrics to instrument the <code>inventory</code> microservice to provide application-level metrics data.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>SystemResource</code> class.</mark>
<code>src/main/java/io/openliberty/deepdive/rest/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.deepdive.rest</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.net.URI</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 16</span>
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.Operation</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.ParameterIn</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.media.Schema</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.parameters.Parameters</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponseSchema</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.openapi.annotations.responses.APIResponses</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.RestClientBuilder</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.jwt.JsonWebToken</span>;
<span class="line-numbers"> 29</span><span class="comment">// tag::metricsImport[]</span>
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.metrics.annotation.Counted</span>;
<span class="line-numbers"> 31</span><span class="comment">// end::metricsImport[]</span>
<span class="line-numbers"> 32</span>
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.client.SystemClient</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.client.UnknownUriExceptionMapper</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">io.openliberty.deepdive.rest.model.SystemData</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">jakarta.transaction.Transactional</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.DELETE</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 43</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.POST</span>;
<span class="line-numbers"> 44</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="line-numbers"> 45</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 46</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 47</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 48</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.QueryParam</span>;
<span class="line-numbers"> 49</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 50</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 51</span>
<span class="line-numbers"> 52</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 53</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 54</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers"> 55</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 57</span>    Inventory inventory;
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">client.https.port</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 61</span>    <span class="predefined-type">String</span> CLIENT_PORT;
<span class="line-numbers"> 62</span>
<span class="line-numbers"> 63</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 64</span>    JsonWebToken jwt;
<span class="line-numbers"> 65</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 67</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 68</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 69</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 70</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">A list of system data stored within the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 71</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 72</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 73</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">List contents.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 74</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Returns the currently stored system data in the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 75</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">listContents</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 76</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SystemData&gt; listContents() {
<span class="line-numbers"> 77</span>        <span class="keyword">return</span> inventory.getSystems();
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>
<span class="line-numbers"> 80</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 81</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 82</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 83</span>    <span class="annotation">@APIResponseSchema</span>(value = SystemData.class,
<span class="line-numbers"> 84</span>        responseDescription = <span class="string"><span class="delimiter">"</span><span class="content">System data of a particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 85</span>        responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 86</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers"> 87</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Get System</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 88</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Retrieves and returns the system data from the system </span><span class="delimiter">"</span></span>
<span class="line-numbers"> 89</span>                      + <span class="string"><span class="delimiter">"</span><span class="content">service running on the particular host.</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 90</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">getSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 91</span>    )
<span class="line-numbers"> 92</span>    <span class="directive">public</span> SystemData getSystem(
<span class="line-numbers"> 93</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers"> 94</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers"> 95</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 96</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 97</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers"> 98</span>        )
<span class="line-numbers"> 99</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">100</span>        <span class="keyword">return</span> inventory.getSystem(hostname);
<span class="line-numbers">101</span>    }
<span class="line-numbers">102</span>
<span class="line-numbers">103</span>    <span class="annotation">@POST</span>
<span class="line-numbers">104</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">105</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">106</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">107</span>    <span class="comment">// tag::metricsAddSystem[]</span>
<span class="line-numbers">108</span>    <span class="annotation">@Counted</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>,
<span class="line-numbers">109</span>             absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers">110</span>             description = <span class="string"><span class="delimiter">"</span><span class="content">Number of times adding system endpoint is called</span><span class="delimiter">"</span></span>)
<span class="line-numbers">111</span>    <span class="comment">// end::metricsAddSystem[]</span>
<span class="line-numbers">112</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">113</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">114</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system to inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">115</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">116</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system to inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">117</span>    })
<span class="line-numbers">118</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">119</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">120</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">121</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">122</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">123</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">124</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">125</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">126</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">127</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">128</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">129</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">130</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">131</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">132</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">133</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">134</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">135</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">136</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">137</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">138</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">139</span>    })
<span class="line-numbers">140</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">141</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">142</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Add a system and its data to the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">143</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">144</span>    )
<span class="line-numbers">145</span>    <span class="directive">public</span> Response addSystem(
<span class="line-numbers">146</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">147</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">148</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">149</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">150</span>
<span class="line-numbers">151</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">152</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">153</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">154</span>        }
<span class="line-numbers">155</span>        inventory.add(hostname, osName, javaVersion, heapSize);
<span class="line-numbers">156</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">157</span>    }
<span class="line-numbers">158</span>
<span class="line-numbers">159</span>    <span class="annotation">@PUT</span>
<span class="line-numbers">160</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">161</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">162</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">163</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">164</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> })
<span class="line-numbers">165</span>    <span class="comment">// tag::metricsUpdateSystem[]</span>
<span class="line-numbers">166</span>    <span class="annotation">@Counted</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>,
<span class="line-numbers">167</span>             absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers">168</span>             description = <span class="string"><span class="delimiter">"</span><span class="content">Number of times updating a system endpoint is called</span><span class="delimiter">"</span></span>)
<span class="line-numbers">169</span>    <span class="comment">// end::metricsUpdateSystem[]</span>
<span class="line-numbers">170</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">171</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">172</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully updated system</span><span class="delimiter">"</span></span>),
<span class="line-numbers">173</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">174</span>           description =
<span class="line-numbers">175</span>               <span class="string"><span class="delimiter">"</span><span class="content">Unable to update because the system does not exist in the inventory.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">176</span>    })
<span class="line-numbers">177</span>    <span class="annotation">@Parameters</span>(value = {
<span class="line-numbers">178</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">179</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">180</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">181</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">182</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">183</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">184</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">185</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The operating system of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">186</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">linux</span><span class="delimiter">"</span></span>,
<span class="line-numbers">187</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">188</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">189</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">190</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The Java version of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">191</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">11</span><span class="delimiter">"</span></span>,
<span class="line-numbers">192</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)),
<span class="line-numbers">193</span>        <span class="annotation">@Parameter</span>(
<span class="line-numbers">194</span>            name = <span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>, in = ParameterIn.QUERY,
<span class="line-numbers">195</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">The heap size of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">196</span>            required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">1048576</span><span class="delimiter">"</span></span>,
<span class="line-numbers">197</span>            schema = <span class="annotation">@Schema</span>(type = SchemaType.NUMBER)),
<span class="line-numbers">198</span>    })
<span class="line-numbers">199</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">200</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Update system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">201</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Update a system and its data on the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">202</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">updateSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">203</span>    )
<span class="line-numbers">204</span>    <span class="directive">public</span> Response updateSystem(
<span class="line-numbers">205</span>        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname,
<span class="line-numbers">206</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">osName</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> osName,
<span class="line-numbers">207</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">javaVersion</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> javaVersion,
<span class="line-numbers">208</span>        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">heapSize</span><span class="delimiter">"</span></span>) <span class="predefined-type">Long</span> heapSize) {
<span class="line-numbers">209</span>
<span class="line-numbers">210</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">211</span>        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span>) {
<span class="line-numbers">212</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">213</span>        }
<span class="line-numbers">214</span>        s.setOsName(osName);
<span class="line-numbers">215</span>        s.setJavaVersion(javaVersion);
<span class="line-numbers">216</span>        s.setHeapSize(heapSize);
<span class="line-numbers">217</span>        inventory.update(s);
<span class="line-numbers">218</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">219</span>    }
<span class="line-numbers">220</span>
<span class="line-numbers">221</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">222</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">223</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">224</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">225</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">226</span>    <span class="comment">// tag::metricsRemoveSystem[]</span>
<span class="line-numbers">227</span>    <span class="annotation">@Counted</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>,
<span class="line-numbers">228</span>             absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers">229</span>             description = <span class="string"><span class="delimiter">"</span><span class="content">Number of times removing a system endpoint is called</span><span class="delimiter">"</span></span>)
<span class="line-numbers">230</span>    <span class="comment">// end::metricsRemoveSystem[]</span>
<span class="line-numbers">231</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">232</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">233</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully deleted the system from inventory</span><span class="delimiter">"</span></span>),
<span class="line-numbers">234</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">235</span>            description =
<span class="line-numbers">236</span>                <span class="string"><span class="delimiter">"</span><span class="content">Unable to delete because the system does not exist in the inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers">237</span>    })
<span class="line-numbers">238</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">239</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">240</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">241</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">242</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">243</span>    )
<span class="line-numbers">244</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">245</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Remove system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">246</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">Removes a system from the inventory.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">247</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">removeSystem</span><span class="delimiter">"</span></span>
<span class="line-numbers">248</span>    )
<span class="line-numbers">249</span>    <span class="directive">public</span> Response removeSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">250</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">251</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">252</span>            inventory.removeSystem(s);
<span class="line-numbers">253</span>            <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was removed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">254</span>        } <span class="keyword">else</span> {
<span class="line-numbers">255</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> does not exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">256</span>        }
<span class="line-numbers">257</span>    }
<span class="line-numbers">258</span>
<span class="line-numbers">259</span>    <span class="annotation">@POST</span>
<span class="line-numbers">260</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/client/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers">261</span>    <span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="line-numbers">262</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">263</span>    <span class="annotation">@Transactional</span>
<span class="line-numbers">264</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">265</span>    <span class="comment">// tag::metricsAddSystemClient[]</span>
<span class="line-numbers">266</span>    <span class="annotation">@Counted</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>,
<span class="line-numbers">267</span>             absolute = <span class="predefined-constant">true</span>,
<span class="line-numbers">268</span>             description = <span class="string"><span class="delimiter">"</span><span class="content">Number of times adding a system by client is called</span><span class="delimiter">"</span></span>)
<span class="line-numbers">269</span>    <span class="comment">// end::metricsAddSystemClient[]</span>
<span class="line-numbers">270</span>    <span class="annotation">@APIResponses</span>(value = {
<span class="line-numbers">271</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>,
<span class="line-numbers">272</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Successfully added system client</span><span class="delimiter">"</span></span>),
<span class="line-numbers">273</span>        <span class="annotation">@APIResponse</span>(responseCode = <span class="string"><span class="delimiter">"</span><span class="content">400</span><span class="delimiter">"</span></span>,
<span class="line-numbers">274</span>            description = <span class="string"><span class="delimiter">"</span><span class="content">Unable to add system client</span><span class="delimiter">"</span></span>)
<span class="line-numbers">275</span>    })
<span class="line-numbers">276</span>    <span class="annotation">@Parameter</span>(
<span class="line-numbers">277</span>        name = <span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, in = ParameterIn.PATH,
<span class="line-numbers">278</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">The hostname of the system</span><span class="delimiter">"</span></span>,
<span class="line-numbers">279</span>        required = <span class="predefined-constant">true</span>, example = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>,
<span class="line-numbers">280</span>        schema = <span class="annotation">@Schema</span>(type = SchemaType.STRING)
<span class="line-numbers">281</span>    )
<span class="line-numbers">282</span>    <span class="annotation">@Operation</span>(
<span class="line-numbers">283</span>        summary = <span class="string"><span class="delimiter">"</span><span class="content">Add system client</span><span class="delimiter">"</span></span>,
<span class="line-numbers">284</span>        description = <span class="string"><span class="delimiter">"</span><span class="content">This adds a system client.</span><span class="delimiter">"</span></span>,
<span class="line-numbers">285</span>        operationId = <span class="string"><span class="delimiter">"</span><span class="content">addSystemClient</span><span class="delimiter">"</span></span>
<span class="line-numbers">286</span>    )
<span class="line-numbers">287</span>    <span class="directive">public</span> Response addSystemClient(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers">288</span>
<span class="line-numbers">289</span>        SystemData s = inventory.getSystem(hostname);
<span class="line-numbers">290</span>        <span class="keyword">if</span> (s != <span class="predefined-constant">null</span>) {
<span class="line-numbers">291</span>            <span class="keyword">return</span> fail(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> already exists.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">292</span>        }
<span class="line-numbers">293</span>
<span class="line-numbers">294</span>        SystemClient customRestClient = <span class="predefined-constant">null</span>;
<span class="line-numbers">295</span>        <span class="keyword">try</span> {
<span class="line-numbers">296</span>            customRestClient = getSystemClient(hostname);
<span class="line-numbers">297</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers">298</span>            <span class="keyword">return</span> fail(<span class="string"><span class="delimiter">"</span><span class="content">Failed to create the client </span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content">.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">299</span>        }
<span class="line-numbers">300</span>
<span class="line-numbers">301</span>        <span class="predefined-type">String</span> authHeader = <span class="string"><span class="delimiter">"</span><span class="content">Bearer </span><span class="delimiter">"</span></span> + jwt.getRawToken();
<span class="line-numbers">302</span>        <span class="keyword">try</span> {
<span class="line-numbers">303</span>            <span class="predefined-type">String</span> osName = customRestClient.getProperty(authHeader, <span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">304</span>            <span class="predefined-type">String</span> javaVer = customRestClient.getProperty(authHeader, <span class="string"><span class="delimiter">"</span><span class="content">java.version</span><span class="delimiter">"</span></span>);
<span class="line-numbers">305</span>            <span class="predefined-type">Long</span> heapSize = customRestClient.getHeapSize(authHeader);
<span class="line-numbers">306</span>            inventory.add(hostname, osName, javaVer, heapSize);
<span class="line-numbers">307</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers">308</span>            <span class="keyword">return</span> fail(<span class="string"><span class="delimiter">"</span><span class="content">Failed to reach the client </span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content">.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">309</span>        }
<span class="line-numbers">310</span>        <span class="keyword">return</span> success(hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">311</span>    }
<span class="line-numbers">312</span>
<span class="line-numbers">313</span>    <span class="directive">private</span> SystemClient getSystemClient(<span class="predefined-type">String</span> hostname) <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers">314</span>        <span class="predefined-type">String</span> customURIString = <span class="string"><span class="delimiter">"</span><span class="content">https://</span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + CLIENT_PORT + <span class="string"><span class="delimiter">"</span><span class="content">/system</span><span class="delimiter">"</span></span>;
<span class="line-numbers">315</span>        <span class="predefined-type">URI</span> customURI = <span class="predefined-type">URI</span>.create(customURIString);
<span class="line-numbers">316</span>        <span class="keyword">return</span> RestClientBuilder.newBuilder()
<span class="line-numbers">317</span>                                .baseUri(customURI)
<span class="line-numbers">318</span>                                .register(UnknownUriExceptionMapper.class)
<span class="line-numbers">319</span>                                .build(SystemClient.class);
<span class="line-numbers">320</span>    }
<span class="line-numbers">321</span>
<span class="line-numbers">322</span>    <span class="directive">private</span> Response success(<span class="predefined-type">String</span> message) {
<span class="line-numbers">323</span>        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">ok</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">324</span>    }
<span class="line-numbers">325</span>
<span class="line-numbers">326</span>    <span class="directive">private</span> Response fail(<span class="predefined-type">String</span> message) {
<span class="line-numbers">327</span>        <span class="keyword">return</span> Response.status(Response.Status.BAD_REQUEST)
<span class="line-numbers">328</span>                       .entity(<span class="string"><span class="delimiter">"</span><span class="content">{ </span><span class="char">\"</span><span class="content">error</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="delimiter">"</span></span> + message + <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content"> }</span><span class="delimiter">"</span></span>)
<span class="line-numbers">329</span>                       .build();
<span class="line-numbers">330</span>    }
<span class="line-numbers">331</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Import the <code class="hotspot=metricsImport file=1">Counted</code> annotation and apply it to the <code class="hotspot=metricsAddSystem file=1">POST /api/systems</code>, <code class="hotspot=metricsUpdateSystem file=1">PUT /api/systems/{hostname}</code>, <code class="hotspot=metricsRemoveSystem file=1">DELETE /api/systems/{hostname}</code>, and <code class="hotspot=metricsAddSystemClient file=1">POST /api/systems/client/{hostname}</code> endpoints to monotonically count how many times that the endpoints are accessed.</p>
</div>
<div class="paragraph">
<p>Additional information about the annotations that MicroProfile metrics provides, relevant metadata fields, and more are available at the <a href="https://openliberty.io/docs/latest/reference/javadoc/microprofile-6.0-javadoc.html?package=org/eclipse/microprofile/metrics/annotation/package-frame.html&amp;class=overview-summary.html" target="_blank" rel="noopener">MicroProfile Metrics Annotation Javadoc</a>.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9080/openapi/ui" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui</a> URL to try out your application and call some of the endpoints that you annotated.</p>
</div>
<div class="paragraph">
<p>MicroProfile Metrics provides 4 different REST endpoints.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>/metrics</code> endpoint provides you with all the metrics in text format.</p>
</li>
<li>
<p>The <code>/metrics?scope=application</code> endpoint provides you with application-specific metrics.</p>
</li>
<li>
<p>The <code>/metrics?scope=base</code> endpoint provides you with metrics that are defined in MicroProfile specifications. Metrics in the base scope are intended to be portable between different MicroProfile-compatible runtimes.</p>
</li>
<li>
<p>The <code>/metrics?scope=vendor</code> endpoint provides you with metrics that are specific to the runtime.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="https://localhost:9443/metrics" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9443/metrics</a> URL to review all the metrics that are enabled through MicroProfile Metrics. Log in with <code>bob</code> as your username and <code>bobpwd</code> as your password. You can see the metrics in text format.</p>
</div>
<div class="paragraph">
<p>To see only the application metrics, point your browser to <a href="https://localhost:9443/metrics?scope=application" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9443/metrics?scope=application</a>. You can expect to see your application metrics in the output.</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code># HELP updateSystem_total Number of times updating a system endpoint is called
# TYPE updateSystem_total counter
updateSystem_total{mp_scope="application",} 1.0
# HELP removeSystem_total Number of times removing a system endpoint is called
# TYPE removeSystem_total counter
removeSystem_total{mp_scope="application",} 1.0
# HELP addSystemClient_total Number of times adding a system by client is called
# TYPE addSystemClient_total counter
addSystemClient_total{mp_scope="application",} 0.0
# HELP addSystem_total Number of times adding system endpoint is called
# TYPE addSystem_total counter
addSystem_total{mp_scope="application",} 1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the system metrics at the <a href="https://localhost:9443/metrics?scope=base" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9443/metrics?scope=base</a> URL. You can also see the vendor metrics at the <a href="https://localhost:9443/metrics?scope=vendor" class="notranslate bare" target="_blank" rel="noopener noreferrer">https://localhost:9443/metrics?scope=vendor</a> URL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-the-container">Building the container </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Press <code>CTRL+C</code> in the command-line session to stop the <code>gradlew libertyDev</code> dev mode that you started in the previous section.</p>
</div>
<div class="paragraph">
<p>Navigate to your application directory:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd start/inventory</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step to containerizing your application inside of a container is creating a Containerfile. A Containerfile is a collection of instructions for building a container image that can then be run as a container.</p>
</div>
<div class="paragraph">
<p>Make sure to start your podman daemon before you proceed.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>Containerfile</code> in the <code>start/inventory</code> directory.</mark>
<code>Containerfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Containerfile</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"><span class="line-numbers"> 1</span># tag::from[]
<span class="line-numbers"> 2</span>FROM icr.io/appcafe/open-liberty:full-java11-openj9-ubi
<span class="line-numbers"> 3</span># end::from[]
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>ARG VERSION=1.0
<span class="line-numbers"> 6</span>ARG REVISION=SNAPSHOT
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span># tag::label[]
<span class="line-numbers"> 9</span>LABEL \
<span class="line-numbers">10</span>  org.opencontainers.image.authors="My Name" \
<span class="line-numbers">11</span>  org.opencontainers.image.vendor="Open Liberty" \
<span class="line-numbers">12</span>  org.opencontainers.image.url="local" \
<span class="line-numbers">13</span>  org.opencontainers.image.source="https://github.com/OpenLiberty/guide-liberty-deepdive-gradle" \
<span class="line-numbers">14</span>  org.opencontainers.image.version="$VERSION" \
<span class="line-numbers">15</span>  org.opencontainers.image.revision="$REVISION" \
<span class="line-numbers">16</span>  vendor="Open Liberty" \
<span class="line-numbers">17</span>  name="inventory" \
<span class="line-numbers">18</span>  version="$VERSION-$REVISION" \
<span class="line-numbers">19</span>  summary="" \
<span class="line-numbers">20</span>  description="This image contains the inventory microservice running with the Open Liberty runtime."
<span class="line-numbers">21</span># end::label[]
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>USER root
<span class="line-numbers">24</span>
<span class="line-numbers">25</span># tag::copy[]
<span class="line-numbers">26</span># tag::copy-config[]
<span class="line-numbers">27</span># tag::config-userID[]
<span class="line-numbers">28</span>COPY --chown=1001:0 \
<span class="line-numbers">29</span># end::config-userID[]
<span class="line-numbers">30</span>    # tag::inventory-config[]
<span class="line-numbers">31</span>    src/main/liberty/config/ \
<span class="line-numbers">32</span>    # end::inventory-config[]
<span class="line-numbers">33</span>    # tag::config[]
<span class="line-numbers">34</span>    /config/
<span class="line-numbers">35</span>    # end::config[]
<span class="line-numbers">36</span># end::copy-config[]
<span class="line-numbers">37</span>
<span class="line-numbers">38</span># tag::copy-war[]
<span class="line-numbers">39</span># tag::war-userID[]
<span class="line-numbers">40</span>COPY --chown=1001:0 \
<span class="line-numbers">41</span># end::war-userID[]
<span class="line-numbers">42</span>    # tag::inventory-war[]
<span class="line-numbers">43</span>    build/libs/inventory.war \
<span class="line-numbers">44</span>    # end::inventory-war[]
<span class="line-numbers">45</span>    # tag::config-apps[]
<span class="line-numbers">46</span>    /config/apps
<span class="line-numbers">47</span>    # end::config-apps[]
<span class="line-numbers">48</span># end::copy-war[]
<span class="line-numbers">49</span>
<span class="line-numbers">50</span># tag::copy-jar[]
<span class="line-numbers">51</span># tag::jar-userID[]
<span class="line-numbers">52</span>COPY --chown=1001:0 \
<span class="line-numbers">53</span># end::jar-userID[]
<span class="line-numbers">54</span>    # tag::inventory-jar[]
<span class="line-numbers">55</span>    build/wlp/usr/shared/resources/*.jar \
<span class="line-numbers">56</span>    # end::inventory-jar[]
<span class="line-numbers">57</span>    # tag::shared-resources[]
<span class="line-numbers">58</span>    /opt/ol/wlp/usr/shared/resources/
<span class="line-numbers">59</span>    # end::shared-resources[]
<span class="line-numbers">60</span># end::copy-jar[]
<span class="line-numbers">61</span># end::copy[]
<span class="line-numbers">62</span>
<span class="line-numbers">63</span>USER 1001
<span class="line-numbers">64</span>
<span class="line-numbers">65</span>RUN configure.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=from file=0">FROM</code> instruction initializes a new build stage and indicates the parent image from which your image is built. In this case, you’re using the <code>icr.io/appcafe/open-liberty:full-java11-openj9-ubi</code> image that comes with the latest Open Liberty runtime as your parent image.</p>
</div>
<div class="paragraph">
<p>To help you manage your images, you can label your container images with the <code class="hotspot=label file=0">LABEL</code> command.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=copy file=0">COPY</code> instructions are structured as <code>COPY</code> <code>[--chown=&lt;user&gt;:&lt;group&gt;]</code> <code>&lt;source&gt;</code> <code>&lt;destination&gt;</code>. They copy local files into the specified destination within your container  image. In this case, the first <code class="hotspot=copy-config file=0">COPY</code> instruction copies the server configuration file that is at <code>src/main/liberty/config/server.xml</code> to the <code>/config/</code> destination directory. Similarly, the second <code class="hotspot=copy-war file=0">COPY</code> instruction copies the <code>.war</code> file to the <code>/config/apps</code> destination directory. The third <code class="hotspot=copy-jar file=0">COPY</code> instruction copies the PostgreSQL library file to the Liberty shared resources directory.</p>
</div>
<div class="paragraph">
<p>Next, make the PostgreSQL database configurable in the Liberty server configuraton file.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>server.xml</code> file.</mark>
<code>src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>jakartaee-10.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>microProfile-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>        <span class="tag">&lt;feature&gt;</span>jwtSso-1.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers"> 9</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">11</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9443</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">12</span>    <span class="comment">&lt;!-- tag::contextRoot[] --&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.context.root</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">14</span>    <span class="comment">&lt;!-- end::contextRoot[] --&gt;</span>
<span class="line-numbers">15</span>    <span class="comment">&lt;!-- tag::variables[] --&gt;</span>
<span class="line-numbers">16</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/hostname</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">17</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/portnum</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">5432</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">18</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/username</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">19</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgres/password</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">adminpwd</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">20</span>    <span class="comment">&lt;!-- end::variables[] --&gt;</span>
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">23</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> 
<span class="line-numbers">24</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>    <span class="comment">&lt;!-- Automatically expand WAR files and EAR files --&gt;</span>
<span class="line-numbers">27</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>    <span class="tag">&lt;keyStore</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultKeyStore</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">secret</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">30</span>    
<span class="line-numbers">31</span>    <span class="tag">&lt;basicRegistry</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">basic</span><span class="delimiter">"</span></span> <span class="attribute-name">realm</span>=<span class="string"><span class="delimiter">"</span><span class="content">WebRealm</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">32</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PTA9Lyg7</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">33</span>        <span class="tag">&lt;user</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">{xor}PjM2PDovKDs=</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">36</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">37</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">38</span>
<span class="line-numbers">39</span>        <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">40</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">bob</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">41</span>            <span class="tag">&lt;member</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">alice</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">42</span>        <span class="tag">&lt;/group&gt;</span>
<span class="line-numbers">43</span>    <span class="tag">&lt;/basicRegistry&gt;</span>
<span class="line-numbers">44</span>
<span class="line-numbers">45</span>    <span class="comment">&lt;!-- Configures the application on a specified context root --&gt;</span>
<span class="line-numbers">46</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.context.root}</span><span class="delimiter">"</span></span>
<span class="line-numbers">47</span>                    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">inventory.war</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">48</span>        <span class="tag">&lt;application-bnd&gt;</span>
<span class="line-numbers">49</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">50</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">51</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">52</span>            <span class="tag">&lt;security-role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">53</span>                <span class="tag">&lt;group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">54</span>            <span class="tag">&lt;/security-role&gt;</span>
<span class="line-numbers">55</span>        <span class="tag">&lt;/application-bnd&gt;</span>
<span class="line-numbers">56</span>    <span class="tag">&lt;/webApplication&gt;</span>
<span class="line-numbers">57</span>
<span class="line-numbers">58</span>    <span class="tag">&lt;jwtSso</span> <span class="attribute-name">jwtBuilderRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">jwtInventoryBuilder</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span> 
<span class="line-numbers">59</span>    <span class="tag">&lt;jwtBuilder</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">jwtInventoryBuilder</span><span class="delimiter">"</span></span> 
<span class="line-numbers">60</span>                <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://openliberty.io</span><span class="delimiter">"</span></span> 
<span class="line-numbers">61</span>                <span class="attribute-name">audiences</span>=<span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span>
<span class="line-numbers">62</span>                <span class="attribute-name">expiry</span>=<span class="string"><span class="delimiter">"</span><span class="content">24h</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">63</span>    <span class="tag">&lt;mpJwt</span> <span class="attribute-name">audiences</span>=<span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span> 
<span class="line-numbers">64</span>           <span class="attribute-name">groupNameAttribute</span>=<span class="string"><span class="delimiter">"</span><span class="content">groups</span><span class="delimiter">"</span></span> 
<span class="line-numbers">65</span>           <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">myMpJwt</span><span class="delimiter">"</span></span> 
<span class="line-numbers">66</span>           <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://openliberty.io</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">67</span>
<span class="line-numbers">68</span>    <span class="comment">&lt;!-- Default SSL configuration enables trust for default certificates from the Java runtime --&gt;</span>
<span class="line-numbers">69</span>    <span class="tag">&lt;ssl</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultSSLConfig</span><span class="delimiter">"</span></span> <span class="attribute-name">trustDefaultCerts</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">70</span>
<span class="line-numbers">71</span>    <span class="tag">&lt;library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">72</span>        <span class="tag">&lt;fileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">"</span><span class="content">${shared.resource.dir}/</span><span class="delimiter">"</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">"</span><span class="content">*.jar</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">73</span>    <span class="tag">&lt;/library&gt;</span>
<span class="line-numbers">74</span>
<span class="line-numbers">75</span>    <span class="tag">&lt;dataSource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">DefaultDataSource</span><span class="delimiter">"</span></span> <span class="attribute-name">jndiName</span>=<span class="string"><span class="delimiter">"</span><span class="content">jdbc/postgresql</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">76</span>        <span class="tag">&lt;jdbcDriver</span> <span class="attribute-name">libraryRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">postgresql-library</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="line-numbers">77</span>        <span class="comment">&lt;!-- tag::postgresProperties[] --&gt;</span>
<span class="line-numbers">78</span>        <span class="tag">&lt;properties.postgresql</span> <span class="attribute-name">databaseName</span>=<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>
<span class="line-numbers">79</span>                               <span class="attribute-name">serverName</span>=<span class="string"><span class="delimiter">"</span><span class="content">${postgres/hostname}</span><span class="delimiter">"</span></span>
<span class="line-numbers">80</span>                               <span class="attribute-name">portNumber</span>=<span class="string"><span class="delimiter">"</span><span class="content">${postgres/portnum}</span><span class="delimiter">"</span></span>
<span class="line-numbers">81</span>                               <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">"</span><span class="content">${postgres/username}</span><span class="delimiter">"</span></span>
<span class="line-numbers">82</span>                               <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">${postgres/password}</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">83</span>        <span class="comment">&lt;!-- end::postgresProperties[] --&gt;</span>
<span class="line-numbers">84</span>    <span class="tag">&lt;/dataSource&gt;</span>
<span class="line-numbers">85</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of the hard-coded <code>serverName</code>, <code>portNumber</code>, <code>user</code>, and <code>password</code> values in the <code class="hotspot=postgresProperties file=1">properties.postgresql</code> properties, use <code>${postgres/hostname}</code>, <code>${postgres/portnum}</code>, <code>${postgres/username}</code>, and <code>${postgres/password}</code>, which are defined by the <code class="hotspot=variables file=1">variable</code> elements.</p>
</div>
<div class="sect2">
<h3 id="building-the-container-image">Building the container image</h3>
<div class="paragraph">
<p>Run the <code>war</code> task from the <code>start/inventory</code> directory so that the <code>.war</code> file resides in the <code>build/libs</code> directory.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>gradlew war</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew war</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Build your container image with the following commands:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>podman build -t liberty-deepdive-inventory:1.0-SNAPSHOT .</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the build finishes, run the following command to list all local container images:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>podman images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that the <code>liberty-deepdive-inventory:1.0-SNAPSHOT</code> image is listed among the container images, for example:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>REPOSITORY                             TAG
localhost/liberty-deepdive-inventory   1.0-SNAPSHOT
icr.io/appcafe/open-liberty            full-java11-openj9-ubi</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-application-in-container">Running the application in container</h3>
<div class="paragraph">
<p>Now that the <code>inventory</code> container image is built, you will run the application in container with the PostgreSQL container IP address.</p>
</div>
<div class="paragraph">
<p>Retrieve the PostgreSQL container IP address by running the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>podman inspect -f "{{.NetworkSettings.IPAddress }}" postgres-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command returns the PostgreSQL container IP address:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>10.88.0.10</pre>
</div>
</div>
<div class="paragraph">
<p>Run the container with the PostgreSQL container IP address. If your PostgreSQL container IP address is not <code>10.88.0.10</code>, replace the command with the right IP address.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>podman run -d --name inventory -p 9080:9080 -e POSTGRES_HOSTNAME=10.88.0.10 liberty-deepdive-inventory:1.0-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes the flags in this command:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 13.0434%;">
<col style="width: 86.9566%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Flag</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs the container in the background.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a name for the container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-p</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps the host ports to the container ports. For example: <code>-p &lt;HOST_PORT&gt;:&lt;CONTAINER_PORT&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets environment variables within the container. For example: <code>-e &lt;VARIABLE_NAME&gt;=&lt;value&gt;</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Next, run the <code>podman ps</code> command to verify that your container is started:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>podman ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure that your container is running and show <code>Up</code> as their status:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>CONTAINER ID    IMAGE                                              COMMAND                CREATED          STATUS          PORTS                                        NAMES
2b584282e0f5    localhost/liberty-deepdive-inventory:1.0-SNAPSHOT  /opt/ol/wlp/bin/s...   8 seconds ago    Up 8 second     0.0.0.0:9080-&gt;9080/tcp   inventory</pre>
</div>
</div>
<div class="paragraph">
<p>If a problem occurs and your container exit prematurely, the container don’t appear in the container
list that the <code>podman ps</code> command displays. Instead, your container appear with an <code>Exited</code> status when you run the <code>podman ps -a</code> command. Run the <code>podman logs inventory</code> command to view the container logs for any potential problems. Run the <code>podman stats inventory</code> command to display a live stream of usage statistics for your container. You can also double-check that your <code>Containerfile</code> file is correct. When you find the cause of the issues, remove the faulty container with the <code>podman rm inventory</code> command. Rebuild your image, and start the container again.</p>
</div>
<div class="paragraph">
<p>Now, you can access the application by the <a href="http://localhost:9080/inventory/api/systems" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/inventory/api/systems</a> URL. Alternatively, for the updated OpenAPI UI, use the following URL <a href="http://localhost:9080/openapi/ui/" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/openapi/ui/</a>.</p>
</div>
<div class="paragraph">
<p>When you’re finished trying out the application, run the following commands to stop the <code>inventory</code> container and the PostgreSQL container that was started in the previous section:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>podman stop inventory postgres-container
podman rm inventory postgres-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>To learn how to optimize the image size, check out the <a href="https://openliberty.io/guides/containerize-podman.html#optimizing-the-image-size" target="_blank" rel="noopener">Containerizing microservices with Podman guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="support-licensing">Support Licensing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Open Liberty is open source under the Eclipse Public License v1 so there is no fee to use it in production. Community support is available at StackOverflow, Gitter, or the mail list, and bugs can be raised in <a href="https://github.com/openliberty/open-liberty" target="_blank" rel="noopener noreferrer">GitHub</a>. Commercial support is available for Open Liberty from IBM. For more information, see the <a href="https://www.ibm.com/uk-en/marketplace/elite-support-for-open-liberty" target="_blank" rel="noopener noreferrer">IBM Marketplace</a>. The WebSphere Liberty product is built on Open Liberty. No migration is required to use WebSphere Liberty, you simply point to WebSphere Liberty in your build. WebSphere Liberty users get support for the packaged Open Liberty function.</p>
</div>
<div class="paragraph">
<p>WebSphere Liberty is also available in <a href="https://search.maven.org/search?q=g:com.ibm.websphere.appserver.runtime" target="_blank" rel="noopener noreferrer">Maven Central</a>.</p>
</div>
<div class="paragraph">
<p>You can use WebSphere Liberty for development even without purchasing it. However, if you have production entitlement, you can easily change to use it with the following steps.</p>
</div>
<div class="paragraph">
<p>In the <code>build.gradle</code>, add the <code>liberty</code> element as the following:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>liberty {
    runtime = [ 'group':'com.ibm.websphere.appserver.runtime',
                'name':'wlp-kernel']
}</pre>
</div>
</div>
<div class="paragraph">
<p>Rebuild and restart the <code>inventory</code> service by dev mode:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew clean
./gradlew libertyDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>Containerfile</code>, replace the Liberty image at the <code>FROM</code> statement with <code>websphere-liberty</code> as shown in the following example:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>FROM icr.io/appcafe/websphere-liberty:full-java11-openj9-ubi

ARG VERSION=1.0
ARG REVISION=SNAPSHOT
...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You just completed a hands-on deep dive on Liberty!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Technical Deep Dive on Liberty <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-liberty-deep-dive-gradle/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-liberty-deep-dive-gradle/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-liberty-deep-dive-gradle/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-openapi.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Documenting RESTful APIs</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/cdi-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Injecting dependencies into microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-config.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Configuring microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/jpa-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Accessing and persisting data in microservices using Java Persistence API (JPA)</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-jwt.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Securing microservices with JSON Web Tokens</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">25 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-health.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Adding health reports to microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-metrics.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Providing metrics from a microservice</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/containerize.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Containerizing microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/openliberty-operator-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Deploying a microservice to Kubernetes using Open Liberty Operator</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">30 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/kubernetes-microprofile-config.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Configuring microservices running in Kubernetes</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
