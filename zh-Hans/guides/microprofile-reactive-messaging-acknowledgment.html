<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      Acknowledging messages in Java microservices using MicroProfile Reactive Messaging
    
  </title>
  <meta name="description" content="A getting started tutorial with examples on how to acknowledge messages in asynchronous Java microservices using different MicroProfile Reactive Messaging acknowledgment strategies.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/microprofile-reactive-messaging-acknowledgment">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="Acknowledging messages in Java microservices using MicroProfile Reactive Messaging" />
  <meta name="twitter:description" content="A getting started tutorial with examples on how to acknowledge messages in asynchronous Java microservices using different MicroProfile Reactive Messaging acknowledgment strategies." />

  <meta property='og:title' content="Acknowledging messages in Java microservices using MicroProfile Reactive Messaging" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="A getting started tutorial with examples on how to acknowledge messages in asynchronous Java microservices using different MicroProfile Reactive Messaging acknowledgment strategies." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/microprofile-reactive-messaging-acknowledgment" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li><a href="#what-youll-learn">What you’ll learn</a></li>
<li><a href="#additional-prerequisites">Additional prerequisites</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#choosing-an-acknowledgment-strategy">Choosing an acknowledgment strategy</a></li>
<li><a href="#implementing-the-manual-acknowledgment-strategy">Implementing the MANUAL acknowledgment strategy</a></li>
<li><a href="#waiting-for-a-message-to-be-acknowledged">Waiting for a message to be acknowledged</a></li>
<li><a href="#building-and-running-the-application">Building and running the application</a></li>
<li><a href="#testing-the-application">Testing the application</a></li>
<li><a href="#tearing-down-the-environment">Tearing down the environment</a></li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#related-links">Related Links</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">Acknowledging messages using MicroProfile Reactive Messaging</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">20 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="https://openliberty.io/guides/microprofile-reactive-messaging-acknowledgment.html">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Learn how to acknowledge messages by using MicroProfile Reactive Messaging.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MicroProfile Reactive Messaging provides a reliable way to handle messages in reactive applications. MicroProfile Reactive Messaging ensures that messages aren’t lost by requiring that messages that were delivered to the target server are acknowledged after they are processed. Every message that gets sent out must be acknowledged. This way, any messages that were delivered to the target service but not processed, for example, due to a system failure, can be identified and sent again.</p>
</div>
<div class="paragraph">
<p>The application in this guide consists of two microservices, <code>system</code> and <code>inventory</code>. Every 15 seconds, the <code>system</code> microservice calculates and publishes events that contain its current average system load. The <code>inventory</code> microservice subscribes to that information so that it can keep an updated list of all the systems and their current system loads. You can get the current inventory of systems by accessing the <code>/systems</code> REST endpoint. The following diagram depicts the application that is used in this guide:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/guide/microprofile-reactive-messaging-acknowledgment/reactive-messaging-system-inventory-rest.png" alt="Reactive system inventory">
</div>
</div>
<div class="paragraph">
<p>You will explore the acknowledgment strategies that are available with MicroProfile Reactive Messaging, and you’ll implement your own manual acknowledgment strategy. To learn more about how the reactive Java services used in this guide work, check out the <a href="https://openliberty.io/guides/microprofile-reactive-messaging.html" target="_blank" rel="noopener">Creating reactive Java microservices</a> guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-prerequisites">Additional prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to have Docker installed. For installation instructions, refer to the official <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Docker documentation</a>. You will build and run the microservices in Docker containers. An installation of Apache Kafka is provided in another Docker container.</p>
</div>
</div>
</div>
<div class="sect1 command">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to work through this guide is to clone the <a href="https://github.com/openliberty/guide-microprofile-reactive-messaging-acknowledgment.git" target="_blank" rel="noopener noreferrer">Git repository</a> and use the projects that are provided inside:</p>
</div>
<div id="git_clone" class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-microprofile-reactive-messaging-acknowledgment.git
cd guide-microprofile-reactive-messaging-acknowledgment</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory contains the starting project that you will build upon.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished project that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary <span class="prerequisites">prerequisites</span>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="choosing-an-acknowledgment-strategy">Choosing an acknowledgment strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>start/SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2020, 2021 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">java.lang.management.ManagementFactory</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.lang.management.OperatingSystemMXBean</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">java.net.InetAddress</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">java.net.UnknownHostException</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Incoming</span>;
<span class="line-numbers">24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Outgoing</span>;
<span class="line-numbers">25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.streams.operators.PublisherBuilder</span>;
<span class="line-numbers">26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.streams.operators.ReactiveStreams</span>;
<span class="line-numbers">27</span><span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;
<span class="line-numbers">28</span>
<span class="line-numbers">29</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.models.PropertyMessage</span>;
<span class="line-numbers">30</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.models.SystemLoad</span>;
<span class="line-numbers">31</span><span class="keyword">import</span> <span class="include">io.reactivex.rxjava3.core.Flowable</span>;
<span class="line-numbers">32</span>
<span class="line-numbers">33</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">34</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> {
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers">37</span>
<span class="line-numbers">38</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">OperatingSystemMXBean</span> OS_MEAN =
<span class="line-numbers">39</span>            <span class="predefined-type">ManagementFactory</span>.getOperatingSystemMXBean();
<span class="line-numbers">40</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> hostname = <span class="predefined-constant">null</span>;
<span class="line-numbers">41</span>
<span class="line-numbers">42</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers">43</span>        <span class="keyword">if</span> (hostname == <span class="predefined-constant">null</span>) {
<span class="line-numbers">44</span>            <span class="keyword">try</span> {
<span class="line-numbers">45</span>                <span class="keyword">return</span> <span class="predefined-type">InetAddress</span>.getLocalHost().getHostName();
<span class="line-numbers">46</span>            } <span class="keyword">catch</span> (<span class="exception">UnknownHostException</span> e) {
<span class="line-numbers">47</span>                <span class="keyword">return</span> <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">"</span><span class="content">HOSTNAME</span><span class="delimiter">"</span></span>);
<span class="line-numbers">48</span>            }
<span class="line-numbers">49</span>        }
<span class="line-numbers">50</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers">51</span>    }
<span class="line-numbers">52</span>
<span class="line-numbers">53</span>    <span class="annotation">@Outgoing</span>(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>)
<span class="line-numbers">54</span>    <span class="directive">public</span> Publisher&lt;SystemLoad&gt; sendSystemLoad() {
<span class="line-numbers">55</span>        <span class="keyword">return</span> Flowable.interval(<span class="integer">15</span>, <span class="predefined-type">TimeUnit</span>.SECONDS)
<span class="line-numbers">56</span>                .map((interval -&gt; <span class="keyword">new</span> SystemLoad(getHostname(),
<span class="line-numbers">57</span>                        OS_MEAN.getSystemLoadAverage())));
<span class="line-numbers">58</span>    }
<span class="line-numbers">59</span>
<span class="line-numbers">60</span>    <span class="comment">// tag::sendProperty[]</span>
<span class="line-numbers">61</span>    <span class="annotation">@Incoming</span>(<span class="string"><span class="delimiter">"</span><span class="content">propertyRequest</span><span class="delimiter">"</span></span>)
<span class="line-numbers">62</span>    <span class="annotation">@Outgoing</span>(<span class="string"><span class="delimiter">"</span><span class="content">propertyResponse</span><span class="delimiter">"</span></span>)
<span class="line-numbers">63</span>    <span class="directive">public</span> PublisherBuilder&lt;PropertyMessage&gt; sendProperty(<span class="predefined-type">String</span> propertyName) {
<span class="line-numbers">64</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">sendProperty: </span><span class="delimiter">"</span></span> + propertyName);
<span class="line-numbers">65</span>        <span class="comment">// tag::null[]</span>
<span class="line-numbers">66</span>        <span class="predefined-type">String</span> propertyValue = <span class="predefined-type">System</span>.getProperty(propertyName);
<span class="line-numbers">67</span>        <span class="keyword">if</span> (propertyValue == <span class="predefined-constant">null</span>) {
<span class="line-numbers">68</span>            logger.warning(propertyName + <span class="string"><span class="delimiter">"</span><span class="content"> is not System property.</span><span class="delimiter">"</span></span>);
<span class="line-numbers">69</span>            <span class="comment">// tag::returnEmpty[]</span>
<span class="line-numbers">70</span>            <span class="keyword">return</span> ReactiveStreams.empty();
<span class="line-numbers">71</span>            <span class="comment">// end::returnEmpty[]</span>
<span class="line-numbers">72</span>        }
<span class="line-numbers">73</span>        <span class="comment">// end::null[]</span>
<span class="line-numbers">74</span>        <span class="comment">// tag::propertyMessage[]</span>
<span class="line-numbers">75</span>        PropertyMessage message =
<span class="line-numbers">76</span>                <span class="keyword">new</span> PropertyMessage(getHostname(),
<span class="line-numbers">77</span>                                    propertyName,
<span class="line-numbers">78</span>                                    <span class="predefined-type">System</span>.getProperty(propertyName, <span class="string"><span class="delimiter">"</span><span class="content">unknown</span><span class="delimiter">"</span></span>));
<span class="line-numbers">79</span>        <span class="keyword">return</span> ReactiveStreams.of(message);
<span class="line-numbers">80</span>        <span class="comment">// end::propertyMessage[]</span>
<span class="line-numbers">81</span>    }
<span class="line-numbers">82</span>    <span class="comment">// end::sendProperty[]</span>
<span class="line-numbers">83</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Messages must be acknowledged in reactive applications. Messages are either acknowledged explicitly, or messages are acknowledged implicitly by MicroProfile Reactive Messaging. Acknowledgment for incoming messages is controlled by the <code>@Acknowledgment</code> annotation in MicroProfile Reactive Messaging. If the <code>@Acknowledgment</code> annotation isn’t explicitly defined, then the default acknowledgment strategy applies, which depends on the method signature. Only methods that receive incoming messages and are annotated with the <code>@Incoming</code> annotation must acknowledge messages. Methods that are annotated only with the <code>@Outgoing</code> annotation don’t need to acknowledge messages because messages aren’t being received and MicroProfile Reactive Messaging requires only that <em>received</em> messages are acknowledged.</p>
</div>
<div class="paragraph">
<p>Almost all of the methods in this application that require message acknowledgment are assigned the <code>POST_PROCESSING</code> strategy by default. If the acknowledgment strategy is set to <code>POST_PROCESSING</code>, then MicroProfile Reactive Messaging acknowledges the message based on whether the annotated method emits data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the method emits data, the incoming message is acknowledged after the outgoing message is acknowledged.</p>
</li>
<li>
<p>If the method doesn’t emit data, the incoming message is acknowledged after the method or processing completes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It’s important that the methods use the <code>POST_PROCESSING</code> strategy because it fulfills the requirement that a message isn’t acknowledged until after the message is fully processed. This processing strategy is beneficial in situations where messages must reliably not get lost. When the <code>POST_PROCESSING</code> acknowledgment strategy can’t be used, the <code>MANUAL</code> strategy can be used to fulfill the same requirement. In situations where message acknowledgment reliability isn’t important and losing messages is acceptable, the <code>PRE_PROCESSING</code> strategy might be appropriate.</p>
</div>
<div class="paragraph">
<p>The only method in the guide that doesn’t default to the <code>POST_PROCESSING</code> strategy is the <code class="hotspot=sendProperty file=0">sendProperty()</code> method in the <code>system</code> service. The <code class="hotspot=sendProperty file=0">sendProperty()</code> method receives property requests from the <code>inventory</code> service. For each property request, if the property that’s being requested is valid, then the method creates and returns a <code class="hotspot=propertyMessage file=0">PropertyMessage</code> object with the value of the property. However, if the <code class="hotspot=null file=0">propertyName</code> requested property doesn’t exist, the request is ignored and no property response is returned.</p>
</div>
<div class="paragraph">
<p>A key difference exists between when a property response is returned and when a property response isn’t returned. In the case where a property response is returned, the request doesn’t finish processing until the response is sent and safely stored by the Kafka broker. Only then is the incoming message acknowledged. However, in the case where the requested property doesn’t exist and a property response isn’t returned, the method finishes processing the request message so the message must be acknowledged immediately.</p>
</div>
<div class="paragraph">
<p>This case where a message either needs to be acknowledged immediately or some time later is one of the situations where the <code>MANUAL</code> acknowledgment strategy would be beneficial</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-the-manual-acknowledgment-strategy">Implementing the MANUAL acknowledgment strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Navigate to the <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>Update the <code>SystemService.sendProperty</code> method to use the <code>MANUAL</code> acknowledgment strategy, which fits the method processing requirements better than the default <code>PRE_PROCESSING</code> strategy.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemService</code> class.</mark>
<code>system/src/main/java/io/openliberty/guides/system/SystemService.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>finish/SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2020 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers"> 10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers"> 11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.lang.management.ManagementFactory</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.lang.management.OperatingSystemMXBean</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.net.InetAddress</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.net.UnknownHostException</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 23</span>
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Acknowledgment</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Incoming</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Message</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Outgoing</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.streams.operators.PublisherBuilder</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.streams.operators.ReactiveStreams</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.models.PropertyMessage</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.models.SystemLoad</span>;
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">io.reactivex.rxjava3.core.Flowable</span>;
<span class="line-numbers"> 35</span>
<span class="line-numbers"> 36</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 37</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> {
<span class="line-numbers"> 38</span>    
<span class="line-numbers"> 39</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers"> 40</span>
<span class="line-numbers"> 41</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">OperatingSystemMXBean</span> osMean = 
<span class="line-numbers"> 42</span>            <span class="predefined-type">ManagementFactory</span>.getOperatingSystemMXBean();
<span class="line-numbers"> 43</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> hostname = <span class="predefined-constant">null</span>;
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> getHostname() {
<span class="line-numbers"> 46</span>        <span class="keyword">if</span> (hostname == <span class="predefined-constant">null</span>) {
<span class="line-numbers"> 47</span>            <span class="keyword">try</span> {
<span class="line-numbers"> 48</span>                <span class="keyword">return</span> <span class="predefined-type">InetAddress</span>.getLocalHost().getHostName();
<span class="line-numbers"> 49</span>            } <span class="keyword">catch</span> (<span class="exception">UnknownHostException</span> e) {
<span class="line-numbers"> 50</span>                <span class="keyword">return</span> <span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">"</span><span class="content">HOSTNAME</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 51</span>            }
<span class="line-numbers"> 52</span>        }
<span class="line-numbers"> 53</span>        <span class="keyword">return</span> hostname;
<span class="line-numbers"> 54</span>    }
<span class="line-numbers"> 55</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@Outgoing</span>(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="directive">public</span> Publisher&lt;SystemLoad&gt; sendSystemLoad() {
<span class="line-numbers"> 58</span>        <span class="keyword">return</span> Flowable.interval(<span class="integer">15</span>, <span class="predefined-type">TimeUnit</span>.SECONDS)
<span class="line-numbers"> 59</span>                .map((interval -&gt; <span class="keyword">new</span> SystemLoad(getHostname(),
<span class="line-numbers"> 60</span>                        osMean.getSystemLoadAverage())));
<span class="line-numbers"> 61</span>    }
<span class="line-numbers"> 62</span>
<span class="line-numbers"> 63</span>    <span class="comment">// tag::sendProperty[]</span>
<span class="line-numbers"> 64</span>    <span class="annotation">@Incoming</span>(<span class="string"><span class="delimiter">"</span><span class="content">propertyRequest</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 65</span>    <span class="annotation">@Outgoing</span>(<span class="string"><span class="delimiter">"</span><span class="content">propertyResponse</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 66</span>    <span class="comment">// tag::ackAnnotation[]</span>
<span class="line-numbers"> 67</span>    <span class="annotation">@Acknowledgment</span>(Acknowledgment.Strategy.MANUAL)
<span class="line-numbers"> 68</span>    <span class="comment">// end::ackAnnotation[]</span>
<span class="line-numbers"> 69</span>    <span class="comment">// tag::methodSignature[]</span>
<span class="line-numbers"> 70</span>    <span class="directive">public</span> PublisherBuilder&lt;Message&lt;PropertyMessage&gt;&gt;
<span class="line-numbers"> 71</span>    sendProperty(Message&lt;<span class="predefined-type">String</span>&gt; propertyMessage) {
<span class="line-numbers"> 72</span>    <span class="comment">// end::methodSignature[]</span>
<span class="line-numbers"> 73</span>        <span class="comment">// tag::propertyValue[]</span>
<span class="line-numbers"> 74</span>        <span class="predefined-type">String</span> propertyName = propertyMessage.getPayload();
<span class="line-numbers"> 75</span>        <span class="predefined-type">String</span> propertyValue = <span class="predefined-type">System</span>.getProperty(propertyName, <span class="string"><span class="delimiter">"</span><span class="content">unknown</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 76</span>        <span class="comment">// end::propertyValue[]</span>
<span class="line-numbers"> 77</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">sendProperty: </span><span class="delimiter">"</span></span> + propertyValue);
<span class="line-numbers"> 78</span>        <span class="comment">// tag::invalid[]</span>
<span class="line-numbers"> 79</span>        <span class="keyword">if</span> (propertyName == <span class="predefined-constant">null</span> || propertyName.isEmpty() || propertyValue == <span class="string"><span class="delimiter">"</span><span class="content">unknown</span><span class="delimiter">"</span></span>) {
<span class="line-numbers"> 80</span>            logger.warning(<span class="string"><span class="delimiter">"</span><span class="content">Provided property: </span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 81</span>                    propertyName + <span class="string"><span class="delimiter">"</span><span class="content"> is not a system property</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 82</span>            <span class="comment">// tag::propertyMessageAck[]</span>
<span class="line-numbers"> 83</span>            propertyMessage.ack();
<span class="line-numbers"> 84</span>            <span class="comment">// end::propertyMessageAck[]</span>
<span class="line-numbers"> 85</span>            <span class="comment">// tag::emptyReactiveStream[]</span>
<span class="line-numbers"> 86</span>            <span class="keyword">return</span> ReactiveStreams.empty();
<span class="line-numbers"> 87</span>            <span class="comment">// end::emptyReactiveStream[]</span>
<span class="line-numbers"> 88</span>        }
<span class="line-numbers"> 89</span>        <span class="comment">// end::invalid[]</span>
<span class="line-numbers"> 90</span>        <span class="comment">// tag::returnMessage[]</span>
<span class="line-numbers"> 91</span>        Message&lt;PropertyMessage&gt; message = Message.of(
<span class="line-numbers"> 92</span>                <span class="keyword">new</span> PropertyMessage(getHostname(),
<span class="line-numbers"> 93</span>                        propertyName,
<span class="line-numbers"> 94</span>                        propertyValue),
<span class="line-numbers"> 95</span>                propertyMessage::ack
<span class="line-numbers"> 96</span>        );
<span class="line-numbers"> 97</span>        <span class="keyword">return</span> ReactiveStreams.of(message);
<span class="line-numbers"> 98</span>        <span class="comment">// end::returnMessage[]</span>
<span class="line-numbers"> 99</span>    }
<span class="line-numbers">100</span>    <span class="comment">// end::sendProperty[]</span>
<span class="line-numbers">101</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=sendProperty file=0">sendProperty()</code> method needs to manually acknowledge the incoming messages, so it is annotated with the <code class="hotspot=ackAnnotation file=0">@Acknowledgment(Acknowledgment.Strategy.MANUAL)</code> annotation. This annotation sets the method up to expect an incoming message. To meet the requirements of acknowledgment, the method parameter is updated to receive and return a <code class="hotspot=methodSignature file=0">Message</code> of type <code>String</code>, rather than just a <code>String</code>. Then, the <code>propertyName</code> is extracted from the <code>propertyMessage</code> incoming message using the <code class="hotspot=propertyValue file=0">getPayload()</code> method and checked for validity. One of the following outcomes occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code class="hotspot=invalid file=0">propertyName</code> system property isn’t valid, the <code class="hotspot=propertyMessageAck file=0">ack()</code> method acknowledges the incoming message and returns an empty reactive stream using the <code class="hotspot=emptyReactiveStream file=0">empty()</code> method. The processing is complete.</p>
</li>
<li>
<p>If the system property is valid, the method creates a <code class="hotspot=returnMessage file=0">Message</code> object with the value of the requested system property and sends it to the proper channel. The method acknowledges the incoming message only after the sent message is acknowledged.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="waiting-for-a-message-to-be-acknowledged">Waiting for a message to be acknowledged</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>inventory</code> service contains an endpoint that accepts <code>PUT</code> requests. When a <code>PUT</code> request that contains a system property is made to the <code>inventory</code> service, the <code>inventory</code> service sends a message to the <code>system</code> service. The message from the <code>inventory</code> service requests the value of the system property from the system service. Currently, a <code>200</code> response code is returned without confirming whether the sent message was acknowledged. Replace the <code>inventory</code> service to return a <code>200</code> response only after the outgoing message is acknowledged.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>InventoryResource</code> class.</mark>
<code>inventory/src/main/java/io/openliberty/guides/inventory/InventoryResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>InventoryResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2020, 2021 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.inventory</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Optional</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CompletableFuture</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CompletionStage</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Consumes</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">javax.ws.rs.DELETE</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">javax.ws.rs.GET</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">javax.ws.rs.PUT</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Path</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">javax.ws.rs.PathParam</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Produces</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.Response</span>;
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Incoming</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Message</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.reactive.messaging.Outgoing</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;
<span class="line-numbers"> 38</span>
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.models.PropertyMessage</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.models.SystemLoad</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">io.reactivex.rxjava3.core.BackpressureStrategy</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">io.reactivex.rxjava3.core.Flowable</span>;
<span class="line-numbers"> 43</span><span class="keyword">import</span> <span class="include">io.reactivex.rxjava3.core.FlowableEmitter</span>;
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span>
<span class="line-numbers"> 46</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 47</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/inventory</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 48</span><span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryResource</span> {
<span class="line-numbers"> 49</span>
<span class="line-numbers"> 50</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(InventoryResource.class.getName());
<span class="line-numbers"> 51</span>    <span class="comment">// tag::propertyNameEmitter[]</span>
<span class="line-numbers"> 52</span>    <span class="directive">private</span> FlowableEmitter&lt;Message&lt;<span class="predefined-type">String</span>&gt;&gt; propertyNameEmitter;
<span class="line-numbers"> 53</span>    <span class="comment">// end::propertyNameEmitter[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 56</span>    <span class="directive">private</span> InventoryManager manager;
<span class="line-numbers"> 57</span>
<span class="line-numbers"> 58</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 59</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 60</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 61</span>    <span class="directive">public</span> Response getSystems() {
<span class="line-numbers"> 62</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">Properties</span>&gt; systems = manager.getSystems()
<span class="line-numbers"> 63</span>                .values()
<span class="line-numbers"> 64</span>                .stream()
<span class="line-numbers"> 65</span>                .collect(Collectors.toList());
<span class="line-numbers"> 66</span>        <span class="keyword">return</span> Response
<span class="line-numbers"> 67</span>                .status(Response.Status.OK)
<span class="line-numbers"> 68</span>                .entity(systems)
<span class="line-numbers"> 69</span>                .build();
<span class="line-numbers"> 70</span>            }
<span class="line-numbers"> 71</span>
<span class="line-numbers"> 72</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 73</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systems/{hostname}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 74</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 75</span>    <span class="directive">public</span> Response getSystem(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> hostname) {
<span class="line-numbers"> 76</span>        Optional&lt;<span class="predefined-type">Properties</span>&gt; system = manager.getSystem(hostname);
<span class="line-numbers"> 77</span>        <span class="keyword">if</span> (system.isPresent()) {
<span class="line-numbers"> 78</span>            <span class="keyword">return</span> Response
<span class="line-numbers"> 79</span>                    .status(Response.Status.OK)
<span class="line-numbers"> 80</span>                    .entity(system)
<span class="line-numbers"> 81</span>                    .build();
<span class="line-numbers"> 82</span>        }
<span class="line-numbers"> 83</span>        <span class="keyword">return</span> Response
<span class="line-numbers"> 84</span>                .status(Response.Status.NOT_FOUND)
<span class="line-numbers"> 85</span>                .entity(<span class="string"><span class="delimiter">"</span><span class="content">hostname does not exist.</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 86</span>                .build();
<span class="line-numbers"> 87</span>    }
<span class="line-numbers"> 88</span>
<span class="line-numbers"> 89</span>    <span class="comment">// tag::updateSystemProperty[]</span>
<span class="line-numbers"> 90</span>    <span class="annotation">@PUT</span>
<span class="line-numbers"> 91</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/data</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 92</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 93</span>    <span class="annotation">@Consumes</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers"> 94</span>    <span class="comment">/* This method sends a message and returns a CompletionStage that doesn't</span>
<span class="line-numbers"> 95</span><span class="comment">        complete until the message is acknowledged. */</span>
<span class="line-numbers"> 96</span>    <span class="comment">// tag::USPHeader[]</span>
<span class="line-numbers"> 97</span>    <span class="directive">public</span> CompletionStage&lt;Response&gt; updateSystemProperty(<span class="predefined-type">String</span> propertyName) {
<span class="line-numbers"> 98</span>    <span class="comment">// end::USPHeader[]</span>
<span class="line-numbers"> 99</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">updateSystemProperty: </span><span class="delimiter">"</span></span> + propertyName);
<span class="line-numbers">100</span>        <span class="comment">// First, create an incomplete CompletableFuture named "result".</span>
<span class="line-numbers">101</span>        <span class="comment">// tag::CompletableFuture[]</span>
<span class="line-numbers">102</span>        CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; result = <span class="keyword">new</span> CompletableFuture&lt;&gt;();
<span class="line-numbers">103</span>        <span class="comment">// end::CompletableFuture[]</span>
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        <span class="comment">// Create a message that holds the payload.</span>
<span class="line-numbers">106</span>        <span class="comment">// tag::message[]</span>
<span class="line-numbers">107</span>        Message&lt;<span class="predefined-type">String</span>&gt; message = Message.of(
<span class="line-numbers">108</span>                <span class="comment">// tag::payload[]</span>
<span class="line-numbers">109</span>                propertyName,
<span class="line-numbers">110</span>                <span class="comment">// end::payload[]</span>
<span class="line-numbers">111</span>                <span class="comment">// tag::acknowledgeAction[]</span>
<span class="line-numbers">112</span>                () -&gt; {
<span class="line-numbers">113</span>                    <span class="comment">/* This is the ack callback, which runs when the outgoing</span>
<span class="line-numbers">114</span><span class="comment">                        message is acknowledged. After the outgoing message is</span>
<span class="line-numbers">115</span><span class="comment">                        acknowledged, complete the "result" CompletableFuture. */</span>
<span class="line-numbers">116</span>                    result.complete(<span class="predefined-constant">null</span>);
<span class="line-numbers">117</span>                    <span class="comment">/* An ack callback must return a CompletionStage that says</span>
<span class="line-numbers">118</span><span class="comment">                        when it's complete. Asynchronous processing isn't necessary</span>
<span class="line-numbers">119</span><span class="comment">                        so a completed CompletionStage is returned to indicate that</span>
<span class="line-numbers">120</span><span class="comment">                        the work here is done. */</span>
<span class="line-numbers">121</span>                    <span class="keyword">return</span> CompletableFuture.completedFuture(<span class="predefined-constant">null</span>);
<span class="line-numbers">122</span>                }
<span class="line-numbers">123</span>                <span class="comment">// end::acknowledgeAction[]</span>
<span class="line-numbers">124</span>        );
<span class="line-numbers">125</span>        <span class="comment">// end::message[]</span>
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>        <span class="comment">// Send the message</span>
<span class="line-numbers">128</span>        propertyNameEmitter.onNext(message);
<span class="line-numbers">129</span>        <span class="comment">/* Set up what happens when the message is acknowledged and the "result"</span>
<span class="line-numbers">130</span><span class="comment">            CompletableFuture is completed. When "result" completes, the Response</span>
<span class="line-numbers">131</span><span class="comment">            object is created with the status code and message. */</span>
<span class="line-numbers">132</span>        <span class="comment">// tag::returnResult[]</span>
<span class="line-numbers">133</span>        <span class="keyword">return</span> result.thenApply(a -&gt; Response
<span class="line-numbers">134</span>                .status(Response.Status.OK)
<span class="line-numbers">135</span>                .entity(<span class="string"><span class="delimiter">"</span><span class="content">Request successful for the </span><span class="delimiter">"</span></span> + propertyName + <span class="string"><span class="delimiter">"</span><span class="content"> property</span><span class="char">\n</span><span class="delimiter">"</span></span>)
<span class="line-numbers">136</span>                .build());
<span class="line-numbers">137</span>        <span class="comment">// end::returnResult[]</span>
<span class="line-numbers">138</span>    }
<span class="line-numbers">139</span>    <span class="comment">// end::updateSystemProperty[]</span>
<span class="line-numbers">140</span>
<span class="line-numbers">141</span>    <span class="annotation">@DELETE</span>
<span class="line-numbers">142</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">143</span>    <span class="directive">public</span> Response resetSystems() {
<span class="line-numbers">144</span>        manager.resetSystems();
<span class="line-numbers">145</span>        <span class="keyword">return</span> Response
<span class="line-numbers">146</span>                .status(Response.Status.OK)
<span class="line-numbers">147</span>                .build();
<span class="line-numbers">148</span>    }
<span class="line-numbers">149</span>
<span class="line-numbers">150</span>    <span class="annotation">@Incoming</span>(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>)
<span class="line-numbers">151</span>    <span class="directive">public</span> <span class="type">void</span> updateStatus(SystemLoad sl)  {
<span class="line-numbers">152</span>        <span class="predefined-type">String</span> hostname = sl.hostname;
<span class="line-numbers">153</span>        <span class="keyword">if</span> (manager.getSystem(hostname).isPresent()) {
<span class="line-numbers">154</span>            manager.updateCpuStatus(hostname, sl.loadAverage);
<span class="line-numbers">155</span>            logger.info(<span class="string"><span class="delimiter">"</span><span class="content">Host </span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was updated: </span><span class="delimiter">"</span></span> + sl);
<span class="line-numbers">156</span>        } <span class="keyword">else</span> {
<span class="line-numbers">157</span>            manager.addSystem(hostname, sl.loadAverage);
<span class="line-numbers">158</span>            logger.info(<span class="string"><span class="delimiter">"</span><span class="content">Host </span><span class="delimiter">"</span></span> + hostname + <span class="string"><span class="delimiter">"</span><span class="content"> was added: </span><span class="delimiter">"</span></span> + sl);
<span class="line-numbers">159</span>        }
<span class="line-numbers">160</span>    }
<span class="line-numbers">161</span>
<span class="line-numbers">162</span>    <span class="annotation">@Incoming</span>(<span class="string"><span class="delimiter">"</span><span class="content">addSystemProperty</span><span class="delimiter">"</span></span>)
<span class="line-numbers">163</span>    <span class="directive">public</span> <span class="type">void</span> getPropertyMessage(PropertyMessage pm)  {
<span class="line-numbers">164</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">getPropertyMessage: </span><span class="delimiter">"</span></span> + pm);
<span class="line-numbers">165</span>        <span class="predefined-type">String</span> hostId = pm.hostname;
<span class="line-numbers">166</span>        <span class="keyword">if</span> (manager.getSystem(hostId).isPresent()) {
<span class="line-numbers">167</span>            manager.updatePropertyMessage(hostId, pm.key, pm.value);
<span class="line-numbers">168</span>            logger.info(<span class="string"><span class="delimiter">"</span><span class="content">Host </span><span class="delimiter">"</span></span> + hostId + <span class="string"><span class="delimiter">"</span><span class="content"> was updated: </span><span class="delimiter">"</span></span> + pm);
<span class="line-numbers">169</span>        } <span class="keyword">else</span> {
<span class="line-numbers">170</span>            manager.addSystem(hostId, pm.key, pm.value);
<span class="line-numbers">171</span>            logger.info(<span class="string"><span class="delimiter">"</span><span class="content">Host </span><span class="delimiter">"</span></span> + hostId + <span class="string"><span class="delimiter">"</span><span class="content"> was added: </span><span class="delimiter">"</span></span> + pm);
<span class="line-numbers">172</span>        }
<span class="line-numbers">173</span>    }
<span class="line-numbers">174</span>
<span class="line-numbers">175</span>    <span class="comment">// tag::sendPropertyName[]</span>
<span class="line-numbers">176</span>    <span class="annotation">@Outgoing</span>(<span class="string"><span class="delimiter">"</span><span class="content">requestSystemProperty</span><span class="delimiter">"</span></span>)
<span class="line-numbers">177</span>    <span class="comment">// tag::SPMHeader[]</span>
<span class="line-numbers">178</span>    <span class="directive">public</span> Publisher&lt;Message&lt;<span class="predefined-type">String</span>&gt;&gt; sendPropertyName() {
<span class="line-numbers">179</span>    <span class="comment">// end::SPMHeader[]</span>
<span class="line-numbers">180</span>        Flowable&lt;Message&lt;<span class="predefined-type">String</span>&gt;&gt; flowable = Flowable.create(emitter -&gt;
<span class="line-numbers">181</span>                <span class="local-variable">this</span>.propertyNameEmitter = emitter, BackpressureStrategy.BUFFER);
<span class="line-numbers">182</span>        <span class="keyword">return</span> flowable;
<span class="line-numbers">183</span>    }
<span class="line-numbers">184</span>    <span class="comment">// end::sendPropertyName[]</span>
<span class="line-numbers">185</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=sendPropertyName file=0">sendPropertyName()</code> method is updated to return a <code class="hotspot=SPMHeader file=0">Message&lt;String&gt;</code> instead of just a <code>String</code>. This return type allows the method to set a callback that runs after the outgoing message is acknowledged. In addition to updating the <code class="hotspot=sendPropertyName file=0">sendPropertyName()</code> method, the <code class="hotspot=propertyNameEmitter file=0">propertyNameEmitter</code> variable is updated to send a <code>Message&lt;String&gt;</code> type.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=updateSystemProperty file=0">updateSystemProperty()</code> method now returns a <code class="hotspot=USPHeader file=0">CompletionStage</code> object wrapped around a Response type. This return type allows for a response object to be returned after the outgoing message is acknowledged. The outgoing <code class="hotspot=message file=0">message</code> is created with the requested property name as the <code class="hotspot=payload file=0">payload</code> and an acknowledgment <code class="hotspot=acknowledgeAction file=0">callback</code> to execute an action after the message is acknowledged. The method creates a <code class="hotspot=CompletableFuture file=0">CompletableFuture</code> variable that returns a <code class="hotspot=returnResult file=0">200</code> response code after the variable is completed in the <code class="hotspot=acknowledgeAction file=0">callback</code> function.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-and-running-the-application">Building and running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Build the <code>system</code> and <code>inventory</code> microservices using Maven and then run them in Docker containers.</p>
</div>
<div class="paragraph">
<p>Start your Docker environment. Dockerfiles are provided for you to use.</p>
</div>
<div class="paragraph">
<p>To build the application, run the Maven <code>install</code> and <code>package</code> goals from the command-line session in the <code>start</code> directory:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl models install
mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the following commands to containerize the microservices:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker build -t system:1.0-SNAPSHOT system/.
docker build -t inventory:1.0-SNAPSHOT inventory/.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, use the provided script to start the application in Docker containers. The script creates a network for the containers to communicate with each other. It also creates containers for Kafka, Zookeeper, and the microservices in the project. For simplicity, the script starts one instance of the <code>system</code> service.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>.\scripts\startContainers.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./scripts/startContainers.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">Testing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The application might take some time to become available. After the application is up and running, you can access it by making a GET request to the <code>/systems</code> endpoint of the <code>inventory</code> service.</p>
</div>
<div class="paragraph">
<p>Visit the <a href="http://localhost:9085/health" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9085/health</a> URL to confirm that the <code>inventory</code> microservice is up and running.</p>
</div>
<div class="paragraph">
<p>When both the liveness and readiness health checks are up, go to the <a href="http://localhost:9085/inventory/systems" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9085/inventory/systems</a> URL to access the <code>inventory</code> microservice.  Look for the CPU <code>systemLoad</code> property for all the systems:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{
   "hostname":"30bec2b63a96",
   "systemLoad":1.44
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>system</code> service sends messages to the <code>inventory</code> service every 15 seconds. The <code>inventory</code> service processes and acknowledges each incoming message, ensuring that no <code>system</code> message is lost.</p>
</div>
<div class="paragraph">
<p>If you revisit the <a href="http://localhost:9085/inventory/systems" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9085/inventory/systems</a> URL after a while, you notice that the CPU <code>systemLoad</code> property for the systems changed.</p>
</div>
<div class="paragraph">
<p>Make a <code>PUT</code> request to the <code>http://localhost:9085/inventory/data</code> URL to add the value of a particular system property to the set of existing properties. For example, run the following <code>curl</code> command:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="paragraph">
<p>If <code>curl</code> is unavailable on your computer, use another client such as <a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">Postman</a>, which allows requests to be made with a graphical interface.</p>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>curl -X PUT -d "os.name" http://localhost:9085/inventory/data --header "Content-Type:text/plain"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>PUT</code> request with the <code>os.name</code> system property in the request body on the <code>http://localhost:9085/inventory/data</code> URL adds the <code>os.name</code> system property for your system. The <code>inventory</code> service sends a message that contains the requested system property to the <code>system</code> service. The <code>inventory</code> service then waits until the message is acknowledged before it sends a response back.</p>
</div>
<div class="paragraph">
<p>You see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>Request successful for the os.name property</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous example response is confirmation that the sent request message was acknowledged.</p>
</div>
<div class="paragraph">
<p>Revisit the <a href="http://localhost:9085/inventory/systems" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9085/inventory/systems</a> URL and see the <code>os.name</code> system property value is now
included with the previous values:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{
   "hostname":"30bec2b63a96",
   "os.name":"Linux",
   "systemLoad":1.44
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tearing-down-the-environment">Tearing down the environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finally, run the following script to stop the application:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>.\scripts\stopContainers.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./scripts/stopContainers.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You developed an application by using MicroProfile Reactive Messaging, Open Liberty, and Kafka.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links">Related Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Learn more about MicroProfile.</p>
</div>
<div class="paragraph">
<p><a href="https://download.eclipse.org/microprofile/microprofile-reactive-messaging-1.0/microprofile-reactive-messaging-spec.html" target="_blank" rel="noopener noreferrer">View the MicroProfile Reactive Messaging Specification</a></p>
</div>
<div class="paragraph">
<p><a href="https://download.eclipse.org/microprofile/microprofile-reactive-messaging-1.0/apidocs/" target="_blank" rel="noopener noreferrer">View the MicroProfile Reactive Messaging Javadoc</a></p>
</div>
<div class="paragraph">
<p><a href="https://openliberty.io/docs/latest/microprofile.html" target="_blank" rel="noopener">View the MicroProfile</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Acknowledging messages using MicroProfile Reactive Messaging <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-microprofile-reactive-messaging-acknowledgment/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-microprofile-reactive-messaging-acknowledgment/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-microprofile-reactive-messaging-acknowledgment/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-reactive-messaging.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Creating reactive Java microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/reactive-messaging-sse.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Streaming updates to a client using Server-Sent Events</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">30 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/reactive-service-testing.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Testing reactive Java microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-rest-client-async.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Consuming RESTful services asynchronously with template interfaces</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
