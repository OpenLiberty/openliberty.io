<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      Securing Java microservices with Eclipse MicroProfile JSON Web Token (MicroProfile JWT)
    
  </title>
  <meta name="description" content="A getting started tutorial and an example on how to secure Java microservices to authenticate users and authorize access by validating JSON Web Tokens (JWT) using Eclipse MicroProfile JWT.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/microprofile-jwt">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="Securing Java microservices with Eclipse MicroProfile JSON Web Token (MicroProfile JWT)" />
  <meta name="twitter:description" content="A getting started tutorial and an example on how to secure Java microservices to authenticate users and authorize access by validating JSON Web Tokens (JWT) using Eclipse MicroProfile JWT." />

  <meta property='og:title' content="Securing Java microservices with Eclipse MicroProfile JSON Web Token (MicroProfile JWT)" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="A getting started tutorial and an example on how to secure Java microservices to authenticate users and authorize access by validating JSON Web Tokens (JWT) using Eclipse MicroProfile JWT." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/microprofile-jwt" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li><a href="#what-youll-learn">What you’ll learn</a></li>
<li>
<a href="#getting-started">Getting started</a>
<ul class="sectlevel2">
<li><a href="#try-what-youll-build">Try what you’ll build</a></li>
</ul>
</li>
<li><a href="#creating-the-secure-system-service">Creating the secure system service</a></li>
<li><a href="#creating-a-client-to-access-the-secure-system-service">Creating a client to access the secure system service</a></li>
<li><a href="#configuring-microprofile-jwt">Configuring MicroProfile JWT</a></li>
<li><a href="#building-and-running-the-application">Building and running the application</a></li>
<li>
<a href="#testing-the-application">Testing the application</a>
<ul class="sectlevel2">
<li><a href="#running-the-tests">Running the tests</a></li>
</ul>
</li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">Securing microservices with JSON Web Tokens</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">25 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="https://openliberty.io/guides/microprofile-jwt.html" target="_blank" rel="noopener">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You’ll explore how to control user and role access to microservices with MicroProfile JSON Web Token (MicroProfile JWT).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will add token-based authentication mechanisms to authenticate, authorize, and verify users by implementing MicroProfile JWT in the <code>system</code> microservice.</p>
</div>
<div class="paragraph">
<p>A JSON Web Token (JWT) is a self-contained token that is designed to securely transmit information as a JSON object. The information in this JSON object is digitally signed and can be trusted and verified by the recipient.</p>
</div>
<div class="paragraph">
<p>For microservices, a token-based authentication mechanism offers a lightweight way for security controls and security tokens to propagate user identities across different services. JSON Web Token is becoming the most common token format because it follows well-defined and known standards.</p>
</div>
<div class="paragraph">
<p>MicroProfile JWT standards define the required format of JWT for authentication and authorization. The standards also map JWT claims to various Jakarta EE container APIs and make the set of claims available through getter methods.</p>
</div>
<div class="paragraph">
<p>In this guide, the application uses JWTs to authenticate a user, allowing them to make authorized requests to a secure backend service.</p>
</div>
<div class="paragraph">
<p>You will be working with two services, a <code>frontend</code> service and a secure <code>system</code> backend service. The <code>frontend</code> service logs a user in, builds a JWT, and makes authorized requests to the secure <code>system</code> service for JVM system properties. The following diagram depicts the application that is used in this guide:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/guide/microprofile-jwt/JWT_Diagram.png" alt="JWT frontend and system services" width="490" height="654">
</div>
</div>
<div class="paragraph">
<p>The user signs in to the <code>frontend</code> service with a username and a password, at which point a JWT is created. The <code>frontend</code> service then makes requests, with the JWT included, to the <code>system</code> backend service. The secure <code>system</code> service verifies the JWT to ensure that the request came from the authorized <code>frontend</code> service. After the JWT is validated, the information in the claims, such as the user’s role, can be trusted and used to determine which system properties the user has access to.</p>
</div>
<div class="paragraph">
<p>To learn more about JSON Web Tokens, check out the <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">jwt.io website</a>. If you want to learn more about how JWTs can be used for user authentication and authorization, check out the Open Liberty <a href="https://openliberty.io/docs/latest/single-sign-on.html" target="_blank" rel="noopener">Single Sign-on documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1 command">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to work through this guide is to clone the <a href="https://github.com/openliberty/guide-microprofile-jwt.git" target="_blank" rel="noopener noreferrer">Git repository</a> and use the projects that are provided inside:</p>
</div>
<div id="git_clone" class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-microprofile-jwt.git
cd guide-microprofile-jwt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory contains the starting project that you will build upon.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished project that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary <span class="prerequisites">prerequisites</span>.</p>
</div>
<div class="sect2">
<h3 id="try-what-youll-build">Try what you’ll build</h3>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished JWT security implementation for the services in the application. Try the finished application before you build your own.</p>
</div>
<div class="paragraph">
<p>To try out the application, run the following commands to navigate to the <code>finish/frontend</code> directory and deploy the <code>frontend</code> service to Open Liberty:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd finish/frontend
mvn liberty:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open another command-line session and run the following commands to navigate to the <code>finish/system</code> directory and deploy the <code>system</code> service to Open Liberty:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd finish/system
mvn liberty:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you see the following message in both command-line sessions, both of your services are ready:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>The defaultServer server is ready to run a smarter planet.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In your browser, go to the front-end web application endpoint at <a href="http://localhost:9090/login.jsf" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9090/login.jsf</a>. From here, you can log in to the application with the form-based login.</p>
</div>
<div class="paragraph">
<p>Log in with one of the following usernames and its corresponding password:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.0459%;">
<col style="width: 45.977%;">
<col style="width: 45.9771%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Username</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Role</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bob</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bobpwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">admin, user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alice</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">alicepwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">carl</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">carlpwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">user</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You’re redirected to a page that displays information that the front end requested from the <code>system</code> service, such as the system username. If you log in as an <code>admin</code>, you can also see the current OS. Click <code>Log Out</code> and log in as a <code>user</code>. You’ll see the message <code>You are not authorized to access this system property</code> because the <code>user</code> role doesn’t have sufficient privileges to view current OS information.</p>
</div>
<div class="paragraph">
<p>Additionally, the <code>groups</code> claim of the JWT is read by the <code>system</code> service and requested by the front end to be displayed.</p>
</div>
<div class="paragraph">
<p>You can try accessing these services without a JWT by going to the <a href="https://localhost:8443/system/properties/os" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:8443/system/properties/os</a> <code>system</code> endpoint in your browser. You get a blank screen and aren’t given access because you didn’t supply a valid JWT with the request. The following error also appears in the command-line session of the <code>system</code> service:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>[ERROR] CWWKS5522E: The MicroProfile JWT feature cannot perform authentication because a MicroProfile JWT cannot be found in the request.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you are done with the application, stop both the <code>frontend</code> and <code>system</code> services by pressing <code>CTRL+C</code> in the command-line sessions where you ran them. Alternatively, you can run the following goals from the <code>finish</code> directory in another command-line session:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl system liberty:stop
mvn -pl frontend liberty:stop</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-secure-system-service">Creating the secure system service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Navigate to the <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>When you run Open Liberty in <a href="https://openliberty.io/docs/latest/development-mode.html" target="_blank" rel="noopener">dev mode</a>, dev mode listens for file changes and automatically recompiles and deploys your updates whenever you save a new change. Run the following commands to navigate to the <code>frontend</code> directory and start the <code>frontend</code> service in dev mode:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd frontend
mvn liberty:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open another command-line session and run the following commands to navigate to the <code>system</code> directory and start the <code>system</code> service in dev mode:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd system
mvn liberty:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you see the following message, your Liberty instance is ready in dev mode:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>**************************************************************
*    Liberty is running in dev mode.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>system</code> service provides endpoints for the <code>frontend</code> service to use to request system properties. This service is secure and requires a valid JWT to be included in requests that are made to it. The claims in the JWT are used to determine what properties the user has access to.</p>
</div>
<div class="paragraph">
<p>Create the secure <code>system</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemResource</code> class.</mark>
<code>system/src/main/java/io/openliberty/guides/system/SystemResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2017, 2022 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">jakarta.json.JsonArray</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.RequestScoped</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.jwt.Claim</span>;
<span class="line-numbers">24</span>
<span class="line-numbers">25</span><span class="annotation">@RequestScoped</span>
<span class="line-numbers">26</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/properties</span><span class="delimiter">"</span></span>)
<span class="line-numbers">27</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemResource</span> {
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>    <span class="annotation">@Inject</span>
<span class="line-numbers">30</span>    <span class="comment">// tag::claim[]</span>
<span class="line-numbers">31</span>    <span class="annotation">@Claim</span>(<span class="string"><span class="delimiter">"</span><span class="content">groups</span><span class="delimiter">"</span></span>)
<span class="line-numbers">32</span>    <span class="comment">// end::claim[]</span>
<span class="line-numbers">33</span>    <span class="comment">// tag::rolesArray[]</span>
<span class="line-numbers">34</span>    <span class="directive">private</span> JsonArray roles;
<span class="line-numbers">35</span>    <span class="comment">// end::rolesArray[]</span>
<span class="line-numbers">36</span>
<span class="line-numbers">37</span>    <span class="annotation">@GET</span>
<span class="line-numbers">38</span>    <span class="comment">// tag::usernameEndpoint[]</span>
<span class="line-numbers">39</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/username</span><span class="delimiter">"</span></span>)
<span class="line-numbers">40</span>    <span class="comment">// end::usernameEndpoint[]</span>
<span class="line-numbers">41</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">42</span>    <span class="comment">// tag::rolesAllowedAdminUser1[]</span>
<span class="line-numbers">43</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> })
<span class="line-numbers">44</span>    <span class="comment">// end::rolesAllowedAdminUser1[]</span>
<span class="line-numbers">45</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getUsername() {
<span class="line-numbers">46</span>        <span class="keyword">return</span> <span class="predefined-type">System</span>.getProperties().getProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">47</span>    }
<span class="line-numbers">48</span>
<span class="line-numbers">49</span>    <span class="annotation">@GET</span>
<span class="line-numbers">50</span>    <span class="comment">// tag::osEndpoint[]</span>
<span class="line-numbers">51</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>)
<span class="line-numbers">52</span>    <span class="comment">// end::osEndpoint[]</span>
<span class="line-numbers">53</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">54</span>    <span class="comment">// tag::rolesAllowedAdmin[]</span>
<span class="line-numbers">55</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span> })
<span class="line-numbers">56</span>    <span class="comment">// end::rolesAllowedAdmin[]</span>
<span class="line-numbers">57</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOS() {
<span class="line-numbers">58</span>        <span class="keyword">return</span> <span class="predefined-type">System</span>.getProperties().getProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">59</span>    }
<span class="line-numbers">60</span>
<span class="line-numbers">61</span>    <span class="annotation">@GET</span>
<span class="line-numbers">62</span>    <span class="comment">// tag::rolesEndpoint[]</span>
<span class="line-numbers">63</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/jwtroles</span><span class="delimiter">"</span></span>)
<span class="line-numbers">64</span>    <span class="comment">// end::rolesEndpoint[]</span>
<span class="line-numbers">65</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">66</span>    <span class="comment">// tag::rolesAllowedAdminUser2[]</span>
<span class="line-numbers">67</span>    <span class="annotation">@RolesAllowed</span>({ <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span> })
<span class="line-numbers">68</span>    <span class="comment">// end::rolesAllowedAdminUser2[]</span>
<span class="line-numbers">69</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getRoles() {
<span class="line-numbers">70</span>        <span class="keyword">return</span> roles.toString();
<span class="line-numbers">71</span>    }
<span class="line-numbers">72</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class has role-based access control. The role names that are used in the <code class="hotspot=rolesAllowedAdminUser1 hotspot=rolesAllowedAdminUser2 hotspot=rolesAllowedAdmin file=0">@RolesAllowed</code> annotations are mapped to group names in the <code>groups</code> claim of the JWT, which results in an authorization decision wherever the security constraint is applied.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=usernameEndpoint file=0">/username</code> endpoint returns the system’s username and is annotated with the <code class="hotspot=rolesAllowedAdminUser1 file=0">@RolesAllowed({"admin, "user"})</code> annotation. Only authenticated users with the role of <code>admin</code> or <code>user</code> can access this endpoint.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=osEndpoint file=0">/os</code> endpoint returns the system’s current OS. Here, the <code class="hotspot=rolesAllowedAdmin file=0">@RolesAllowed</code> annotation is limited to <code>admin</code>, meaning that only authenticated users with the role of <code>admin</code> are able to access the endpoint.</p>
</div>
<div class="paragraph">
<p>While the <code class="hotspot=rolesAllowedAdminUser1 hotspot=rolesAllowedAdminUser2 hotspot=rolesAllowedAdmin file=0">@RolesAllowed</code> annotation automatically reads from the <code>groups</code> claim of the JWT to make an authorization decision, you can also manually access the claims of the JWT by using the <code class="hotspot=claim file=0">@Claim</code> annotation. In this case, the <code>groups</code> claim is injected into the <code class="hotspot=rolesArray file=0">roles</code> JSON array. The roles that are parsed from the <code>groups</code> claim of the JWT are then exposed back to the front end at the <code class="hotspot=rolesEndpoint file=0">/jwtroles</code> endpoint. To read more about different claims and ways to access them, check out the <a href="https://github.com/eclipse/microprofile-jwt-auth/blob/master/spec/src/main/asciidoc/interoperability.asciidoc" target="_blank" rel="noopener noreferrer">MicroProfile JWT documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-client-to-access-the-secure-system-service">Creating a client to access the secure system service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a RESTful client interface for the <code>frontend</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemClient</code> class.</mark>
<code>frontend/src/main/java/io/openliberty/guides/frontend/client/SystemClient.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemClient.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2020, 2022 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.frontend.client</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.RequestScoped</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.HeaderParam</span>;
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.inject.RegisterRestClient</span>;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span><span class="comment">// tag::systemClient[]</span>
<span class="line-numbers">24</span><span class="annotation">@RegisterRestClient</span>(baseUri = <span class="string"><span class="delimiter">"</span><span class="content">https://localhost:8443/system</span><span class="delimiter">"</span></span>)
<span class="line-numbers">25</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/properties</span><span class="delimiter">"</span></span>)
<span class="line-numbers">26</span><span class="annotation">@RequestScoped</span>
<span class="line-numbers">27</span><span class="directive">public</span> <span class="type">interface</span> <span class="class">SystemClient</span> <span class="directive">extends</span> AutoCloseable {
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>    <span class="annotation">@GET</span>
<span class="line-numbers">30</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>)
<span class="line-numbers">31</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">32</span>    <span class="comment">// tag::headerParam1[]</span>
<span class="line-numbers">33</span>    <span class="predefined-type">String</span> getOS(<span class="annotation">@HeaderParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">Authorization</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> authHeader);
<span class="line-numbers">34</span>    <span class="comment">// end::headerParam1[]</span>
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>    <span class="annotation">@GET</span>
<span class="line-numbers">37</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/username</span><span class="delimiter">"</span></span>)
<span class="line-numbers">38</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">39</span>    <span class="comment">// tag::headerParam2[]</span>
<span class="line-numbers">40</span>    <span class="predefined-type">String</span> getUsername(<span class="annotation">@HeaderParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">Authorization</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> authHeader);
<span class="line-numbers">41</span>    <span class="comment">// end::headerParam2[]</span>
<span class="line-numbers">42</span>
<span class="line-numbers">43</span>    <span class="annotation">@GET</span>
<span class="line-numbers">44</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/jwtroles</span><span class="delimiter">"</span></span>)
<span class="line-numbers">45</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">46</span>    <span class="comment">// tag::headerParam3[]</span>
<span class="line-numbers">47</span>    <span class="predefined-type">String</span> getJwtRoles(<span class="annotation">@HeaderParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">Authorization</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> authHeader);
<span class="line-numbers">48</span>    <span class="comment">// end::headerParam3[]</span>
<span class="line-numbers">49</span>}
<span class="line-numbers">50</span><span class="comment">// end::systemClient[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface declares methods for accessing each of the endpoints that were
previously set up in the <code>system</code> service.</p>
</div>
<div class="paragraph">
<p>The MicroProfile Rest Client feature automatically builds and generates a client implementation based on what is defined in the <code class="hotspot=systemClient file=0">SystemClient</code> interface. You don’t need to set up the client and connect with the remote service.</p>
</div>
<div class="paragraph">
<p>As discussed, the <code>system</code> service is secured and requests made to it must include a valid JWT in the <code>Authorization</code> header. The <code class="hotspot=headerParam1 hotspot=headerParam2 hotspot=headerParam3 file=0">@HeaderParam</code> annotations include the JWT by specifying that the value of the <code>String authHeader</code> parameter, which contains the JWT, be used as the value for the <code>Authorization</code> header. This header is included in all of the requests that are made to the <code>system</code> service through this client.</p>
</div>
<div class="paragraph">
<p>Create the application bean that the front-end UI uses to request data.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>ApplicationBean</code> class.</mark>
<code>frontend/src/main/java/io/openliberty/guides/frontend/ApplicationBean.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>ApplicationBean.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2020, 2022 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.frontend</span>;
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.inject.RestClient</span>;
<span class="line-numbers">19</span>
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.frontend.client.SystemClient</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.frontend.util.SessionUtils</span>;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>
<span class="line-numbers">24</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers">25</span><span class="annotation">@Named</span>
<span class="line-numbers">26</span><span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationBean</span> {
<span class="line-numbers">27</span>
<span class="line-numbers">28</span>    <span class="comment">// tag::restClient[]</span>
<span class="line-numbers">29</span>    <span class="annotation">@Inject</span>
<span class="line-numbers">30</span>    <span class="annotation">@RestClient</span>
<span class="line-numbers">31</span>    <span class="directive">private</span> SystemClient defaultRestClient;
<span class="line-numbers">32</span>    <span class="comment">// end::restClient[]</span>
<span class="line-numbers">33</span>
<span class="line-numbers">34</span>    <span class="comment">// tag::getJwt[]</span>
<span class="line-numbers">35</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJwt() {
<span class="line-numbers">36</span>        <span class="predefined-type">String</span> jwtTokenString = SessionUtils.getJwtToken();
<span class="line-numbers">37</span>        <span class="predefined-type">String</span> authHeader = <span class="string"><span class="delimiter">"</span><span class="content">Bearer </span><span class="delimiter">"</span></span> + jwtTokenString;
<span class="line-numbers">38</span>        <span class="keyword">return</span> authHeader;
<span class="line-numbers">39</span>    }
<span class="line-numbers">40</span>    <span class="comment">// end::getJwt[]</span>
<span class="line-numbers">41</span>
<span class="line-numbers">42</span>    <span class="comment">// tag::getOs[]</span>
<span class="line-numbers">43</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getOs() {
<span class="line-numbers">44</span>        <span class="predefined-type">String</span> authHeader = getJwt();
<span class="line-numbers">45</span>        <span class="predefined-type">String</span> os;
<span class="line-numbers">46</span>        <span class="keyword">try</span> {
<span class="line-numbers">47</span>            <span class="comment">// tag::authHeader1[]</span>
<span class="line-numbers">48</span>            os = defaultRestClient.getOS(authHeader);
<span class="line-numbers">49</span>            <span class="comment">// end::authHeader1[]</span>
<span class="line-numbers">50</span>        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
<span class="line-numbers">51</span>            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">You are not authorized to access this system property</span><span class="delimiter">"</span></span>;
<span class="line-numbers">52</span>        }
<span class="line-numbers">53</span>        <span class="keyword">return</span> os;
<span class="line-numbers">54</span>    }
<span class="line-numbers">55</span>    <span class="comment">// end::getOs[]</span>
<span class="line-numbers">56</span>
<span class="line-numbers">57</span>    <span class="comment">// tag::getUsername[]</span>
<span class="line-numbers">58</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getUsername() {
<span class="line-numbers">59</span>        <span class="predefined-type">String</span> authHeader = getJwt();
<span class="line-numbers">60</span>        <span class="comment">// tag::authHeader2[]</span>
<span class="line-numbers">61</span>        <span class="keyword">return</span> defaultRestClient.getUsername(authHeader);
<span class="line-numbers">62</span>        <span class="comment">// end::authHeader2[]</span>
<span class="line-numbers">63</span>    }
<span class="line-numbers">64</span>    <span class="comment">// end::getUsername[]</span>
<span class="line-numbers">65</span>
<span class="line-numbers">66</span>    <span class="comment">// tag::getJwtRoles[]</span>
<span class="line-numbers">67</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getJwtRoles() {
<span class="line-numbers">68</span>        <span class="predefined-type">String</span> authHeader = getJwt();
<span class="line-numbers">69</span>        <span class="comment">// tag::authHeader3[]</span>
<span class="line-numbers">70</span>        <span class="keyword">return</span> defaultRestClient.getJwtRoles(authHeader);
<span class="line-numbers">71</span>        <span class="comment">// end::authHeader3[]</span>
<span class="line-numbers">72</span>    }
<span class="line-numbers">73</span>    <span class="comment">// end::getJwtRoles[]</span>
<span class="line-numbers">74</span>
<span class="line-numbers">75</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application bean is used to populate the table in the front end by making requests for data through the <code class="hotspot=restClient file=1">defaultRestClient</code>, which is an injected instance of the <code class="hotspot=systemClient file=0">SystemClient</code> class that you created. The <code class="hotspot=getOs file=1">getOs()</code>, <code class="hotspot=getUsername file=1">getUsername()</code>, and <code class="hotspot=getJwtRoles file=1">getJwtRoles()</code> methods call their associated methods of the <code>SystemClient</code> class with the <code class="hotspot=authHeader1 hotspot=authHeader2 hotspot=authHeader3 file=1">authHeader</code> passed in as a parameter. The <code>authHeader</code> is a string that consists of the JWT with <code>Bearer</code> prefixed to it. The <code>authHeader</code> is included in the <code>Authorization</code> header of the subsequent requests that are made by the <code>defaultRestClient</code> instance.</p>
</div>
<div class="paragraph">
<p>LoginBean.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2018, 2022 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.frontend</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.Set</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.HashSet</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">jakarta.servlet.ServletException</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServletRequest</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpSession</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">com.ibm.websphere.security.jwt.JwtBuilder</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">com.ibm.websphere.security.jwt.Claims</span>;
<span class="line-numbers"> 24</span>
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.frontend.util.SessionUtils</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="comment">// tag::loginBean[]</span>
<span class="line-numbers"> 28</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 29</span><span class="annotation">@Named</span>
<span class="line-numbers"> 30</span><span class="directive">public</span> <span class="type">class</span> <span class="class">LoginBean</span> {
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="predefined-type">String</span> username;
<span class="line-numbers"> 33</span>    <span class="directive">private</span> <span class="predefined-type">String</span> password;
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span>    <span class="directive">public</span> <span class="type">void</span> setUsername(<span class="predefined-type">String</span> username) {
<span class="line-numbers"> 36</span>        <span class="local-variable">this</span>.username = username;
<span class="line-numbers"> 37</span>    }
<span class="line-numbers"> 38</span>
<span class="line-numbers"> 39</span>    <span class="directive">public</span> <span class="type">void</span> setPassword(<span class="predefined-type">String</span> password) {
<span class="line-numbers"> 40</span>        <span class="local-variable">this</span>.password = password;
<span class="line-numbers"> 41</span>    }
<span class="line-numbers"> 42</span>
<span class="line-numbers"> 43</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getUsername() {
<span class="line-numbers"> 44</span>        <span class="keyword">return</span> username;
<span class="line-numbers"> 45</span>    }
<span class="line-numbers"> 46</span>
<span class="line-numbers"> 47</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getPassword() {
<span class="line-numbers"> 48</span>        <span class="keyword">return</span> password;
<span class="line-numbers"> 49</span>    }
<span class="line-numbers"> 50</span>
<span class="line-numbers"> 51</span>    <span class="comment">// tag::doLogin[]</span>
<span class="line-numbers"> 52</span>    <span class="directive">public</span> <span class="predefined-type">String</span> doLogin() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 53</span>        HttpServletRequest request = SessionUtils.getRequest();
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>        <span class="keyword">try</span> {
<span class="line-numbers"> 56</span>            request.logout();
<span class="line-numbers"> 57</span>            request.login(<span class="local-variable">this</span>.username, <span class="local-variable">this</span>.password);
<span class="line-numbers"> 58</span>        } <span class="keyword">catch</span> (ServletException e) {
<span class="line-numbers"> 59</span>            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">Login failed.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 60</span>            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">error.jsf</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 61</span>        }
<span class="line-numbers"> 62</span>
<span class="line-numbers"> 63</span>        <span class="predefined-type">String</span> remoteUser = request.getRemoteUser();
<span class="line-numbers"> 64</span>        <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; roles = getRoles(request);
<span class="line-numbers"> 65</span>        <span class="keyword">if</span> (remoteUser != <span class="predefined-constant">null</span> &amp;&amp; remoteUser.equals(username)) {
<span class="line-numbers"> 66</span>            <span class="predefined-type">String</span> jwt = buildJwt(username, roles);
<span class="line-numbers"> 67</span>            HttpSession ses = request.getSession();
<span class="line-numbers"> 68</span>            <span class="keyword">if</span> (ses == <span class="predefined-constant">null</span>) {
<span class="line-numbers"> 69</span>                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">Session timed out.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 70</span>            } <span class="keyword">else</span> {
<span class="line-numbers"> 71</span>                <span class="comment">// tag::setAttribute[]</span>
<span class="line-numbers"> 72</span>                ses.setAttribute(<span class="string"><span class="delimiter">"</span><span class="content">jwt</span><span class="delimiter">"</span></span>, jwt);
<span class="line-numbers"> 73</span>                <span class="comment">// end::setAttribute[]</span>
<span class="line-numbers"> 74</span>            }
<span class="line-numbers"> 75</span>        } <span class="keyword">else</span> {
<span class="line-numbers"> 76</span>            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">Failed to update JWT in session.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 77</span>        }
<span class="line-numbers"> 78</span>        <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">application.jsf?faces-redirect=true</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 79</span>    }
<span class="line-numbers"> 80</span>    <span class="comment">// end::doLogin[]</span>
<span class="line-numbers"> 81</span>    <span class="comment">// tag::buildJwt[]</span>
<span class="line-numbers"> 82</span>
<span class="line-numbers"> 83</span>  <span class="directive">private</span> <span class="predefined-type">String</span> buildJwt(<span class="predefined-type">String</span> userName, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; roles) <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 84</span>        <span class="comment">// tag::jwtBuilder[]</span>
<span class="line-numbers"> 85</span>        <span class="keyword">return</span> JwtBuilder.create(<span class="string"><span class="delimiter">"</span><span class="content">jwtFrontEndBuilder</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 86</span>        <span class="comment">// end::jwtBuilder[]</span>
<span class="line-numbers"> 87</span>                         .claim(Claims.SUBJECT, userName)
<span class="line-numbers"> 88</span>                         .claim(<span class="string"><span class="delimiter">"</span><span class="content">upn</span><span class="delimiter">"</span></span>, userName)
<span class="line-numbers"> 89</span>                         <span class="comment">// tag::claim[]</span>
<span class="line-numbers"> 90</span>                         .claim(<span class="string"><span class="delimiter">"</span><span class="content">groups</span><span class="delimiter">"</span></span>, roles.toArray(<span class="keyword">new</span> <span class="predefined-type">String</span>[roles.size()]))
<span class="line-numbers"> 91</span>                         .claim(<span class="string"><span class="delimiter">"</span><span class="content">aud</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">systemService</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 92</span>                         <span class="comment">// end::claim[]</span>
<span class="line-numbers"> 93</span>                         .buildJwt()
<span class="line-numbers"> 94</span>                         .compact();
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>    }
<span class="line-numbers"> 97</span>    <span class="comment">// end::buildJwt[]</span>
<span class="line-numbers"> 98</span>
<span class="line-numbers"> 99</span>    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getRoles(HttpServletRequest request) {
<span class="line-numbers">100</span>        <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; roles = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;<span class="predefined-type">String</span>&gt;();
<span class="line-numbers">101</span>        <span class="type">boolean</span> isAdmin = request.isUserInRole(<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>);
<span class="line-numbers">102</span>        <span class="type">boolean</span> isUser = request.isUserInRole(<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span>);
<span class="line-numbers">103</span>        <span class="keyword">if</span> (isAdmin) {
<span class="line-numbers">104</span>            roles.add(<span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>);
<span class="line-numbers">105</span>        }
<span class="line-numbers">106</span>        <span class="keyword">if</span> (isUser) {
<span class="line-numbers">107</span>            roles.add(<span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span>);
<span class="line-numbers">108</span>        }
<span class="line-numbers">109</span>        <span class="keyword">return</span> roles;
<span class="line-numbers">110</span>    }
<span class="line-numbers">111</span>}
<span class="line-numbers">112</span><span class="comment">// end::loginBean[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JWT for these requests is retrieved from the session attributes with the <code class="hotspot=getJwt file=1">getJwt()</code> method. The JWT is stored in the session attributes by the provided <code class="hotspot file=2">LoginBean</code> class. When the user logs in to the front end, the <code class="hotspot=doLogin file=2">doLogin()</code> method is called and builds the JWT. Then, the <code class="hotspot=setAttribute file=2">setAttribute()</code> method stores it as an <code>HttpSession</code> attribute. The JWT is built by using the <code class="hotspot=jwtBuilder file=2">JwtBuilder</code> APIs in the <code class="hotspot=buildJwt file=2">buildJwt()</code> method. You can see that the <code class="hotspot=claim file=2">claim()</code> method is being used to set the <code>groups</code> and the <code>aud</code> claims of the token. The <code>groups</code> claim is used to provide the role-based access that you implemented. The <code>aud</code> claim is used to specify the audience that the JWT is intended for.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-microprofile-jwt">Configuring MicroProfile JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure the <code>mpJwt</code> feature in the <code>microprofile-config.properties</code> file for the <code>system</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the microprofile-config.properties file.</mark>
<code>system/src/main/webapp/META-INF/microprofile-config.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>microprofile-config.properties</p>
</div>
<div class="listingblock code_column hide_tags=propagateHeaders">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"><span class="line-numbers"> 1</span># tag::issuer[]
<span class="line-numbers"> 2</span>mp.jwt.verify.issuer=http://openliberty.io
<span class="line-numbers"> 3</span># end::issuer[]
<span class="line-numbers"> 4</span># tag::header[]
<span class="line-numbers"> 5</span>mp.jwt.token.header=Authorization
<span class="line-numbers"> 6</span># end::header[]
<span class="line-numbers"> 7</span># tag::cookie[]
<span class="line-numbers"> 8</span>mp.jwt.token.cookie=Bearer
<span class="line-numbers"> 9</span># end::cookie[]
<span class="line-numbers">10</span># tag::audiences[]
<span class="line-numbers">11</span>mp.jwt.verify.audiences=systemService, adminServices
<span class="line-numbers">12</span># end::audiences[]
<span class="line-numbers">13</span># tag::location[]
<span class="line-numbers">14</span># mp.jwt.decrypt.key.location=privatekey.pem
<span class="line-numbers">15</span># end::location[]
<span class="line-numbers">16</span># tag::algorithm[]
<span class="line-numbers">17</span>mp.jwt.verify.publickey.algorithm=RS256
<span class="line-numbers">18</span># end::algorithm[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table breaks down some of the properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=issuer file=0">mp.jwt.verify.issuer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the expected value of the issuer claim on an incoming JWT. Incoming JWTs with an issuer claim that’s different from this expected value aren’t considered valid.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=header file=0">mp.jwt.token.header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this property, you can control the HTTP request header, which is expected to contain a JWT. You can either specify Authorization, by default, or the Cookie values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=cookie file=0">mp.jwt.token.cookie</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the cookie, which is expected to contain a JWT token. The default value is Bearer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=audiences file=0">mp.jwt.verify.audiences</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this property, you can create a list of allowable audience (aud) values. At least one of these values must be found in the claim. Previously, this configuration was included in the <code>server.xml</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=location file=0">mp.jwt.decrypt.key.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this property, you can specify the location of the Key Management key. It is a Private key that is used to decrypt the Content Encryption key, which is then used to decrypt the JWE ciphertext. This private key must correspond to the public key that is used to encrypt the Content Encryption key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="hotspot=algorithm file=0">mp.jwt.verify.publickey.algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this property, you can control the Public Key Signature Algorithm that is supported by the MicroProfile JWT endpoint. The default value is RS256. Previously, this configuration was included in the <code>server.xml</code> file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about these and other JWT properties, see the <a href="https://openliberty.io/docs/latest/microprofile-config-properties.html#jwt" target="_blank" rel="noopener">MicroProfile Config properties for MicroProfile JSON Web Token documentation</a>.</p>
</div>
<div class="paragraph">
<p>Next, add the MicroProfile JSON Web Token feature to the Liberty <code>server.xml</code> configuration file for the <code>system</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the system <code>server.xml</code> configuration file.</mark>
<code>system/src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Sample Liberty server</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 2</span>
<span class="line-numbers"> 3</span>  <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;feature&gt;</span>restfulWS-3.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 5</span>    <span class="tag">&lt;feature&gt;</span>jsonb-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>    <span class="tag">&lt;feature&gt;</span>jsonp-2.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>    <span class="tag">&lt;feature&gt;</span>cdi-4.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>    <span class="tag">&lt;feature&gt;</span>mpConfig-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 9</span>    <span class="tag">&lt;feature&gt;</span>mpRestClient-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">10</span>    <span class="tag">&lt;feature&gt;</span>appSecurity-5.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">11</span>    <span class="tag">&lt;feature&gt;</span>servlet-6.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">12</span>    <span class="comment">&lt;!-- tag::mpJwt[] --&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;feature&gt;</span>mpJwt-2.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">14</span>    <span class="comment">&lt;!-- end::mpJwt[] --&gt;</span>
<span class="line-numbers">15</span>  <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>  <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">8080</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">18</span>  <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">8443</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">19</span>
<span class="line-numbers">20</span>  <span class="tag">&lt;keyStore</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultKeyStore</span><span class="delimiter">"</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">"</span><span class="content">secret</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">21</span>  
<span class="line-numbers">22</span>  <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">"</span><span class="content">*</span><span class="delimiter">"</span></span> <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span> <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span>
<span class="line-numbers">23</span>                <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">24</span>                 
<span class="line-numbers">25</span>  <span class="tag">&lt;webApplication</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">system.war</span><span class="delimiter">"</span></span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">26</span>
<span class="line-numbers">27</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=mpJwt file=1">mpJwt</code> feature adds the libraries that are required for MicroProfile JWT implementation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-and-running-the-application">Building and running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because you are running the <code>frontend</code> and <code>system</code> services in dev mode, the changes that you made were automatically picked up. You’re now ready to check out your application in your browser.</p>
</div>
<div class="paragraph">
<p>In your browser, go to the front-end web application endpoint at <a href="http://localhost:9090/login.jsf" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9090/login.jsf</a>. Log in with one of the following usernames and its corresponding password:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.0459%;">
<col style="width: 45.977%;">
<col style="width: 45.9771%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Username</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Role</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bob</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bobpwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">admin, user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alice</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">alicepwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">carl</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">carlpwd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">user</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After you log in as an <code>admin</code>, you can see the information that’s retrieved from the <code>system</code> service. Click <code>Log Out</code> and log in as a <code>user</code>. With successfully implemented role-based access in the application, if you log in as a <code>user</code> role, you don’t have access to the OS property.</p>
</div>
<div class="paragraph">
<p>You can also see the value of the <code>groups</code> claim in the row with the <code>Roles:</code> label. These roles are read from the JWT and sent back to the front end to be displayed.</p>
</div>
<div class="paragraph">
<p>You can check that the <code>system</code> service is secured against unauthenticated requests by going to the <a href="https://localhost:8443/system/properties/os" target="_blank" rel="noopener noreferrer" class="notranslate">https://localhost:8443/system/properties/os</a> <code>system</code> endpoint in your browser.</p>
</div>
<div class="paragraph">
<p>In the front end, you see your JWT displayed in the row with the <code>JSON Web Token</code> label.</p>
</div>
<div class="paragraph">
<p>To see the specific information that this JWT holds, you can enter it into the token reader on the <a href="https://JWT.io" target="_blank" rel="noopener noreferrer">JWT.io website</a>. The token reader shows you the header, which contains information about the JWT, as shown in the following example:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{
  "kid": "NPzyG3ZMzljUwQgbzi44",
  "typ": "JWT",
  "alg": "RS256"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The token reader also shows you the payload, which contains the claims information:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{
  "token_type": "Bearer",
  "sub": "bob",
  "upn": "bob",
  "groups": [ "admin", "user" ],
  "iss": "http://openliberty.io",
  "exp": 1596723489,
  "iat": 1596637089
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can learn more about these claims in the <a href="https://github.com/eclipse/microprofile-jwt-auth/blob/master/spec/src/main/asciidoc/interoperability.asciidoc" target="_blank" rel="noopener noreferrer">MicroProfile JWT documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">Testing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can manually check that the <code>system</code> service is secure by making requests to each of the endpoints with and without valid JWTs. However, automated tests are a much better approach because they are more reliable and trigger a failure if a breaking change is introduced.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemEndpointIT</code> class.</mark>
<code>system/src/test/java/it/io/openliberty/guides/system/SystemEndpointIT.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemEndpointIT.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2020, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.Client</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.Invocation.Builder</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.HttpHeaders</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="line-numbers"> 24</span>
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">it.io.openliberty.guides.system.util.JwtBuilder</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemEndpointIT</span> {
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span>    <span class="directive">static</span> <span class="predefined-type">String</span> authHeaderAdmin;
<span class="line-numbers"> 30</span>    <span class="directive">static</span> <span class="predefined-type">String</span> authHeaderUser;
<span class="line-numbers"> 31</span>    <span class="directive">static</span> <span class="predefined-type">String</span> urlOS;
<span class="line-numbers"> 32</span>    <span class="directive">static</span> <span class="predefined-type">String</span> urlUsername;
<span class="line-numbers"> 33</span>    <span class="directive">static</span> <span class="predefined-type">String</span> urlRoles;
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span>    <span class="annotation">@BeforeAll</span>
<span class="line-numbers"> 36</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setup() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 37</span>        <span class="predefined-type">String</span> urlBase = <span class="string"><span class="delimiter">"</span><span class="content">http://</span><span class="delimiter">"</span></span> + <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 38</span>                 + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">http.port</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 39</span>                 + <span class="string"><span class="delimiter">"</span><span class="content">/system/properties</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 40</span>        urlOS = urlBase + <span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 41</span>        urlUsername = urlBase + <span class="string"><span class="delimiter">"</span><span class="content">/username</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 42</span>        urlRoles = urlBase + <span class="string"><span class="delimiter">"</span><span class="content">/jwtroles</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 43</span>
<span class="line-numbers"> 44</span>        authHeaderAdmin = <span class="string"><span class="delimiter">"</span><span class="content">Bearer </span><span class="delimiter">"</span></span> + <span class="keyword">new</span> JwtBuilder().createAdminJwt(<span class="string"><span class="delimiter">"</span><span class="content">testUser</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 45</span>        authHeaderUser = <span class="string"><span class="delimiter">"</span><span class="content">Bearer </span><span class="delimiter">"</span></span> + <span class="keyword">new</span> JwtBuilder().createUserJwt(<span class="string"><span class="delimiter">"</span><span class="content">testUser</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 46</span>    }
<span class="line-numbers"> 47</span>
<span class="line-numbers"> 48</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 49</span>    <span class="comment">// tag::os[]</span>
<span class="line-numbers"> 50</span>    <span class="directive">public</span> <span class="type">void</span> testOSEndpoint() {
<span class="line-numbers"> 51</span>        <span class="comment">// tag::adminRequest1[]</span>
<span class="line-numbers"> 52</span>        Response response = makeRequest(urlOS, authHeaderAdmin);
<span class="line-numbers"> 53</span>        <span class="comment">// end::adminRequest1[]</span>
<span class="line-numbers"> 54</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 55</span>                    <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlOS);
<span class="line-numbers"> 56</span>        assertEquals(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>), response.readEntity(<span class="predefined-type">String</span>.class),
<span class="line-numbers"> 57</span>                <span class="string"><span class="delimiter">"</span><span class="content">The system property for the local and remote JVM should match</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>        <span class="comment">// tag::userRequest1[]</span>
<span class="line-numbers"> 60</span>        response = makeRequest(urlOS, authHeaderUser);
<span class="line-numbers"> 61</span>        <span class="comment">// end::userRequest1[]</span>
<span class="line-numbers"> 62</span>        assertEquals(<span class="integer">403</span>, response.getStatus(),
<span class="line-numbers"> 63</span>                    <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlOS);
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>        <span class="comment">// tag::nojwtRequest1[]</span>
<span class="line-numbers"> 66</span>        response = makeRequest(urlOS, <span class="predefined-constant">null</span>);
<span class="line-numbers"> 67</span>        <span class="comment">// end::nojwtRequest1[]</span>
<span class="line-numbers"> 68</span>        assertEquals(<span class="integer">401</span>, response.getStatus(),
<span class="line-numbers"> 69</span>                    <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlOS);
<span class="line-numbers"> 70</span>
<span class="line-numbers"> 71</span>        response.close();
<span class="line-numbers"> 72</span>    }
<span class="line-numbers"> 73</span>    <span class="comment">// end::os[]</span>
<span class="line-numbers"> 74</span>
<span class="line-numbers"> 75</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 76</span>    <span class="comment">// tag::username[]</span>
<span class="line-numbers"> 77</span>    <span class="directive">public</span> <span class="type">void</span> testUsernameEndpoint() {
<span class="line-numbers"> 78</span>        <span class="comment">// tag::adminRequest2[]</span>
<span class="line-numbers"> 79</span>        Response response = makeRequest(urlUsername, authHeaderAdmin);
<span class="line-numbers"> 80</span>        <span class="comment">// end::adminRequest2[]</span>
<span class="line-numbers"> 81</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 82</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlUsername);
<span class="line-numbers"> 83</span>
<span class="line-numbers"> 84</span>        <span class="comment">// tag::userRequest2[]</span>
<span class="line-numbers"> 85</span>        response = makeRequest(urlUsername, authHeaderUser);
<span class="line-numbers"> 86</span>        <span class="comment">// end::userRequest2[]</span>
<span class="line-numbers"> 87</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 88</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlUsername);
<span class="line-numbers"> 89</span>
<span class="line-numbers"> 90</span>        <span class="comment">// tag::nojwtRequest2[]</span>
<span class="line-numbers"> 91</span>        response = makeRequest(urlUsername, <span class="predefined-constant">null</span>);
<span class="line-numbers"> 92</span>        <span class="comment">// end::nojwtRequest2[]</span>
<span class="line-numbers"> 93</span>        assertEquals(<span class="integer">401</span>, response.getStatus(),
<span class="line-numbers"> 94</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlUsername);
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>        response.close();
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::username[]</span>
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="annotation">@Test</span>
<span class="line-numbers">101</span>    <span class="comment">// tag::roles[]</span>
<span class="line-numbers">102</span>    <span class="directive">public</span> <span class="type">void</span> testRolesEndpoint() {
<span class="line-numbers">103</span>        <span class="comment">// tag::adminRequest3[]</span>
<span class="line-numbers">104</span>        Response response = makeRequest(urlRoles, authHeaderAdmin);
<span class="line-numbers">105</span>        <span class="comment">// end::adminRequest3[]</span>
<span class="line-numbers">106</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers">107</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlRoles);
<span class="line-numbers">108</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">[</span><span class="char">\"</span><span class="content">admin</span><span class="char">\"</span><span class="content">,</span><span class="char">\"</span><span class="content">user</span><span class="char">\"</span><span class="content">]</span><span class="delimiter">"</span></span>, response.readEntity(<span class="predefined-type">String</span>.class),
<span class="line-numbers">109</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect groups claim in token </span><span class="delimiter">"</span></span> + urlRoles);
<span class="line-numbers">110</span>
<span class="line-numbers">111</span>        <span class="comment">// tag::userRequest3[]</span>
<span class="line-numbers">112</span>        response = makeRequest(urlRoles, authHeaderUser);
<span class="line-numbers">113</span>        <span class="comment">// end::userRequest3[]</span>
<span class="line-numbers">114</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers">115</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlRoles);
<span class="line-numbers">116</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">[</span><span class="char">\"</span><span class="content">user</span><span class="char">\"</span><span class="content">]</span><span class="delimiter">"</span></span>, response.readEntity(<span class="predefined-type">String</span>.class),
<span class="line-numbers">117</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect groups claim in token </span><span class="delimiter">"</span></span> + urlRoles);
<span class="line-numbers">118</span>
<span class="line-numbers">119</span>        <span class="comment">// tag::nojwtRequest3[]</span>
<span class="line-numbers">120</span>        response = makeRequest(urlRoles, <span class="predefined-constant">null</span>);
<span class="line-numbers">121</span>        <span class="comment">// end::nojwtRequest3[]</span>
<span class="line-numbers">122</span>        assertEquals(<span class="integer">401</span>, response.getStatus(),
<span class="line-numbers">123</span>                <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + urlRoles);
<span class="line-numbers">124</span>
<span class="line-numbers">125</span>        response.close();
<span class="line-numbers">126</span>    }
<span class="line-numbers">127</span>    <span class="comment">// end::roles[]</span>
<span class="line-numbers">128</span>
<span class="line-numbers">129</span>    <span class="directive">private</span> Response makeRequest(<span class="predefined-type">String</span> url, <span class="predefined-type">String</span> authHeader) {
<span class="line-numbers">130</span>        <span class="keyword">try</span> (Client client = ClientBuilder.newClient()) {
<span class="line-numbers">131</span>            Builder builder = client.target(url).request();
<span class="line-numbers">132</span>            builder.header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON);
<span class="line-numbers">133</span>            <span class="keyword">if</span> (authHeader != <span class="predefined-constant">null</span>) {
<span class="line-numbers">134</span>            builder.header(HttpHeaders.AUTHORIZATION, authHeader);
<span class="line-numbers">135</span>            }
<span class="line-numbers">136</span>            Response response = builder.get();
<span class="line-numbers">137</span>            <span class="keyword">return</span> response;
<span class="line-numbers">138</span>        }
<span class="line-numbers">139</span>    }
<span class="line-numbers">140</span>
<span class="line-numbers">141</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=os file=0">testOSEndpoint()</code>, <code class="hotspot=username file=0">testUsernameEndpoint()</code>, and <code class="hotspot=roles file=0">testRolesEndpoint()</code> tests test the <code>/os</code>, <code>/username</code>, and <code>/roles</code> endpoints.</p>
</div>
<div class="paragraph">
<p>Each test makes three requests to its associated endpoint. The first <code class="hotspot=adminRequest1 hotspot=adminRequest2 hotspot=adminRequest3 file=0">makeRequest()</code> call has a JWT with the <code>admin</code> role. The second <code class="hotspot=userRequest1 hotspot=userRequest2 hotspot=userRequest3 file=0">makeRequest()</code> call has a JWT with the <code>user</code> role. The third <code class="hotspot=nojwtRequest1 hotspot=nojwtRequest2 hotspot=nojwtRequest3 file=0">makeRequest()</code> call has no JWT at all. The responses to these requests are checked based on the role-based access rules for the endpoints. The <code>admin</code> requests should be successful on all endpoints. The <code>user</code> requests should be denied by the <code>/os</code> endpoint but successfully access the <code>/username</code> and <code>/jwtroles</code> endpoints. The requests that don’t include a JWT should be denied access to all endpoints.</p>
</div>
<div class="sect2">
<h3 id="running-the-tests">Running the tests</h3>
<div class="paragraph">
<p>Because you started Open Liberty in dev mode, press the <code>enter/return</code> key from the command-line session of the <code>system</code> service to run the tests. You see the following output:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>-------------------------------------------------------
  T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.system.SystemEndpointIT
[ERROR   ] CWWKS5522E: The MicroProfile JWT feature cannot perform authentication because a MicroProfile JWT cannot be found in the request.
[ERROR   ] CWWKS5522E: The MicroProfile JWT feature cannot perform authentication because a MicroProfile JWT cannot be found in the request.
[ERROR   ] CWWKS5522E: The MicroProfile JWT feature cannot perform authentication because a MicroProfile JWT cannot be found in the request.
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.648 s - in it.io.openliberty.guides.system.SystemEndpointIT

Results:

Tests run: 3, Failures: 0, Errors: 0, Skipped: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three errors in the output are expected and result from the <code>system</code> service successfully rejecting the requests that didn’t include a JWT.</p>
</div>
<div class="paragraph">
<p>When you are finished testing the application, stop both the <code>frontend</code> and <code>system</code> services by pressing <code>CTRL+C</code> in the command-line sessions where you ran them. Alternatively, you can run the following goals from the <code>start</code> directory in another command-line session:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl system liberty:stop
mvn -pl frontend liberty:stop</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You learned how to use MicroProfile JWT to validate JWTs, authenticate and authorize users to secure your microservices in Open Liberty.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Securing microservices with JSON Web Tokens <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-microprofile-jwt/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-microprofile-jwt/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-microprofile-jwt/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/social-media-login.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Authenticating users through social media providers</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">30 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/rest-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Creating a RESTful web service</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">30 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/cdi-intro.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Injecting dependencies into microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
