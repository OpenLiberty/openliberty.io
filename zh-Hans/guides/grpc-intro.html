<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      Streaming messages between client and server services using gRPC remote procedure calls
    
  </title>
  <meta name="description" content="A getting started tutorial with examples on how to write gRPC remote procedure call services with unary calls, server streaming, client streaming, and bidirectional streaming using Java with Open Liberty.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/grpc-intro">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="Streaming messages between client and server services using gRPC remote procedure calls" />
  <meta name="twitter:description" content="A getting started tutorial with examples on how to write gRPC remote procedure call services with unary calls, server streaming, client streaming, and bidirectional streaming using Java with Open Liberty." />

  <meta property='og:title' content="Streaming messages between client and server services using gRPC remote procedure calls" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="A getting started tutorial with examples on how to write gRPC remote procedure call services with unary calls, server streaming, client streaming, and bidirectional streaming using Java with Open Liberty." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/grpc-intro" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li><a href="#what-is-grpc">What is gRPC?</a></li>
<li><a href="#what-youll-learn">What you’ll learn</a></li>
<li>
<a href="#getting-started">Getting started</a>
<ul class="sectlevel2">
<li><a href="#try-what-youll-build">Try what you’ll build</a></li>
</ul>
</li>
<li><a href="#creating-and-defining-the-grpc-server-service">Creating and defining the gRPC server service</a></li>
<li><a href="#implementing-the-unary-call">Implementing the unary call</a></li>
<li><a href="#implementing-the-server-streaming-call">Implementing the server streaming call</a></li>
<li><a href="#implementing-the-client-streaming-call">Implementing the client streaming call</a></li>
<li><a href="#implementing-the-bidirectional-streaming-call">Implementing the bidirectional streaming call</a></li>
<li>
<a href="#testing-the-application">Testing the application</a>
<ul class="sectlevel2">
<li><a href="#implementing-unit-tests-for-the-grpc-server-service">Implementing unit tests for the gRPC server service</a></li>
<li><a href="#running-unit-tests-for-the-grpc-server-service">Running unit tests for the gRPC server service</a></li>
<li><a href="#implementing-integration-tests-for-the-query-service">Implementing integration tests for the query service</a></li>
<li><a href="#running-integration-tests-for-the-query-service">Running integration tests for the query service</a></li>
</ul>
</li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">Streaming messages between client and server services using gRPC</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">30 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="https://openliberty.io/guides/grpc-intro.html">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Learn how to use gRPC unary calls, server streaming, client streaming, and bidirectional streaming to communicate between Java client and server services with Open Liberty.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-grpc">What is gRPC?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC</a> Remote Procedure Call is a technology that implements remote procedure call (RPC) style APIs with HTTP/2. Typically, gRPC uses <a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">protocol buffers</a> to define the format of data to be transferred and the service interfaces to access it, which include service calls and expected messages. For each service defined in a <code>.proto</code> file, gRPC uses the definition to generate the skeleton code for users to implement and extend. Protocol buffers use a binary format to send and receive messages that is faster and more lightweight than the JSON that is typically used in RESTful APIs.</p>
</div>
<div class="paragraph">
<p>Protocol buffers allow cross-project support through the <code>.proto</code> file. As a result, gRPC clients and servers can run and communicate with each other from different environments. For example, a gRPC client running on a Java virtual machine can call a gRPC server developed in any other <a href="https://grpc.io/docs/languages/" target="_blank" rel="noopener noreferrer">supported language</a>. This feature of protocol buffers allows for easier integration between services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will learn how to create gRPC services and their clients by using protocol buffers and how to implement them with Open Liberty. You will use Maven to generate the gRPC stubs, deploy the services, and to interact with the running Liberty runtime.</p>
</div>
<div class="paragraph">
<p>The application that you will build in this guide consists of three projects: the <code>systemproto</code> model project, the <code>query</code> client service, and the <code>system</code> server service.</p>
</div>
<div class="paragraph">
<p>The <code>query</code> service implements four RESTful APIs by using four different gRPC streaming methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unary RPC: The client sends a single request and receives a single response.</p>
</li>
<li>
<p>Server streaming RPC: The client sends a single request and the server returns a stream of messages.</p>
</li>
<li>
<p>Client streaming RPC: The client sends a stream of messages and the server responds with a single message.</p>
</li>
<li>
<p>Bidirectional RPC: Both client and server send a stream of messages. The client and server can read and write messages in any order.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/guide/grpc-intro/architecture.png" alt="Application architecture of the gRPC application covered in guide" width="where a system service acts as the gRPC server and a query service acts a client that makes different gRPC streaming calls">
</div>
</div>
</div>
</div>
<div class="sect1 command">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to work through this guide is to clone the <a href="https://github.com/openliberty/guide-grpc-intro.git" target="_blank" rel="noopener noreferrer">Git repository</a> and use the projects that are provided inside:</p>
</div>
<div id="git_clone" class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-grpc-intro.git
cd guide-grpc-intro</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory contains the starting project that you will build upon.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished project that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary <span class="prerequisites">prerequisites</span>.</p>
</div>
<div class="sect2">
<h3 id="try-what-youll-build">Try what you’ll build</h3>
<div class="paragraph">
<p>The <code>finish</code> directory in the root of this guide contains the finished application. Give it a try before you proceed.</p>
</div>
<div class="paragraph">
<p>To try out the application, first go to the <code>finish</code> directory and run the following Maven goal to generate all the gRPC abstract classes defined in the <code>.proto</code> file.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>cd finish
mvn -pl systemproto install</pre>
</div>
</div>
<div class="paragraph">
<p>Start the <code>system</code> service by running the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>mvn -pl system liberty:run</pre>
</div>
</div>
<div class="paragraph">
<p>Next, open another command-line session, navigate to the <code>finish</code> directory, and start the <code>query</code> service by using the following command:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>mvn -pl query liberty:run</pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the <code>The defaultServer server is ready to run a smarter planet</code> message in your consoles. Then, point your browser to the <a href="http://localhost:9081/query/properties/os.name" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/os.name</a> URL to test out the basic unary service. You will see your operating system name.</p>
</div>
<div class="paragraph">
<p>Next, point your browser to the following URLs to try out the corresponding streaming RPC call:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Visit <a href="http://localhost:9081/query/properties/os" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/os</a> to test out server streaming call. The details of your localhost operating system are displayed.</p>
</li>
<li>
<p>Visit <a href="http://localhost:9081/query/properties/user" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/user</a> to test out client streaming call. The details of your localhost user properties are displayed.</p>
</li>
<li>
<p>Visit <a href="http://localhost:9081/query/properties/java" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/java</a> to test out bidirectional streaming call. The details of your localhost Java properties are displayed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Observe the output from the consoles running the <code>system</code> and <code>query</code> services.</p>
</div>
<div class="paragraph">
<p>After you are finished checking out the application, stop both the <code>query</code> and <code>system</code> services by pressing <code>CTRL+C</code> in the command-line sessions where you ran them. Alternatively, you can run the following goals from the <code>finish</code> directory in another command-line session:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>mvn -pl system liberty:stop
mvn -pl query liberty:stop</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-and-defining-the-grpc-server-service">Creating and defining the gRPC server service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Navigate to the <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>First, create the <code>.proto</code> file and generate gRPC classes. You will implement the gRPC server service with the generated classes later. The <code>.proto</code> file defines all the service calls and message types. The message types are used in the service call definition for the parameters and returns.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemService.proto</code> file.</mark>
<code>systemproto/src/main/proto/SystemService.proto</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemService.proto</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers">10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">12</span>
<span class="line-numbers">13</span><span class="comment">// tag::basicConfig[]</span>
<span class="line-numbers">14</span>syntax = <span class="string"><span class="delimiter">"</span><span class="content">proto3</span><span class="delimiter">"</span></span>;
<span class="line-numbers">15</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.systemproto</span>;
<span class="line-numbers">16</span>option java_multiple_files = <span class="predefined-constant">true</span>;
<span class="line-numbers">17</span><span class="comment">// end::basicConfig[]</span>
<span class="line-numbers">18</span>
<span class="line-numbers">19</span><span class="comment">// tag::SystemService[]</span>
<span class="line-numbers">20</span>service SystemService {
<span class="line-numbers">21</span>  <span class="comment">// tag::getProperty[]</span>
<span class="line-numbers">22</span>  rpc getProperty (SystemPropertyName) returns (SystemPropertyValue) {}
<span class="line-numbers">23</span>  <span class="comment">// end::getProperty[]</span>
<span class="line-numbers">24</span>
<span class="line-numbers">25</span>  <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers">26</span>  rpc getServerStreamingProperties (SystemPropertyPrefix) returns (stream SystemProperty) {}
<span class="line-numbers">27</span>  <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>  <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">30</span>  rpc getClientStreamingProperties (stream SystemPropertyName) returns (SystemProperties) {}
<span class="line-numbers">31</span>  <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>  <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">34</span>  rpc getBidirectionalProperties (stream SystemPropertyName) returns (stream SystemProperty) {}
<span class="line-numbers">35</span>  <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">36</span>}
<span class="line-numbers">37</span><span class="comment">// end::SystemService[]</span>
<span class="line-numbers">38</span>
<span class="line-numbers">39</span><span class="comment">// tag::SystemPropertyName[]</span>
<span class="line-numbers">40</span>message SystemPropertyName {
<span class="line-numbers">41</span>    string propertyName = <span class="integer">1</span>;
<span class="line-numbers">42</span>}
<span class="line-numbers">43</span><span class="comment">// end::SystemPropertyName[]</span>
<span class="line-numbers">44</span>
<span class="line-numbers">45</span>message SystemPropertyPrefix {
<span class="line-numbers">46</span>    string propertyPrefix = <span class="integer">1</span>;
<span class="line-numbers">47</span>}
<span class="line-numbers">48</span>
<span class="line-numbers">49</span><span class="comment">// tag::SystemPropertyValue[]</span>
<span class="line-numbers">50</span>message SystemPropertyValue {
<span class="line-numbers">51</span>    string propertyValue = <span class="integer">1</span>;
<span class="line-numbers">52</span>}
<span class="line-numbers">53</span><span class="comment">// end::SystemPropertyValue[]</span>
<span class="line-numbers">54</span>
<span class="line-numbers">55</span><span class="comment">// tag::SystemProperty[]</span>
<span class="line-numbers">56</span>message SystemProperty {
<span class="line-numbers">57</span>    string propertyName = <span class="integer">1</span>;
<span class="line-numbers">58</span>    string propertyValue = <span class="integer">2</span>;
<span class="line-numbers">59</span>}
<span class="line-numbers">60</span><span class="comment">// end::SystemProperty[]</span>
<span class="line-numbers">61</span>
<span class="line-numbers">62</span><span class="comment">// tag::SystemProperties[]</span>
<span class="line-numbers">63</span>message SystemProperties {
<span class="line-numbers">64</span>    map&lt;string, string&gt; properties = <span class="integer">1</span>;
<span class="line-numbers">65</span>}
<span class="line-numbers">66</span><span class="comment">// end::SystemProperties[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>pom.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;project</span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 5</span>    <span class="tag">&lt;artifactId&gt;</span>systemproto<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 6</span>    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 7</span>    <span class="tag">&lt;packaging&gt;</span>jar<span class="tag">&lt;/packaging&gt;</span>
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>    <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers">10</span>        <span class="tag">&lt;maven.compiler.source&gt;</span>11<span class="tag">&lt;/maven.compiler.source&gt;</span>
<span class="line-numbers">11</span>        <span class="tag">&lt;maven.compiler.target&gt;</span>11<span class="tag">&lt;/maven.compiler.target&gt;</span>
<span class="line-numbers">12</span>        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
<span class="line-numbers">13</span>    <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>    <span class="tag">&lt;dependencies&gt;</span>
<span class="line-numbers">16</span>        <span class="comment">&lt;!-- Provided dependencies --&gt;</span>
<span class="line-numbers">17</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers">18</span>            <span class="tag">&lt;groupId&gt;</span>jakarta.platform<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">19</span>            <span class="tag">&lt;artifactId&gt;</span>jakarta.jakartaee-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">20</span>            <span class="tag">&lt;version&gt;</span>10.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">21</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers">22</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">23</span>        <span class="comment">&lt;!-- grpc compile dependencies --&gt;</span>
<span class="line-numbers">24</span>        <span class="comment">&lt;!-- tag::grpc[] --&gt;</span>
<span class="line-numbers">25</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers">26</span>            <span class="tag">&lt;groupId&gt;</span>io.grpc<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">27</span>            <span class="tag">&lt;artifactId&gt;</span>grpc-protobuf<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">28</span>            <span class="tag">&lt;version&gt;</span>1.54.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">29</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers">30</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">31</span>        <span class="comment">&lt;!-- end::grpc[] --&gt;</span>
<span class="line-numbers">32</span>        <span class="comment">&lt;!-- tag::grpc-stub[] --&gt;</span>
<span class="line-numbers">33</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers">34</span>            <span class="tag">&lt;groupId&gt;</span>io.grpc<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">35</span>            <span class="tag">&lt;artifactId&gt;</span>grpc-stub<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">36</span>            <span class="tag">&lt;version&gt;</span>1.54.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">37</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers">38</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">39</span>        <span class="comment">&lt;!-- end::grpc-stub[] --&gt;</span>
<span class="line-numbers">40</span>        <span class="comment">&lt;!-- tag::javax[] --&gt;</span>
<span class="line-numbers">41</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers">42</span>            <span class="tag">&lt;groupId&gt;</span>javax.annotation<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">43</span>            <span class="tag">&lt;artifactId&gt;</span>javax.annotation-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">44</span>            <span class="tag">&lt;version&gt;</span>1.3.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">45</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers">46</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">47</span>        <span class="comment">&lt;!-- end::javax[] --&gt;</span>
<span class="line-numbers">48</span>    <span class="tag">&lt;/dependencies&gt;</span>
<span class="line-numbers">49</span>
<span class="line-numbers">50</span>    <span class="tag">&lt;build&gt;</span>
<span class="line-numbers">51</span>        <span class="tag">&lt;finalName&gt;</span>${project.artifactId}<span class="tag">&lt;/finalName&gt;</span>
<span class="line-numbers">52</span>        <span class="comment">&lt;!-- tag::osmavenplugin[] --&gt;</span>
<span class="line-numbers">53</span>        <span class="tag">&lt;extensions&gt;</span>
<span class="line-numbers">54</span>            <span class="tag">&lt;extension&gt;</span>
<span class="line-numbers">55</span>                <span class="tag">&lt;groupId&gt;</span>kr.motd.maven<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">56</span>                <span class="tag">&lt;artifactId&gt;</span>os-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">57</span>                <span class="tag">&lt;version&gt;</span>1.7.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">58</span>            <span class="tag">&lt;/extension&gt;</span>
<span class="line-numbers">59</span>        <span class="tag">&lt;/extensions&gt;</span>
<span class="line-numbers">60</span>        <span class="comment">&lt;!-- end::osmavenplugin[] --&gt;</span>
<span class="line-numbers">61</span>        <span class="tag">&lt;plugins&gt;</span>
<span class="line-numbers">62</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">63</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">64</span>                <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">65</span>                <span class="tag">&lt;version&gt;</span>3.11.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">66</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">67</span>            <span class="comment">&lt;!-- tag::protobufmavenplugin[] --&gt;</span>
<span class="line-numbers">68</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">69</span>                <span class="tag">&lt;groupId&gt;</span>org.xolstice.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">70</span>                <span class="tag">&lt;artifactId&gt;</span>protobuf-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">71</span>                <span class="tag">&lt;version&gt;</span>0.6.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">72</span>                <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">73</span>                    <span class="tag">&lt;protocArtifact&gt;</span>com.google.protobuf:protoc:3.21.9:exe:${os.detected.classifier}<span class="tag">&lt;/protocArtifact&gt;</span>
<span class="line-numbers">74</span>                    <span class="tag">&lt;pluginId&gt;</span>grpc-java<span class="tag">&lt;/pluginId&gt;</span>
<span class="line-numbers">75</span>                    <span class="tag">&lt;pluginArtifact&gt;</span>io.grpc:protoc-gen-grpc-java:1.51.0:exe:${os.detected.classifier}<span class="tag">&lt;/pluginArtifact&gt;</span>
<span class="line-numbers">76</span>                <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">77</span>                <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers">78</span>                    <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">79</span>                        <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">80</span>                            <span class="tag">&lt;goal&gt;</span>compile<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">81</span>                            <span class="tag">&lt;goal&gt;</span>compile-custom<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">82</span>                        <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">83</span>                    <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">84</span>                <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers">85</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">86</span>            <span class="comment">&lt;!-- end::protobufmavenplugin[] --&gt;</span>
<span class="line-numbers">87</span>        <span class="tag">&lt;/plugins&gt;</span>
<span class="line-numbers">88</span>    <span class="tag">&lt;/build&gt;</span>
<span class="line-numbers">89</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first few lines define the <code class="hotspot=basicConfig file=0">syntax</code>, <code class="hotspot=basicConfig file=0">package</code>, and <code class="hotspot=basicConfig file=0">option</code> basic configuration of the <code>.proto</code> file. The <code class="hotspot=SystemService file=0">SystemService</code> service contains the four service calls that you will implement in the coming sections.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getProperty file=0">getProperty</code> RPC defines the unary call. In this call, the client service sends a <code>SystemPropertyName</code> message to the server service, which returns a <code>SystemPropertyValue</code> message with the property value. The <code class="hotspot=SystemPropertyName file=0">SystemPropertyName</code> and <code class="hotspot=SystemPropertyValue file=0">SystemPropertyValue</code> message types define that the <code>propertyName</code> and <code>propertyValue</code> fields must be string.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getServerStreamingProperties file=0">getServerStreamingProperties</code> RPC defines the server streaming call. The client service sends a <code>SystemPropertyPrefix</code> message to the server service. The server service returns a stream of <code>SystemProperty</code> messages. Each <code class="hotspot=SystemProperty file=0">SystemProperty</code> message contains <code>propertyName</code> and <code>propertyValue</code> strings.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getClientStreamingProperties file=0">getClientStreamingProperties</code> RPC defines the client streaming call. The client service streams <code>SystemPropertyName</code> messages to the server service. The server service returns a <code class="hotspot=SystemProperties file=0">SystemProperties</code> message that contains a map of the properties with their respective values.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getBidirectionalProperties file=0">getBidirectionalProperties</code> RPC defines the bidirectional streaming call. In this service, the client service streams <code>SystemPropertyName</code> messages to the server service. The server service returns a stream of <code class="hotspot=SystemProperty file=0">SystemProperty</code> messages.</p>
</div>
<div class="paragraph">
<p>To compile the <code>.proto</code> file, the <code>pom.xml</code> Maven configuration file needs the <code class="hotspot=grpc file=1">grpc-protobuf</code>, <code class="hotspot=grpc-stub file=1">grpc-stub</code>, <code class="hotspot=javax file=1">javax.annotation-api</code> dependencies, and the <code class="hotspot=protobufmavenplugin file=1">protobuf-maven-plugin</code> plugin. To install the correct version of the Protobuf compiler automatically, the <code class="hotspot=osmavenplugin file=1">os-maven-plugin</code> extension is required in the <code>build</code> configuration.</p>
</div>
<div class="paragraph">
<p>Run the following command to generate the gRPC classes.</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>mvn -pl systemproto install</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-the-unary-call">Implementing the unary call</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Navigate to the <code>start</code> directory.</p>
</div>
<div class="paragraph">
<p>When you run Open Liberty in <a href="https://openliberty.io/docs/latest/development-mode.html" target="_blank" rel="noopener">dev mode</a>, dev mode listens for file changes and automatically recompiles and deploys your updates whenever you save a new change. Run the following command to start the <code>system</code> service in dev mode:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl system liberty:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open another command-line session, navigate to the <code>start</code> directory, and run the following command to start the <code>query</code> service in dev mode:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl query liberty:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you see the following message, your Liberty instances are ready in dev mode:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre>**************************************************************
*    Liberty is running in dev mode.</pre>
</div>
</div>
<div class="paragraph">
<p>Dev mode holds your command-line session to listen for file changes. Open another command-line session and navigate to the <code>start</code> directory to continue, or open the project in your editor.</p>
</div>
<div class="paragraph">
<p>Start by implementing the first service call, the unary call. In this service call, the <code>query</code> client service sends a property to the <code>system</code> server service, which returns the property value. This type of service call resembles a RESTful API.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>SystemService</code> class.</mark>
<code>system/src/main/java/io/openliberty/guides/system/SystemService.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright,getServerStreamingProperties,getClientStreamingProperties,getBidirectionalProperties">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 19</span><span class="comment">// tag::importGrpcClasses[]</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 26</span><span class="comment">// end::importGrpcClasses[]</span>
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="comment">// tag::extends[]</span>
<span class="line-numbers"> 29</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> <span class="directive">extends</span> SystemServiceGrpc.SystemServiceImplBase {
<span class="line-numbers"> 30</span><span class="comment">// end::extends[]</span>
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="directive">public</span> SystemService() {
<span class="line-numbers"> 35</span>    }
<span class="line-numbers"> 36</span>
<span class="line-numbers"> 37</span>    <span class="comment">// tag::getProperty[]</span>
<span class="line-numbers"> 38</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 39</span>    <span class="directive">public</span> <span class="type">void</span> getProperty(
<span class="line-numbers"> 40</span>        SystemPropertyName request, StreamObserver&lt;SystemPropertyValue&gt; observer) {
<span class="line-numbers"> 41</span>
<span class="line-numbers"> 42</span>        <span class="comment">// tag::pName[]</span>
<span class="line-numbers"> 43</span>        <span class="predefined-type">String</span> pName = request.getPropertyName();
<span class="line-numbers"> 44</span>        <span class="comment">// end::pName[]</span>
<span class="line-numbers"> 45</span>        <span class="comment">// tag::pValue[]</span>
<span class="line-numbers"> 46</span>        <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers"> 47</span>        <span class="comment">// end::pValue[]</span>
<span class="line-numbers"> 48</span>        <span class="comment">// tag::response[]</span>
<span class="line-numbers"> 49</span>        SystemPropertyValue value = SystemPropertyValue
<span class="line-numbers"> 50</span>                                        .newBuilder()
<span class="line-numbers"> 51</span>                                        .setPropertyValue(pValue)
<span class="line-numbers"> 52</span>                                        .build();
<span class="line-numbers"> 53</span>        <span class="comment">// end::response[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>        <span class="comment">// tag::next[]</span>
<span class="line-numbers"> 56</span>        observer.onNext(value);
<span class="line-numbers"> 57</span>        <span class="comment">// end::next[]</span>
<span class="line-numbers"> 58</span>        <span class="comment">// tag::complete[]</span>
<span class="line-numbers"> 59</span>        observer.onCompleted();
<span class="line-numbers"> 60</span>        <span class="comment">// end::complete[]</span>
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>    }
<span class="line-numbers"> 63</span>    <span class="comment">// end::getProperty[]</span>
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 67</span>    <span class="directive">public</span> <span class="type">void</span> getServerStreamingProperties(
<span class="line-numbers"> 68</span>        SystemPropertyPrefix request, StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers"> 69</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::prefix[]</span>
<span class="line-numbers"> 71</span>        <span class="predefined-type">String</span> prefix = request.getPropertyPrefix();
<span class="line-numbers"> 72</span>        <span class="comment">// end::prefix[]</span>
<span class="line-numbers"> 73</span>        <span class="predefined-type">System</span>.getProperties()
<span class="line-numbers"> 74</span>              .stringPropertyNames()
<span class="line-numbers"> 75</span>              .stream()
<span class="line-numbers"> 76</span>              <span class="comment">// tag::filter[]</span>
<span class="line-numbers"> 77</span>              .filter(name -&gt; name.startsWith(prefix))
<span class="line-numbers"> 78</span>              <span class="comment">// end::filter[]</span>
<span class="line-numbers"> 79</span>              .forEach(name -&gt; {
<span class="line-numbers"> 80</span>                  <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(name);
<span class="line-numbers"> 81</span>                  <span class="comment">// tag::serverMessage[]</span>
<span class="line-numbers"> 82</span>                  SystemProperty value = SystemProperty
<span class="line-numbers"> 83</span>                      .newBuilder()
<span class="line-numbers"> 84</span>                      .setPropertyName(name)
<span class="line-numbers"> 85</span>                      .setPropertyValue(pValue)
<span class="line-numbers"> 86</span>                      .build();
<span class="line-numbers"> 87</span>                  <span class="comment">// end::serverMessage[]</span>
<span class="line-numbers"> 88</span>                  <span class="comment">// tag::serverNext1[]</span>
<span class="line-numbers"> 89</span>                  observer.onNext(value);
<span class="line-numbers"> 90</span>                  <span class="comment">// end::serverNext1[]</span>
<span class="line-numbers"> 91</span>                  logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming sent property: </span><span class="delimiter">"</span></span> + name);
<span class="line-numbers"> 92</span>               });
<span class="line-numbers"> 93</span>        <span class="comment">// tag::serverComplete[]</span>
<span class="line-numbers"> 94</span>        observer.onCompleted();
<span class="line-numbers"> 95</span>        <span class="comment">// end::serverComplete[]</span>
<span class="line-numbers"> 96</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">101</span>    <span class="annotation">@Override</span>
<span class="line-numbers">102</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getClientStreamingProperties(
<span class="line-numbers">103</span>        StreamObserver&lt;SystemProperties&gt; observer) {
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        <span class="comment">// tag::streamObserverClient[]</span>
<span class="line-numbers">106</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>            <span class="comment">// tag::clientStreamingMap[]</span>
<span class="line-numbers">109</span>            <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();
<span class="line-numbers">110</span>            <span class="comment">// end::clientStreamingMap[]</span>
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>            <span class="comment">// tag::receivingProperties[]</span>
<span class="line-numbers">113</span>            <span class="annotation">@Override</span>
<span class="line-numbers">114</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">115</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">116</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">117</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received property: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">118</span>                properties.put(pName, pValue);
<span class="line-numbers">119</span>            }
<span class="line-numbers">120</span>            <span class="comment">// end::receivingProperties[]</span>
<span class="line-numbers">121</span>
<span class="line-numbers">122</span>            <span class="annotation">@Override</span>
<span class="line-numbers">123</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">124</span>                t.printStackTrace();
<span class="line-numbers">125</span>            }
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>            <span class="comment">// tag::clientStreamingCompleted[]</span>
<span class="line-numbers">128</span>            <span class="annotation">@Override</span>
<span class="line-numbers">129</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">130</span>                SystemProperties value = SystemProperties.newBuilder()
<span class="line-numbers">131</span>                                             .putAllProperties(properties)
<span class="line-numbers">132</span>                                             .build();
<span class="line-numbers">133</span>                observer.onNext(value);
<span class="line-numbers">134</span>                observer.onCompleted();
<span class="line-numbers">135</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">136</span>            }
<span class="line-numbers">137</span>            <span class="comment">// end::clientStreamingCompleted[]</span>
<span class="line-numbers">138</span>        };
<span class="line-numbers">139</span>        <span class="comment">// end::streamObserverClient[]</span>
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>    <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">142</span>
<span class="line-numbers">143</span>    <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">144</span>    <span class="annotation">@Override</span>
<span class="line-numbers">145</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getBidirectionalProperties(
<span class="line-numbers">146</span>        StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>        <span class="comment">// tag::streamObserverBidirectional[]</span>
<span class="line-numbers">149</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">150</span>            <span class="comment">// tag::receiveBidirectionalProperties[]</span>
<span class="line-numbers">151</span>            <span class="annotation">@Override</span>
<span class="line-numbers">152</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">153</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">154</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">155</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming received: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">156</span>                <span class="comment">// tag::systemPropertyMessage[]</span>
<span class="line-numbers">157</span>                SystemProperty value = SystemProperty.newBuilder()
<span class="line-numbers">158</span>                                           .setPropertyName(pName)
<span class="line-numbers">159</span>                                           .setPropertyValue(pValue)
<span class="line-numbers">160</span>                                           .build();
<span class="line-numbers">161</span>                <span class="comment">// end::systemPropertyMessage[]</span>
<span class="line-numbers">162</span>                <span class="comment">// tag::serverNext2[]</span>
<span class="line-numbers">163</span>                observer.onNext(value);
<span class="line-numbers">164</span>                <span class="comment">// end::serverNext2[]</span>
<span class="line-numbers">165</span>            }
<span class="line-numbers">166</span>            <span class="comment">// end::receiveBidirectionalProperties[]</span>
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>            <span class="annotation">@Override</span>
<span class="line-numbers">169</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">170</span>                t.printStackTrace();
<span class="line-numbers">171</span>            }
<span class="line-numbers">172</span>
<span class="line-numbers">173</span>            <span class="comment">// tag::bidirectionalCompleted[]</span>
<span class="line-numbers">174</span>            <span class="annotation">@Override</span>
<span class="line-numbers">175</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">176</span>                observer.onCompleted();
<span class="line-numbers">177</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">178</span>            }
<span class="line-numbers">179</span>            <span class="comment">// end::bidirectionalCompleted[]</span>
<span class="line-numbers">180</span>        };
<span class="line-numbers">181</span>        <span class="comment">// end::streamObserverBidirectional[]</span>
<span class="line-numbers">182</span>    }
<span class="line-numbers">183</span>    <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">184</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SystemService</code> class extends the <code>SystemServiceGrpc</code> class that is generated by the <code>.proto</code> file. The four types of services defined in the proto file are implemented in this class.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getProperty file=0">getProperty()</code> method implements the unary RPC call defined in the <code>.proto</code> file. The <code class="hotspot=pName file=0">getPropertyName()</code> getter method that is generated by gRPC retrieves the property name from the client, and stores it into the <code>pName</code> variable. The System property value is stored into the <code class="hotspot=pValue file=0">pValue</code> variable. The gRPC library will create a <code class="hotspot=response file=0">SystemPropertyValue</code> message, with its type defined in the <code>SystemService.proto</code> file. Then, the message is sent to the client service through the <code>StreamObserver</code> by using its <code class="hotspot=next file=0">onNext()</code> and <code class="hotspot=complete file=0">onComplete()</code> methods.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the system's <code>server.xml</code> configuration file.</mark>
<code>system/src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>system/server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">system service</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>restfulWS-3.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="comment">&lt;!-- tag::grpc[] --&gt;</span>
<span class="line-numbers"> 7</span>        <span class="tag">&lt;feature&gt;</span>grpc-1.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>        <span class="comment">&lt;!-- end::grpc[] --&gt;</span>
<span class="line-numbers"> 9</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>    <span class="comment">&lt;!-- tag::grpcConfig[] --&gt;</span>
<span class="line-numbers">12</span>    <span class="comment">&lt;!-- Due to target="*", this configuration will be applied to every gRPC service </span>
<span class="line-numbers">13</span><span class="comment">         running on the server. This configuration registers a ServerInterceptor --&gt;</span>
<span class="line-numbers">14</span>    <span class="tag">&lt;grpc</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">"</span><span class="content">*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">15</span>    <span class="comment">&lt;!-- end::grpcConfig[] --&gt;</span>
<span class="line-numbers">16</span>
<span class="line-numbers">17</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">guide-grpc-intro-system.war</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>    <span class="tag">&lt;logging</span> <span class="attribute-name">consoleLogLevel</span>=<span class="string"><span class="delimiter">"</span><span class="content">INFO</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">22</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the <code class="hotspot=grpc file=1">grpc</code> feature to the Liberty <code>server.xml</code> configuration file. This feature enables applications running on Liberty to provide gRPC services. Configure the <code class="hotspot=grpcConfig file=1">grpc</code> feature with the <code>target</code> attribute. If you want to learn more about configuration for the <code>grpc</code> feature, see the <a href="https://openliberty.io/docs/latest/reference/config/grpc.html" target="_blank" rel="noopener">GRPC Server Properties</a>.</p>
</div>
<div class="paragraph">
<p>Next, implement the corresponding REST endpoint in the <code>query</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=2">
<div class="content">
<pre><mark>Create the <code>PropertiesResource</code> class.</mark>
<code>query/src/main/java/io/openliberty/guides/query/PropertiesResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>PropertiesResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright,serverStreaming,clientStreaming,bidirectionalStreaming">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannel</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannelBuilder</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 34</span><span class="comment">// tag::grpcImports[]</span>
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceBlockingStub</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceStub</span>;
<span class="line-numbers"> 43</span><span class="comment">// end::grpcImports[]</span>
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 46</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/properties</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 47</span><span class="directive">public</span> <span class="type">class</span> <span class="class">PropertiesResource</span> {
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(PropertiesResource.class.getName());
<span class="line-numbers"> 50</span>
<span class="line-numbers"> 51</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 52</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.hostname</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 53</span>    <span class="predefined-type">String</span> SYSTEM_HOST;
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.port</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="type">int</span> SYSTEM_PORT;
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="comment">// tag::unary[]</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 61</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{property}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 62</span>    <span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers"> 63</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getPropertiesString(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> property) {
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>        <span class="comment">// tag::createChannel1[]</span>
<span class="line-numbers"> 66</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 67</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 68</span>                                     .usePlaintext().build();
<span class="line-numbers"> 69</span>        <span class="comment">// end::createChannel1[]</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::createClient1[]</span>
<span class="line-numbers"> 71</span>        SystemServiceBlockingStub client = SystemServiceGrpc.newBlockingStub(channel);
<span class="line-numbers"> 72</span>        <span class="comment">// end::createClient1[]</span>
<span class="line-numbers"> 73</span>        SystemPropertyName request = SystemPropertyName.newBuilder()
<span class="line-numbers"> 74</span>                                             .setPropertyName(property).build();
<span class="line-numbers"> 75</span>        SystemPropertyValue response = client.getProperty(request);
<span class="line-numbers"> 76</span>        channel.shutdownNow();
<span class="line-numbers"> 77</span>        <span class="keyword">return</span> response.getPropertyValue();
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>    <span class="comment">// end::unary[]</span>
<span class="line-numbers"> 80</span>
<span class="line-numbers"> 81</span>    <span class="comment">// tag::serverStreaming[]</span>
<span class="line-numbers"> 82</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 83</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 84</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 85</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getOSProperties() {
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>        <span class="comment">// tag::createChannel2[]</span>
<span class="line-numbers"> 88</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 89</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 90</span>                                     .usePlaintext().build();
<span class="line-numbers"> 91</span>        <span class="comment">// end::createChannel2[]</span>
<span class="line-numbers"> 92</span>        <span class="comment">// tag::createClient2[]</span>
<span class="line-numbers"> 93</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers"> 94</span>        <span class="comment">// end::createClient2[]</span>
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 97</span>        <span class="comment">// tag::countDownLatch1[]</span>
<span class="line-numbers"> 98</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers"> 99</span>        <span class="comment">// end::countDownLatch1[]</span>
<span class="line-numbers">100</span>        SystemPropertyPrefix request = SystemPropertyPrefix.newBuilder()
<span class="line-numbers">101</span>                                         .setPropertyPrefix(<span class="string"><span class="delimiter">"</span><span class="content">os.</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">102</span>        <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers">103</span>        client.getServerStreamingProperties(
<span class="line-numbers">104</span>            request, <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">105</span>
<span class="line-numbers">106</span>            <span class="comment">// tag::onNext1[]</span>
<span class="line-numbers">107</span>            <span class="annotation">@Override</span>
<span class="line-numbers">108</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">109</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">110</span>                   + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">111</span>                properties.put(value.getPropertyName(), value.getPropertyValue());
<span class="line-numbers">112</span>            }
<span class="line-numbers">113</span>            <span class="comment">// end::onNext1[]</span>
<span class="line-numbers">114</span>
<span class="line-numbers">115</span>            <span class="annotation">@Override</span>
<span class="line-numbers">116</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">117</span>                t.printStackTrace();
<span class="line-numbers">118</span>            }
<span class="line-numbers">119</span>
<span class="line-numbers">120</span>            <span class="annotation">@Override</span>
<span class="line-numbers">121</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">122</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">123</span>                <span class="comment">// tag::countDownLatch2[]</span>
<span class="line-numbers">124</span>                countDown.countDown();
<span class="line-numbers">125</span>                <span class="comment">// end::countDownLatch2[]</span>
<span class="line-numbers">126</span>            }
<span class="line-numbers">127</span>        });
<span class="line-numbers">128</span>        <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers">129</span>
<span class="line-numbers">130</span>
<span class="line-numbers">131</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">132</span>        <span class="comment">// tag::countDownLatch3[]</span>
<span class="line-numbers">133</span>        <span class="keyword">try</span> {
<span class="line-numbers">134</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">135</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">136</span>            e.printStackTrace();
<span class="line-numbers">137</span>        }
<span class="line-numbers">138</span>        <span class="comment">// end::countDownLatch3[]</span>
<span class="line-numbers">139</span>
<span class="line-numbers">140</span>        <span class="comment">// tag::closeConnection[]</span>
<span class="line-numbers">141</span>        channel.shutdownNow();
<span class="line-numbers">142</span>        <span class="comment">// end::closeConnection[]</span>
<span class="line-numbers">143</span>
<span class="line-numbers">144</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">145</span>    }
<span class="line-numbers">146</span>    <span class="comment">// end::serverStreaming[]</span>
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>    <span class="comment">// tag::clientStreaming[]</span>
<span class="line-numbers">149</span>    <span class="annotation">@GET</span>
<span class="line-numbers">150</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/user</span><span class="delimiter">"</span></span>)
<span class="line-numbers">151</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">152</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getUserProperties() {
<span class="line-numbers">153</span>
<span class="line-numbers">154</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">155</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">156</span>                                     .usePlaintext().build();
<span class="line-numbers">157</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">158</span>        <span class="comment">// tag::countDownLatch4[]</span>
<span class="line-numbers">159</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">160</span>        <span class="comment">// end::countDownLatch4[]</span>
<span class="line-numbers">161</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">162</span>
<span class="line-numbers">163</span>        <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">164</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getClientStreamingProperties(
<span class="line-numbers">165</span>            <span class="keyword">new</span> StreamObserver&lt;SystemProperties&gt;() {
<span class="line-numbers">166</span>
<span class="line-numbers">167</span>                <span class="annotation">@Override</span>
<span class="line-numbers">168</span>                <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperties value) {
<span class="line-numbers">169</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received a map that has </span><span class="delimiter">"</span></span>
<span class="line-numbers">170</span>                        + value.getPropertiesCount() + <span class="string"><span class="delimiter">"</span><span class="content"> properties</span><span class="delimiter">"</span></span>);
<span class="line-numbers">171</span>                    properties.putAll(value.getPropertiesMap());
<span class="line-numbers">172</span>                }
<span class="line-numbers">173</span>
<span class="line-numbers">174</span>                <span class="annotation">@Override</span>
<span class="line-numbers">175</span>                <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">176</span>                    t.printStackTrace();
<span class="line-numbers">177</span>                }
<span class="line-numbers">178</span>
<span class="line-numbers">179</span>                <span class="annotation">@Override</span>
<span class="line-numbers">180</span>                <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">181</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">182</span>                    <span class="comment">// tag::countDownLatch5[]</span>
<span class="line-numbers">183</span>                    countDown.countDown();
<span class="line-numbers">184</span>                    <span class="comment">// end::countDownLatch5[]</span>
<span class="line-numbers">185</span>                }
<span class="line-numbers">186</span>            });
<span class="line-numbers">187</span>        <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">188</span>
<span class="line-numbers">189</span>        <span class="comment">// collect the property names starting with user.</span>
<span class="line-numbers">190</span>        <span class="comment">// tag::collectUserProperties[]</span>
<span class="line-numbers">191</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">192</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">user.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">193</span>                                  .collect(Collectors.toList());
<span class="line-numbers">194</span>        <span class="comment">// end::collectUserProperties[]</span>
<span class="line-numbers">195</span>
<span class="line-numbers">196</span>        <span class="comment">// send messages to the server</span>
<span class="line-numbers">197</span>        keys.stream()
<span class="line-numbers">198</span>            <span class="comment">// tag::clientMessage1[]</span>
<span class="line-numbers">199</span>            .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">200</span>            <span class="comment">// end::clientMessage1[]</span>
<span class="line-numbers">201</span>            <span class="comment">// tag::streamOnNext1[]</span>
<span class="line-numbers">202</span>            .forEach(stream::onNext);
<span class="line-numbers">203</span>            <span class="comment">// end::streamOnNext1[]</span>
<span class="line-numbers">204</span>        <span class="comment">// tag::clientCompleted1[]</span>
<span class="line-numbers">205</span>        stream.onCompleted();
<span class="line-numbers">206</span>        <span class="comment">// end::clientCompleted1[]</span>
<span class="line-numbers">207</span>
<span class="line-numbers">208</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">209</span>        <span class="comment">// tag::countDownLatch6[]</span>
<span class="line-numbers">210</span>        <span class="keyword">try</span> {
<span class="line-numbers">211</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">212</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">213</span>            e.printStackTrace();
<span class="line-numbers">214</span>        }
<span class="line-numbers">215</span>        <span class="comment">// end::countDownLatch6[]</span>
<span class="line-numbers">216</span>
<span class="line-numbers">217</span>        channel.shutdownNow();
<span class="line-numbers">218</span>
<span class="line-numbers">219</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">220</span>    }
<span class="line-numbers">221</span>    <span class="comment">// end::clientStreaming[]</span>
<span class="line-numbers">222</span>
<span class="line-numbers">223</span>    <span class="comment">// tag::bidirectionalStreaming[]</span>
<span class="line-numbers">224</span>    <span class="annotation">@GET</span>
<span class="line-numbers">225</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/java</span><span class="delimiter">"</span></span>)
<span class="line-numbers">226</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">227</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getJavaProperties() {
<span class="line-numbers">228</span>
<span class="line-numbers">229</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">230</span>                                      .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">231</span>                                      .usePlaintext().build();
<span class="line-numbers">232</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">233</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">234</span>        <span class="comment">// tag::countDownLatch7[]</span>
<span class="line-numbers">235</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">236</span>        <span class="comment">// end::countDownLatch7[]</span>
<span class="line-numbers">237</span>
<span class="line-numbers">238</span>        <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">239</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getBidirectionalProperties(
<span class="line-numbers">240</span>                <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">241</span>
<span class="line-numbers">242</span>                    <span class="comment">// tag::onNext2[]</span>
<span class="line-numbers">243</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">244</span>                    <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">245</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">246</span>                            + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">247</span>                        properties.put(value.getPropertyName(),
<span class="line-numbers">248</span>                                       value.getPropertyValue());
<span class="line-numbers">249</span>                    }
<span class="line-numbers">250</span>                    <span class="comment">// end::onNext2[]</span>
<span class="line-numbers">251</span>
<span class="line-numbers">252</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">253</span>                    <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">254</span>                        t.printStackTrace();
<span class="line-numbers">255</span>                    }
<span class="line-numbers">256</span>
<span class="line-numbers">257</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">258</span>                    <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">259</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">260</span>                        <span class="comment">// tag::countDownLatch8[]</span>
<span class="line-numbers">261</span>                        countDown.countDown();
<span class="line-numbers">262</span>                        <span class="comment">// end::countDownLatch8[]</span>
<span class="line-numbers">263</span>                    }
<span class="line-numbers">264</span>                });
<span class="line-numbers">265</span>        <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">266</span>
<span class="line-numbers">267</span>        <span class="comment">// collect the property names starting with java</span>
<span class="line-numbers">268</span>        <span class="comment">// tag::collectJavaProperties[]</span>
<span class="line-numbers">269</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">270</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">java.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">271</span>                                  .collect(Collectors.toList());
<span class="line-numbers">272</span>        <span class="comment">// end::collectJavaProperties[]</span>
<span class="line-numbers">273</span>
<span class="line-numbers">274</span>        <span class="comment">// post messages to the server</span>
<span class="line-numbers">275</span>        keys.stream()
<span class="line-numbers">276</span>              <span class="comment">// tag::clientMessage2[]</span>
<span class="line-numbers">277</span>              .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">278</span>              <span class="comment">// end::clientMessage2[]</span>
<span class="line-numbers">279</span>              <span class="comment">// tag::streamOnNext2[]</span>
<span class="line-numbers">280</span>              .forEach(stream::onNext);
<span class="line-numbers">281</span>              <span class="comment">// end::streamOnNext2[]</span>
<span class="line-numbers">282</span>        <span class="comment">// tag::clientCompleted2[]</span>
<span class="line-numbers">283</span>        stream.onCompleted();
<span class="line-numbers">284</span>        <span class="comment">// end::clientCompleted2[]</span>
<span class="line-numbers">285</span>
<span class="line-numbers">286</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">287</span>        <span class="comment">// tag::countDownLatch9[]</span>
<span class="line-numbers">288</span>        <span class="keyword">try</span> {
<span class="line-numbers">289</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">290</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">291</span>            e.printStackTrace();
<span class="line-numbers">292</span>        }
<span class="line-numbers">293</span>        <span class="comment">// end::countDownLatch9[]</span>
<span class="line-numbers">294</span>
<span class="line-numbers">295</span>        channel.shutdownNow();
<span class="line-numbers">296</span>
<span class="line-numbers">297</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">298</span>    }
<span class="line-numbers">299</span>    <span class="comment">// end::bidirectionalStreaming[]</span>
<span class="line-numbers">300</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PropertiesResource</code> class provides RESTful endpoints to interact with the <code>system</code> service. The <code class="hotspot=unary file=2">/query/properties/${property}</code> endpoint uses the unary service call to get the property value from the <code>system</code> service. The endpoint creates a <code class="hotspot=createChannel1 file=2">channel</code>, which it uses to create a client by the <code class="hotspot=createClient1 file=2">SystemServiceGrpc.newBlockingStub()</code> API. The endpoint then uses the client to get the property value, shuts down the channel, and immediately returns the value from the <code>system</code> service response.</p>
</div>
<div class="listingblock code_command hotspot file=3">
<div class="content">
<pre><mark>Replace the query's <code>server.xml</code> configuration file.</mark>
<code>query/src/main/liberty/config/server.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>query/server.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers"> 1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="line-numbers"> 2</span><span class="tag">&lt;server</span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">query service</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="tag">&lt;featureManager&gt;</span>
<span class="line-numbers"> 5</span>        <span class="tag">&lt;feature&gt;</span>restfulWS-3.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 6</span>        <span class="tag">&lt;feature&gt;</span>jsonp-2.1<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 7</span>        <span class="tag">&lt;feature&gt;</span>jsonb-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 8</span>        <span class="tag">&lt;feature&gt;</span>cdi-4.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers"> 9</span>        <span class="tag">&lt;feature&gt;</span>mpConfig-3.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">10</span>        <span class="comment">&lt;!-- tag::grpc[] --&gt;</span>
<span class="line-numbers">11</span>        <span class="tag">&lt;feature&gt;</span>grpc-1.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">12</span>        <span class="comment">&lt;!-- end::grpc[] --&gt;</span>
<span class="line-numbers">13</span>        <span class="comment">&lt;!-- tag::grpcClient[] --&gt;</span>
<span class="line-numbers">14</span>        <span class="tag">&lt;feature&gt;</span>grpcClient-1.0<span class="tag">&lt;/feature&gt;</span>
<span class="line-numbers">15</span>        <span class="comment">&lt;!-- end::grpcClient[] --&gt;</span>
<span class="line-numbers">16</span>    <span class="tag">&lt;/featureManager&gt;</span>
<span class="line-numbers">17</span>
<span class="line-numbers">18</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9081</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.http.port</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">19</span>    <span class="tag">&lt;variable</span> <span class="attribute-name">defaultValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">9444</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">default.https.port</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">20</span>
<span class="line-numbers">21</span>    <span class="tag">&lt;httpEndpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">defaultHttpEndpoint</span><span class="delimiter">"</span></span>
<span class="line-numbers">22</span>                  <span class="attribute-name">httpPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.http.port}</span><span class="delimiter">"</span></span>
<span class="line-numbers">23</span>                  <span class="attribute-name">httpsPort</span>=<span class="string"><span class="delimiter">"</span><span class="content">${default.https.port}</span><span class="delimiter">"</span></span>
<span class="line-numbers">24</span>                  <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">"</span><span class="content">*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>    <span class="comment">&lt;!-- tag::grpcClientConfig[] --&gt;</span>
<span class="line-numbers">27</span>    <span class="comment">&lt;!-- Due to host="*", this configuration will be applied to every gRPC client call</span>
<span class="line-numbers">28</span><span class="comment">         that gets made. This configuration registers a ClientInterceptor, and it directs</span>
<span class="line-numbers">29</span><span class="comment">         Cookie headers to get forwarded with any outbound RPC calls, in this case, that</span>
<span class="line-numbers">30</span><span class="comment">         enables authorization propagation. --&gt;</span>
<span class="line-numbers">31</span>    <span class="tag">&lt;grpcClient</span> <span class="attribute-name">headersToPropagate</span>=<span class="string"><span class="delimiter">"</span><span class="content">Cookie</span><span class="delimiter">"</span></span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">"</span><span class="content">*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">32</span>    <span class="comment">&lt;!-- end::grpcClientConfig[] --&gt;</span>
<span class="line-numbers">33</span>
<span class="line-numbers">34</span>    <span class="tag">&lt;applicationManager</span> <span class="attribute-name">autoExpand</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>    <span class="tag">&lt;webApplication</span> <span class="attribute-name">contextRoot</span>=<span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">guide-grpc-intro-query.war</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">37</span>
<span class="line-numbers">38</span>    <span class="tag">&lt;logging</span> <span class="attribute-name">consoleLogLevel</span>=<span class="string"><span class="delimiter">"</span><span class="content">INFO</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="line-numbers">39</span><span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the <code class="hotspot=grpc file=3">grpc</code> and <code class="hotspot=grpcClient file=3">grpcClient</code> features to the Liberty <code>server.xml</code> configuration file for the <code>query</code> service. These two features enable gRPC server and client support on Liberty respectively. Configure the <code class="hotspot=grpcClientConfig file=3">grpcClient</code> feature with the <code>headersToPropagate</code> and <code>target</code> attributes. If you want to learn more about <code>grpcClient</code> feature configuration, see the <a href="https://openliberty.io/docs/latest/reference/config/grpcClient.html" target="_blank" rel="noopener">GRPC Client Properties</a>.</p>
</div>
<div class="paragraph">
<p>Because you are running the <code>system</code> and <code>query</code> services in dev mode, the changes that you made are automatically picked up. You’re now ready to check out your application in your browser.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9081/query/properties/os.name" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/os.name</a> URL to test out the unary service call. Your operating system name is displayed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-the-server-streaming-call">Implementing the server streaming call</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the server streaming call, the <code>query</code> client service provides the <code>/query/properties/os</code> endpoint that sends a message to the <code>system</code> server service. The <code>system</code> service streams any properties that start with <code>os.</code> back to the <code>query</code> service. A channel is created between the <code>query</code> and the <code>system</code> services to stream messages. The channel is closed by the <code>system</code> service only after sending the last message to the <code>query</code> service.</p>
</div>
<div class="paragraph">
<p>Update the <code>SystemService</code> class to implement the server streaming RPC call.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemService</code> class.</mark>
<code>system/src/main/java/io/openliberty/guides/system/SystemService.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright,getClientStreamingProperties,getBidirectionalProperties">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 19</span><span class="comment">// tag::importGrpcClasses[]</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 26</span><span class="comment">// end::importGrpcClasses[]</span>
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="comment">// tag::extends[]</span>
<span class="line-numbers"> 29</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> <span class="directive">extends</span> SystemServiceGrpc.SystemServiceImplBase {
<span class="line-numbers"> 30</span><span class="comment">// end::extends[]</span>
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="directive">public</span> SystemService() {
<span class="line-numbers"> 35</span>    }
<span class="line-numbers"> 36</span>
<span class="line-numbers"> 37</span>    <span class="comment">// tag::getProperty[]</span>
<span class="line-numbers"> 38</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 39</span>    <span class="directive">public</span> <span class="type">void</span> getProperty(
<span class="line-numbers"> 40</span>        SystemPropertyName request, StreamObserver&lt;SystemPropertyValue&gt; observer) {
<span class="line-numbers"> 41</span>
<span class="line-numbers"> 42</span>        <span class="comment">// tag::pName[]</span>
<span class="line-numbers"> 43</span>        <span class="predefined-type">String</span> pName = request.getPropertyName();
<span class="line-numbers"> 44</span>        <span class="comment">// end::pName[]</span>
<span class="line-numbers"> 45</span>        <span class="comment">// tag::pValue[]</span>
<span class="line-numbers"> 46</span>        <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers"> 47</span>        <span class="comment">// end::pValue[]</span>
<span class="line-numbers"> 48</span>        <span class="comment">// tag::response[]</span>
<span class="line-numbers"> 49</span>        SystemPropertyValue value = SystemPropertyValue
<span class="line-numbers"> 50</span>                                        .newBuilder()
<span class="line-numbers"> 51</span>                                        .setPropertyValue(pValue)
<span class="line-numbers"> 52</span>                                        .build();
<span class="line-numbers"> 53</span>        <span class="comment">// end::response[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>        <span class="comment">// tag::next[]</span>
<span class="line-numbers"> 56</span>        observer.onNext(value);
<span class="line-numbers"> 57</span>        <span class="comment">// end::next[]</span>
<span class="line-numbers"> 58</span>        <span class="comment">// tag::complete[]</span>
<span class="line-numbers"> 59</span>        observer.onCompleted();
<span class="line-numbers"> 60</span>        <span class="comment">// end::complete[]</span>
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>    }
<span class="line-numbers"> 63</span>    <span class="comment">// end::getProperty[]</span>
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 67</span>    <span class="directive">public</span> <span class="type">void</span> getServerStreamingProperties(
<span class="line-numbers"> 68</span>        SystemPropertyPrefix request, StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers"> 69</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::prefix[]</span>
<span class="line-numbers"> 71</span>        <span class="predefined-type">String</span> prefix = request.getPropertyPrefix();
<span class="line-numbers"> 72</span>        <span class="comment">// end::prefix[]</span>
<span class="line-numbers"> 73</span>        <span class="predefined-type">System</span>.getProperties()
<span class="line-numbers"> 74</span>              .stringPropertyNames()
<span class="line-numbers"> 75</span>              .stream()
<span class="line-numbers"> 76</span>              <span class="comment">// tag::filter[]</span>
<span class="line-numbers"> 77</span>              .filter(name -&gt; name.startsWith(prefix))
<span class="line-numbers"> 78</span>              <span class="comment">// end::filter[]</span>
<span class="line-numbers"> 79</span>              .forEach(name -&gt; {
<span class="line-numbers"> 80</span>                  <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(name);
<span class="line-numbers"> 81</span>                  <span class="comment">// tag::serverMessage[]</span>
<span class="line-numbers"> 82</span>                  SystemProperty value = SystemProperty
<span class="line-numbers"> 83</span>                      .newBuilder()
<span class="line-numbers"> 84</span>                      .setPropertyName(name)
<span class="line-numbers"> 85</span>                      .setPropertyValue(pValue)
<span class="line-numbers"> 86</span>                      .build();
<span class="line-numbers"> 87</span>                  <span class="comment">// end::serverMessage[]</span>
<span class="line-numbers"> 88</span>                  <span class="comment">// tag::serverNext1[]</span>
<span class="line-numbers"> 89</span>                  observer.onNext(value);
<span class="line-numbers"> 90</span>                  <span class="comment">// end::serverNext1[]</span>
<span class="line-numbers"> 91</span>                  logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming sent property: </span><span class="delimiter">"</span></span> + name);
<span class="line-numbers"> 92</span>               });
<span class="line-numbers"> 93</span>        <span class="comment">// tag::serverComplete[]</span>
<span class="line-numbers"> 94</span>        observer.onCompleted();
<span class="line-numbers"> 95</span>        <span class="comment">// end::serverComplete[]</span>
<span class="line-numbers"> 96</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">101</span>    <span class="annotation">@Override</span>
<span class="line-numbers">102</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getClientStreamingProperties(
<span class="line-numbers">103</span>        StreamObserver&lt;SystemProperties&gt; observer) {
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        <span class="comment">// tag::streamObserverClient[]</span>
<span class="line-numbers">106</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>            <span class="comment">// tag::clientStreamingMap[]</span>
<span class="line-numbers">109</span>            <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();
<span class="line-numbers">110</span>            <span class="comment">// end::clientStreamingMap[]</span>
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>            <span class="comment">// tag::receivingProperties[]</span>
<span class="line-numbers">113</span>            <span class="annotation">@Override</span>
<span class="line-numbers">114</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">115</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">116</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">117</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received property: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">118</span>                properties.put(pName, pValue);
<span class="line-numbers">119</span>            }
<span class="line-numbers">120</span>            <span class="comment">// end::receivingProperties[]</span>
<span class="line-numbers">121</span>
<span class="line-numbers">122</span>            <span class="annotation">@Override</span>
<span class="line-numbers">123</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">124</span>                t.printStackTrace();
<span class="line-numbers">125</span>            }
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>            <span class="comment">// tag::clientStreamingCompleted[]</span>
<span class="line-numbers">128</span>            <span class="annotation">@Override</span>
<span class="line-numbers">129</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">130</span>                SystemProperties value = SystemProperties.newBuilder()
<span class="line-numbers">131</span>                                             .putAllProperties(properties)
<span class="line-numbers">132</span>                                             .build();
<span class="line-numbers">133</span>                observer.onNext(value);
<span class="line-numbers">134</span>                observer.onCompleted();
<span class="line-numbers">135</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">136</span>            }
<span class="line-numbers">137</span>            <span class="comment">// end::clientStreamingCompleted[]</span>
<span class="line-numbers">138</span>        };
<span class="line-numbers">139</span>        <span class="comment">// end::streamObserverClient[]</span>
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>    <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">142</span>
<span class="line-numbers">143</span>    <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">144</span>    <span class="annotation">@Override</span>
<span class="line-numbers">145</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getBidirectionalProperties(
<span class="line-numbers">146</span>        StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>        <span class="comment">// tag::streamObserverBidirectional[]</span>
<span class="line-numbers">149</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">150</span>            <span class="comment">// tag::receiveBidirectionalProperties[]</span>
<span class="line-numbers">151</span>            <span class="annotation">@Override</span>
<span class="line-numbers">152</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">153</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">154</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">155</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming received: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">156</span>                <span class="comment">// tag::systemPropertyMessage[]</span>
<span class="line-numbers">157</span>                SystemProperty value = SystemProperty.newBuilder()
<span class="line-numbers">158</span>                                           .setPropertyName(pName)
<span class="line-numbers">159</span>                                           .setPropertyValue(pValue)
<span class="line-numbers">160</span>                                           .build();
<span class="line-numbers">161</span>                <span class="comment">// end::systemPropertyMessage[]</span>
<span class="line-numbers">162</span>                <span class="comment">// tag::serverNext2[]</span>
<span class="line-numbers">163</span>                observer.onNext(value);
<span class="line-numbers">164</span>                <span class="comment">// end::serverNext2[]</span>
<span class="line-numbers">165</span>            }
<span class="line-numbers">166</span>            <span class="comment">// end::receiveBidirectionalProperties[]</span>
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>            <span class="annotation">@Override</span>
<span class="line-numbers">169</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">170</span>                t.printStackTrace();
<span class="line-numbers">171</span>            }
<span class="line-numbers">172</span>
<span class="line-numbers">173</span>            <span class="comment">// tag::bidirectionalCompleted[]</span>
<span class="line-numbers">174</span>            <span class="annotation">@Override</span>
<span class="line-numbers">175</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">176</span>                observer.onCompleted();
<span class="line-numbers">177</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">178</span>            }
<span class="line-numbers">179</span>            <span class="comment">// end::bidirectionalCompleted[]</span>
<span class="line-numbers">180</span>        };
<span class="line-numbers">181</span>        <span class="comment">// end::streamObserverBidirectional[]</span>
<span class="line-numbers">182</span>    }
<span class="line-numbers">183</span>    <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">184</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getServerStreamingProperties file=0">getServerStreamingProperties()</code> method implements the server streaming RPC call. The <code class="hotspot=prefix file=0">getPropertyPrefix()</code> getter method retrieves the property prefix from the client. Properties that start with the <code class="hotspot=filter file=0">prefix</code> are filtered out. For each property, a <code class="hotspot=serverMessage file=0">SystemProperty</code> message is built and streamed to the client through the <code>StreamObserver</code> by using its <code class="hotspot=serverNext1 file=0">onNext()</code> method. When all properties are streamed, the service stops streaming by calling the <code class="hotspot=serverComplete file=0">onComplete()</code> method.</p>
</div>
<div class="paragraph">
<p>Update the <code>PropertiesResource</code> class to implement the <code>/query/properties/os</code> endpoint of the <code>query</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>PropertiesResource</code> class.</mark>
<code>query/src/main/java/io/openliberty/guides/query/PropertiesResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>PropertiesResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright,clientStreaming,bidirectionalStreaming">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannel</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannelBuilder</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 34</span><span class="comment">// tag::grpcImports[]</span>
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceBlockingStub</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceStub</span>;
<span class="line-numbers"> 43</span><span class="comment">// end::grpcImports[]</span>
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 46</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/properties</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 47</span><span class="directive">public</span> <span class="type">class</span> <span class="class">PropertiesResource</span> {
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(PropertiesResource.class.getName());
<span class="line-numbers"> 50</span>
<span class="line-numbers"> 51</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 52</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.hostname</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 53</span>    <span class="predefined-type">String</span> SYSTEM_HOST;
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.port</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="type">int</span> SYSTEM_PORT;
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="comment">// tag::unary[]</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 61</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{property}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 62</span>    <span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers"> 63</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getPropertiesString(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> property) {
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>        <span class="comment">// tag::createChannel1[]</span>
<span class="line-numbers"> 66</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 67</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 68</span>                                     .usePlaintext().build();
<span class="line-numbers"> 69</span>        <span class="comment">// end::createChannel1[]</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::createClient1[]</span>
<span class="line-numbers"> 71</span>        SystemServiceBlockingStub client = SystemServiceGrpc.newBlockingStub(channel);
<span class="line-numbers"> 72</span>        <span class="comment">// end::createClient1[]</span>
<span class="line-numbers"> 73</span>        SystemPropertyName request = SystemPropertyName.newBuilder()
<span class="line-numbers"> 74</span>                                             .setPropertyName(property).build();
<span class="line-numbers"> 75</span>        SystemPropertyValue response = client.getProperty(request);
<span class="line-numbers"> 76</span>        channel.shutdownNow();
<span class="line-numbers"> 77</span>        <span class="keyword">return</span> response.getPropertyValue();
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>    <span class="comment">// end::unary[]</span>
<span class="line-numbers"> 80</span>
<span class="line-numbers"> 81</span>    <span class="comment">// tag::serverStreaming[]</span>
<span class="line-numbers"> 82</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 83</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 84</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 85</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getOSProperties() {
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>        <span class="comment">// tag::createChannel2[]</span>
<span class="line-numbers"> 88</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 89</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 90</span>                                     .usePlaintext().build();
<span class="line-numbers"> 91</span>        <span class="comment">// end::createChannel2[]</span>
<span class="line-numbers"> 92</span>        <span class="comment">// tag::createClient2[]</span>
<span class="line-numbers"> 93</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers"> 94</span>        <span class="comment">// end::createClient2[]</span>
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 97</span>        <span class="comment">// tag::countDownLatch1[]</span>
<span class="line-numbers"> 98</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers"> 99</span>        <span class="comment">// end::countDownLatch1[]</span>
<span class="line-numbers">100</span>        SystemPropertyPrefix request = SystemPropertyPrefix.newBuilder()
<span class="line-numbers">101</span>                                         .setPropertyPrefix(<span class="string"><span class="delimiter">"</span><span class="content">os.</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">102</span>        <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers">103</span>        client.getServerStreamingProperties(
<span class="line-numbers">104</span>            request, <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">105</span>
<span class="line-numbers">106</span>            <span class="comment">// tag::onNext1[]</span>
<span class="line-numbers">107</span>            <span class="annotation">@Override</span>
<span class="line-numbers">108</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">109</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">110</span>                   + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">111</span>                properties.put(value.getPropertyName(), value.getPropertyValue());
<span class="line-numbers">112</span>            }
<span class="line-numbers">113</span>            <span class="comment">// end::onNext1[]</span>
<span class="line-numbers">114</span>
<span class="line-numbers">115</span>            <span class="annotation">@Override</span>
<span class="line-numbers">116</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">117</span>                t.printStackTrace();
<span class="line-numbers">118</span>            }
<span class="line-numbers">119</span>
<span class="line-numbers">120</span>            <span class="annotation">@Override</span>
<span class="line-numbers">121</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">122</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">123</span>                <span class="comment">// tag::countDownLatch2[]</span>
<span class="line-numbers">124</span>                countDown.countDown();
<span class="line-numbers">125</span>                <span class="comment">// end::countDownLatch2[]</span>
<span class="line-numbers">126</span>            }
<span class="line-numbers">127</span>        });
<span class="line-numbers">128</span>        <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers">129</span>
<span class="line-numbers">130</span>
<span class="line-numbers">131</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">132</span>        <span class="comment">// tag::countDownLatch3[]</span>
<span class="line-numbers">133</span>        <span class="keyword">try</span> {
<span class="line-numbers">134</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">135</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">136</span>            e.printStackTrace();
<span class="line-numbers">137</span>        }
<span class="line-numbers">138</span>        <span class="comment">// end::countDownLatch3[]</span>
<span class="line-numbers">139</span>
<span class="line-numbers">140</span>        <span class="comment">// tag::closeConnection[]</span>
<span class="line-numbers">141</span>        channel.shutdownNow();
<span class="line-numbers">142</span>        <span class="comment">// end::closeConnection[]</span>
<span class="line-numbers">143</span>
<span class="line-numbers">144</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">145</span>    }
<span class="line-numbers">146</span>    <span class="comment">// end::serverStreaming[]</span>
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>    <span class="comment">// tag::clientStreaming[]</span>
<span class="line-numbers">149</span>    <span class="annotation">@GET</span>
<span class="line-numbers">150</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/user</span><span class="delimiter">"</span></span>)
<span class="line-numbers">151</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">152</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getUserProperties() {
<span class="line-numbers">153</span>
<span class="line-numbers">154</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">155</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">156</span>                                     .usePlaintext().build();
<span class="line-numbers">157</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">158</span>        <span class="comment">// tag::countDownLatch4[]</span>
<span class="line-numbers">159</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">160</span>        <span class="comment">// end::countDownLatch4[]</span>
<span class="line-numbers">161</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">162</span>
<span class="line-numbers">163</span>        <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">164</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getClientStreamingProperties(
<span class="line-numbers">165</span>            <span class="keyword">new</span> StreamObserver&lt;SystemProperties&gt;() {
<span class="line-numbers">166</span>
<span class="line-numbers">167</span>                <span class="annotation">@Override</span>
<span class="line-numbers">168</span>                <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperties value) {
<span class="line-numbers">169</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received a map that has </span><span class="delimiter">"</span></span>
<span class="line-numbers">170</span>                        + value.getPropertiesCount() + <span class="string"><span class="delimiter">"</span><span class="content"> properties</span><span class="delimiter">"</span></span>);
<span class="line-numbers">171</span>                    properties.putAll(value.getPropertiesMap());
<span class="line-numbers">172</span>                }
<span class="line-numbers">173</span>
<span class="line-numbers">174</span>                <span class="annotation">@Override</span>
<span class="line-numbers">175</span>                <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">176</span>                    t.printStackTrace();
<span class="line-numbers">177</span>                }
<span class="line-numbers">178</span>
<span class="line-numbers">179</span>                <span class="annotation">@Override</span>
<span class="line-numbers">180</span>                <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">181</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">182</span>                    <span class="comment">// tag::countDownLatch5[]</span>
<span class="line-numbers">183</span>                    countDown.countDown();
<span class="line-numbers">184</span>                    <span class="comment">// end::countDownLatch5[]</span>
<span class="line-numbers">185</span>                }
<span class="line-numbers">186</span>            });
<span class="line-numbers">187</span>        <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">188</span>
<span class="line-numbers">189</span>        <span class="comment">// collect the property names starting with user.</span>
<span class="line-numbers">190</span>        <span class="comment">// tag::collectUserProperties[]</span>
<span class="line-numbers">191</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">192</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">user.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">193</span>                                  .collect(Collectors.toList());
<span class="line-numbers">194</span>        <span class="comment">// end::collectUserProperties[]</span>
<span class="line-numbers">195</span>
<span class="line-numbers">196</span>        <span class="comment">// send messages to the server</span>
<span class="line-numbers">197</span>        keys.stream()
<span class="line-numbers">198</span>            <span class="comment">// tag::clientMessage1[]</span>
<span class="line-numbers">199</span>            .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">200</span>            <span class="comment">// end::clientMessage1[]</span>
<span class="line-numbers">201</span>            <span class="comment">// tag::streamOnNext1[]</span>
<span class="line-numbers">202</span>            .forEach(stream::onNext);
<span class="line-numbers">203</span>            <span class="comment">// end::streamOnNext1[]</span>
<span class="line-numbers">204</span>        <span class="comment">// tag::clientCompleted1[]</span>
<span class="line-numbers">205</span>        stream.onCompleted();
<span class="line-numbers">206</span>        <span class="comment">// end::clientCompleted1[]</span>
<span class="line-numbers">207</span>
<span class="line-numbers">208</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">209</span>        <span class="comment">// tag::countDownLatch6[]</span>
<span class="line-numbers">210</span>        <span class="keyword">try</span> {
<span class="line-numbers">211</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">212</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">213</span>            e.printStackTrace();
<span class="line-numbers">214</span>        }
<span class="line-numbers">215</span>        <span class="comment">// end::countDownLatch6[]</span>
<span class="line-numbers">216</span>
<span class="line-numbers">217</span>        channel.shutdownNow();
<span class="line-numbers">218</span>
<span class="line-numbers">219</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">220</span>    }
<span class="line-numbers">221</span>    <span class="comment">// end::clientStreaming[]</span>
<span class="line-numbers">222</span>
<span class="line-numbers">223</span>    <span class="comment">// tag::bidirectionalStreaming[]</span>
<span class="line-numbers">224</span>    <span class="annotation">@GET</span>
<span class="line-numbers">225</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/java</span><span class="delimiter">"</span></span>)
<span class="line-numbers">226</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">227</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getJavaProperties() {
<span class="line-numbers">228</span>
<span class="line-numbers">229</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">230</span>                                      .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">231</span>                                      .usePlaintext().build();
<span class="line-numbers">232</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">233</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">234</span>        <span class="comment">// tag::countDownLatch7[]</span>
<span class="line-numbers">235</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">236</span>        <span class="comment">// end::countDownLatch7[]</span>
<span class="line-numbers">237</span>
<span class="line-numbers">238</span>        <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">239</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getBidirectionalProperties(
<span class="line-numbers">240</span>                <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">241</span>
<span class="line-numbers">242</span>                    <span class="comment">// tag::onNext2[]</span>
<span class="line-numbers">243</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">244</span>                    <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">245</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">246</span>                            + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">247</span>                        properties.put(value.getPropertyName(),
<span class="line-numbers">248</span>                                       value.getPropertyValue());
<span class="line-numbers">249</span>                    }
<span class="line-numbers">250</span>                    <span class="comment">// end::onNext2[]</span>
<span class="line-numbers">251</span>
<span class="line-numbers">252</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">253</span>                    <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">254</span>                        t.printStackTrace();
<span class="line-numbers">255</span>                    }
<span class="line-numbers">256</span>
<span class="line-numbers">257</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">258</span>                    <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">259</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">260</span>                        <span class="comment">// tag::countDownLatch8[]</span>
<span class="line-numbers">261</span>                        countDown.countDown();
<span class="line-numbers">262</span>                        <span class="comment">// end::countDownLatch8[]</span>
<span class="line-numbers">263</span>                    }
<span class="line-numbers">264</span>                });
<span class="line-numbers">265</span>        <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">266</span>
<span class="line-numbers">267</span>        <span class="comment">// collect the property names starting with java</span>
<span class="line-numbers">268</span>        <span class="comment">// tag::collectJavaProperties[]</span>
<span class="line-numbers">269</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">270</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">java.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">271</span>                                  .collect(Collectors.toList());
<span class="line-numbers">272</span>        <span class="comment">// end::collectJavaProperties[]</span>
<span class="line-numbers">273</span>
<span class="line-numbers">274</span>        <span class="comment">// post messages to the server</span>
<span class="line-numbers">275</span>        keys.stream()
<span class="line-numbers">276</span>              <span class="comment">// tag::clientMessage2[]</span>
<span class="line-numbers">277</span>              .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">278</span>              <span class="comment">// end::clientMessage2[]</span>
<span class="line-numbers">279</span>              <span class="comment">// tag::streamOnNext2[]</span>
<span class="line-numbers">280</span>              .forEach(stream::onNext);
<span class="line-numbers">281</span>              <span class="comment">// end::streamOnNext2[]</span>
<span class="line-numbers">282</span>        <span class="comment">// tag::clientCompleted2[]</span>
<span class="line-numbers">283</span>        stream.onCompleted();
<span class="line-numbers">284</span>        <span class="comment">// end::clientCompleted2[]</span>
<span class="line-numbers">285</span>
<span class="line-numbers">286</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">287</span>        <span class="comment">// tag::countDownLatch9[]</span>
<span class="line-numbers">288</span>        <span class="keyword">try</span> {
<span class="line-numbers">289</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">290</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">291</span>            e.printStackTrace();
<span class="line-numbers">292</span>        }
<span class="line-numbers">293</span>        <span class="comment">// end::countDownLatch9[]</span>
<span class="line-numbers">294</span>
<span class="line-numbers">295</span>        channel.shutdownNow();
<span class="line-numbers">296</span>
<span class="line-numbers">297</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">298</span>    }
<span class="line-numbers">299</span>    <span class="comment">// end::bidirectionalStreaming[]</span>
<span class="line-numbers">300</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint creates a <code class="hotspot=createChannel2 file=1">channel</code> to the <code>system</code> service and a <code class="hotspot=createClient2 file=1">client</code> by using the <code>SystemServiceGrpc.newStub()</code> API. Then, it calls the <code class="hotspot=getServerStreamingProperties file=1">getServerStreamingProperties()</code> method with an implementation of the <code>StreamObserver</code> interface. The <code class="hotspot=onNext1 file=1">onNext()</code> method receives messages streaming from the server service individually and stores them into the <code>properties</code> placeholder. After all properties are received, the <code>system</code> service shuts down the <code class="hotspot=closeConnection file=1">channel</code> and returns the placeholder. Because the RPC call is asynchronous, a <code class="hotspot=countDownLatch1 hotspot=countDownLatch2 hotspot=countDownLatch3 file=1">CountDownLatch</code> instance synchronizes the streaming flow.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9081/query/properties/os" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/os</a> URL to test out the server streaming call. The <code>os.</code> properties from the <code>system</code> service are displayed. Observe the output from the consoles running the <code>system</code> and <code>query</code> services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-the-client-streaming-call">Implementing the client streaming call</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the client streaming call, the <code>query</code> client service provides the <code>/query/properties/user</code> endpoint, which streams the user properties to the <code>system</code> server service. The <code>system</code> service returns a map of user properties with their values.</p>
</div>
<div class="paragraph">
<p>Update the <code>SystemService</code> class to implement the client streaming RPC call.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemService</code> class.</mark>
<code>system/src/main/java/io/openliberty/guides/system/SystemService.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright,getBidirectionalProperties">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 19</span><span class="comment">// tag::importGrpcClasses[]</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 26</span><span class="comment">// end::importGrpcClasses[]</span>
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="comment">// tag::extends[]</span>
<span class="line-numbers"> 29</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> <span class="directive">extends</span> SystemServiceGrpc.SystemServiceImplBase {
<span class="line-numbers"> 30</span><span class="comment">// end::extends[]</span>
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="directive">public</span> SystemService() {
<span class="line-numbers"> 35</span>    }
<span class="line-numbers"> 36</span>
<span class="line-numbers"> 37</span>    <span class="comment">// tag::getProperty[]</span>
<span class="line-numbers"> 38</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 39</span>    <span class="directive">public</span> <span class="type">void</span> getProperty(
<span class="line-numbers"> 40</span>        SystemPropertyName request, StreamObserver&lt;SystemPropertyValue&gt; observer) {
<span class="line-numbers"> 41</span>
<span class="line-numbers"> 42</span>        <span class="comment">// tag::pName[]</span>
<span class="line-numbers"> 43</span>        <span class="predefined-type">String</span> pName = request.getPropertyName();
<span class="line-numbers"> 44</span>        <span class="comment">// end::pName[]</span>
<span class="line-numbers"> 45</span>        <span class="comment">// tag::pValue[]</span>
<span class="line-numbers"> 46</span>        <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers"> 47</span>        <span class="comment">// end::pValue[]</span>
<span class="line-numbers"> 48</span>        <span class="comment">// tag::response[]</span>
<span class="line-numbers"> 49</span>        SystemPropertyValue value = SystemPropertyValue
<span class="line-numbers"> 50</span>                                        .newBuilder()
<span class="line-numbers"> 51</span>                                        .setPropertyValue(pValue)
<span class="line-numbers"> 52</span>                                        .build();
<span class="line-numbers"> 53</span>        <span class="comment">// end::response[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>        <span class="comment">// tag::next[]</span>
<span class="line-numbers"> 56</span>        observer.onNext(value);
<span class="line-numbers"> 57</span>        <span class="comment">// end::next[]</span>
<span class="line-numbers"> 58</span>        <span class="comment">// tag::complete[]</span>
<span class="line-numbers"> 59</span>        observer.onCompleted();
<span class="line-numbers"> 60</span>        <span class="comment">// end::complete[]</span>
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>    }
<span class="line-numbers"> 63</span>    <span class="comment">// end::getProperty[]</span>
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 67</span>    <span class="directive">public</span> <span class="type">void</span> getServerStreamingProperties(
<span class="line-numbers"> 68</span>        SystemPropertyPrefix request, StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers"> 69</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::prefix[]</span>
<span class="line-numbers"> 71</span>        <span class="predefined-type">String</span> prefix = request.getPropertyPrefix();
<span class="line-numbers"> 72</span>        <span class="comment">// end::prefix[]</span>
<span class="line-numbers"> 73</span>        <span class="predefined-type">System</span>.getProperties()
<span class="line-numbers"> 74</span>              .stringPropertyNames()
<span class="line-numbers"> 75</span>              .stream()
<span class="line-numbers"> 76</span>              <span class="comment">// tag::filter[]</span>
<span class="line-numbers"> 77</span>              .filter(name -&gt; name.startsWith(prefix))
<span class="line-numbers"> 78</span>              <span class="comment">// end::filter[]</span>
<span class="line-numbers"> 79</span>              .forEach(name -&gt; {
<span class="line-numbers"> 80</span>                  <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(name);
<span class="line-numbers"> 81</span>                  <span class="comment">// tag::serverMessage[]</span>
<span class="line-numbers"> 82</span>                  SystemProperty value = SystemProperty
<span class="line-numbers"> 83</span>                      .newBuilder()
<span class="line-numbers"> 84</span>                      .setPropertyName(name)
<span class="line-numbers"> 85</span>                      .setPropertyValue(pValue)
<span class="line-numbers"> 86</span>                      .build();
<span class="line-numbers"> 87</span>                  <span class="comment">// end::serverMessage[]</span>
<span class="line-numbers"> 88</span>                  <span class="comment">// tag::serverNext1[]</span>
<span class="line-numbers"> 89</span>                  observer.onNext(value);
<span class="line-numbers"> 90</span>                  <span class="comment">// end::serverNext1[]</span>
<span class="line-numbers"> 91</span>                  logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming sent property: </span><span class="delimiter">"</span></span> + name);
<span class="line-numbers"> 92</span>               });
<span class="line-numbers"> 93</span>        <span class="comment">// tag::serverComplete[]</span>
<span class="line-numbers"> 94</span>        observer.onCompleted();
<span class="line-numbers"> 95</span>        <span class="comment">// end::serverComplete[]</span>
<span class="line-numbers"> 96</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">101</span>    <span class="annotation">@Override</span>
<span class="line-numbers">102</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getClientStreamingProperties(
<span class="line-numbers">103</span>        StreamObserver&lt;SystemProperties&gt; observer) {
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        <span class="comment">// tag::streamObserverClient[]</span>
<span class="line-numbers">106</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>            <span class="comment">// tag::clientStreamingMap[]</span>
<span class="line-numbers">109</span>            <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();
<span class="line-numbers">110</span>            <span class="comment">// end::clientStreamingMap[]</span>
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>            <span class="comment">// tag::receivingProperties[]</span>
<span class="line-numbers">113</span>            <span class="annotation">@Override</span>
<span class="line-numbers">114</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">115</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">116</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">117</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received property: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">118</span>                properties.put(pName, pValue);
<span class="line-numbers">119</span>            }
<span class="line-numbers">120</span>            <span class="comment">// end::receivingProperties[]</span>
<span class="line-numbers">121</span>
<span class="line-numbers">122</span>            <span class="annotation">@Override</span>
<span class="line-numbers">123</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">124</span>                t.printStackTrace();
<span class="line-numbers">125</span>            }
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>            <span class="comment">// tag::clientStreamingCompleted[]</span>
<span class="line-numbers">128</span>            <span class="annotation">@Override</span>
<span class="line-numbers">129</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">130</span>                SystemProperties value = SystemProperties.newBuilder()
<span class="line-numbers">131</span>                                             .putAllProperties(properties)
<span class="line-numbers">132</span>                                             .build();
<span class="line-numbers">133</span>                observer.onNext(value);
<span class="line-numbers">134</span>                observer.onCompleted();
<span class="line-numbers">135</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">136</span>            }
<span class="line-numbers">137</span>            <span class="comment">// end::clientStreamingCompleted[]</span>
<span class="line-numbers">138</span>        };
<span class="line-numbers">139</span>        <span class="comment">// end::streamObserverClient[]</span>
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>    <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">142</span>
<span class="line-numbers">143</span>    <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">144</span>    <span class="annotation">@Override</span>
<span class="line-numbers">145</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getBidirectionalProperties(
<span class="line-numbers">146</span>        StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>        <span class="comment">// tag::streamObserverBidirectional[]</span>
<span class="line-numbers">149</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">150</span>            <span class="comment">// tag::receiveBidirectionalProperties[]</span>
<span class="line-numbers">151</span>            <span class="annotation">@Override</span>
<span class="line-numbers">152</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">153</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">154</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">155</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming received: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">156</span>                <span class="comment">// tag::systemPropertyMessage[]</span>
<span class="line-numbers">157</span>                SystemProperty value = SystemProperty.newBuilder()
<span class="line-numbers">158</span>                                           .setPropertyName(pName)
<span class="line-numbers">159</span>                                           .setPropertyValue(pValue)
<span class="line-numbers">160</span>                                           .build();
<span class="line-numbers">161</span>                <span class="comment">// end::systemPropertyMessage[]</span>
<span class="line-numbers">162</span>                <span class="comment">// tag::serverNext2[]</span>
<span class="line-numbers">163</span>                observer.onNext(value);
<span class="line-numbers">164</span>                <span class="comment">// end::serverNext2[]</span>
<span class="line-numbers">165</span>            }
<span class="line-numbers">166</span>            <span class="comment">// end::receiveBidirectionalProperties[]</span>
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>            <span class="annotation">@Override</span>
<span class="line-numbers">169</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">170</span>                t.printStackTrace();
<span class="line-numbers">171</span>            }
<span class="line-numbers">172</span>
<span class="line-numbers">173</span>            <span class="comment">// tag::bidirectionalCompleted[]</span>
<span class="line-numbers">174</span>            <span class="annotation">@Override</span>
<span class="line-numbers">175</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">176</span>                observer.onCompleted();
<span class="line-numbers">177</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">178</span>            }
<span class="line-numbers">179</span>            <span class="comment">// end::bidirectionalCompleted[]</span>
<span class="line-numbers">180</span>        };
<span class="line-numbers">181</span>        <span class="comment">// end::streamObserverBidirectional[]</span>
<span class="line-numbers">182</span>    }
<span class="line-numbers">183</span>    <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">184</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getClientStreamingProperties file=0">getClientStreamingProperties()</code> method implements client streaming RPC call. This method returns an instance of the <code class="hotspot=streamObserverClient file=0">StreamObserver</code> interface. Its <code class="hotspot=receivingProperties file=0">onNext()</code> method receives the messages from the client individually and stores the property values into the <code class="hotspot=clientStreamingMap file=0">properties</code> map placeholder. When the streaming is completed, the <code>properties</code> placeholder is sent back to the client by the <code class="hotspot=clientStreamingCompleted file=0">onCompleted()</code> method.</p>
</div>
<div class="paragraph">
<p>Update the <code>PropertiesResource</code> class to implement the <code>/query/properties/user</code> endpoint of the query service.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>PropertiesResource</code> class.</mark>
<code>query/src/main/java/io/openliberty/guides/query/PropertiesResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>PropertiesResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright,bidirectionalStreaming">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannel</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannelBuilder</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 34</span><span class="comment">// tag::grpcImports[]</span>
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceBlockingStub</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceStub</span>;
<span class="line-numbers"> 43</span><span class="comment">// end::grpcImports[]</span>
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 46</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/properties</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 47</span><span class="directive">public</span> <span class="type">class</span> <span class="class">PropertiesResource</span> {
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(PropertiesResource.class.getName());
<span class="line-numbers"> 50</span>
<span class="line-numbers"> 51</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 52</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.hostname</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 53</span>    <span class="predefined-type">String</span> SYSTEM_HOST;
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.port</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="type">int</span> SYSTEM_PORT;
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="comment">// tag::unary[]</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 61</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{property}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 62</span>    <span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers"> 63</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getPropertiesString(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> property) {
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>        <span class="comment">// tag::createChannel1[]</span>
<span class="line-numbers"> 66</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 67</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 68</span>                                     .usePlaintext().build();
<span class="line-numbers"> 69</span>        <span class="comment">// end::createChannel1[]</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::createClient1[]</span>
<span class="line-numbers"> 71</span>        SystemServiceBlockingStub client = SystemServiceGrpc.newBlockingStub(channel);
<span class="line-numbers"> 72</span>        <span class="comment">// end::createClient1[]</span>
<span class="line-numbers"> 73</span>        SystemPropertyName request = SystemPropertyName.newBuilder()
<span class="line-numbers"> 74</span>                                             .setPropertyName(property).build();
<span class="line-numbers"> 75</span>        SystemPropertyValue response = client.getProperty(request);
<span class="line-numbers"> 76</span>        channel.shutdownNow();
<span class="line-numbers"> 77</span>        <span class="keyword">return</span> response.getPropertyValue();
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>    <span class="comment">// end::unary[]</span>
<span class="line-numbers"> 80</span>
<span class="line-numbers"> 81</span>    <span class="comment">// tag::serverStreaming[]</span>
<span class="line-numbers"> 82</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 83</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 84</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 85</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getOSProperties() {
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>        <span class="comment">// tag::createChannel2[]</span>
<span class="line-numbers"> 88</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 89</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 90</span>                                     .usePlaintext().build();
<span class="line-numbers"> 91</span>        <span class="comment">// end::createChannel2[]</span>
<span class="line-numbers"> 92</span>        <span class="comment">// tag::createClient2[]</span>
<span class="line-numbers"> 93</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers"> 94</span>        <span class="comment">// end::createClient2[]</span>
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 97</span>        <span class="comment">// tag::countDownLatch1[]</span>
<span class="line-numbers"> 98</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers"> 99</span>        <span class="comment">// end::countDownLatch1[]</span>
<span class="line-numbers">100</span>        SystemPropertyPrefix request = SystemPropertyPrefix.newBuilder()
<span class="line-numbers">101</span>                                         .setPropertyPrefix(<span class="string"><span class="delimiter">"</span><span class="content">os.</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">102</span>        <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers">103</span>        client.getServerStreamingProperties(
<span class="line-numbers">104</span>            request, <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">105</span>
<span class="line-numbers">106</span>            <span class="comment">// tag::onNext1[]</span>
<span class="line-numbers">107</span>            <span class="annotation">@Override</span>
<span class="line-numbers">108</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">109</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">110</span>                   + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">111</span>                properties.put(value.getPropertyName(), value.getPropertyValue());
<span class="line-numbers">112</span>            }
<span class="line-numbers">113</span>            <span class="comment">// end::onNext1[]</span>
<span class="line-numbers">114</span>
<span class="line-numbers">115</span>            <span class="annotation">@Override</span>
<span class="line-numbers">116</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">117</span>                t.printStackTrace();
<span class="line-numbers">118</span>            }
<span class="line-numbers">119</span>
<span class="line-numbers">120</span>            <span class="annotation">@Override</span>
<span class="line-numbers">121</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">122</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">123</span>                <span class="comment">// tag::countDownLatch2[]</span>
<span class="line-numbers">124</span>                countDown.countDown();
<span class="line-numbers">125</span>                <span class="comment">// end::countDownLatch2[]</span>
<span class="line-numbers">126</span>            }
<span class="line-numbers">127</span>        });
<span class="line-numbers">128</span>        <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers">129</span>
<span class="line-numbers">130</span>
<span class="line-numbers">131</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">132</span>        <span class="comment">// tag::countDownLatch3[]</span>
<span class="line-numbers">133</span>        <span class="keyword">try</span> {
<span class="line-numbers">134</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">135</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">136</span>            e.printStackTrace();
<span class="line-numbers">137</span>        }
<span class="line-numbers">138</span>        <span class="comment">// end::countDownLatch3[]</span>
<span class="line-numbers">139</span>
<span class="line-numbers">140</span>        <span class="comment">// tag::closeConnection[]</span>
<span class="line-numbers">141</span>        channel.shutdownNow();
<span class="line-numbers">142</span>        <span class="comment">// end::closeConnection[]</span>
<span class="line-numbers">143</span>
<span class="line-numbers">144</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">145</span>    }
<span class="line-numbers">146</span>    <span class="comment">// end::serverStreaming[]</span>
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>    <span class="comment">// tag::clientStreaming[]</span>
<span class="line-numbers">149</span>    <span class="annotation">@GET</span>
<span class="line-numbers">150</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/user</span><span class="delimiter">"</span></span>)
<span class="line-numbers">151</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">152</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getUserProperties() {
<span class="line-numbers">153</span>
<span class="line-numbers">154</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">155</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">156</span>                                     .usePlaintext().build();
<span class="line-numbers">157</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">158</span>        <span class="comment">// tag::countDownLatch4[]</span>
<span class="line-numbers">159</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">160</span>        <span class="comment">// end::countDownLatch4[]</span>
<span class="line-numbers">161</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">162</span>
<span class="line-numbers">163</span>        <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">164</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getClientStreamingProperties(
<span class="line-numbers">165</span>            <span class="keyword">new</span> StreamObserver&lt;SystemProperties&gt;() {
<span class="line-numbers">166</span>
<span class="line-numbers">167</span>                <span class="annotation">@Override</span>
<span class="line-numbers">168</span>                <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperties value) {
<span class="line-numbers">169</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received a map that has </span><span class="delimiter">"</span></span>
<span class="line-numbers">170</span>                        + value.getPropertiesCount() + <span class="string"><span class="delimiter">"</span><span class="content"> properties</span><span class="delimiter">"</span></span>);
<span class="line-numbers">171</span>                    properties.putAll(value.getPropertiesMap());
<span class="line-numbers">172</span>                }
<span class="line-numbers">173</span>
<span class="line-numbers">174</span>                <span class="annotation">@Override</span>
<span class="line-numbers">175</span>                <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">176</span>                    t.printStackTrace();
<span class="line-numbers">177</span>                }
<span class="line-numbers">178</span>
<span class="line-numbers">179</span>                <span class="annotation">@Override</span>
<span class="line-numbers">180</span>                <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">181</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">182</span>                    <span class="comment">// tag::countDownLatch5[]</span>
<span class="line-numbers">183</span>                    countDown.countDown();
<span class="line-numbers">184</span>                    <span class="comment">// end::countDownLatch5[]</span>
<span class="line-numbers">185</span>                }
<span class="line-numbers">186</span>            });
<span class="line-numbers">187</span>        <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">188</span>
<span class="line-numbers">189</span>        <span class="comment">// collect the property names starting with user.</span>
<span class="line-numbers">190</span>        <span class="comment">// tag::collectUserProperties[]</span>
<span class="line-numbers">191</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">192</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">user.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">193</span>                                  .collect(Collectors.toList());
<span class="line-numbers">194</span>        <span class="comment">// end::collectUserProperties[]</span>
<span class="line-numbers">195</span>
<span class="line-numbers">196</span>        <span class="comment">// send messages to the server</span>
<span class="line-numbers">197</span>        keys.stream()
<span class="line-numbers">198</span>            <span class="comment">// tag::clientMessage1[]</span>
<span class="line-numbers">199</span>            .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">200</span>            <span class="comment">// end::clientMessage1[]</span>
<span class="line-numbers">201</span>            <span class="comment">// tag::streamOnNext1[]</span>
<span class="line-numbers">202</span>            .forEach(stream::onNext);
<span class="line-numbers">203</span>            <span class="comment">// end::streamOnNext1[]</span>
<span class="line-numbers">204</span>        <span class="comment">// tag::clientCompleted1[]</span>
<span class="line-numbers">205</span>        stream.onCompleted();
<span class="line-numbers">206</span>        <span class="comment">// end::clientCompleted1[]</span>
<span class="line-numbers">207</span>
<span class="line-numbers">208</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">209</span>        <span class="comment">// tag::countDownLatch6[]</span>
<span class="line-numbers">210</span>        <span class="keyword">try</span> {
<span class="line-numbers">211</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">212</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">213</span>            e.printStackTrace();
<span class="line-numbers">214</span>        }
<span class="line-numbers">215</span>        <span class="comment">// end::countDownLatch6[]</span>
<span class="line-numbers">216</span>
<span class="line-numbers">217</span>        channel.shutdownNow();
<span class="line-numbers">218</span>
<span class="line-numbers">219</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">220</span>    }
<span class="line-numbers">221</span>    <span class="comment">// end::clientStreaming[]</span>
<span class="line-numbers">222</span>
<span class="line-numbers">223</span>    <span class="comment">// tag::bidirectionalStreaming[]</span>
<span class="line-numbers">224</span>    <span class="annotation">@GET</span>
<span class="line-numbers">225</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/java</span><span class="delimiter">"</span></span>)
<span class="line-numbers">226</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">227</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getJavaProperties() {
<span class="line-numbers">228</span>
<span class="line-numbers">229</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">230</span>                                      .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">231</span>                                      .usePlaintext().build();
<span class="line-numbers">232</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">233</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">234</span>        <span class="comment">// tag::countDownLatch7[]</span>
<span class="line-numbers">235</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">236</span>        <span class="comment">// end::countDownLatch7[]</span>
<span class="line-numbers">237</span>
<span class="line-numbers">238</span>        <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">239</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getBidirectionalProperties(
<span class="line-numbers">240</span>                <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">241</span>
<span class="line-numbers">242</span>                    <span class="comment">// tag::onNext2[]</span>
<span class="line-numbers">243</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">244</span>                    <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">245</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">246</span>                            + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">247</span>                        properties.put(value.getPropertyName(),
<span class="line-numbers">248</span>                                       value.getPropertyValue());
<span class="line-numbers">249</span>                    }
<span class="line-numbers">250</span>                    <span class="comment">// end::onNext2[]</span>
<span class="line-numbers">251</span>
<span class="line-numbers">252</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">253</span>                    <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">254</span>                        t.printStackTrace();
<span class="line-numbers">255</span>                    }
<span class="line-numbers">256</span>
<span class="line-numbers">257</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">258</span>                    <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">259</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">260</span>                        <span class="comment">// tag::countDownLatch8[]</span>
<span class="line-numbers">261</span>                        countDown.countDown();
<span class="line-numbers">262</span>                        <span class="comment">// end::countDownLatch8[]</span>
<span class="line-numbers">263</span>                    }
<span class="line-numbers">264</span>                });
<span class="line-numbers">265</span>        <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">266</span>
<span class="line-numbers">267</span>        <span class="comment">// collect the property names starting with java</span>
<span class="line-numbers">268</span>        <span class="comment">// tag::collectJavaProperties[]</span>
<span class="line-numbers">269</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">270</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">java.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">271</span>                                  .collect(Collectors.toList());
<span class="line-numbers">272</span>        <span class="comment">// end::collectJavaProperties[]</span>
<span class="line-numbers">273</span>
<span class="line-numbers">274</span>        <span class="comment">// post messages to the server</span>
<span class="line-numbers">275</span>        keys.stream()
<span class="line-numbers">276</span>              <span class="comment">// tag::clientMessage2[]</span>
<span class="line-numbers">277</span>              .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">278</span>              <span class="comment">// end::clientMessage2[]</span>
<span class="line-numbers">279</span>              <span class="comment">// tag::streamOnNext2[]</span>
<span class="line-numbers">280</span>              .forEach(stream::onNext);
<span class="line-numbers">281</span>              <span class="comment">// end::streamOnNext2[]</span>
<span class="line-numbers">282</span>        <span class="comment">// tag::clientCompleted2[]</span>
<span class="line-numbers">283</span>        stream.onCompleted();
<span class="line-numbers">284</span>        <span class="comment">// end::clientCompleted2[]</span>
<span class="line-numbers">285</span>
<span class="line-numbers">286</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">287</span>        <span class="comment">// tag::countDownLatch9[]</span>
<span class="line-numbers">288</span>        <span class="keyword">try</span> {
<span class="line-numbers">289</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">290</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">291</span>            e.printStackTrace();
<span class="line-numbers">292</span>        }
<span class="line-numbers">293</span>        <span class="comment">// end::countDownLatch9[]</span>
<span class="line-numbers">294</span>
<span class="line-numbers">295</span>        channel.shutdownNow();
<span class="line-numbers">296</span>
<span class="line-numbers">297</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">298</span>    }
<span class="line-numbers">299</span>    <span class="comment">// end::bidirectionalStreaming[]</span>
<span class="line-numbers">300</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a connection is created between the two services, the <code class="hotspot=getClientStreamingProperties file=1">client.getClientStreamingProperties()</code> method is called to get a <code>stream</code> and collect the properties with property names that are prefixed by <code class="hotspot=collectUserProperties file=1">user.</code>. The method creates a <code class="hotspot=clientMessage1 file=1">SystemPropertyName</code> message individually and sends the message to the server by the <code class="hotspot=streamOnNext1 file=1">stream::onNext</code> action. When all property names are sent, the <code class="hotspot=clientCompleted1 file=1">onCompleted()</code> method is called to finish the streaming. Again, a <code class="hotspot=countDownLatch4 hotspot=countDownLatch5 hotspot=countDownLatch6 file=1">CountDownLatch</code> instance synchronizes the streaming flow.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9081/query/properties/user" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/user</a> URL to test the client streaming call. The <code>user.</code> properties from the <code>system</code> service are displayed. Observe the output from the consoles running the <code>system</code> and <code>query</code> services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-the-bidirectional-streaming-call">Implementing the bidirectional streaming call</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the bidirectional streaming call, the <code>query</code> client service provides the <code>/query/properties/java</code> endpoint, which streams the property names that start with <code>java.</code> to the <code>system</code> server service. The <code>system</code> service streams the property values back to the <code>query</code> service.</p>
</div>
<div class="paragraph">
<p>Update the <code>SystemService</code> class to implement the bidirectional streaming RPC call.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>SystemService</code> class.</mark>
<code>system/src/main/java/io/openliberty/guides/system/SystemService.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 19</span><span class="comment">// tag::importGrpcClasses[]</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 26</span><span class="comment">// end::importGrpcClasses[]</span>
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="comment">// tag::extends[]</span>
<span class="line-numbers"> 29</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> <span class="directive">extends</span> SystemServiceGrpc.SystemServiceImplBase {
<span class="line-numbers"> 30</span><span class="comment">// end::extends[]</span>
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="directive">public</span> SystemService() {
<span class="line-numbers"> 35</span>    }
<span class="line-numbers"> 36</span>
<span class="line-numbers"> 37</span>    <span class="comment">// tag::getProperty[]</span>
<span class="line-numbers"> 38</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 39</span>    <span class="directive">public</span> <span class="type">void</span> getProperty(
<span class="line-numbers"> 40</span>        SystemPropertyName request, StreamObserver&lt;SystemPropertyValue&gt; observer) {
<span class="line-numbers"> 41</span>
<span class="line-numbers"> 42</span>        <span class="comment">// tag::pName[]</span>
<span class="line-numbers"> 43</span>        <span class="predefined-type">String</span> pName = request.getPropertyName();
<span class="line-numbers"> 44</span>        <span class="comment">// end::pName[]</span>
<span class="line-numbers"> 45</span>        <span class="comment">// tag::pValue[]</span>
<span class="line-numbers"> 46</span>        <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers"> 47</span>        <span class="comment">// end::pValue[]</span>
<span class="line-numbers"> 48</span>        <span class="comment">// tag::response[]</span>
<span class="line-numbers"> 49</span>        SystemPropertyValue value = SystemPropertyValue
<span class="line-numbers"> 50</span>                                        .newBuilder()
<span class="line-numbers"> 51</span>                                        .setPropertyValue(pValue)
<span class="line-numbers"> 52</span>                                        .build();
<span class="line-numbers"> 53</span>        <span class="comment">// end::response[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>        <span class="comment">// tag::next[]</span>
<span class="line-numbers"> 56</span>        observer.onNext(value);
<span class="line-numbers"> 57</span>        <span class="comment">// end::next[]</span>
<span class="line-numbers"> 58</span>        <span class="comment">// tag::complete[]</span>
<span class="line-numbers"> 59</span>        observer.onCompleted();
<span class="line-numbers"> 60</span>        <span class="comment">// end::complete[]</span>
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>    }
<span class="line-numbers"> 63</span>    <span class="comment">// end::getProperty[]</span>
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 67</span>    <span class="directive">public</span> <span class="type">void</span> getServerStreamingProperties(
<span class="line-numbers"> 68</span>        SystemPropertyPrefix request, StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers"> 69</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::prefix[]</span>
<span class="line-numbers"> 71</span>        <span class="predefined-type">String</span> prefix = request.getPropertyPrefix();
<span class="line-numbers"> 72</span>        <span class="comment">// end::prefix[]</span>
<span class="line-numbers"> 73</span>        <span class="predefined-type">System</span>.getProperties()
<span class="line-numbers"> 74</span>              .stringPropertyNames()
<span class="line-numbers"> 75</span>              .stream()
<span class="line-numbers"> 76</span>              <span class="comment">// tag::filter[]</span>
<span class="line-numbers"> 77</span>              .filter(name -&gt; name.startsWith(prefix))
<span class="line-numbers"> 78</span>              <span class="comment">// end::filter[]</span>
<span class="line-numbers"> 79</span>              .forEach(name -&gt; {
<span class="line-numbers"> 80</span>                  <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(name);
<span class="line-numbers"> 81</span>                  <span class="comment">// tag::serverMessage[]</span>
<span class="line-numbers"> 82</span>                  SystemProperty value = SystemProperty
<span class="line-numbers"> 83</span>                      .newBuilder()
<span class="line-numbers"> 84</span>                      .setPropertyName(name)
<span class="line-numbers"> 85</span>                      .setPropertyValue(pValue)
<span class="line-numbers"> 86</span>                      .build();
<span class="line-numbers"> 87</span>                  <span class="comment">// end::serverMessage[]</span>
<span class="line-numbers"> 88</span>                  <span class="comment">// tag::serverNext1[]</span>
<span class="line-numbers"> 89</span>                  observer.onNext(value);
<span class="line-numbers"> 90</span>                  <span class="comment">// end::serverNext1[]</span>
<span class="line-numbers"> 91</span>                  logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming sent property: </span><span class="delimiter">"</span></span> + name);
<span class="line-numbers"> 92</span>               });
<span class="line-numbers"> 93</span>        <span class="comment">// tag::serverComplete[]</span>
<span class="line-numbers"> 94</span>        observer.onCompleted();
<span class="line-numbers"> 95</span>        <span class="comment">// end::serverComplete[]</span>
<span class="line-numbers"> 96</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">101</span>    <span class="annotation">@Override</span>
<span class="line-numbers">102</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getClientStreamingProperties(
<span class="line-numbers">103</span>        StreamObserver&lt;SystemProperties&gt; observer) {
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        <span class="comment">// tag::streamObserverClient[]</span>
<span class="line-numbers">106</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>            <span class="comment">// tag::clientStreamingMap[]</span>
<span class="line-numbers">109</span>            <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();
<span class="line-numbers">110</span>            <span class="comment">// end::clientStreamingMap[]</span>
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>            <span class="comment">// tag::receivingProperties[]</span>
<span class="line-numbers">113</span>            <span class="annotation">@Override</span>
<span class="line-numbers">114</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">115</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">116</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">117</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received property: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">118</span>                properties.put(pName, pValue);
<span class="line-numbers">119</span>            }
<span class="line-numbers">120</span>            <span class="comment">// end::receivingProperties[]</span>
<span class="line-numbers">121</span>
<span class="line-numbers">122</span>            <span class="annotation">@Override</span>
<span class="line-numbers">123</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">124</span>                t.printStackTrace();
<span class="line-numbers">125</span>            }
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>            <span class="comment">// tag::clientStreamingCompleted[]</span>
<span class="line-numbers">128</span>            <span class="annotation">@Override</span>
<span class="line-numbers">129</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">130</span>                SystemProperties value = SystemProperties.newBuilder()
<span class="line-numbers">131</span>                                             .putAllProperties(properties)
<span class="line-numbers">132</span>                                             .build();
<span class="line-numbers">133</span>                observer.onNext(value);
<span class="line-numbers">134</span>                observer.onCompleted();
<span class="line-numbers">135</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">136</span>            }
<span class="line-numbers">137</span>            <span class="comment">// end::clientStreamingCompleted[]</span>
<span class="line-numbers">138</span>        };
<span class="line-numbers">139</span>        <span class="comment">// end::streamObserverClient[]</span>
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>    <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">142</span>
<span class="line-numbers">143</span>    <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">144</span>    <span class="annotation">@Override</span>
<span class="line-numbers">145</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getBidirectionalProperties(
<span class="line-numbers">146</span>        StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>        <span class="comment">// tag::streamObserverBidirectional[]</span>
<span class="line-numbers">149</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">150</span>            <span class="comment">// tag::receiveBidirectionalProperties[]</span>
<span class="line-numbers">151</span>            <span class="annotation">@Override</span>
<span class="line-numbers">152</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">153</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">154</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">155</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming received: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">156</span>                <span class="comment">// tag::systemPropertyMessage[]</span>
<span class="line-numbers">157</span>                SystemProperty value = SystemProperty.newBuilder()
<span class="line-numbers">158</span>                                           .setPropertyName(pName)
<span class="line-numbers">159</span>                                           .setPropertyValue(pValue)
<span class="line-numbers">160</span>                                           .build();
<span class="line-numbers">161</span>                <span class="comment">// end::systemPropertyMessage[]</span>
<span class="line-numbers">162</span>                <span class="comment">// tag::serverNext2[]</span>
<span class="line-numbers">163</span>                observer.onNext(value);
<span class="line-numbers">164</span>                <span class="comment">// end::serverNext2[]</span>
<span class="line-numbers">165</span>            }
<span class="line-numbers">166</span>            <span class="comment">// end::receiveBidirectionalProperties[]</span>
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>            <span class="annotation">@Override</span>
<span class="line-numbers">169</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">170</span>                t.printStackTrace();
<span class="line-numbers">171</span>            }
<span class="line-numbers">172</span>
<span class="line-numbers">173</span>            <span class="comment">// tag::bidirectionalCompleted[]</span>
<span class="line-numbers">174</span>            <span class="annotation">@Override</span>
<span class="line-numbers">175</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">176</span>                observer.onCompleted();
<span class="line-numbers">177</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">178</span>            }
<span class="line-numbers">179</span>            <span class="comment">// end::bidirectionalCompleted[]</span>
<span class="line-numbers">180</span>        };
<span class="line-numbers">181</span>        <span class="comment">// end::streamObserverBidirectional[]</span>
<span class="line-numbers">182</span>    }
<span class="line-numbers">183</span>    <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">184</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getBidirectionalProperties file=0">getBidirectionalProperties()</code> method implements bidirectional streaming RPC call. This method returns an instance of the <code class="hotspot=streamObserverBidirectional file=0">StreamObserver</code> interface. Its <code class="hotspot=receiveBidirectionalProperties file=0">onNext()</code> method receives the messages from the client individually, creates a <code class="hotspot=systemPropertyMessage file=0">SystemProperty</code> message with the property name and value, and sends the message back to the client. When the client streaming is completed, the method closes the server streaming by calling the <code class="hotspot=bidirectionalCompleted file=0">onCompleted()</code> method.</p>
</div>
<div class="paragraph">
<p>Update the <code>PropertiesResource</code> class to implement of <code>/query/properties/java</code> endpoint of the query service.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>PropertiesResource</code> class.</mark>
<code>query/src/main/java/io/openliberty/guides/query/PropertiesResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>PropertiesResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.PathParam</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannel</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannelBuilder</span>;
<span class="line-numbers"> 33</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 34</span><span class="comment">// tag::grpcImports[]</span>
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceBlockingStub</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceStub</span>;
<span class="line-numbers"> 43</span><span class="comment">// end::grpcImports[]</span>
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 46</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/properties</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 47</span><span class="directive">public</span> <span class="type">class</span> <span class="class">PropertiesResource</span> {
<span class="line-numbers"> 48</span>
<span class="line-numbers"> 49</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(PropertiesResource.class.getName());
<span class="line-numbers"> 50</span>
<span class="line-numbers"> 51</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 52</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.hostname</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">localhost</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 53</span>    <span class="predefined-type">String</span> SYSTEM_HOST;
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 56</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">system.port</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">9080</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 57</span>    <span class="type">int</span> SYSTEM_PORT;
<span class="line-numbers"> 58</span>
<span class="line-numbers"> 59</span>    <span class="comment">// tag::unary[]</span>
<span class="line-numbers"> 60</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 61</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/{property}</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 62</span>    <span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="line-numbers"> 63</span>    <span class="directive">public</span> <span class="predefined-type">String</span> getPropertiesString(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> property) {
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>        <span class="comment">// tag::createChannel1[]</span>
<span class="line-numbers"> 66</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 67</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 68</span>                                     .usePlaintext().build();
<span class="line-numbers"> 69</span>        <span class="comment">// end::createChannel1[]</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::createClient1[]</span>
<span class="line-numbers"> 71</span>        SystemServiceBlockingStub client = SystemServiceGrpc.newBlockingStub(channel);
<span class="line-numbers"> 72</span>        <span class="comment">// end::createClient1[]</span>
<span class="line-numbers"> 73</span>        SystemPropertyName request = SystemPropertyName.newBuilder()
<span class="line-numbers"> 74</span>                                             .setPropertyName(property).build();
<span class="line-numbers"> 75</span>        SystemPropertyValue response = client.getProperty(request);
<span class="line-numbers"> 76</span>        channel.shutdownNow();
<span class="line-numbers"> 77</span>        <span class="keyword">return</span> response.getPropertyValue();
<span class="line-numbers"> 78</span>    }
<span class="line-numbers"> 79</span>    <span class="comment">// end::unary[]</span>
<span class="line-numbers"> 80</span>
<span class="line-numbers"> 81</span>    <span class="comment">// tag::serverStreaming[]</span>
<span class="line-numbers"> 82</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 83</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/os</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 84</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 85</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getOSProperties() {
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>        <span class="comment">// tag::createChannel2[]</span>
<span class="line-numbers"> 88</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers"> 89</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers"> 90</span>                                     .usePlaintext().build();
<span class="line-numbers"> 91</span>        <span class="comment">// end::createChannel2[]</span>
<span class="line-numbers"> 92</span>        <span class="comment">// tag::createClient2[]</span>
<span class="line-numbers"> 93</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers"> 94</span>        <span class="comment">// end::createClient2[]</span>
<span class="line-numbers"> 95</span>
<span class="line-numbers"> 96</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers"> 97</span>        <span class="comment">// tag::countDownLatch1[]</span>
<span class="line-numbers"> 98</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers"> 99</span>        <span class="comment">// end::countDownLatch1[]</span>
<span class="line-numbers">100</span>        SystemPropertyPrefix request = SystemPropertyPrefix.newBuilder()
<span class="line-numbers">101</span>                                         .setPropertyPrefix(<span class="string"><span class="delimiter">"</span><span class="content">os.</span><span class="delimiter">"</span></span>).build();
<span class="line-numbers">102</span>        <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers">103</span>        client.getServerStreamingProperties(
<span class="line-numbers">104</span>            request, <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">105</span>
<span class="line-numbers">106</span>            <span class="comment">// tag::onNext1[]</span>
<span class="line-numbers">107</span>            <span class="annotation">@Override</span>
<span class="line-numbers">108</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">109</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">110</span>                   + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">111</span>                properties.put(value.getPropertyName(), value.getPropertyValue());
<span class="line-numbers">112</span>            }
<span class="line-numbers">113</span>            <span class="comment">// end::onNext1[]</span>
<span class="line-numbers">114</span>
<span class="line-numbers">115</span>            <span class="annotation">@Override</span>
<span class="line-numbers">116</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">117</span>                t.printStackTrace();
<span class="line-numbers">118</span>            }
<span class="line-numbers">119</span>
<span class="line-numbers">120</span>            <span class="annotation">@Override</span>
<span class="line-numbers">121</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">122</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">123</span>                <span class="comment">// tag::countDownLatch2[]</span>
<span class="line-numbers">124</span>                countDown.countDown();
<span class="line-numbers">125</span>                <span class="comment">// end::countDownLatch2[]</span>
<span class="line-numbers">126</span>            }
<span class="line-numbers">127</span>        });
<span class="line-numbers">128</span>        <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers">129</span>
<span class="line-numbers">130</span>
<span class="line-numbers">131</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">132</span>        <span class="comment">// tag::countDownLatch3[]</span>
<span class="line-numbers">133</span>        <span class="keyword">try</span> {
<span class="line-numbers">134</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">135</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">136</span>            e.printStackTrace();
<span class="line-numbers">137</span>        }
<span class="line-numbers">138</span>        <span class="comment">// end::countDownLatch3[]</span>
<span class="line-numbers">139</span>
<span class="line-numbers">140</span>        <span class="comment">// tag::closeConnection[]</span>
<span class="line-numbers">141</span>        channel.shutdownNow();
<span class="line-numbers">142</span>        <span class="comment">// end::closeConnection[]</span>
<span class="line-numbers">143</span>
<span class="line-numbers">144</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">145</span>    }
<span class="line-numbers">146</span>    <span class="comment">// end::serverStreaming[]</span>
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>    <span class="comment">// tag::clientStreaming[]</span>
<span class="line-numbers">149</span>    <span class="annotation">@GET</span>
<span class="line-numbers">150</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/user</span><span class="delimiter">"</span></span>)
<span class="line-numbers">151</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">152</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getUserProperties() {
<span class="line-numbers">153</span>
<span class="line-numbers">154</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">155</span>                                     .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">156</span>                                     .usePlaintext().build();
<span class="line-numbers">157</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">158</span>        <span class="comment">// tag::countDownLatch4[]</span>
<span class="line-numbers">159</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">160</span>        <span class="comment">// end::countDownLatch4[]</span>
<span class="line-numbers">161</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">162</span>
<span class="line-numbers">163</span>        <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">164</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getClientStreamingProperties(
<span class="line-numbers">165</span>            <span class="keyword">new</span> StreamObserver&lt;SystemProperties&gt;() {
<span class="line-numbers">166</span>
<span class="line-numbers">167</span>                <span class="annotation">@Override</span>
<span class="line-numbers">168</span>                <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperties value) {
<span class="line-numbers">169</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received a map that has </span><span class="delimiter">"</span></span>
<span class="line-numbers">170</span>                        + value.getPropertiesCount() + <span class="string"><span class="delimiter">"</span><span class="content"> properties</span><span class="delimiter">"</span></span>);
<span class="line-numbers">171</span>                    properties.putAll(value.getPropertiesMap());
<span class="line-numbers">172</span>                }
<span class="line-numbers">173</span>
<span class="line-numbers">174</span>                <span class="annotation">@Override</span>
<span class="line-numbers">175</span>                <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">176</span>                    t.printStackTrace();
<span class="line-numbers">177</span>                }
<span class="line-numbers">178</span>
<span class="line-numbers">179</span>                <span class="annotation">@Override</span>
<span class="line-numbers">180</span>                <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">181</span>                    logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">182</span>                    <span class="comment">// tag::countDownLatch5[]</span>
<span class="line-numbers">183</span>                    countDown.countDown();
<span class="line-numbers">184</span>                    <span class="comment">// end::countDownLatch5[]</span>
<span class="line-numbers">185</span>                }
<span class="line-numbers">186</span>            });
<span class="line-numbers">187</span>        <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">188</span>
<span class="line-numbers">189</span>        <span class="comment">// collect the property names starting with user.</span>
<span class="line-numbers">190</span>        <span class="comment">// tag::collectUserProperties[]</span>
<span class="line-numbers">191</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">192</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">user.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">193</span>                                  .collect(Collectors.toList());
<span class="line-numbers">194</span>        <span class="comment">// end::collectUserProperties[]</span>
<span class="line-numbers">195</span>
<span class="line-numbers">196</span>        <span class="comment">// send messages to the server</span>
<span class="line-numbers">197</span>        keys.stream()
<span class="line-numbers">198</span>            <span class="comment">// tag::clientMessage1[]</span>
<span class="line-numbers">199</span>            .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">200</span>            <span class="comment">// end::clientMessage1[]</span>
<span class="line-numbers">201</span>            <span class="comment">// tag::streamOnNext1[]</span>
<span class="line-numbers">202</span>            .forEach(stream::onNext);
<span class="line-numbers">203</span>            <span class="comment">// end::streamOnNext1[]</span>
<span class="line-numbers">204</span>        <span class="comment">// tag::clientCompleted1[]</span>
<span class="line-numbers">205</span>        stream.onCompleted();
<span class="line-numbers">206</span>        <span class="comment">// end::clientCompleted1[]</span>
<span class="line-numbers">207</span>
<span class="line-numbers">208</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">209</span>        <span class="comment">// tag::countDownLatch6[]</span>
<span class="line-numbers">210</span>        <span class="keyword">try</span> {
<span class="line-numbers">211</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">212</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">213</span>            e.printStackTrace();
<span class="line-numbers">214</span>        }
<span class="line-numbers">215</span>        <span class="comment">// end::countDownLatch6[]</span>
<span class="line-numbers">216</span>
<span class="line-numbers">217</span>        channel.shutdownNow();
<span class="line-numbers">218</span>
<span class="line-numbers">219</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">220</span>    }
<span class="line-numbers">221</span>    <span class="comment">// end::clientStreaming[]</span>
<span class="line-numbers">222</span>
<span class="line-numbers">223</span>    <span class="comment">// tag::bidirectionalStreaming[]</span>
<span class="line-numbers">224</span>    <span class="annotation">@GET</span>
<span class="line-numbers">225</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/java</span><span class="delimiter">"</span></span>)
<span class="line-numbers">226</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers">227</span>    <span class="directive">public</span> <span class="predefined-type">Properties</span> getJavaProperties() {
<span class="line-numbers">228</span>
<span class="line-numbers">229</span>        ManagedChannel channel = ManagedChannelBuilder
<span class="line-numbers">230</span>                                      .forAddress(SYSTEM_HOST, SYSTEM_PORT)
<span class="line-numbers">231</span>                                      .usePlaintext().build();
<span class="line-numbers">232</span>        SystemServiceStub client = SystemServiceGrpc.newStub(channel);
<span class="line-numbers">233</span>        <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="line-numbers">234</span>        <span class="comment">// tag::countDownLatch7[]</span>
<span class="line-numbers">235</span>        <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">236</span>        <span class="comment">// end::countDownLatch7[]</span>
<span class="line-numbers">237</span>
<span class="line-numbers">238</span>        <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">239</span>        StreamObserver&lt;SystemPropertyName&gt; stream = client.getBidirectionalProperties(
<span class="line-numbers">240</span>                <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">241</span>
<span class="line-numbers">242</span>                    <span class="comment">// tag::onNext2[]</span>
<span class="line-numbers">243</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">244</span>                    <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty value) {
<span class="line-numbers">245</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming received: </span><span class="delimiter">"</span></span>
<span class="line-numbers">246</span>                            + value.getPropertyName() + <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span> + value.getPropertyValue());
<span class="line-numbers">247</span>                        properties.put(value.getPropertyName(),
<span class="line-numbers">248</span>                                       value.getPropertyValue());
<span class="line-numbers">249</span>                    }
<span class="line-numbers">250</span>                    <span class="comment">// end::onNext2[]</span>
<span class="line-numbers">251</span>
<span class="line-numbers">252</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">253</span>                    <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">254</span>                        t.printStackTrace();
<span class="line-numbers">255</span>                    }
<span class="line-numbers">256</span>
<span class="line-numbers">257</span>                    <span class="annotation">@Override</span>
<span class="line-numbers">258</span>                    <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">259</span>                        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bidirectional streaming completed</span><span class="delimiter">"</span></span>);
<span class="line-numbers">260</span>                        <span class="comment">// tag::countDownLatch8[]</span>
<span class="line-numbers">261</span>                        countDown.countDown();
<span class="line-numbers">262</span>                        <span class="comment">// end::countDownLatch8[]</span>
<span class="line-numbers">263</span>                    }
<span class="line-numbers">264</span>                });
<span class="line-numbers">265</span>        <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">266</span>
<span class="line-numbers">267</span>        <span class="comment">// collect the property names starting with java</span>
<span class="line-numbers">268</span>        <span class="comment">// tag::collectJavaProperties[]</span>
<span class="line-numbers">269</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">270</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">java.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">271</span>                                  .collect(Collectors.toList());
<span class="line-numbers">272</span>        <span class="comment">// end::collectJavaProperties[]</span>
<span class="line-numbers">273</span>
<span class="line-numbers">274</span>        <span class="comment">// post messages to the server</span>
<span class="line-numbers">275</span>        keys.stream()
<span class="line-numbers">276</span>              <span class="comment">// tag::clientMessage2[]</span>
<span class="line-numbers">277</span>              .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">278</span>              <span class="comment">// end::clientMessage2[]</span>
<span class="line-numbers">279</span>              <span class="comment">// tag::streamOnNext2[]</span>
<span class="line-numbers">280</span>              .forEach(stream::onNext);
<span class="line-numbers">281</span>              <span class="comment">// end::streamOnNext2[]</span>
<span class="line-numbers">282</span>        <span class="comment">// tag::clientCompleted2[]</span>
<span class="line-numbers">283</span>        stream.onCompleted();
<span class="line-numbers">284</span>        <span class="comment">// end::clientCompleted2[]</span>
<span class="line-numbers">285</span>
<span class="line-numbers">286</span>        <span class="comment">// wait until completed</span>
<span class="line-numbers">287</span>        <span class="comment">// tag::countDownLatch9[]</span>
<span class="line-numbers">288</span>        <span class="keyword">try</span> {
<span class="line-numbers">289</span>            countDown.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers">290</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers">291</span>            e.printStackTrace();
<span class="line-numbers">292</span>        }
<span class="line-numbers">293</span>        <span class="comment">// end::countDownLatch9[]</span>
<span class="line-numbers">294</span>
<span class="line-numbers">295</span>        channel.shutdownNow();
<span class="line-numbers">296</span>
<span class="line-numbers">297</span>        <span class="keyword">return</span> properties;
<span class="line-numbers">298</span>    }
<span class="line-numbers">299</span>    <span class="comment">// end::bidirectionalStreaming[]</span>
<span class="line-numbers">300</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a connection is created between the two services, the <code class="hotspot=getBidirectionalProperties file=1">client.getBidirectionalProperties()</code> method is called with an implementation of the <code>StreamObserver</code> interface. The <code class="hotspot=onNext2 file=1">onNext()</code> method receives messages that are streaming from the server individually and stores them into the <code>properties</code> placeholder. Then, collect the properties . For each property name that starts with <code class="hotspot=collectJavaProperties file=1">java.</code>, a <code class="hotspot=clientMessage2 file=1">SystemPropertyName</code> message is created and sent to the server by the <code class="hotspot=streamOnNext2 file=1">stream::onNext</code> action. When all property names are sent, the streaming is ended by calling the <code class="hotspot=clientCompleted2 file=1">onCompleted()</code> method. Again, a <code class="hotspot=countDownLatch7 hotspot=countDownLatch8 hotspot=countDownLatch9 file=1">CountDownLatch</code> instance synchronizes the streaming flow.</p>
</div>
<div class="paragraph">
<p>Point your browser to the <a href="http://localhost:9081/query/properties/java" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9081/query/properties/java</a> URL to test the bidirectional streaming call. The <code>java.</code> properties from the <code>system</code> service are displayed. Observe the output from the consoles running the <code>system</code> and <code>query</code> services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">Testing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although you can test your application manually, automated tests ensure consistent code quality by triggering a failure whenever a code change introduces a defect. In this section, you’ll create unit tests for the gRPC server service and integration tests for the <code>query</code> service.</p>
</div>
<div class="sect2">
<h3 id="implementing-unit-tests-for-the-grpc-server-service">Implementing unit tests for the gRPC server service</h3>
<div class="paragraph">
<p>system/pom.xml</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers">  1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-numbers">  2</span><span class="tag">&lt;project</span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">  3</span>
<span class="line-numbers">  4</span>    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>
<span class="line-numbers">  5</span>    <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">  6</span>    <span class="tag">&lt;artifactId&gt;</span>guide-grpc-intro-system<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">  7</span>    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">  8</span>    <span class="tag">&lt;packaging&gt;</span>war<span class="tag">&lt;/packaging&gt;</span>
<span class="line-numbers">  9</span>
<span class="line-numbers"> 10</span>    <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers"> 11</span>        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
<span class="line-numbers"> 12</span>        <span class="tag">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.reporting.outputEncoding&gt;</span>
<span class="line-numbers"> 13</span>        <span class="tag">&lt;maven.compiler.source&gt;</span>11<span class="tag">&lt;/maven.compiler.source&gt;</span>
<span class="line-numbers"> 14</span>        <span class="tag">&lt;maven.compiler.target&gt;</span>11<span class="tag">&lt;/maven.compiler.target&gt;</span>
<span class="line-numbers"> 15</span>        <span class="comment">&lt;!-- Liberty configuration --&gt;</span>
<span class="line-numbers"> 16</span>        <span class="tag">&lt;liberty.var.default.http.port&gt;</span>9081<span class="tag">&lt;/liberty.var.default.http.port&gt;</span>
<span class="line-numbers"> 17</span>        <span class="tag">&lt;liberty.var.default.https.port&gt;</span>9444<span class="tag">&lt;/liberty.var.default.https.port&gt;</span>
<span class="line-numbers"> 18</span>    <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers"> 19</span>    <span class="tag">&lt;dependencies&gt;</span>
<span class="line-numbers"> 20</span>        <span class="comment">&lt;!-- Provided dependencies --&gt;</span>
<span class="line-numbers"> 21</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 22</span>            <span class="tag">&lt;groupId&gt;</span>jakarta.platform<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 23</span>            <span class="tag">&lt;artifactId&gt;</span>jakarta.jakartaee-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 24</span>            <span class="tag">&lt;version&gt;</span>10.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 25</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 26</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 27</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 28</span>            <span class="tag">&lt;groupId&gt;</span>org.eclipse.microprofile<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 29</span>            <span class="tag">&lt;artifactId&gt;</span>microprofile<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 30</span>            <span class="tag">&lt;version&gt;</span>6.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 31</span>            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers"> 32</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 33</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 36</span>           <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 37</span>           <span class="tag">&lt;artifactId&gt;</span>systemproto<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 38</span>           <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 39</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 40</span>
<span class="line-numbers"> 41</span>        <span class="comment">&lt;!-- Java utility classes --&gt;</span>
<span class="line-numbers"> 42</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 43</span>            <span class="tag">&lt;groupId&gt;</span>org.apache.commons<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 44</span>            <span class="tag">&lt;artifactId&gt;</span>commons-lang3<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 45</span>            <span class="tag">&lt;version&gt;</span>3.12.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 46</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 47</span>
<span class="line-numbers"> 48</span>        <span class="comment">&lt;!-- grpc compile dependencies; provided by Liberty at runtime --&gt;</span>
<span class="line-numbers"> 49</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 50</span>            <span class="tag">&lt;groupId&gt;</span>io.grpc<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 51</span>            <span class="tag">&lt;artifactId&gt;</span>grpc-protobuf<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 52</span>            <span class="tag">&lt;version&gt;</span>1.54.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 53</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 54</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 55</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 56</span>            <span class="tag">&lt;groupId&gt;</span>io.grpc<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 57</span>            <span class="tag">&lt;artifactId&gt;</span>grpc-stub<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 58</span>            <span class="tag">&lt;version&gt;</span>1.54.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 59</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 60</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>        <span class="comment">&lt;!-- For tests --&gt;</span>
<span class="line-numbers"> 63</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 64</span>            <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 65</span>            <span class="tag">&lt;artifactId&gt;</span>junit-jupiter<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 66</span>            <span class="tag">&lt;version&gt;</span>5.8.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 67</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 68</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 69</span>        <span class="comment">&lt;!-- tag::grpc-testing[] --&gt;</span>
<span class="line-numbers"> 70</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 71</span>            <span class="tag">&lt;groupId&gt;</span>io.grpc<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 72</span>            <span class="tag">&lt;artifactId&gt;</span>grpc-testing<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 73</span>            <span class="tag">&lt;version&gt;</span>1.54.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 74</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 75</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 76</span>        <span class="comment">&lt;!-- end::grpc-testing[] --&gt;</span>
<span class="line-numbers"> 77</span>        <span class="comment">&lt;!-- tag::mockito-core[] --&gt;</span>
<span class="line-numbers"> 78</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 79</span>            <span class="tag">&lt;groupId&gt;</span>org.mockito<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 80</span>            <span class="tag">&lt;artifactId&gt;</span>mockito-core<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 81</span>            <span class="tag">&lt;version&gt;</span>5.1.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 82</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 83</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 84</span>        <span class="comment">&lt;!-- end::mockito-core[] --&gt;</span>
<span class="line-numbers"> 85</span>    <span class="tag">&lt;/dependencies&gt;</span>
<span class="line-numbers"> 86</span>    
<span class="line-numbers"> 87</span>    <span class="tag">&lt;build&gt;</span>
<span class="line-numbers"> 88</span>        <span class="tag">&lt;finalName&gt;</span>${project.artifactId}<span class="tag">&lt;/finalName&gt;</span>
<span class="line-numbers"> 89</span>        <span class="tag">&lt;plugins&gt;</span>
<span class="line-numbers"> 90</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> 91</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 92</span>                <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 93</span>                <span class="tag">&lt;version&gt;</span>3.3.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 94</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers"> 95</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> 96</span>                <span class="tag">&lt;groupId&gt;</span>io.openliberty.tools<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 97</span>                <span class="tag">&lt;artifactId&gt;</span>liberty-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 98</span>                <span class="tag">&lt;version&gt;</span>3.8.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 99</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">100</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">101</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">102</span>                <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">103</span>                <span class="tag">&lt;version&gt;</span>3.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">104</span>            <span class="tag">&lt;/plugin&gt;</span>       
<span class="line-numbers">105</span>        <span class="tag">&lt;/plugins&gt;</span>
<span class="line-numbers">106</span>    <span class="tag">&lt;/build&gt;</span>
<span class="line-numbers">107</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>pom.xml</code> Maven configuration file already specifies the required dependencies, including <code>JUnit5</code>, <code class="hotspot=grpc-testing file=0">grpc-testing</code>, and <code class="hotspot=mockito-core file=0">mockito-core</code> libraries. The <code>grpc-testing</code> dependency provides utilities for testing gRPC services and creates a mock gRPC server that simulates client-server communication during testing. The <code>mockito-core</code> dependency enables the Mockito mocking framework.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>SystemServiceTest</code> class.</mark>
<code>system/src/test/java/io/openliberty/guides/system/SystemServiceTest.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemServiceTest.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertTrue</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.fail</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.ArgumentMatchers.any</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.Mockito.mock</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.Mockito.never</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.Mockito.timeout</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.Mockito.verify</span>;
<span class="line-numbers"> 22</span>
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.AfterAll</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="line-numbers"> 31</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="line-numbers"> 32</span><span class="keyword">import</span> <span class="include">org.mockito.ArgumentCaptor</span>;
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span><span class="keyword">import</span> <span class="include">io.grpc.ManagedChannel</span>;
<span class="line-numbers"> 35</span><span class="keyword">import</span> <span class="include">io.grpc.Server</span>;
<span class="line-numbers"> 36</span><span class="keyword">import</span> <span class="include">io.grpc.inprocess.InProcessChannelBuilder</span>;
<span class="line-numbers"> 37</span><span class="keyword">import</span> <span class="include">io.grpc.inprocess.InProcessServerBuilder</span>;
<span class="line-numbers"> 38</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 39</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 40</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 41</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 42</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 43</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 44</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 45</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceBlockingStub</span>;
<span class="line-numbers"> 46</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc.SystemServiceStub</span>;
<span class="line-numbers"> 47</span>
<span class="line-numbers"> 48</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemServiceTest</span> {
<span class="line-numbers"> 49</span>
<span class="line-numbers"> 50</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> SERVER_NAME = <span class="string"><span class="delimiter">"</span><span class="content">system</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 51</span>
<span class="line-numbers"> 52</span>    <span class="directive">private</span> <span class="directive">static</span> Server inProcessServer;
<span class="line-numbers"> 53</span>    <span class="directive">private</span> <span class="directive">static</span> ManagedChannel inProcessChannel;
<span class="line-numbers"> 54</span>    <span class="directive">private</span> <span class="directive">static</span> SystemServiceBlockingStub blockingStub;
<span class="line-numbers"> 55</span>    <span class="directive">private</span> <span class="directive">static</span> SystemServiceStub asyncStub;
<span class="line-numbers"> 56</span>
<span class="line-numbers"> 57</span>    <span class="annotation">@BeforeAll</span>
<span class="line-numbers"> 58</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 59</span>        <span class="comment">// tag::inProcessServer[]</span>
<span class="line-numbers"> 60</span>        inProcessServer = InProcessServerBuilder.forName(SERVER_NAME)
<span class="line-numbers"> 61</span>                              .addService(<span class="keyword">new</span> SystemService())
<span class="line-numbers"> 62</span>                              .directExecutor()
<span class="line-numbers"> 63</span>                              .build();
<span class="line-numbers"> 64</span>        inProcessServer.start();
<span class="line-numbers"> 65</span>        <span class="comment">// end::inProcessServer[]</span>
<span class="line-numbers"> 66</span>        <span class="comment">// tag::inProcessChannel[]</span>
<span class="line-numbers"> 67</span>        inProcessChannel = InProcessChannelBuilder.forName(SERVER_NAME)
<span class="line-numbers"> 68</span>                               .directExecutor()
<span class="line-numbers"> 69</span>                               .build();
<span class="line-numbers"> 70</span>        <span class="comment">// end::inProcessChannel[]</span>
<span class="line-numbers"> 71</span>        <span class="comment">// tag::blockingStub[]</span>
<span class="line-numbers"> 72</span>        blockingStub = SystemServiceGrpc.newBlockingStub(inProcessChannel);
<span class="line-numbers"> 73</span>        <span class="comment">// end::blockingStub[]</span>
<span class="line-numbers"> 74</span>        <span class="comment">// tag::asyncStub[]</span>
<span class="line-numbers"> 75</span>        asyncStub = SystemServiceGrpc.newStub(inProcessChannel);
<span class="line-numbers"> 76</span>        <span class="comment">// end::asyncStub[]</span>
<span class="line-numbers"> 77</span>    }
<span class="line-numbers"> 78</span>
<span class="line-numbers"> 79</span>    <span class="comment">// tag::tearDown[]</span>
<span class="line-numbers"> 80</span>    <span class="annotation">@AfterAll</span>
<span class="line-numbers"> 81</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> tearDown() {
<span class="line-numbers"> 82</span>        inProcessChannel.shutdownNow();
<span class="line-numbers"> 83</span>        inProcessServer.shutdownNow();
<span class="line-numbers"> 84</span>    }
<span class="line-numbers"> 85</span>    <span class="comment">// end::tearDown[]</span>
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 88</span>    <span class="comment">// tag::testGetProperty[]</span>
<span class="line-numbers"> 89</span>    <span class="directive">public</span> <span class="type">void</span> testGetProperty() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers"> 90</span>        SystemPropertyName request = SystemPropertyName.newBuilder()
<span class="line-numbers"> 91</span>                                         .setPropertyName(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 92</span>                                         .build();
<span class="line-numbers"> 93</span>        SystemPropertyValue response = blockingStub.getProperty(request);
<span class="line-numbers"> 94</span>        assertEquals(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>), response.getPropertyValue());
<span class="line-numbers"> 95</span>    }
<span class="line-numbers"> 96</span>    <span class="comment">// end::testGetProperty[]</span>
<span class="line-numbers"> 97</span>
<span class="line-numbers"> 98</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 99</span>    <span class="comment">// tag::testGetServerStreamingProperties[]</span>
<span class="line-numbers">100</span>    <span class="directive">public</span> <span class="type">void</span> testGetServerStreamingProperties() <span class="directive">throws</span> <span class="exception">Exception</span> {
<span class="line-numbers">101</span>
<span class="line-numbers">102</span>        SystemPropertyPrefix request = SystemPropertyPrefix.newBuilder()
<span class="line-numbers">103</span>                                           .setPropertyPrefix(<span class="string"><span class="delimiter">"</span><span class="content">os.</span><span class="delimiter">"</span></span>)
<span class="line-numbers">104</span>                                           .build();
<span class="line-numbers">105</span>        <span class="directive">final</span> <span class="predefined-type">CountDownLatch</span> countDown = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
<span class="line-numbers">106</span>        <span class="predefined-type">List</span>&lt;SystemProperty&gt; properties = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;SystemProperty&gt;();
<span class="line-numbers">107</span>        StreamObserver&lt;SystemProperty&gt; responseObserver =
<span class="line-numbers">108</span>            <span class="keyword">new</span> StreamObserver&lt;SystemProperty&gt;() {
<span class="line-numbers">109</span>                <span class="annotation">@Override</span>
<span class="line-numbers">110</span>                <span class="directive">public</span> <span class="type">void</span> onNext(SystemProperty property) {
<span class="line-numbers">111</span>                    properties.add(property);
<span class="line-numbers">112</span>                }
<span class="line-numbers">113</span>
<span class="line-numbers">114</span>                <span class="annotation">@Override</span>
<span class="line-numbers">115</span>                <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">116</span>                    fail(t.getMessage());
<span class="line-numbers">117</span>                }
<span class="line-numbers">118</span>
<span class="line-numbers">119</span>                <span class="annotation">@Override</span>
<span class="line-numbers">120</span>                <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">121</span>                    countDown.countDown();
<span class="line-numbers">122</span>                }
<span class="line-numbers">123</span>            };
<span class="line-numbers">124</span>
<span class="line-numbers">125</span>        asyncStub.getServerStreamingProperties(request, responseObserver);
<span class="line-numbers">126</span>        assertTrue(countDown.await(<span class="integer">10</span>, <span class="predefined-type">TimeUnit</span>.SECONDS));
<span class="line-numbers">127</span>
<span class="line-numbers">128</span>        <span class="keyword">for</span> (SystemProperty property : properties) {
<span class="line-numbers">129</span>            <span class="predefined-type">String</span> propertName = property.getPropertyName();
<span class="line-numbers">130</span>            assertEquals(<span class="predefined-type">System</span>.getProperty(propertName),
<span class="line-numbers">131</span>                property.getPropertyValue(), propertName + <span class="string"><span class="delimiter">"</span><span class="content"> is incorrect</span><span class="delimiter">"</span></span>);
<span class="line-numbers">132</span>        }
<span class="line-numbers">133</span>    }
<span class="line-numbers">134</span>    <span class="comment">// end::testGetServerStreamingProperties[]</span>
<span class="line-numbers">135</span>
<span class="line-numbers">136</span>    <span class="annotation">@Test</span>
<span class="line-numbers">137</span>    <span class="comment">// tag::testGetClientStreamingProperties[]</span>
<span class="line-numbers">138</span>    <span class="directive">public</span> <span class="type">void</span> testGetClientStreamingProperties() {
<span class="line-numbers">139</span>
<span class="line-numbers">140</span>        <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">"</span><span class="content">unchecked</span><span class="delimiter">"</span></span>)
<span class="line-numbers">141</span>        StreamObserver&lt;SystemProperties&gt; responseObserver =
<span class="line-numbers">142</span>            (StreamObserver&lt;SystemProperties&gt;) mock(StreamObserver.class);
<span class="line-numbers">143</span>        ArgumentCaptor&lt;SystemProperties&gt; systemPropertiesCaptor =
<span class="line-numbers">144</span>            ArgumentCaptor.forClass(SystemProperties.class);
<span class="line-numbers">145</span>
<span class="line-numbers">146</span>        StreamObserver&lt;SystemPropertyName&gt; requestObserver =
<span class="line-numbers">147</span>            asyncStub.getClientStreamingProperties(responseObserver);
<span class="line-numbers">148</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">149</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">user.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">150</span>                                  .collect(Collectors.toList());
<span class="line-numbers">151</span>        keys.stream()
<span class="line-numbers">152</span>            .map(k -&gt; SystemPropertyName.newBuilder().setPropertyName(k).build())
<span class="line-numbers">153</span>            .forEach(requestObserver::onNext);
<span class="line-numbers">154</span>        requestObserver.onCompleted();
<span class="line-numbers">155</span>        verify(responseObserver, timeout(<span class="integer">100</span>)).onNext(systemPropertiesCaptor.capture());
<span class="line-numbers">156</span>
<span class="line-numbers">157</span>        SystemProperties systemProperties = systemPropertiesCaptor.getValue();
<span class="line-numbers">158</span>        systemProperties.getPropertiesMap()
<span class="line-numbers">159</span>            .forEach((propertyName, propertyValue) -&gt;
<span class="line-numbers">160</span>            assertEquals(<span class="predefined-type">System</span>.getProperty(propertyName), propertyValue));
<span class="line-numbers">161</span>        verify(responseObserver, timeout(<span class="integer">100</span>)).onCompleted();
<span class="line-numbers">162</span>        verify(responseObserver, never()).onError(any(<span class="predefined-type">Throwable</span>.class));
<span class="line-numbers">163</span>    }
<span class="line-numbers">164</span>    <span class="comment">// end::testGetClientStreamingProperties[]</span>
<span class="line-numbers">165</span>
<span class="line-numbers">166</span>    <span class="annotation">@Test</span>
<span class="line-numbers">167</span>    <span class="comment">// tag::testGetBidirectionalProperties[]</span>
<span class="line-numbers">168</span>    <span class="directive">public</span> <span class="type">void</span> testGetBidirectionalProperties() {
<span class="line-numbers">169</span>
<span class="line-numbers">170</span>        <span class="type">int</span> timesOnNext = <span class="integer">0</span>;
<span class="line-numbers">171</span>
<span class="line-numbers">172</span>        <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">"</span><span class="content">unchecked</span><span class="delimiter">"</span></span>)
<span class="line-numbers">173</span>        StreamObserver&lt;SystemProperty&gt; responseObserver =
<span class="line-numbers">174</span>            (StreamObserver&lt;SystemProperty&gt;) mock(StreamObserver.class);
<span class="line-numbers">175</span>        StreamObserver&lt;SystemPropertyName&gt; requestObserver =
<span class="line-numbers">176</span>            asyncStub.getBidirectionalProperties(responseObserver);
<span class="line-numbers">177</span>
<span class="line-numbers">178</span>        verify(responseObserver, never()).onNext(any(SystemProperty.class));
<span class="line-numbers">179</span>
<span class="line-numbers">180</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">System</span>.getProperties().stringPropertyNames().stream()
<span class="line-numbers">181</span>                                  .filter(k -&gt; k.startsWith(<span class="string"><span class="delimiter">"</span><span class="content">java.</span><span class="delimiter">"</span></span>))
<span class="line-numbers">182</span>                                  .collect(Collectors.toList());
<span class="line-numbers">183</span>
<span class="line-numbers">184</span>        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; keys.size(); i++) {
<span class="line-numbers">185</span>            SystemPropertyName spn = SystemPropertyName.newBuilder()
<span class="line-numbers">186</span>                                         .setPropertyName(keys.get(i))
<span class="line-numbers">187</span>                                         .build();
<span class="line-numbers">188</span>            requestObserver.onNext(spn);
<span class="line-numbers">189</span>            ArgumentCaptor&lt;SystemProperty&gt; systemPropertyCaptor =
<span class="line-numbers">190</span>                ArgumentCaptor.forClass(SystemProperty.class);
<span class="line-numbers">191</span>            verify(responseObserver, timeout(<span class="integer">100</span>).times(++timesOnNext))
<span class="line-numbers">192</span>                .onNext(systemPropertyCaptor.capture());
<span class="line-numbers">193</span>            SystemProperty systemProperty = systemPropertyCaptor.getValue();
<span class="line-numbers">194</span>            assertEquals(<span class="predefined-type">System</span>.getProperty(systemProperty.getPropertyName()),
<span class="line-numbers">195</span>                         systemProperty.getPropertyValue());
<span class="line-numbers">196</span>        }
<span class="line-numbers">197</span>
<span class="line-numbers">198</span>        requestObserver.onCompleted();
<span class="line-numbers">199</span>        verify(responseObserver, timeout(<span class="integer">100</span>)).onCompleted();
<span class="line-numbers">200</span>        verify(responseObserver, never()).onError(any(<span class="predefined-type">Throwable</span>.class));
<span class="line-numbers">201</span>    }
<span class="line-numbers">202</span>    <span class="comment">// end::testGetBidirectionalProperties[]</span>
<span class="line-numbers">203</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>SystemService.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.system</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">io.grpc.stub.StreamObserver</span>;
<span class="line-numbers"> 19</span><span class="comment">// tag::importGrpcClasses[]</span>
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperties</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemProperty</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyName</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyPrefix</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemPropertyValue</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.systemproto.SystemServiceGrpc</span>;
<span class="line-numbers"> 26</span><span class="comment">// end::importGrpcClasses[]</span>
<span class="line-numbers"> 27</span>
<span class="line-numbers"> 28</span><span class="comment">// tag::extends[]</span>
<span class="line-numbers"> 29</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemService</span> <span class="directive">extends</span> SystemServiceGrpc.SystemServiceImplBase {
<span class="line-numbers"> 30</span><span class="comment">// end::extends[]</span>
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(SystemService.class.getName());
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="directive">public</span> SystemService() {
<span class="line-numbers"> 35</span>    }
<span class="line-numbers"> 36</span>
<span class="line-numbers"> 37</span>    <span class="comment">// tag::getProperty[]</span>
<span class="line-numbers"> 38</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 39</span>    <span class="directive">public</span> <span class="type">void</span> getProperty(
<span class="line-numbers"> 40</span>        SystemPropertyName request, StreamObserver&lt;SystemPropertyValue&gt; observer) {
<span class="line-numbers"> 41</span>
<span class="line-numbers"> 42</span>        <span class="comment">// tag::pName[]</span>
<span class="line-numbers"> 43</span>        <span class="predefined-type">String</span> pName = request.getPropertyName();
<span class="line-numbers"> 44</span>        <span class="comment">// end::pName[]</span>
<span class="line-numbers"> 45</span>        <span class="comment">// tag::pValue[]</span>
<span class="line-numbers"> 46</span>        <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers"> 47</span>        <span class="comment">// end::pValue[]</span>
<span class="line-numbers"> 48</span>        <span class="comment">// tag::response[]</span>
<span class="line-numbers"> 49</span>        SystemPropertyValue value = SystemPropertyValue
<span class="line-numbers"> 50</span>                                        .newBuilder()
<span class="line-numbers"> 51</span>                                        .setPropertyValue(pValue)
<span class="line-numbers"> 52</span>                                        .build();
<span class="line-numbers"> 53</span>        <span class="comment">// end::response[]</span>
<span class="line-numbers"> 54</span>
<span class="line-numbers"> 55</span>        <span class="comment">// tag::next[]</span>
<span class="line-numbers"> 56</span>        observer.onNext(value);
<span class="line-numbers"> 57</span>        <span class="comment">// end::next[]</span>
<span class="line-numbers"> 58</span>        <span class="comment">// tag::complete[]</span>
<span class="line-numbers"> 59</span>        observer.onCompleted();
<span class="line-numbers"> 60</span>        <span class="comment">// end::complete[]</span>
<span class="line-numbers"> 61</span>
<span class="line-numbers"> 62</span>    }
<span class="line-numbers"> 63</span>    <span class="comment">// end::getProperty[]</span>
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>    <span class="comment">// tag::getServerStreamingProperties[]</span>
<span class="line-numbers"> 66</span>    <span class="annotation">@Override</span>
<span class="line-numbers"> 67</span>    <span class="directive">public</span> <span class="type">void</span> getServerStreamingProperties(
<span class="line-numbers"> 68</span>        SystemPropertyPrefix request, StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers"> 69</span>
<span class="line-numbers"> 70</span>        <span class="comment">// tag::prefix[]</span>
<span class="line-numbers"> 71</span>        <span class="predefined-type">String</span> prefix = request.getPropertyPrefix();
<span class="line-numbers"> 72</span>        <span class="comment">// end::prefix[]</span>
<span class="line-numbers"> 73</span>        <span class="predefined-type">System</span>.getProperties()
<span class="line-numbers"> 74</span>              .stringPropertyNames()
<span class="line-numbers"> 75</span>              .stream()
<span class="line-numbers"> 76</span>              <span class="comment">// tag::filter[]</span>
<span class="line-numbers"> 77</span>              .filter(name -&gt; name.startsWith(prefix))
<span class="line-numbers"> 78</span>              <span class="comment">// end::filter[]</span>
<span class="line-numbers"> 79</span>              .forEach(name -&gt; {
<span class="line-numbers"> 80</span>                  <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(name);
<span class="line-numbers"> 81</span>                  <span class="comment">// tag::serverMessage[]</span>
<span class="line-numbers"> 82</span>                  SystemProperty value = SystemProperty
<span class="line-numbers"> 83</span>                      .newBuilder()
<span class="line-numbers"> 84</span>                      .setPropertyName(name)
<span class="line-numbers"> 85</span>                      .setPropertyValue(pValue)
<span class="line-numbers"> 86</span>                      .build();
<span class="line-numbers"> 87</span>                  <span class="comment">// end::serverMessage[]</span>
<span class="line-numbers"> 88</span>                  <span class="comment">// tag::serverNext1[]</span>
<span class="line-numbers"> 89</span>                  observer.onNext(value);
<span class="line-numbers"> 90</span>                  <span class="comment">// end::serverNext1[]</span>
<span class="line-numbers"> 91</span>                  logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming sent property: </span><span class="delimiter">"</span></span> + name);
<span class="line-numbers"> 92</span>               });
<span class="line-numbers"> 93</span>        <span class="comment">// tag::serverComplete[]</span>
<span class="line-numbers"> 94</span>        observer.onCompleted();
<span class="line-numbers"> 95</span>        <span class="comment">// end::serverComplete[]</span>
<span class="line-numbers"> 96</span>        logger.info(<span class="string"><span class="delimiter">"</span><span class="content">server streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::getServerStreamingProperties[]</span>
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>    <span class="comment">// tag::getClientStreamingProperties[]</span>
<span class="line-numbers">101</span>    <span class="annotation">@Override</span>
<span class="line-numbers">102</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getClientStreamingProperties(
<span class="line-numbers">103</span>        StreamObserver&lt;SystemProperties&gt; observer) {
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        <span class="comment">// tag::streamObserverClient[]</span>
<span class="line-numbers">106</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>            <span class="comment">// tag::clientStreamingMap[]</span>
<span class="line-numbers">109</span>            <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();
<span class="line-numbers">110</span>            <span class="comment">// end::clientStreamingMap[]</span>
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>            <span class="comment">// tag::receivingProperties[]</span>
<span class="line-numbers">113</span>            <span class="annotation">@Override</span>
<span class="line-numbers">114</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">115</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">116</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">117</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming received property: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">118</span>                properties.put(pName, pValue);
<span class="line-numbers">119</span>            }
<span class="line-numbers">120</span>            <span class="comment">// end::receivingProperties[]</span>
<span class="line-numbers">121</span>
<span class="line-numbers">122</span>            <span class="annotation">@Override</span>
<span class="line-numbers">123</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">124</span>                t.printStackTrace();
<span class="line-numbers">125</span>            }
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>            <span class="comment">// tag::clientStreamingCompleted[]</span>
<span class="line-numbers">128</span>            <span class="annotation">@Override</span>
<span class="line-numbers">129</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">130</span>                SystemProperties value = SystemProperties.newBuilder()
<span class="line-numbers">131</span>                                             .putAllProperties(properties)
<span class="line-numbers">132</span>                                             .build();
<span class="line-numbers">133</span>                observer.onNext(value);
<span class="line-numbers">134</span>                observer.onCompleted();
<span class="line-numbers">135</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">client streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">136</span>            }
<span class="line-numbers">137</span>            <span class="comment">// end::clientStreamingCompleted[]</span>
<span class="line-numbers">138</span>        };
<span class="line-numbers">139</span>        <span class="comment">// end::streamObserverClient[]</span>
<span class="line-numbers">140</span>    }
<span class="line-numbers">141</span>    <span class="comment">// end::getClientStreamingProperties[]</span>
<span class="line-numbers">142</span>
<span class="line-numbers">143</span>    <span class="comment">// tag::getBidirectionalProperties[]</span>
<span class="line-numbers">144</span>    <span class="annotation">@Override</span>
<span class="line-numbers">145</span>    <span class="directive">public</span> StreamObserver&lt;SystemPropertyName&gt; getBidirectionalProperties(
<span class="line-numbers">146</span>        StreamObserver&lt;SystemProperty&gt; observer) {
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>        <span class="comment">// tag::streamObserverBidirectional[]</span>
<span class="line-numbers">149</span>        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;SystemPropertyName&gt;() {
<span class="line-numbers">150</span>            <span class="comment">// tag::receiveBidirectionalProperties[]</span>
<span class="line-numbers">151</span>            <span class="annotation">@Override</span>
<span class="line-numbers">152</span>            <span class="directive">public</span> <span class="type">void</span> onNext(SystemPropertyName spn) {
<span class="line-numbers">153</span>                <span class="predefined-type">String</span> pName = spn.getPropertyName();
<span class="line-numbers">154</span>                <span class="predefined-type">String</span> pValue = <span class="predefined-type">System</span>.getProperty(pName);
<span class="line-numbers">155</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming received: </span><span class="delimiter">"</span></span> + pName);
<span class="line-numbers">156</span>                <span class="comment">// tag::systemPropertyMessage[]</span>
<span class="line-numbers">157</span>                SystemProperty value = SystemProperty.newBuilder()
<span class="line-numbers">158</span>                                           .setPropertyName(pName)
<span class="line-numbers">159</span>                                           .setPropertyValue(pValue)
<span class="line-numbers">160</span>                                           .build();
<span class="line-numbers">161</span>                <span class="comment">// end::systemPropertyMessage[]</span>
<span class="line-numbers">162</span>                <span class="comment">// tag::serverNext2[]</span>
<span class="line-numbers">163</span>                observer.onNext(value);
<span class="line-numbers">164</span>                <span class="comment">// end::serverNext2[]</span>
<span class="line-numbers">165</span>            }
<span class="line-numbers">166</span>            <span class="comment">// end::receiveBidirectionalProperties[]</span>
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>            <span class="annotation">@Override</span>
<span class="line-numbers">169</span>            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
<span class="line-numbers">170</span>                t.printStackTrace();
<span class="line-numbers">171</span>            }
<span class="line-numbers">172</span>
<span class="line-numbers">173</span>            <span class="comment">// tag::bidirectionalCompleted[]</span>
<span class="line-numbers">174</span>            <span class="annotation">@Override</span>
<span class="line-numbers">175</span>            <span class="directive">public</span> <span class="type">void</span> onCompleted() {
<span class="line-numbers">176</span>                observer.onCompleted();
<span class="line-numbers">177</span>                logger.info(<span class="string"><span class="delimiter">"</span><span class="content">bi-directional streaming was completed!</span><span class="delimiter">"</span></span>);
<span class="line-numbers">178</span>            }
<span class="line-numbers">179</span>            <span class="comment">// end::bidirectionalCompleted[]</span>
<span class="line-numbers">180</span>        };
<span class="line-numbers">181</span>        <span class="comment">// end::streamObserverBidirectional[]</span>
<span class="line-numbers">182</span>    }
<span class="line-numbers">183</span>    <span class="comment">// end::getBidirectionalProperties[]</span>
<span class="line-numbers">184</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>setUp()</code> static method, create and start the <code class="hotspot=inProcessServer file=1">inProcessServer</code> in-process gRPC server. Then, create the <code class="hotspot=inProcessChannel file=1">inProcessChannel</code> in-process channel that connects to the <code>inProcessServer</code> server running in the same JVM process. The unit tests can make calls to the gRPC server by using the same method signatures and functionalities as the gRPC client, even though they use different <code class="hotspot=blockingStub file=1">blockingStub</code> or <code class="hotspot=asyncStub file=1">asyncStub</code> stubs through the same channel.</p>
</div>
<div class="paragraph">
<p>In the <code class="hotspot=tearDown file=1">tearDown()</code> static method, shut down the <code>inProcessChannel</code> in-process channel and the <code>inProcessServer</code> in-process gRPC server.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testGetProperty file=1">testGetProperty()</code> tests the unary call to retrieve a single system property value.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testGetServerStreamingProperties file=1">testGetServerStreamingProperties()</code> tests the server streaming call to retrieve multiple system property values with a given property prefix.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testGetClientStreamingProperties file=1">testGetClientStreamingProperties()</code> tests the client streaming call to retrieve multiple system property values with given property names.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testGetBidirectionalProperties file=1">testGetBidirectionalProperties()</code> tests the bidirectional streaming call to retrieve multiple system property values with given property names.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-unit-tests-for-the-grpc-server-service">Running unit tests for the gRPC server service</h3>
<div class="paragraph">
<p>Because you started Open Liberty in dev mode, you can run the tests by pressing the <code>enter/return</code> key from the command-line session where you started the <code>system</code> service.</p>
</div>
<div class="paragraph">
<p>If the tests pass, you see output similar to the following example:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running io.openliberty.guides.system.SystemServiceTest

Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.527 s - in io.openliberty.guides.system.SystemServiceTest

Results:

Tests run: 4, Failures: 0, Errors: 0, Skipped: 0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-integration-tests-for-the-query-service">Implementing integration tests for the query service</h3>
<div class="paragraph">
<p>In this section, you’ll write integration tests using Jakarta Restful Web Services Client APIs to test the <code>query</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>QueryIT</code> class.</mark>
<code>query/src/test/java/it/io/openliberty/guides/query/QueryIT.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>QueryIT.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2022, 2023 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License 2.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-2.0/</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * SPDX-License-Identifier: EPL-2.0</span>
<span class="line-numbers"> 10</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 11</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 12</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.query</span>;
<span class="line-numbers"> 13</span>
<span class="line-numbers"> 14</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertFalse</span>;
<span class="line-numbers"> 16</span>
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.net.MalformedURLException</span>;
<span class="line-numbers"> 18</span>
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">jakarta.json.JsonObject</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.Client</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.client.WebTarget</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Response</span>;
<span class="line-numbers"> 24</span>
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.AfterAll</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="directive">public</span> <span class="type">class</span> <span class="class">QueryIT</span> {
<span class="line-numbers"> 30</span>
<span class="line-numbers"> 31</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PORT = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">http.port</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">9081</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 32</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> <span class="predefined-type">URL</span> = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost:</span><span class="delimiter">"</span></span> + PORT + <span class="string"><span class="delimiter">"</span><span class="content">/</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 33</span>    <span class="directive">private</span> <span class="directive">static</span> Client client;
<span class="line-numbers"> 34</span>
<span class="line-numbers"> 35</span>    <span class="annotation">@BeforeAll</span>
<span class="line-numbers"> 36</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setup() {
<span class="line-numbers"> 37</span>        client = ClientBuilder.newClient();
<span class="line-numbers"> 38</span>    }
<span class="line-numbers"> 39</span>
<span class="line-numbers"> 40</span>    <span class="annotation">@AfterAll</span>
<span class="line-numbers"> 41</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> teardown() {
<span class="line-numbers"> 42</span>        client.close();
<span class="line-numbers"> 43</span>    }
<span class="line-numbers"> 44</span>
<span class="line-numbers"> 45</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 46</span>    <span class="comment">// tag::getPropertiesString[]</span>
<span class="line-numbers"> 47</span>    <span class="directive">public</span> <span class="type">void</span> testGetPropertiesString() <span class="directive">throws</span> <span class="exception">MalformedURLException</span> {
<span class="line-numbers"> 48</span>        WebTarget target = client.target(<span class="predefined-type">URL</span> + <span class="string"><span class="delimiter">"</span><span class="content">query/properties/os.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 49</span>        Response response = target.request().get();
<span class="line-numbers"> 50</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 51</span>                     <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + target.getUri().getPath());
<span class="line-numbers"> 52</span>        assertFalse(response.readEntity(<span class="predefined-type">String</span>.class).isEmpty(),
<span class="line-numbers"> 53</span>                    <span class="string"><span class="delimiter">"</span><span class="content">response should not be empty.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 54</span>        response.close();
<span class="line-numbers"> 55</span>    }
<span class="line-numbers"> 56</span>    <span class="comment">// end::getPropertiesString[]</span>
<span class="line-numbers"> 57</span>
<span class="line-numbers"> 58</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 59</span>    <span class="comment">// tag::getOSProperties[]</span>
<span class="line-numbers"> 60</span>    <span class="directive">public</span> <span class="type">void</span> testGetOSProperties() <span class="directive">throws</span> <span class="exception">MalformedURLException</span> {
<span class="line-numbers"> 61</span>        WebTarget target = client.target(<span class="predefined-type">URL</span> + <span class="string"><span class="delimiter">"</span><span class="content">query/properties/os</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 62</span>        Response response = target.request().get();
<span class="line-numbers"> 63</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 64</span>                     <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + target.getUri().getPath());
<span class="line-numbers"> 65</span>        JsonObject obj = response.readEntity(JsonObject.class);
<span class="line-numbers"> 66</span>        assertFalse(obj.getString(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>).isEmpty(),
<span class="line-numbers"> 67</span>                    <span class="string"><span class="delimiter">"</span><span class="content">os.name should not be empty.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 68</span>        response.close();
<span class="line-numbers"> 69</span>    }
<span class="line-numbers"> 70</span>    <span class="comment">// end::getOSProperties[]</span>
<span class="line-numbers"> 71</span>
<span class="line-numbers"> 72</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 73</span>    <span class="comment">// tag::getUserProperties[]</span>
<span class="line-numbers"> 74</span>    <span class="directive">public</span> <span class="type">void</span> testGetUserProperties() <span class="directive">throws</span> <span class="exception">MalformedURLException</span> {
<span class="line-numbers"> 75</span>        WebTarget target = client.target(<span class="predefined-type">URL</span> + <span class="string"><span class="delimiter">"</span><span class="content">query/properties/user</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 76</span>        Response response = target.request().get();
<span class="line-numbers"> 77</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 78</span>                     <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + target.getUri().getPath());
<span class="line-numbers"> 79</span>        JsonObject obj = response.readEntity(JsonObject.class);
<span class="line-numbers"> 80</span>        assertFalse(obj.getString(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>).isEmpty(),
<span class="line-numbers"> 81</span>                    <span class="string"><span class="delimiter">"</span><span class="content">user.name should not be empty.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 82</span>        response.close();
<span class="line-numbers"> 83</span>    }
<span class="line-numbers"> 84</span>    <span class="comment">// end::getUserProperties[]</span>
<span class="line-numbers"> 85</span>
<span class="line-numbers"> 86</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 87</span>    <span class="comment">// tag::getJavaProperties[]</span>
<span class="line-numbers"> 88</span>    <span class="directive">public</span> <span class="type">void</span> testGetJavaProperties() <span class="directive">throws</span> <span class="exception">MalformedURLException</span> {
<span class="line-numbers"> 89</span>        WebTarget target = client.target(<span class="predefined-type">URL</span> + <span class="string"><span class="delimiter">"</span><span class="content">query/properties/java</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 90</span>        Response response = target.request().get();
<span class="line-numbers"> 91</span>        assertEquals(<span class="integer">200</span>, response.getStatus(),
<span class="line-numbers"> 92</span>                     <span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + target.getUri().getPath());
<span class="line-numbers"> 93</span>        JsonObject obj = response.readEntity(JsonObject.class);
<span class="line-numbers"> 94</span>        assertFalse(obj.getString(<span class="string"><span class="delimiter">"</span><span class="content">java.home</span><span class="delimiter">"</span></span>).isEmpty(),
<span class="line-numbers"> 95</span>                    <span class="string"><span class="delimiter">"</span><span class="content">java.home should not be empty.</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 96</span>        response.close();
<span class="line-numbers"> 97</span>    }
<span class="line-numbers"> 98</span>    <span class="comment">// end::getJavaProperties[]</span>
<span class="line-numbers"> 99</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getPropertiesString file=0">testGetPropertiesString()</code> tests the <code>/query/properties/os.name</code> endpoint and confirms that a response is received.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getOSProperties file=0">testGetOSProperties()</code> tests the <code>/query/properties/os</code> endpoint and confirms that a response is received.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getUserProperties file=0">testGetUserProperties()</code> tests the <code>/query/properties/user</code> endpoint and confirms that a response is received.</p>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getJavaProperties file=0">testGetJavaProperties()</code> tests the <code>/query/properties/java</code> endpoint and confirms that a response is received.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-integration-tests-for-the-query-service">Running integration tests for the query service</h3>
<div class="paragraph">
<p>Because you started Open Liberty in dev mode, you can run the tests by pressing the <code>enter/return</code> key from the command-line session where you started the <code>query</code> service.</p>
</div>
<div class="paragraph">
<p>If the tests pass, you see output similar to the following example:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.query.QueryIT
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.247 s - in it.io.openliberty.guides.query.QueryIT

Results:

Tests run: 4, Failures: 0, Errors: 0, Skipped: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you are done checking out the services, exit dev mode by pressing <code>CTRL+C</code> in the command-line sessions where you ran the <code>system</code> and <code>query</code> services,  or by typing <code>q</code> and then pressing the <code>enter/return</code> key. Alternatively, you can run the <code>liberty:stop</code> goal from the <code>start</code> directory in another command-line session for the <code>system</code> and <code>query</code> services:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre>mvn -pl system liberty:stop
mvn -pl query liberty:stop</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You just developed a Java application that implements four types of gRPC calls with Open Liberty. For more information, see <a href="https://openliberty.io/docs/latest/grpc-services.html" target="_blank" rel="noopener">Provide and consume gRPC services on Open Liberty</a> in the Open Liberty docs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Streaming messages between client and server services using gRPC <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-grpc-intro/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-grpc-intro/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-grpc-intro/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-rest-client-async.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Consuming RESTful services asynchronously with template interfaces</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
