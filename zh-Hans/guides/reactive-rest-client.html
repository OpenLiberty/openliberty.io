<!DOCTYPE html>
<html lang="zh-Hans">

  





<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    
      Consuming RESTful Java microservices asynchronously using the reactive JAX-RS client
    
  </title>
  <meta name="description" content="A getting started tutorial and an example on how to consume RESTful Java microservices asynchronously using reactive Java API for RESTful Web Services (JAX-RS) client with Eclipse Jersey/RxJava reactive client library.">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/openliberty.css">
  <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/coderay-custom.css">

  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/header-dark.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/toc-multipane-static.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/end-of-guide.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-card.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/tabs.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-common.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane.css">
  
    <link type="text/css" rel="stylesheet" href="/zh-Hans/assets/guide-multipane-static.css">
  

  

  

  <link rel="canonical" href="https://openliberty.io/zh-Hans/guides/reactive-rest-client">
  <link rel="alternate" type="application/rss+xml" title="Open Liberty" href="/zh-Hans/feed.xml">
  <link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet">
    
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@OpenLibertyIO" />
  <meta name="twitter:title" content="Consuming RESTful Java microservices asynchronously using the reactive JAX-RS client" />
  <meta name="twitter:description" content="A getting started tutorial and an example on how to consume RESTful Java microservices asynchronously using reactive Java API for RESTful Web Services (JAX-RS) client with Eclipse Jersey/RxJava reactive client library." />

  <meta property='og:title' content="Consuming RESTful Java microservices asynchronously using the reactive JAX-RS client" />
  <meta property='og:image' content="https://openliberty.io/img/twitter_card.jpg" />
  <meta property='og:image:alt' content="Open Liberty Logo" />
  <meta property='og:description' content="A getting started tutorial and an example on how to consume RESTful Java microservices asynchronously using reactive Java API for RESTful Web Services (JAX-RS) client with Eclipse Jersey/RxJava reactive client library." />
  <meta property='og:url' content="https://openliberty.io/zh-Hans/guides/reactive-rest-client" />
  <meta property='og:type' content="website" />
  
  <meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs" />

  
      <meta name="robots" content="noindex" />
  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>
    
    

    


<!--  -->

<header>
    <nav id="nav_bar">
        <div id="nav_header">
            <a id="home_link" href="/" aria-label="Open Liberty Home">
                <img id="ol_logo" src="/img/docs_openliberty_logo.png" alt="Open Liberty Logo">
            </a>
            <button id="hamburger_toggle_button" onclick="$('#nav_bar').toggleClass('responsive');">
                <span id="hamburger_toggle_icon"></span>
            </button>
        </div>
        <div id="hamburger_menu">
            <ul class="nav_list">
                <li class="nav_link">
                    <a href="/start/">入门</a>
                </li>
                <li class="nav_link">
                    <a href="/guides/">指南</a>
                </li>
                <li class="nav_link">
                    <a href="/docs/">文档</a>
                </li>
                <li class="nav_link">
                    <a href="/support/">支持</a>
                </li>
                <li class="nav_link">
                    <a href="/blog/">博客</a>
                </li>
            </ul>
            <div id="header_round_links_container"> 
                <a id="header_twitter_link" class="header_round_button" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="header_stackoverflow_link" class="header_round_button" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="header_groupsio_link" class="header_round_button" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="header_gitter_link" class="header_round_button" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>

    </nav>
</header>


    <main aria-label="Content">

      <!-- Build a list of all the documents in the guides code base -->
  
 

<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->
<!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
 

<!-- Sort list of guides by date with most recent first -->


<div id="background_container">
  <div id="toc_hotspot"></div>
  <!-- Guide's table of contents section -->
  <div id="toc_column" class="collapse inline open">
    <div id="toc_inner">
       
      <div id="close_container">
        <img id="toc_close_white" src="/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0">
      </div>
      <h3 id="toc_title">Contents</h3>
      <div id="toc_container"><ul class="sectlevel1">
<li><a href="#what-youll-learn">What you’ll learn</a></li>
<li><a href="#additional-prerequisites">Additional prerequisites</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#creating-a-web-client-using-the-default-jax-rs-api">Creating a web client using the default JAX-RS API</a></li>
<li><a href="#building-and-running-the-application">Building and running the application</a></li>
<li><a href="#updating-the-web-client-to-use-an-alternative-reactive-provider">Updating the web client to use an alternative reactive provider</a></li>
<li><a href="#updating-the-rest-resource-to-support-the-reactive-jax-rs-client">Updating the REST resource to support the reactive JAX-RS client</a></li>
<li><a href="#rebuilding-and-running-the-application">Rebuilding and running the application</a></li>
<li>
<a href="#testing-the-query-microservice">Testing the query microservice</a>
<ul class="sectlevel2">
<li><a href="#running-the-tests">Running the tests</a></li>
</ul>
</li>
<li><a href="#great-work-youre-done">Great work! You’re done!</a></li>
<li><a href="#guide-attribution">Guide Attribution</a></li>
</ul></div>
      <div id="toc_separator"></div>
      
      <h3 id="tag_title">标签</h3>
      <div id="tags_container"></div>
    </div>
  </div>
  <div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden">
    <img src="/img/arrow_white.svg" alt="arrow">
  </div>
  <div id="toc_line" class="open"></div>
  <!-- Entire guide section -->
  <div id="guide_column" class="position_relative open">
    <div id="guide_content">
      <!-- Guide header section -->
      <div id="guide_meta" class="sect1" tabindex="0">
        <h1 id="guide_title">Consuming RESTful services using the reactive JAX-RS client</h1>
        <div id="duration_container">
          <img src="/img/guide_duration_clock_icon_large.svg" alt="duration">
          <span id="guide_duration">25 minutes</span>

          <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
          <!-- If new posts count is less than 4, use 4 most recent posts -->
           
          <!-- If new posts count is >= 4, use posts from last 30 days-->
          
          <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
          <!-- Count number of guides from past last 12 weeks that is 84 days-->
          <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
          
        </div>
        <div id="mobile_prereqs_section">
          <p id="mobile_prereqs_title">Prerequisites:</p>
          <div class="prereqs_list"></div>
          <div class="skills_network_container">
            <div class="skills_network_description"></div>
          </div>
        </div>
      </div>

      <div class="scroller_anchor"></div>
      <div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column" role="button">
        <div role="menuitem" id="mobile_toc_accordion">
          <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <img src="/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button">
          </button>
          <span>Table of contents</span>
        </div>
      </div>

      <!-- Guide content section -->
      <div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note hidden">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="https://openliberty.io/guides/reactive-rest-client.html">Open Liberty website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Learn how to use a reactive JAX-RS client to asynchronously invoke RESTful microservices over HTTP.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-youll-learn">What you’ll learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, you’ll learn how to create a reactive JAX-RS client application by using the default reactive JAX-RS client APIs. You will then learn how to take advantage of the RxJava reactive extensions with a pluggable reactive JAX-RS client provider that’s published by <a href="https://eclipse-ee4j.github.io/jersey" target="_blank" rel="noopener noreferrer">Eclipse Jersey</a>. The JAX-RS client is an API used to communicate with RESTful web services.  The API makes it easy to consume a web service by using the HTTP protocol, which means that you can efficiently implement client-side applications. The reactive client extension to JAX-RS is an API that enables you to use the reactive programming model when using the JAX-RS client.</p>
</div>
<div class="paragraph">
<p>Reactive programming is an extension of asynchronous programming and focuses on the flow of data through data streams. Reactive applications process data when it becomes available and respond to requests as soon as processing is complete. The request to the application and response from the application are decoupled so that the application is not blocked from responding to other requests in the meantime. Because reactive applications can run faster than synchronous applications, they provide a much smoother user experience.</p>
</div>
<div class="paragraph">
<p>The application in this guide demonstrates how the JAX-RS client accesses remote RESTful services by using asynchronous method calls. You’ll first look at the supplied client application that uses the JAX-RS default <code>CompletionStage</code>-based provider. Then, you’ll modify the client application to use Jersey’s RxJava provider, which is an alternative JAX-RS reactive provider. Both Jersey and Apache CXF provide third-party reactive libraries for RxJava and were tested for use in Open Liberty.</p>
</div>
<div class="paragraph">
<p>The application that you will be working with consists of three microservices, <code>system</code>, <code>inventory</code>, and <code>query</code>. Every 15 seconds, the <code>system</code> microservice calculates and publishes an event that contains its current average system load. The <code>inventory</code> microservice subscribes to that information so that it can keep an updated list of all the systems and their current system loads.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/guide/reactive-rest-client/QueryService.png" alt="Reactive Query Service" width="253" height="327">
</div>
</div>
<div class="paragraph">
<p>The microservice that you will modify is the <code>query</code> service. It communicates with the <code>inventory</code> service to determine which system has the highest system load and which system has the lowest system load.</p>
</div>
<div class="paragraph">
<p>The <code>system</code> and <code>inventory</code> microservices use MicroProfile Reactive Messaging to send and receive the system load events. If you want to learn more about reactive messaging, see the  <a href="https://openliberty.io/guides/microprofile-reactive-messaging.html" target="_blank" rel="noopener">Creating reactive Java microservices</a> guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-prerequisites">Additional prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to have Docker installed. For installation instructions, refer to the official <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Docker documentation</a>. You will build and run the microservices in Docker containers. An installation of Apache Kafka is provided in another Docker container.</p>
</div>
</div>
</div>
<div class="sect1 command">
<h2 id="getting-started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to work through this guide is to clone the <a href="https://github.com/openliberty/guide-reactive-rest-client.git" target="_blank" rel="noopener noreferrer">Git repository</a> and use the projects that are provided inside:</p>
</div>
<div id="git_clone" class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-reactive-rest-client.git
cd guide-reactive-rest-client</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> directory contains the starting project that you will build upon.</p>
</div>
<div class="paragraph">
<p>The <code>finish</code> directory contains the finished project that you will build.</p>
</div>
<div class="paragraph">
<p>Before you begin, make sure you have all the necessary <span class="prerequisites">prerequisites</span>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-web-client-using-the-default-jax-rs-api">Creating a web client using the default JAX-RS API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Navigate to the <code>start</code> directory to begin.</p>
</div>
<div class="paragraph">
<p>JAX-RS provides a default reactive provider that you can use to create a reactive REST client using the <code>CompletionStage</code> interface.</p>
</div>
<div class="paragraph">
<p>Create an <code class="hotspot file=0">InventoryClient</code> class, which retrieves inventory data, and a <code class="hotspot file=1">QueryResource</code> class, which queries data from the <code>inventory</code> service.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Create the <code>InventoryClient</code> interface.</mark>
<code>query/src/main/java/io/openliberty/guides/query/client/InventoryClient.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>InventoryClient.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2020 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers">10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers">11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query.client</span>;
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CompletionStage</span>;
<span class="line-numbers">18</span>
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.RequestScoped</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="line-numbers">22</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.Invocation</span>;
<span class="line-numbers">24</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.WebTarget</span>;
<span class="line-numbers">25</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.GenericType</span>;
<span class="line-numbers">26</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.HttpHeaders</span>;
<span class="line-numbers">27</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers">28</span>
<span class="line-numbers">29</span><span class="annotation">@RequestScoped</span>
<span class="line-numbers">30</span><span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryClient</span> {
<span class="line-numbers">31</span>
<span class="line-numbers">32</span>    <span class="annotation">@Inject</span>
<span class="line-numbers">33</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">INVENTORY_BASE_URI</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9085</span><span class="delimiter">"</span></span>)
<span class="line-numbers">34</span>    <span class="directive">private</span> <span class="predefined-type">String</span> baseUri;
<span class="line-numbers">35</span>
<span class="line-numbers">36</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getSystems() {
<span class="line-numbers">37</span>        <span class="keyword">return</span> ClientBuilder.newClient()
<span class="line-numbers">38</span>                            .target(baseUri)
<span class="line-numbers">39</span>                            .path(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers">40</span>                            .request()
<span class="line-numbers">41</span>                            .header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON)
<span class="line-numbers">42</span>                            .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;&gt;(){});
<span class="line-numbers">43</span>    }
<span class="line-numbers">44</span>
<span class="line-numbers">45</span>    <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers">46</span>    <span class="directive">public</span> CompletionStage&lt;<span class="predefined-type">Properties</span>&gt; getSystem(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">47</span>        <span class="keyword">return</span> ClientBuilder.newClient()
<span class="line-numbers">48</span>                            .target(baseUri)
<span class="line-numbers">49</span>                            .path(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers">50</span>                            .path(hostname)
<span class="line-numbers">51</span>                            .request()
<span class="line-numbers">52</span>                            .header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON)
<span class="line-numbers">53</span>                            <span class="comment">// tag::rx[]</span>
<span class="line-numbers">54</span>                            .rx()
<span class="line-numbers">55</span>                            <span class="comment">// end::rx[]</span>
<span class="line-numbers">56</span>                            .get(<span class="predefined-type">Properties</span>.class);
<span class="line-numbers">57</span>    }
<span class="line-numbers">58</span>    <span class="comment">// end::getSystem[]</span>
<span class="line-numbers">59</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=getSystem file=0">getSystem()</code> method returns the <code>CompletionStage</code> interface. This interface represents a unit or stage of a computation. When the associated computation completes, the value can be retrieved. The <code class="hotspot=rx file=0">rx()</code> method calls the <code>CompletionStage</code> interface. It retrieves the <code>CompletionStageRxInvoker</code> class and allows these methods to function correctly with the <code>CompletionStage</code> interface return type.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Create the <code>QueryResource</code> class.</mark>
<code>query/src/main/java/io/openliberty/guides/query/QueryResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>QueryResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2020 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers"> 10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers"> 11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.concurrent.ConcurrentHashMap</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 22</span>
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">javax.ws.rs.GET</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Path</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Produces</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 29</span>
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.query.client.InventoryClient</span>;
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 33</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/query</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 34</span><span class="directive">public</span> <span class="type">class</span> <span class="class">QueryResource</span> {
<span class="line-numbers"> 35</span>    
<span class="line-numbers"> 36</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 37</span>    <span class="directive">private</span> InventoryClient inventoryClient;
<span class="line-numbers"> 38</span>
<span class="line-numbers"> 39</span>    <span class="comment">// tag::systemLoad[]</span>
<span class="line-numbers"> 40</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 41</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systemLoad</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 42</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 43</span>    <span class="comment">// tag::systemLoadMethod[]</span>
<span class="line-numbers"> 44</span>    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; systemLoad() {
<span class="line-numbers"> 45</span>    <span class="comment">// end::systemLoadMethod[]</span>
<span class="line-numbers"> 46</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; systems = inventoryClient.getSystems();
<span class="line-numbers"> 47</span>        <span class="comment">// tag::countdownlatch[]</span>
<span class="line-numbers"> 48</span>        <span class="predefined-type">CountDownLatch</span> remainingSystems = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(systems.size());
<span class="line-numbers"> 49</span>        <span class="comment">// end::countdownlatch[]</span>
<span class="line-numbers"> 50</span>        <span class="directive">final</span> Holder systemLoads = <span class="keyword">new</span> Holder();
<span class="line-numbers"> 51</span>
<span class="line-numbers"> 52</span>        <span class="keyword">for</span> (<span class="predefined-type">String</span> system : systems) {
<span class="line-numbers"> 53</span>            <span class="comment">// tag::getsystem[]</span>
<span class="line-numbers"> 54</span>            inventoryClient.getSystem(system)
<span class="line-numbers"> 55</span>            <span class="comment">// end::getsystem[]</span>
<span class="line-numbers"> 56</span>                           <span class="comment">// tag::thenAcceptAsync[]</span>
<span class="line-numbers"> 57</span>                           .thenAcceptAsync(p -&gt; {
<span class="line-numbers"> 58</span>                                <span class="keyword">if</span> (p != <span class="predefined-constant">null</span>) {
<span class="line-numbers"> 59</span>                                    systemLoads.updateValues(p);
<span class="line-numbers"> 60</span>                                }
<span class="line-numbers"> 61</span>                                <span class="comment">// tag::countdown1[]</span>
<span class="line-numbers"> 62</span>                                remainingSystems.countDown();
<span class="line-numbers"> 63</span>                                <span class="comment">// end::countdown1[]</span>
<span class="line-numbers"> 64</span>                           })
<span class="line-numbers"> 65</span>                           <span class="comment">// end::thenAcceptAsync[]</span>
<span class="line-numbers"> 66</span>                           <span class="comment">// tag::exceptionally[]</span>
<span class="line-numbers"> 67</span>                           .exceptionally(ex -&gt; {
<span class="line-numbers"> 68</span>                                <span class="comment">// tag::countdown2[]</span>
<span class="line-numbers"> 69</span>                                remainingSystems.countDown();
<span class="line-numbers"> 70</span>                                <span class="comment">// end::countdown2[]</span>
<span class="line-numbers"> 71</span>                                ex.printStackTrace();
<span class="line-numbers"> 72</span>                                <span class="keyword">return</span> <span class="predefined-constant">null</span>;
<span class="line-numbers"> 73</span>                           });
<span class="line-numbers"> 74</span>                           <span class="comment">// end::exceptionally[]</span>
<span class="line-numbers"> 75</span>        }
<span class="line-numbers"> 76</span>
<span class="line-numbers"> 77</span>        <span class="comment">// Wait for all remaining systems to be checked</span>
<span class="line-numbers"> 78</span>        <span class="keyword">try</span> {
<span class="line-numbers"> 79</span>            <span class="comment">// tag::await[]</span>
<span class="line-numbers"> 80</span>            remainingSystems.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers"> 81</span>            <span class="comment">// end::await[]</span>
<span class="line-numbers"> 82</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers"> 83</span>            e.printStackTrace();
<span class="line-numbers"> 84</span>        }
<span class="line-numbers"> 85</span>
<span class="line-numbers"> 86</span>        <span class="keyword">return</span> systemLoads.getValues();
<span class="line-numbers"> 87</span>    }
<span class="line-numbers"> 88</span>    <span class="comment">// end::systemLoad[]</span>
<span class="line-numbers"> 89</span>
<span class="line-numbers"> 90</span>    <span class="directive">private</span> <span class="type">class</span> <span class="class">Holder</span> {
<span class="line-numbers"> 91</span>        <span class="comment">// tag::volatile[]</span>
<span class="line-numbers"> 92</span>        <span class="directive">private</span> <span class="directive">volatile</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; values;
<span class="line-numbers"> 93</span>        <span class="comment">// end::volatile[]</span>
<span class="line-numbers"> 94</span>
<span class="line-numbers"> 95</span>        <span class="directive">public</span> Holder() {
<span class="line-numbers"> 96</span>            <span class="comment">// tag::concurrentHashMap[]</span>
<span class="line-numbers"> 97</span>            <span class="local-variable">this</span>.values = <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt;();
<span class="line-numbers"> 98</span>            <span class="comment">// end::concurrentHashMap[]</span>
<span class="line-numbers"> 99</span>            init();
<span class="line-numbers">100</span>        }
<span class="line-numbers">101</span>
<span class="line-numbers">102</span>        <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; getValues() {
<span class="line-numbers">103</span>            <span class="keyword">return</span> <span class="local-variable">this</span>.values;
<span class="line-numbers">104</span>        }
<span class="line-numbers">105</span>
<span class="line-numbers">106</span>        <span class="directive">public</span> <span class="type">void</span> updateValues(<span class="predefined-type">Properties</span> p) {
<span class="line-numbers">107</span>            <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> load = (<span class="predefined-type">BigDecimal</span>) p.get(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>);
<span class="line-numbers">108</span>
<span class="line-numbers">109</span>            <span class="local-variable">this</span>.values.computeIfPresent(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>, (key, curr_val) -&gt; {
<span class="line-numbers">110</span>                <span class="predefined-type">BigDecimal</span> lowest = (<span class="predefined-type">BigDecimal</span>) curr_val.get(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>);
<span class="line-numbers">111</span>                <span class="keyword">return</span> load.compareTo(lowest) &lt; <span class="integer">0</span> ? p : curr_val;
<span class="line-numbers">112</span>            });
<span class="line-numbers">113</span>            <span class="local-variable">this</span>.values.computeIfPresent(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>, (key, curr_val) -&gt; {
<span class="line-numbers">114</span>                <span class="predefined-type">BigDecimal</span> highest = (<span class="predefined-type">BigDecimal</span>) curr_val.get(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>);
<span class="line-numbers">115</span>                <span class="keyword">return</span> load.compareTo(highest) &gt; <span class="integer">0</span> ? p : curr_val;
<span class="line-numbers">116</span>            });
<span class="line-numbers">117</span>        }
<span class="line-numbers">118</span>
<span class="line-numbers">119</span>        <span class="directive">private</span> <span class="type">void</span> init() {
<span class="line-numbers">120</span>            <span class="comment">// Initialize highest and lowest values</span>
<span class="line-numbers">121</span>            <span class="local-variable">this</span>.values.put(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">Properties</span>());
<span class="line-numbers">122</span>            <span class="local-variable">this</span>.values.put(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">Properties</span>());
<span class="line-numbers">123</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">temp_max</span><span class="delimiter">"</span></span>);
<span class="line-numbers">124</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">temp_min</span><span class="delimiter">"</span></span>);
<span class="line-numbers">125</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="predefined-type">Double</span>.MIN_VALUE));
<span class="line-numbers">126</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="predefined-type">Double</span>.MAX_VALUE));
<span class="line-numbers">127</span>        }
<span class="line-numbers">128</span>    }
<span class="line-numbers">129</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=systemLoadMethod file=1">systemLoad</code> endpoint asynchronously processes the data that is retrieved by the <code class="hotspot=getsystem file=1">InventoryClient</code> interface and serves that data after all of the services respond. The <code class="hotspot=thenAcceptAsync file=1">thenAcceptAsync()</code> and <code class="hotspot=exceptionally file=1">exceptionally()</code> methods together behave like an asynchronous try-catch block. The data is processed in the <code class="hotspot=thenAcceptAsync file=1">thenAcceptAsync()</code> method only after the <code>CompletionStage</code> interface finishes retrieving it.  When you return a <code>CompletionStage</code> type in the resource, it doesn’t necessarily mean that the computation completed and the response was built.</p>
</div>
<div class="paragraph">
<p>A <code class="hotspot=countdownlatch file=1">CountDownLatch</code> object is used to track how many asynchronous requests are being waited on. After each thread is completed, the <code class="hotspot=countdown1 hotspot=countdown2 file=1">countdown()</code> methodcounts the <code class="hotspot=countdownlatch file=1">CountDownLatch</code> object down towards <code>0</code>. This means that the value returns only after the thread that’s retrieving the value is complete.The <code class="hotspot=await file=1">await()</code> method stops and waits until all of the requests are complete. While the countdown completes, the main thread is free to perform other tasks. In this case, no such task is present.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-and-running-the-application">Building and running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>system</code>, <code>inventory</code>, and <code>query</code> microservices will be built in Docker containers. If you want to learn more about Docker containers, check out the <a href="https://openliberty.io/guides/containerize.html" target="_blank" rel="noopener">Containerizing microservices</a> guide.</p>
</div>
<div class="paragraph">
<p>Start your Docker environment.</p>
</div>
<div class="paragraph">
<p>To build the application, run the Maven <code>install</code> and <code>package</code> goals from the command-line session in the <code>start</code> directory:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl models install
mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the following commands to containerize the microservices:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker build -t system:1.0-SNAPSHOT system/.
docker build -t inventory:1.0-SNAPSHOT inventory/.
docker build -t query:1.0-SNAPSHOT query/.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, use the provided script to start the application in Docker containers. The script creates a network for the containers to communicate with each other. It creates containers for Kafka, Zookeeper, and all of the microservices in the project.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>.\scripts\startContainers.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./scripts/startContainers.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The microservices will take some time to become available. See the <a href="http://localhost:9085/health" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9085/health</a> and <a href="http://localhost:9080/health" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/health</a> URLs to confirm that the <code>inventory</code> and <code>query</code> microservices are up and running. Once the microservices are up and running, you can access the application by making requests to the <code>query/systemLoad</code> endpoint at the <a href="http://localhost:9080/query/systemLoad" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9080/query/systemLoad</a> URL.</p>
</div>
<div class="paragraph">
<p>When the service is ready, you see an output similar to the following example. This example was formatted for readability:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>{
    "highest": {
        "hostname":"30bec2b63a96",
        ”systemLoad": 6.1
    },
    "lowest": {
        "hostname":"55ec2b63a96",
        ”systemLoad": 0.1
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON output contains a <code>highest</code> attribute that represents the system with the highest load. Similarly, the <code>lowest</code> attribute represents the system with the lowest load. The JSON output for each of these attributes contains the <code>hostname</code> and <code>systemLoad</code> of the system.</p>
</div>
<div class="paragraph">
<p>When you are done checking out the application, run the following command to stop the <code>query</code> microservice. Leave the <code>system</code> and <code>inventory</code> services running because they will be used when the application is rebuilt later in the guide:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker stop query</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-the-web-client-to-use-an-alternative-reactive-provider">Updating the web client to use an alternative reactive provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although JAX-RS provides the default reactive provider that returns <code>CompletionStage</code> types, you can alternatively use another provider that supports other reactive frameworks like <a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="noopener noreferrer">RxJava</a>. The Apache CXF and Eclipse Jersey projects produce such providers. You’ll now update the web client to use the Jersey reactive provider for RxJava. With this updated reactive provider, you can write clients that use RxJava objects instead of clients that use only the <code>CompletionStage</code> interface. These custom objects provide a simpler and faster way for you to create scalable RESTful services with a <code>CompletionStage</code> interface.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the Maven configuration file.</mark>
<code>query/pom.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>pom.xml</p>
</div>
<div class="listingblock code_column">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers">  1</span><span class="preprocessor">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="line-numbers">  2</span><span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span>
<span class="line-numbers">  3</span>    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span>
<span class="line-numbers">  4</span>    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">  5</span>    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>
<span class="line-numbers">  6</span>
<span class="line-numbers">  7</span>    <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">  8</span>    <span class="tag">&lt;artifactId&gt;</span>query<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">  9</span>    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 10</span>    <span class="tag">&lt;packaging&gt;</span>war<span class="tag">&lt;/packaging&gt;</span>
<span class="line-numbers"> 11</span>
<span class="line-numbers"> 12</span>    <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers"> 13</span>        <span class="tag">&lt;maven.compiler.source&gt;</span>1.8<span class="tag">&lt;/maven.compiler.source&gt;</span>
<span class="line-numbers"> 14</span>        <span class="tag">&lt;maven.compiler.target&gt;</span>1.8<span class="tag">&lt;/maven.compiler.target&gt;</span>
<span class="line-numbers"> 15</span>        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
<span class="line-numbers"> 16</span>        <span class="tag">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.reporting.outputEncoding&gt;</span>
<span class="line-numbers"> 17</span>        <span class="comment">&lt;!-- Liberty configuration --&gt;</span>
<span class="line-numbers"> 18</span>        <span class="tag">&lt;liberty.var.default.http.port&gt;</span>9080<span class="tag">&lt;/liberty.var.default.http.port&gt;</span>
<span class="line-numbers"> 19</span>        <span class="tag">&lt;liberty.var.default.https.port&gt;</span>9443<span class="tag">&lt;/liberty.var.default.https.port&gt;</span>
<span class="line-numbers"> 20</span>    <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers"> 21</span>
<span class="line-numbers"> 22</span>    <span class="tag">&lt;dependencies&gt;</span>
<span class="line-numbers"> 23</span>        <span class="comment">&lt;!-- Provided dependencies --&gt;</span>
<span class="line-numbers"> 24</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 25</span>            <span class="tag">&lt;groupId&gt;</span>jakarta.platform<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 26</span>            <span class="tag">&lt;artifactId&gt;</span>jakarta.jakartaee-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 27</span>            <span class="tag">&lt;version&gt;</span>8.0.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 28</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 29</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 30</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 31</span>            <span class="tag">&lt;groupId&gt;</span>javax.enterprise.concurrent<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 32</span>            <span class="tag">&lt;artifactId&gt;</span>javax.enterprise.concurrent-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 33</span>            <span class="tag">&lt;version&gt;</span>1.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 34</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 35</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 36</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 37</span>            <span class="tag">&lt;groupId&gt;</span>javax.validation<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 38</span>            <span class="tag">&lt;artifactId&gt;</span>validation-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 39</span>            <span class="tag">&lt;version&gt;</span>2.0.1.Final<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 40</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 41</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 42</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 43</span>            <span class="tag">&lt;groupId&gt;</span>org.eclipse.microprofile<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 44</span>            <span class="tag">&lt;artifactId&gt;</span>microprofile<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 45</span>            <span class="tag">&lt;version&gt;</span>3.3<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 46</span>            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers"> 47</span>            <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 48</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 49</span>        <span class="comment">&lt;!-- Required dependencies --&gt;</span>
<span class="line-numbers"> 50</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 51</span>            <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 52</span>            <span class="tag">&lt;artifactId&gt;</span>models<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 53</span>            <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 54</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 55</span>        <span class="comment">&lt;!-- Reactive dependencies --&gt;</span>
<span class="line-numbers"> 56</span>        <span class="comment">&lt;!-- tag::jerseyClient[] --&gt;</span>
<span class="line-numbers"> 57</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 58</span>            <span class="tag">&lt;groupId&gt;</span>org.glassfish.jersey.core<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 59</span>            <span class="tag">&lt;artifactId&gt;</span>jersey-client<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 60</span>            <span class="tag">&lt;version&gt;</span>2.35<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 61</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 62</span>        <span class="comment">&lt;!-- end::jerseyClient[] --&gt;</span>
<span class="line-numbers"> 63</span>        <span class="comment">&lt;!-- tag::jerseyRxjava[] --&gt;</span>
<span class="line-numbers"> 64</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 65</span>            <span class="tag">&lt;groupId&gt;</span>org.glassfish.jersey.ext.rx<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 66</span>            <span class="tag">&lt;artifactId&gt;</span>jersey-rx-client-rxjava<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 67</span>            <span class="tag">&lt;version&gt;</span>2.35<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 68</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 69</span>        <span class="comment">&lt;!-- end::jerseyRxjava[] --&gt;</span>
<span class="line-numbers"> 70</span>        <span class="comment">&lt;!-- tag::jerseyRxjava2[] --&gt;</span>
<span class="line-numbers"> 71</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 72</span>            <span class="tag">&lt;groupId&gt;</span>org.glassfish.jersey.ext.rx<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 73</span>            <span class="tag">&lt;artifactId&gt;</span>jersey-rx-client-rxjava2<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 74</span>            <span class="tag">&lt;version&gt;</span>2.35<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 75</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 76</span>        <span class="comment">&lt;!-- end::jerseyRxjava2[] --&gt;</span>
<span class="line-numbers"> 77</span>        <span class="comment">&lt;!-- For tests --&gt;</span>
<span class="line-numbers"> 78</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 79</span>            <span class="tag">&lt;groupId&gt;</span>org.microshed<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 80</span>            <span class="tag">&lt;artifactId&gt;</span>microshed-testing-liberty<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 81</span>            <span class="tag">&lt;version&gt;</span>0.9.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 82</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 83</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 84</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 85</span>            <span class="tag">&lt;groupId&gt;</span>org.testcontainers<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 86</span>            <span class="tag">&lt;artifactId&gt;</span>mockserver<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 87</span>            <span class="tag">&lt;version&gt;</span>1.16.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 88</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 89</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 90</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 91</span>            <span class="tag">&lt;groupId&gt;</span>org.mock-server<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 92</span>            <span class="tag">&lt;artifactId&gt;</span>mockserver-client-java<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 93</span>            <span class="tag">&lt;version&gt;</span>5.11.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 94</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 95</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 96</span>        <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 97</span>            <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 98</span>            <span class="tag">&lt;artifactId&gt;</span>junit-jupiter<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 99</span>            <span class="tag">&lt;version&gt;</span>5.8.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">100</span>            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers">101</span>        <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">102</span>    <span class="tag">&lt;/dependencies&gt;</span>
<span class="line-numbers">103</span>
<span class="line-numbers">104</span>    <span class="tag">&lt;build&gt;</span>
<span class="line-numbers">105</span>        <span class="tag">&lt;finalName&gt;</span>${project.artifactId}<span class="tag">&lt;/finalName&gt;</span>
<span class="line-numbers">106</span>        <span class="tag">&lt;plugins&gt;</span>
<span class="line-numbers">107</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">108</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">109</span>                <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">110</span>                <span class="tag">&lt;version&gt;</span>3.3.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">111</span>                <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">112</span>                    <span class="tag">&lt;packagingExcludes&gt;</span>pom.xml<span class="tag">&lt;/packagingExcludes&gt;</span>
<span class="line-numbers">113</span>                <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">114</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">115</span>
<span class="line-numbers">116</span>            <span class="comment">&lt;!-- Liberty plugin --&gt;</span>
<span class="line-numbers">117</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">118</span>                <span class="tag">&lt;groupId&gt;</span>io.openliberty.tools<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">119</span>                <span class="tag">&lt;artifactId&gt;</span>liberty-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">120</span>                <span class="tag">&lt;version&gt;</span>3.8.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">121</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">122</span>
<span class="line-numbers">123</span>            <span class="comment">&lt;!-- Plugin to run unit tests --&gt;</span>
<span class="line-numbers">124</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">125</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">126</span>                <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">127</span>                <span class="tag">&lt;version&gt;</span>2.22.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">128</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">129</span>
<span class="line-numbers">130</span>            <span class="comment">&lt;!-- Plugin to run integration tests --&gt;</span>
<span class="line-numbers">131</span>            <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">132</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">133</span>                <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">134</span>                <span class="tag">&lt;version&gt;</span>2.22.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">135</span>                <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers">136</span>                    <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">137</span>                        <span class="tag">&lt;id&gt;</span>integration-test<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">138</span>                        <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">139</span>                            <span class="tag">&lt;goal&gt;</span>integration-test<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">140</span>                        <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">141</span>                    <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">142</span>                    <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">143</span>                        <span class="tag">&lt;id&gt;</span>verify<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">144</span>                        <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">145</span>                            <span class="tag">&lt;goal&gt;</span>verify<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">146</span>                        <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">147</span>                    <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">148</span>                <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers">149</span>            <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">150</span>        <span class="tag">&lt;/plugins&gt;</span>
<span class="line-numbers">151</span>    <span class="tag">&lt;/build&gt;</span>
<span class="line-numbers">152</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=jerseyRxjava file=0">jersey-rx-client-rxjava</code> and <code class="hotspot=jerseyRxjava2 file=0">jersey-rx-client-rxjava2</code> dependencies provide the <code>RxInvokerProvider</code> classes, which are registered to the <code class="hotspot=jerseyClient file=0">jersey-client</code> <code>ClientBuilder</code> class.</p>
</div>
<div class="paragraph">
<p>Update the client to accommodate the custom object types that you are trying to return. You’ll need to register the type of object that you want inside the client invocation.</p>
</div>
<div class="listingblock code_command hotspot file=1">
<div class="content">
<pre><mark>Replace the <code>InventoryClient</code> interface.</mark>
<code>query/src/main/java/io/openliberty/guides/query/client/InventoryClient.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>InventoryClient.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2020 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers">10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers">11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query.client</span>;
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers">16</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers">17</span>
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.RequestScoped</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.GenericType</span>;
<span class="line-numbers">22</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.HttpHeaders</span>;
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="line-numbers">24</span>
<span class="line-numbers">25</span><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="line-numbers">26</span><span class="keyword">import</span> <span class="include">org.glassfish.jersey.client.rx.rxjava.RxObservableInvoker</span>;
<span class="line-numbers">27</span><span class="keyword">import</span> <span class="include">org.glassfish.jersey.client.rx.rxjava.RxObservableInvokerProvider</span>;
<span class="line-numbers">28</span>
<span class="line-numbers">29</span><span class="keyword">import</span> <span class="include">rx.Observable</span>;
<span class="line-numbers">30</span>
<span class="line-numbers">31</span><span class="annotation">@RequestScoped</span>
<span class="line-numbers">32</span><span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryClient</span> {
<span class="line-numbers">33</span>
<span class="line-numbers">34</span>    <span class="annotation">@Inject</span>
<span class="line-numbers">35</span>    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">INVENTORY_BASE_URI</span><span class="delimiter">"</span></span>, defaultValue = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9085</span><span class="delimiter">"</span></span>)
<span class="line-numbers">36</span>    <span class="directive">private</span> <span class="predefined-type">String</span> baseUri;
<span class="line-numbers">37</span>
<span class="line-numbers">38</span>    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getSystems() {
<span class="line-numbers">39</span>        <span class="keyword">return</span> ClientBuilder.newClient()
<span class="line-numbers">40</span>                            .target(baseUri)
<span class="line-numbers">41</span>                            .path(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers">42</span>                            .request()
<span class="line-numbers">43</span>                            .header(HttpHeaders.CONTENT_TYPE,
<span class="line-numbers">44</span>                            MediaType.APPLICATION_JSON)
<span class="line-numbers">45</span>                            .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;&gt;() { });
<span class="line-numbers">46</span>    }
<span class="line-numbers">47</span>
<span class="line-numbers">48</span>    <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers">49</span>    <span class="directive">public</span> <span class="predefined-type">Observable</span>&lt;<span class="predefined-type">Properties</span>&gt; getSystem(<span class="predefined-type">String</span> hostname) {
<span class="line-numbers">50</span>        <span class="keyword">return</span> ClientBuilder.newClient()
<span class="line-numbers">51</span>                            .target(baseUri)
<span class="line-numbers">52</span>                            <span class="comment">// tag::register[]</span>
<span class="line-numbers">53</span>                            .register(RxObservableInvokerProvider.class)
<span class="line-numbers">54</span>                            <span class="comment">// end::register[]</span>
<span class="line-numbers">55</span>                            .path(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers">56</span>                            .path(hostname)
<span class="line-numbers">57</span>                            .request()
<span class="line-numbers">58</span>                            .header(HttpHeaders.CONTENT_TYPE,
<span class="line-numbers">59</span>                            MediaType.APPLICATION_JSON)
<span class="line-numbers">60</span>                            <span class="comment">// tag::rx[]</span>
<span class="line-numbers">61</span>                            .rx(RxObservableInvoker.class)
<span class="line-numbers">62</span>                            <span class="comment">// end::rx[]</span>
<span class="line-numbers">63</span>                            .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">Properties</span>&gt;() { });
<span class="line-numbers">64</span>    }
<span class="line-numbers">65</span>    <span class="comment">// end::getSystem[]</span>
<span class="line-numbers">66</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The return type of the <code class="hotspot=getSystem file=1">getSystem()</code> method is now an <code>Observable</code> object instead of a <code>CompletionStage</code> interface. <a href="http://reactivex.io/RxJava/javadoc/io/reactivex/Observable.html" target="_blank" rel="noopener noreferrer">Observable</a> is a collection of data that waits to be subscribed to before it can release any data and is part of RxJava. The <code class="hotspot=rx file=1">rx()</code> method now needs to contain <code>RxObservableInvoker.class</code> as an argument. This argument calls the specific invoker, <code>RxObservableInvoker</code>, for the <code>Observable</code> class that’s provided by Jersey. In the <code class="hotspot=getSystem file=1">getSystem()</code> method,the <code class="hotspot=register file=1">register(RxObservableInvokerProvider)</code> method call registers the <code>RxObservableInvoker</code> class,which means that the client can recognize the invoker provider.</p>
</div>
<div class="paragraph">
<p>In some scenarios, a producer might generate more data than the consumers can handle. JAX-RS can deal with cases like these by using the RxJava <code>Flowable</code> class with backpressure. To learn more about RxJava and backpressure, see <a href="https://openliberty.io/blog/2019/04/10/jaxrs-reactive-extensions.html" target="_blank" rel="noopener">JAX-RS reactive extensions with RxJava backpressure</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-the-rest-resource-to-support-the-reactive-jax-rs-client">Updating the REST resource to support the reactive JAX-RS client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the client methods return the <code>Observable</code> class, you must update the resource to accommodate these changes.</p>
</div>
<div class="listingblock code_command hotspot file=0">
<div class="content">
<pre><mark>Replace the <code>QueryResource</code> class.</mark>
<code>query/src/main/java/io/openliberty/guides/query/QueryResource.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>QueryResource.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2020 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers"> 10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers"> 11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">io.openliberty.guides.query</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">java.util.concurrent.ConcurrentHashMap</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">java.util.concurrent.CountDownLatch</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="line-numbers"> 22</span>
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">javax.enterprise.context.ApplicationScoped</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">javax.ws.rs.GET</span>;
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Path</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">javax.ws.rs.Produces</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 29</span>
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.query.client.InventoryClient</span>;
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span><span class="annotation">@ApplicationScoped</span>
<span class="line-numbers"> 33</span><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/query</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 34</span><span class="directive">public</span> <span class="type">class</span> <span class="class">QueryResource</span> {
<span class="line-numbers"> 35</span>    
<span class="line-numbers"> 36</span>    <span class="annotation">@Inject</span>
<span class="line-numbers"> 37</span>    <span class="directive">private</span> InventoryClient inventoryClient;
<span class="line-numbers"> 38</span>
<span class="line-numbers"> 39</span>    <span class="comment">// tag::systemload[]</span>
<span class="line-numbers"> 40</span>    <span class="annotation">@GET</span>
<span class="line-numbers"> 41</span>    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">"</span><span class="content">/systemLoad</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 42</span>    <span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="line-numbers"> 43</span>    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; systemLoad() {
<span class="line-numbers"> 44</span>        <span class="comment">// tag::getSystems[]</span>
<span class="line-numbers"> 45</span>        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; systems = inventoryClient.getSystems();
<span class="line-numbers"> 46</span>        <span class="comment">// end::getSystems[]</span>
<span class="line-numbers"> 47</span>        <span class="comment">// tag::countdownlatch[]</span>
<span class="line-numbers"> 48</span>        <span class="predefined-type">CountDownLatch</span> remainingSystems = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(systems.size());
<span class="line-numbers"> 49</span>        <span class="comment">// end::countdownlatch[]</span>
<span class="line-numbers"> 50</span>        <span class="comment">// tag::holder[]</span>
<span class="line-numbers"> 51</span>        <span class="directive">final</span> Holder systemLoads = <span class="keyword">new</span> Holder();
<span class="line-numbers"> 52</span>        <span class="comment">// end::holder[]</span>
<span class="line-numbers"> 53</span>        <span class="keyword">for</span> (<span class="predefined-type">String</span> system : systems) {
<span class="line-numbers"> 54</span>            <span class="comment">// tag::getSystem[]</span>
<span class="line-numbers"> 55</span>            inventoryClient.getSystem(system)
<span class="line-numbers"> 56</span>            <span class="comment">// end::getSystem[]</span>
<span class="line-numbers"> 57</span>                            <span class="comment">// tag::subscribe[]</span>
<span class="line-numbers"> 58</span>                           .subscribe(p -&gt; {
<span class="line-numbers"> 59</span>                                <span class="keyword">if</span> (p != <span class="predefined-constant">null</span>) {
<span class="line-numbers"> 60</span>                                    systemLoads.updateValues(p);
<span class="line-numbers"> 61</span>                                }
<span class="line-numbers"> 62</span>                                <span class="comment">// tag::countdown[]</span>
<span class="line-numbers"> 63</span>                                remainingSystems.countDown();
<span class="line-numbers"> 64</span>                                <span class="comment">// end::countdown[]</span>
<span class="line-numbers"> 65</span>                           }, e -&gt; {
<span class="line-numbers"> 66</span>                                <span class="comment">// tag::countdown2[]</span>
<span class="line-numbers"> 67</span>                                remainingSystems.countDown();
<span class="line-numbers"> 68</span>                                <span class="comment">// end::countdown2[]</span>
<span class="line-numbers"> 69</span>                                e.printStackTrace();
<span class="line-numbers"> 70</span>                           });
<span class="line-numbers"> 71</span>                           <span class="comment">// end::subscribe[]</span>
<span class="line-numbers"> 72</span>        }
<span class="line-numbers"> 73</span>
<span class="line-numbers"> 74</span>        <span class="comment">// Wait for all remaining systems to be checked</span>
<span class="line-numbers"> 75</span>        <span class="keyword">try</span> {
<span class="line-numbers"> 76</span>            <span class="comment">// tag::await[]</span>
<span class="line-numbers"> 77</span>            remainingSystems.await(<span class="integer">30</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
<span class="line-numbers"> 78</span>            <span class="comment">// end::await[]</span>
<span class="line-numbers"> 79</span>        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
<span class="line-numbers"> 80</span>            e.printStackTrace();
<span class="line-numbers"> 81</span>        }
<span class="line-numbers"> 82</span>        
<span class="line-numbers"> 83</span>        <span class="keyword">return</span> systemLoads.getValues();
<span class="line-numbers"> 84</span>    }
<span class="line-numbers"> 85</span>    <span class="comment">// end::systemload[]</span>
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>    <span class="comment">// tag::holderClass[]</span>
<span class="line-numbers"> 88</span>    <span class="directive">private</span> <span class="type">class</span> <span class="class">Holder</span> {
<span class="line-numbers"> 89</span>        <span class="comment">// tag::volatile[]</span>
<span class="line-numbers"> 90</span>        <span class="directive">private</span> <span class="directive">volatile</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; values;
<span class="line-numbers"> 91</span>        <span class="comment">// end::volatile[]</span>
<span class="line-numbers"> 92</span>
<span class="line-numbers"> 93</span>        <span class="directive">public</span> Holder() {
<span class="line-numbers"> 94</span>            <span class="comment">// tag::concurrentHashMap[]</span>
<span class="line-numbers"> 95</span>            <span class="local-variable">this</span>.values = <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt;();
<span class="line-numbers"> 96</span>            <span class="comment">// end::concurrentHashMap[]</span>
<span class="line-numbers"> 97</span>            init();
<span class="line-numbers"> 98</span>        }
<span class="line-numbers"> 99</span>
<span class="line-numbers">100</span>        <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; getValues() {
<span class="line-numbers">101</span>            <span class="keyword">return</span> <span class="local-variable">this</span>.values;
<span class="line-numbers">102</span>        }
<span class="line-numbers">103</span>
<span class="line-numbers">104</span>        <span class="comment">// tag::updateValues[]</span>
<span class="line-numbers">105</span>        <span class="directive">public</span> <span class="type">void</span> updateValues(<span class="predefined-type">Properties</span> p) {
<span class="line-numbers">106</span>            <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> load = (<span class="predefined-type">BigDecimal</span>) p.get(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>);
<span class="line-numbers">107</span>
<span class="line-numbers">108</span>            <span class="local-variable">this</span>.values.computeIfPresent(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>, (key, curr_val) -&gt; {
<span class="line-numbers">109</span>                <span class="predefined-type">BigDecimal</span> lowest = (<span class="predefined-type">BigDecimal</span>) curr_val.get(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>);
<span class="line-numbers">110</span>                <span class="keyword">return</span> load.compareTo(lowest) &lt; <span class="integer">0</span> ? p : curr_val;
<span class="line-numbers">111</span>            });
<span class="line-numbers">112</span>            <span class="local-variable">this</span>.values.computeIfPresent(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>, (key, curr_val) -&gt; {
<span class="line-numbers">113</span>                <span class="predefined-type">BigDecimal</span> highest = (<span class="predefined-type">BigDecimal</span>) curr_val.get(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>);
<span class="line-numbers">114</span>                <span class="keyword">return</span> load.compareTo(highest) &gt; <span class="integer">0</span> ? p : curr_val;
<span class="line-numbers">115</span>            });
<span class="line-numbers">116</span>        }
<span class="line-numbers">117</span>        <span class="comment">// end::updateValues[]</span>
<span class="line-numbers">118</span>
<span class="line-numbers">119</span>        <span class="directive">private</span> <span class="type">void</span> init() {
<span class="line-numbers">120</span>            <span class="comment">// Initialize highest and lowest values</span>
<span class="line-numbers">121</span>            <span class="local-variable">this</span>.values.put(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">Properties</span>());
<span class="line-numbers">122</span>            <span class="local-variable">this</span>.values.put(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">Properties</span>());
<span class="line-numbers">123</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">temp_max</span><span class="delimiter">"</span></span>);
<span class="line-numbers">124</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">temp_min</span><span class="delimiter">"</span></span>);
<span class="line-numbers">125</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="predefined-type">Double</span>.MIN_VALUE));
<span class="line-numbers">126</span>            <span class="local-variable">this</span>.values.get(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>).put(<span class="string"><span class="delimiter">"</span><span class="content">systemLoad</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="predefined-type">Double</span>.MAX_VALUE));
<span class="line-numbers">127</span>        }
<span class="line-numbers">128</span>    }
<span class="line-numbers">129</span>    <span class="comment">// end::holderClass[]</span>
<span class="line-numbers">130</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The goal of the <code class="hotspot=systemload file=0">systemLoad()</code> method is to return the system with the largest load and the system with the smallest load. The <code>systemLoad</code> endpoint first gets all of the hostnames by calling the <code class="hotspot=getSystems file=0">getSystems()</code> method.  Then it loops through the hostnames and calls the <code class="hotspot=getSystem file=0">getSystem()</code> method on each one.</p>
</div>
<div class="paragraph">
<p>Instead of using the <code>thenAcceptAsync()</code> method, <code>Observable</code> uses the <code class="hotspot=subscribe file=0">subscribe()</code> method to asynchronously process data. Thus, any necessary data processing happens inside the <code>subscribe()</code> method. In this case, the necessary data processing is saving the data in the temporary <code class="hotspot=holderClass file=0">Holder</code> class. The <code>Holder</code> class is used to store the value that is returned from the client because values cannot be returned inside the <code>subscribe()</code> method.  The highest and lowest load systems are updated in the <code class="hotspot=updateValues file=0">updateValues()</code> method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rebuilding-and-running-the-application">Rebuilding and running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the Maven <code>install</code> and <code>package</code> goals from the command-line session in the <code>start</code> directory:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>mvn -pl query package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the following command to containerize the <code>query</code> microservice:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>docker build -t query:1.0-SNAPSHOT query/.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, use the provided script to restart the query service in a Docker container.</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>.\scripts\startQueryContainer.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./scripts/startQueryContainer.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://localhost:9080/health" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/health</a> URL to confirm that the <code>query</code> microservice is up and running. Once the <code>query</code> microservice is up and running, you can access the application by making requests to the <code>query/systemLoad</code> endpoint at the <a href="http://localhost:9080/query/systemLoad" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9080/query/systemLoad</a> URL.</p>
</div>
<div class="paragraph">
<p>Switching to a reactive programming model freed up the thread that was handling your request to <code>query/systemLoad</code>. While the client request is being handled, the thread can handle other work.</p>
</div>
<div class="paragraph">
<p>When you are done checking out the application, run the following script to stop the application:</p>
</div>
<div class="paragraph tab_link windows_link">
<p><code><strong>WINDOWS</strong></code></p>
</div>
<div class="paragraph tab_link mac_link">
<p><code><strong>MAC</strong></code></p>
</div>
<div class="paragraph tab_link linux_link">
<p><code><strong>LINUX</strong></code></p>
</div>
<div class="openblock tab_content windows_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>.\scripts\stopContainers.bat</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock tab_content mac_section linux_section">
<div class="content">
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>./scripts/stopContainers.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-query-microservice">Testing the query microservice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A few tests are included for you to test the basic functionality of the <code>query</code> microservice. If a test failure occurs, then you might have introduced a bug into the code.</p>
</div>
<div class="listingblock code_command hotspot">
<div class="content">
<pre><mark>Create the <code>QueryServiceIT</code> class.</mark>
<code>query/src/test/java/it/io/openliberty/guides/query/QueryServiceIT.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>QueryServiceIT.java</p>
</div>
<div class="listingblock code_column hide_tags=copyright">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2020 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers"> 10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers"> 11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.query</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="line-numbers"> 16</span>
<span class="line-numbers"> 17</span><span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">java.util.Properties</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">org.microshed.testing.jaxrs.RESTClient</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">org.microshed.testing.jupiter.MicroShedTest</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">org.microshed.testing.SharedContainerConfig</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">org.mockserver.model.HttpRequest</span>;
<span class="line-numbers"> 25</span><span class="keyword">import</span> <span class="include">org.mockserver.model.HttpResponse</span>;
<span class="line-numbers"> 26</span>
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">io.openliberty.guides.query.QueryResource</span>;
<span class="line-numbers"> 28</span>
<span class="line-numbers"> 29</span><span class="annotation">@MicroShedTest</span>
<span class="line-numbers"> 30</span><span class="annotation">@SharedContainerConfig</span>(AppContainerConfig.class)
<span class="line-numbers"> 31</span><span class="directive">public</span> <span class="type">class</span> <span class="class">QueryServiceIT</span> {
<span class="line-numbers"> 32</span>
<span class="line-numbers"> 33</span>    <span class="annotation">@RESTClient</span>
<span class="line-numbers"> 34</span>    <span class="directive">public</span> <span class="directive">static</span> QueryResource queryResource;
<span class="line-numbers"> 35</span>
<span class="line-numbers"> 36</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> testHost1 = 
<span class="line-numbers"> 37</span>        <span class="string"><span class="delimiter">"</span><span class="content">{</span><span class="delimiter">"</span></span> + 
<span class="line-numbers"> 38</span>            <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">hostname</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="content">testHost1</span><span class="char">\"</span><span class="content">,</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 39</span>            <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">systemLoad</span><span class="char">\"</span><span class="content"> : 1.23</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 40</span>        <span class="string"><span class="delimiter">"</span><span class="content">}</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 41</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> testHost2 = 
<span class="line-numbers"> 42</span>        <span class="string"><span class="delimiter">"</span><span class="content">{</span><span class="delimiter">"</span></span> + 
<span class="line-numbers"> 43</span>            <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">hostname</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="content">testHost2</span><span class="char">\"</span><span class="content">,</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 44</span>            <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">systemLoad</span><span class="char">\"</span><span class="content"> : 3.21</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 45</span>        <span class="string"><span class="delimiter">"</span><span class="content">}</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 46</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> testHost3 =
<span class="line-numbers"> 47</span>        <span class="string"><span class="delimiter">"</span><span class="content">{</span><span class="delimiter">"</span></span> + 
<span class="line-numbers"> 48</span>            <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">hostname</span><span class="char">\"</span><span class="content"> : </span><span class="char">\"</span><span class="content">testHost3</span><span class="char">\"</span><span class="content">,</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 49</span>            <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">systemLoad</span><span class="char">\"</span><span class="content"> : 2.13</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 50</span>        <span class="string"><span class="delimiter">"</span><span class="content">}</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 51</span>
<span class="line-numbers"> 52</span>    <span class="annotation">@BeforeAll</span>
<span class="line-numbers"> 53</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setup() <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
<span class="line-numbers"> 54</span>        AppContainerConfig.mockClient.when(HttpRequest.request()
<span class="line-numbers"> 55</span>                                         .withMethod(<span class="string"><span class="delimiter">"</span><span class="content">GET</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 56</span>                                         .withPath(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems</span><span class="delimiter">"</span></span>))
<span class="line-numbers"> 57</span>                                     .respond(HttpResponse.response()
<span class="line-numbers"> 58</span>                                         .withStatusCode(<span class="integer">200</span>)
<span class="line-numbers"> 59</span>                                         .withBody(<span class="string"><span class="delimiter">"</span><span class="content">[</span><span class="char">\"</span><span class="content">testHost1</span><span class="char">\"</span><span class="content">,</span><span class="delimiter">"</span></span> + 
<span class="line-numbers"> 60</span>                                                    <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">testHost2</span><span class="char">\"</span><span class="content">,</span><span class="delimiter">"</span></span> +
<span class="line-numbers"> 61</span>                                                    <span class="string"><span class="delimiter">"</span><span class="char">\"</span><span class="content">testHost3</span><span class="char">\"</span><span class="content">]</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 62</span>                                         .withHeader(<span class="string"><span class="delimiter">"</span><span class="content">Content-Type</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">application/json</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 63</span>
<span class="line-numbers"> 64</span>        AppContainerConfig.mockClient.when(HttpRequest.request()
<span class="line-numbers"> 65</span>                                         .withMethod(<span class="string"><span class="delimiter">"</span><span class="content">GET</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 66</span>                                         .withPath(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems/testHost1</span><span class="delimiter">"</span></span>))
<span class="line-numbers"> 67</span>                                     .respond(HttpResponse.response()
<span class="line-numbers"> 68</span>                                         .withStatusCode(<span class="integer">200</span>)
<span class="line-numbers"> 69</span>                                         .withBody(testHost1)
<span class="line-numbers"> 70</span>                                         .withHeader(<span class="string"><span class="delimiter">"</span><span class="content">Content-Type</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">application/json</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 71</span>
<span class="line-numbers"> 72</span>        AppContainerConfig.mockClient.when(HttpRequest.request()
<span class="line-numbers"> 73</span>                                         .withMethod(<span class="string"><span class="delimiter">"</span><span class="content">GET</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 74</span>                                         .withPath(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems/testHost2</span><span class="delimiter">"</span></span>))
<span class="line-numbers"> 75</span>                                     .respond(HttpResponse.response()
<span class="line-numbers"> 76</span>                                         .withStatusCode(<span class="integer">200</span>)
<span class="line-numbers"> 77</span>                                         .withBody(testHost2)
<span class="line-numbers"> 78</span>                                         .withHeader(<span class="string"><span class="delimiter">"</span><span class="content">Content-Type</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">application/json</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 79</span>
<span class="line-numbers"> 80</span>        AppContainerConfig.mockClient.when(HttpRequest.request()
<span class="line-numbers"> 81</span>                                         .withMethod(<span class="string"><span class="delimiter">"</span><span class="content">GET</span><span class="delimiter">"</span></span>)
<span class="line-numbers"> 82</span>                                         .withPath(<span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems/testHost3</span><span class="delimiter">"</span></span>))
<span class="line-numbers"> 83</span>                                     .respond(HttpResponse.response()
<span class="line-numbers"> 84</span>                                         .withStatusCode(<span class="integer">200</span>)
<span class="line-numbers"> 85</span>                                         .withBody(testHost3)
<span class="line-numbers"> 86</span>                                         .withHeader(<span class="string"><span class="delimiter">"</span><span class="content">Content-Type</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">application/json</span><span class="delimiter">"</span></span>));
<span class="line-numbers"> 87</span>    }
<span class="line-numbers"> 88</span>
<span class="line-numbers"> 89</span>    <span class="comment">// tag::testSystemLoad[]</span>
<span class="line-numbers"> 90</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 91</span>    <span class="directive">public</span> <span class="type">void</span> testSystemLoad() {
<span class="line-numbers"> 92</span>        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Properties</span>&gt; response = queryResource.systemLoad();
<span class="line-numbers"> 93</span>        assertEquals(
<span class="line-numbers"> 94</span>            <span class="string"><span class="delimiter">"</span><span class="content">testHost2</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 95</span>            response.get(<span class="string"><span class="delimiter">"</span><span class="content">highest</span><span class="delimiter">"</span></span>).get(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>),
<span class="line-numbers"> 96</span>            <span class="string"><span class="delimiter">"</span><span class="content">Returned highest system load incorrect</span><span class="delimiter">"</span></span>
<span class="line-numbers"> 97</span>        );
<span class="line-numbers"> 98</span>        assertEquals(
<span class="line-numbers"> 99</span>            <span class="string"><span class="delimiter">"</span><span class="content">testHost1</span><span class="delimiter">"</span></span>,
<span class="line-numbers">100</span>            response.get(<span class="string"><span class="delimiter">"</span><span class="content">lowest</span><span class="delimiter">"</span></span>).get(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>),
<span class="line-numbers">101</span>            <span class="string"><span class="delimiter">"</span><span class="content">Returned lowest system load incorrect</span><span class="delimiter">"</span></span>
<span class="line-numbers">102</span>        );
<span class="line-numbers">103</span>    }
<span class="line-numbers">104</span>    <span class="comment">// end::testSystemLoad[]</span>
<span class="line-numbers">105</span>
<span class="line-numbers">106</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="hotspot=testSystemLoad file=0">testSystemLoad()</code> test case verifies that the <code>query</code> service can correctly calculate the highest and lowest system loads.</p>
</div>
<div class="sect2">
<h3 id="running-the-tests">Running the tests</h3>
<div class="paragraph">
<p>Navigate to the <code>query</code> directory, then verify that the tests pass by running the Maven <code>verify</code> goal:</p>
</div>
<div class="listingblock command">
<div class="content">
<pre class="CodeRay highlight"><code>cd query
mvn verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the tests succeed, you see output similar to the following example:</p>
</div>
<div class="listingblock no_copy">
<div class="content">
<pre class="CodeRay highlight"><code>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.query.QueryServiceIT
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.88 s - in it.io.openliberty.guides.query.QueryServiceIT

Results:

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="great-work-youre-done">Great work! You’re done!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You modified an application to make HTTP requests by using a reactive JAX-RS client with Open Liberty and Jersey’s RxJava provider.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-attribution">Guide Attribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consuming RESTful services using the reactive JAX-RS client <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p>
</div>
</div>
</div>
    </div>
  </div>

  <!-- Code section -->
  <div id="code_column" class="position_relative" tabindex="0">
    <div id="code_column_title_container">
      <div id="code_column_tabs_container" class="dimmed">
        <ul id="code_column_tabs" class="nav" role="tablist"></ul>
      </div>
      <div class="copyFileButton" tabindex="0">
        <img src="/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents">
        <div id="code_section_copied_confirmation">Copied to clipboard </div>
      </div>
    </div>
    <div id="code_column_content"></div>

    <div id="prereqs_container">
      <p id="prereqs_title">Prerequisites:</p>
      <div class="prereqs_list"></div>
      <div class="skills_network_container">
        <div class="skills_network_description"></div>
      </div>
    </div>

    <button id="dismiss_button" aria-label="Back to text" tabindex="0">
      Back to text
    </button>
  </div>
</div>

<!-- Build a list of all the documents in the guides code base -->






<!-- Remove any documents deemed private (archived, templates, etc) -->


<!-- Count number of guides from past 30 days-->


    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    

    
    
    

    <!-- 2592000 is 30 days in seconds (30 days * 24 hours * 60 minutes * 60 seconds) -->
    


<!-- Sort list of guides by date with most recent first -->





<div id="end_of_guide">
        <h2 tabindex="0">Nice work! Where to next?</h2>
        <div id="end_of_guide_left_section">
            <p id="guide_attribution"></p>
            
            <h3 id="feedback_rating_question">What did you think of this guide?</h3>
            <div id="feedback_ratings">
                <img class="guide_rating" id="extreme_dislike" src="/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike">
                <img class="guide_rating" id="dislike" src="/img/2_Dislike.png" onclick="$('#dislike_popup').show(); $('.popup_content').focus();" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike">
                <img class="guide_rating" id="like" src="/img/3_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like">
                <img class="guide_rating" id="extreme_like" src="/img/4_Extreme_Like.png" onclick="$('#like_popup').show(); $('.popup_content').focus();" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like">
            </div>

            <div id="like_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <button id="close_button" class="popup_button" onclick="$('#like_popup').hide();">Close</button>
                </div>
            </div>

            <div id="dislike_popup" class="popup">
                <div class="popup_content" tabindex="0">
                    <p class="popup_title">Thank you for your feedback!</p>
                    <p id="open_issue">Would you like to open an issue in GitHub?</p>
                    
                        <a href="https://github.com/OpenLiberty/guide-reactive-rest-client/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide();" rel="noopener noreferrer">Yes</a>
                    
                    <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide();">No, thank you</button>
                </div>
            </div>

            <h3 id="improve_guide_feedback">What could make this guide better?</h3>
            
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-reactive-rest-client/issues">Raise an issue</a> to share feedback</p>
                <p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-reactive-rest-client/pulls">Create a pull request</a> to contribute to this guide</p>
            

            <h3 id="need_help">Need help?</h3>
            <p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p>

            <h3>Like Open Liberty? Star our repo on GitHub.</h3>
            <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a>
        </div>
        <div id="end_of_guide_right_section">
            <h3 id="where_to_next">Where to next?</h3>

            
            

            <!-- Related guides section -->
            
            <div id="related-guides">
                <div id="related-guides-cards" class="row">
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-reactive-messaging.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Creating reactive Java microservices</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">20 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                    
                    
                    
                        <!-- Only create a card if we find the permalink -->
                        
                        <div class="col-sm-12 col-lg-6">
                            <a href="/zh-Hans/guides/microprofile-rest-client-async.html" class="small_guide_item">
                                <div class="guide_title_container">
                                    <h3 class="guide_title">Consuming RESTful services asynchronously with template interfaces</h3>
                                </div>
                                <img class="duration_clock_icon" src="/img/guide_duration_clock_icon_small.svg" alt="Duration">
                                <span class="guide_duration">15 minutes</span>

                                <!-- Add New flag to guides from the past 30 days or 4 most recent posts. -->
                                <!-- If new posts count is less than 4, use 4 most recent posts -->
                                
                                    
                                <!-- If new posts count is >= 4, use posts from last 30 days-->
                                
                                <!-- Add Updated flag to guides if the last major update is within last 12 weeks. -->
                                <!-- Count number of guides from past last 12 weeks that is 84 days-->
                                <!-- 7257600 is 84 days in seconds (84 days * 24 hours * 60 minutes * 60 seconds) -->
                                
                                
                            </a>
                        </div>
                    
                
                </div>
            </div>
            
        </div>
    </div>



    </main>

    



<footer>
    <div id="footer_gray_background">
        <div id="footer_top_container" class="footer_container container-fluid">
            <div id="footer_project_container">
                <span id="footer_open_liberty"></span>
                <p id="footer_project">IBM 开放式源代码项目</p>
            </div>
            <div id="footer_round_links_container">
                <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a>
                <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a>
                <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a>
                <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a>
                <a id="footer_gitter_link" class="footer_round_btn" href="https://app.gitter.im/#/room/#OpenLiberty_development:gitter.im" target="_blank" rel="noopener" aria-label="Open Liberty Gitter"></a>
            </div>
        </div>         
    </div>

    <div id="footer_bottom_container" class="footer_container container-fluid">
        <div id="footer_bottom_left_section">
            <p id="footer_copyright">© Copyright IBM Corp. 2017, 2023</p>
            <p class="vertical_bar">|</p>
            <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">隐私策略</a>
            <p class="vertical_bar">|</p>
            <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/release/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">许可证</a>
            <p class="vertical_bar">|</p>
            <a id="footer_logos_link" href="https://github.com/OpenLiberty/logos" target="_blank" rel="noopener noreferrer" class="left_footer_link">洛戈斯</a>
        </div>
        <div id="footer_bottom_right_section">
            <a id="footer_docs_link" href="/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">文档</a>
            <a id="footer_blog_link" href="/blog" aria-label="Open Liberty Blog" class="right_footer_link blue_link_light_background">博客</a>
            <a id="footer_support_link" href="/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">支持</a>
        </div>
    </div>
</footer>

<!-- PRE-LOADED IMAGES FOR ON HOVER BEHAVIOR -->
<div class="d-none hidden">
    <img src="/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link">
    <img src="/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link">
    <img src="/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link">
    <img src="/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link">
    <img src="/img/footer_gitter_hover.svg" alt="Openliberty Gitter link">
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<script type="text/javascript" src="/zh-Hans/assets/devEnvironment.js"></script>




  <script type="text/javascript" src="/zh-Hans/assets/guide-common.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/toc.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/tabs.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-static.js"></script>

  <script type="text/javascript" src="/zh-Hans/assets/guide-multipane-static.js"></script>


<script type="text/javascript" src="/zh-Hans/assets/openliberty.js"></script>

  </body>

</html>
